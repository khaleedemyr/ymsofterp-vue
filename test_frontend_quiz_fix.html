<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Frontend Quiz Fix</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; border-radius: 5px; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        select, input { width: 100%; padding: 8px; margin-bottom: 10px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px; }
        .error { background: #f8d7da; color: #721c24; }
        .success { background: #d4edda; color: #155724; }
    </style>
</head>
<body>
    <h1>Test Frontend Quiz & Questionnaire Fix</h1>
    
    <div class="test-section">
        <h2>Test Quiz Selection</h2>
        <div class="form-group">
            <label>Item Type:</label>
            <select id="quizItemType" onchange="onItemTypeChange('quiz')">
                <option value="">Select type...</option>
                <option value="quiz">Quiz</option>
                <option value="questionnaire">Questionnaire</option>
                <option value="material">Material</option>
            </select>
        </div>
        
        <div id="quizSelection" style="display: none;">
            <div class="form-group">
                <label>Select Quiz:</label>
                <select id="quizSelect">
                    <option value="">Choose quiz...</option>
                    <option value="1">Quiz 1 - Basic Knowledge</option>
                    <option value="2">Quiz 2 - Advanced Concepts</option>
                    <option value="3">Quiz 3 - Final Assessment</option>
                </select>
            </div>
        </div>
        
        <div id="questionnaireSelection" style="display: none;">
            <div class="form-group">
                <label>Select Questionnaire:</label>
                <select id="questionnaireSelect">
                    <option value="">Choose questionnaire...</option>
                    <option value="1">Questionnaire 1 - Feedback</option>
                    <option value="2">Questionnaire 2 - Evaluation</option>
                    <option value="3">Questionnaire 3 - Survey</option>
                </select>
            </div>
        </div>
        
        <div class="form-group">
            <label>Title:</label>
            <input type="text" id="itemTitle" placeholder="Enter title...">
        </div>
        
        <div class="form-group">
            <label>Description:</label>
            <input type="text" id="itemDescription" placeholder="Enter description...">
        </div>
        
        <button onclick="testDataStructure()">Test Data Structure</button>
        <button onclick="testFormData()">Test FormData</button>
    </div>
    
    <div id="result" class="result" style="display: none;"></div>

    <script>
        // Simulate the form structure from Vue component
        let formData = {
            sessions: [{
                order_number: 1,
                session_title: "Test Session",
                session_description: "Test Description",
                estimated_duration_minutes: 60,
                items: []
            }]
        };
        
        let currentItem = {
            order_number: 1,
            item_type: '',
            item_id: '',
            quiz_id: '',
            questionnaire_id: '',
            title: '',
            description: '',
            estimated_duration_minutes: 30,
            material_files: []
        };
        
        function onItemTypeChange(type) {
            console.log(`Item type changed to ${type}`);
            
            // Reset item-specific data when type changes
            currentItem.item_id = '';
            currentItem.quiz_id = '';
            currentItem.questionnaire_id = '';
            currentItem.material_files = [];
            
            // Set default title based on type
            if (type === 'quiz') {
                currentItem.title = 'Quiz';
                document.getElementById('quizSelection').style.display = 'block';
                document.getElementById('questionnaireSelection').style.display = 'none';
            } else if (type === 'questionnaire') {
                currentItem.title = 'Kuesioner';
                document.getElementById('quizSelection').style.display = 'none';
                document.getElementById('questionnaireSelection').style.display = 'block';
            } else if (type === 'material') {
                currentItem.title = 'Materi';
                document.getElementById('quizSelection').style.display = 'none';
                document.getElementById('questionnaireSelection').style.display = 'none';
            }
            
            currentItem.item_type = type;
            
            console.log('Reset data:', {
                item_id: currentItem.item_id,
                quiz_id: currentItem.quiz_id,
                questionnaire_id: currentItem.questionnaire_id,
                material_files: currentItem.material_files
            });
        }
        
        // Update current item when selections change
        document.getElementById('quizSelect').addEventListener('change', function() {
            currentItem.quiz_id = this.value;
            console.log('Quiz ID set to:', currentItem.quiz_id);
        });
        
        document.getElementById('questionnaireSelect').addEventListener('change', function() {
            currentItem.questionnaire_id = this.value;
            console.log('Questionnaire ID set to:', currentItem.questionnaire_id);
        });
        
        document.getElementById('itemTitle').addEventListener('input', function() {
            currentItem.title = this.value;
        });
        
        document.getElementById('itemDescription').addEventListener('input', function() {
            currentItem.description = this.value;
        });
        
        function testDataStructure() {
            const result = document.getElementById('result');
            result.style.display = 'block';
            
            let html = '<h3>Current Item Data Structure:</h3>';
            html += '<pre>' + JSON.stringify(currentItem, null, 2) + '</pre>';
            
            // Validate data
            let errors = [];
            let warnings = [];
            
            if (!currentItem.item_type) {
                errors.push('Item type is required');
            }
            
            if (currentItem.item_type === 'quiz' && !currentItem.quiz_id) {
                errors.push('Quiz ID is required for quiz type');
            }
            
            if (currentItem.item_type === 'questionnaire' && !currentItem.questionnaire_id) {
                errors.push('Questionnaire ID is required for questionnaire type');
            }
            
            if (!currentItem.title) {
                warnings.push('Title is empty');
            }
            
            if (errors.length > 0) {
                html += '<div class="error"><strong>Errors:</strong><ul>';
                errors.forEach(error => html += '<li>' + error + '</li>');
                html += '</ul></div>';
            }
            
            if (warnings.length > 0) {
                html += '<div class="error"><strong>Warnings:</strong><ul>';
                warnings.forEach(warning => html += '<li>' + warning + '</li>');
                html += '</ul></div>';
            }
            
            if (errors.length === 0 && warnings.length === 0) {
                html += '<div class="success"><strong>✓ Data structure is valid!</strong></div>';
            }
            
            result.innerHTML = html;
        }
        
        function testFormData() {
            const result = document.getElementById('result');
            result.style.display = 'block';
            
            // Simulate FormData creation
            const formData = new FormData();
            
            // Add session data
            formData.append('sessions[0][order_number]', '1');
            formData.append('sessions[0][session_title]', 'Test Session');
            formData.append('sessions[0][session_description]', 'Test Description');
            formData.append('sessions[0][estimated_duration_minutes]', '60');
            
            // Add item data
            formData.append('sessions[0][items][0][order_number]', currentItem.order_number);
            formData.append('sessions[0][items][0][item_type]', currentItem.item_type);
            formData.append('sessions[0][items][0][item_id]', currentItem.item_id || '');
            formData.append('sessions[0][items][0][title]', currentItem.title || '');
            formData.append('sessions[0][items][0][description]', currentItem.description || '');
            formData.append('sessions[0][items][0][estimated_duration_minutes]', currentItem.estimated_duration_minutes || 0);
            
            // Handle quiz_id for quiz type items
            if (currentItem.item_type === 'quiz' && currentItem.quiz_id) {
                formData.append('sessions[0][items][0][quiz_id]', currentItem.quiz_id);
                console.log(`Added quiz_id for quiz item: ${currentItem.quiz_id}`);
            }
            
            // Handle questionnaire_id for questionnaire type items
            if (currentItem.item_type === 'questionnaire' && currentItem.questionnaire_id) {
                formData.append('sessions[0][items][0][questionnaire_id]', currentItem.questionnaire_id);
                console.log(`Added questionnaire_id for questionnaire item: ${currentItem.questionnaire_id}`);
            }
            
            // Display FormData contents
            let html = '<h3>FormData Contents:</h3>';
            html += '<table border="1" style="border-collapse: collapse; width: 100%;">';
            html += '<tr><th>Key</th><th>Value</th></tr>';
            
            for (let [key, value] of formData.entries()) {
                html += `<tr><td>${key}</td><td>${value}</td></tr>`;
            }
            
            html += '</table>';
            
            // Check if quiz_id or questionnaire_id is present
            let hasQuizId = false;
            let hasQuestionnaireId = false;
            
            for (let [key, value] of formData.entries()) {
                if (key.includes('quiz_id') && value) hasQuizId = true;
                if (key.includes('questionnaire_id') && value) hasQuestionnaireId = true;
            }
            
            html += '<h4>Validation Results:</h4>';
            
            if (currentItem.item_type === 'quiz') {
                if (hasQuizId) {
                    html += '<div class="success">✓ Quiz ID is present in FormData</div>';
                } else {
                    html += '<div class="error">❌ Quiz ID is missing from FormData</div>';
                }
            }
            
            if (currentItem.item_type === 'questionnaire') {
                if (hasQuestionnaireId) {
                    html += '<div class="success">✓ Questionnaire ID is present in FormData</div>';
                } else {
                    html += '<div class="error">❌ Questionnaire ID is missing from FormData</div>';
                }
            }
            
            result.innerHTML = html;
        }
    </script>
</body>
</html>
