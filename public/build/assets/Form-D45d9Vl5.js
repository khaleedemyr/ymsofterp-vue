import{P,r as Q,A as N,B as a,C as w,x as v,D as e,Q as d,U as Y,L as r,E as _,S as O,Z as b,O as k,H as u,G as f,J as m,F as x,M as y,N as c,I,T as H,Y as R,l as Z}from"./vendor-vue-g7iCcTkf.js";import{A as W}from"./AppLayout-DP-q1yH_.js";import{S as D}from"./app-BoyRvw0M.js";import{a as X}from"./vendor-utils-CpgP2uT4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-Cs9EnNrk.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const ee={class:"max-w-5xl mx-auto py-6 px-4 sm:px-6 lg:px-8"},te={class:"mb-6"},se={class:"flex items-center gap-4 mb-4"},oe={class:"bg-white rounded-2xl shadow-xl border border-gray-100 p-6 sm:p-8"},ne={class:"mb-8"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ie=["value"],ae={class:"md:col-span-2"},re={class:"mb-8"},de={class:"overflow-x-auto"},ue={class:"w-full min-w-full"},pe={class:"bg-white divide-y divide-gray-100"},ge={class:"px-4 py-3 min-w-[260px]"},fe={class:"relative"},me=["id","onUpdate:modelValue","onInput","onFocus","onBlur","onKeydown"],ce=["id"],be=["id","onMousedown"],he={class:"font-medium text-gray-900"},xe={class:"text-xs text-gray-500 mt-0.5"},ye={class:"text-sm text-gray-600 font-medium"},we={key:0,class:"absolute right-3 top-1/2 -translate-y-1/2"},ve={class:"px-4 py-3 min-w-[100px]"},_e=["onUpdate:modelValue"],ke={class:"px-4 py-3 min-w-[100px]"},Ie=["onUpdate:modelValue","onChange"],De=["value"],Se=["onUpdate:modelValue"],Be={class:"px-4 py-3 min-w-[120px]"},Ce=["onUpdate:modelValue"],Ve={class:"px-4 py-3 text-center"},je=["onClick","disabled"],Ae={class:"mb-8"},Ue={class:"flex justify-end gap-3 pt-6 border-t border-gray-200"},Te=["disabled"],qe={key:0,class:"animate-spin mr-2 inline-block"},Me={key:1},Ke={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-30"},Ye={__name:"Form",props:{warehouses:Array,items:Array,editData:Object},setup(S){var j,A,U,T,q,M;const g=S;function B(){return{item_id:"",item_name:"",qty:"",available_units:[],selected_unit:"",unit:"",note:"",suggestions:[],showDropdown:!1,loading:!1,highlightedIndex:-1,_rowKey:Date.now()+"-"+Math.random()}}const o=P({date:((j=g.editData)==null?void 0:j.date)||new Date().toISOString().slice(0,10),warehouse_id:((A=g.editData)==null?void 0:A.warehouse_id)||"",type:((U=g.editData)==null?void 0:U.type)||"",items:(q=(T=g.editData)==null?void 0:T.items)!=null&&q.length?JSON.parse(JSON.stringify(g.editData.items)):[B()],reason:((M=g.editData)==null?void 0:M.reason)||""}),p=Q(!1);function $(){o.items.push(B())}function z(l){o.items.length!==1&&o.items.splice(l,1)}async function F(l,t){if(!t||t.length<2||!o.warehouse_id){o.items[l].suggestions=[],o.items[l].highlightedIndex=-1;return}o.items[l].loading=!0;try{const s=await X.get("/items/search-for-warehouse-transfer",{params:{q:t,warehouse_id:o.warehouse_id}});let i=Array.isArray(s.data)?s.data:[];o.items[l].suggestions=i.map(n=>({...n,available_units:[n.unit_small,n.unit_medium,n.unit_large].filter(Boolean),unit_small:n.unit_small,unit_medium:n.unit_medium,unit_large:n.unit_large,small_unit_id:n.small_unit_id,medium_unit_id:n.medium_unit_id,large_unit_id:n.large_unit_id})),o.items[l].showDropdown=!0,o.items[l].highlightedIndex=0}catch{o.items[l].suggestions=[],o.items[l].highlightedIndex=-1}finally{o.items[l].loading=!1}}function C(l,t){o.items[l].item_id=t.id,o.items[l].item_name=t.name,o.items[l].unit=t.unit_small||t.unit||"",o.items[l].selected_unit=t.unit_small||t.unit||"",o.items[l].available_units=[t.unit_small,t.unit_medium,t.unit_large].filter(Boolean),o.items[l].suggestions=[],o.items[l].showDropdown=!1,o.items[l].highlightedIndex=-1}function V(l,t){const s=t.target.value;o.items[l].item_id="",o.items[l].item_name=s,o.items[l].showDropdown=!0,F(l,s)}function G(l){setTimeout(()=>{o.items[l].showDropdown=!1},200)}function h(l,t){const s=o.items[l];!s.showDropdown||!s.suggestions.length||(t.key==="ArrowDown"?(t.preventDefault(),s.highlightedIndex=(s.highlightedIndex+1)%s.suggestions.length):t.key==="ArrowUp"?(t.preventDefault(),s.highlightedIndex=(s.highlightedIndex-1+s.suggestions.length)%s.suggestions.length):t.key==="Enter"?(t.preventDefault(),s.highlightedIndex>=0&&s.suggestions[s.highlightedIndex]&&C(l,s.suggestions[s.highlightedIndex])):t.key==="Escape"&&(s.showDropdown=!1))}function E(l,t){o.items[l].selected_unit=t.target.value,o.items[l].unit=t.target.value}function J(l){const s=document.querySelectorAll('input[placeholder="Cari nama item..."]')[l];if(!s)return{};const i=s.getBoundingClientRect();return{left:i.left+"px",top:i.bottom+"px",width:i.width+"px",position:"fixed",zIndex:9999}}function L(){if(!p.value){if(!o.date||!o.warehouse_id||!o.type||!o.reason){D.fire({icon:"error",title:"Validasi Gagal",text:"Semua field wajib diisi.",confirmButtonColor:"#3085d6"});return}if(!o.items.length||o.items.some(l=>!l.item_id||!l.qty||!l.selected_unit)){D.fire({icon:"error",title:"Validasi Gagal",text:"Setiap item wajib dipilih, qty dan unit diisi.",confirmButtonColor:"#3085d6"});return}D.fire({title:"Konfirmasi Simpan",text:"Apakah Anda yakin ingin menyimpan stock adjustment ini?",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, simpan!",cancelButtonText:"Batal",confirmButtonColor:"#3085d6",cancelButtonColor:"#6b7280"}).then(l=>{l.isConfirmed&&(p.value=!0,o.post(route("food-inventory-adjustment.store"),{onFinish:()=>p.value=!1}))})}}return(l,t)=>(a(),N(W,null,{default:w(()=>[v(d(Y),{title:"Tambah Stock Adjustment"}),e("div",ee,[e("div",te,[e("div",se,[v(d(O),{href:l.route("food-inventory-adjustment.index"),class:"p-2 hover:bg-gray-100 rounded-lg transition-colors"},{default:w(()=>t[5]||(t[5]=[e("i",{class:"fa fa-arrow-left text-gray-600 text-xl"},null,-1)])),_:1},8,["href"]),t[6]||(t[6]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900 flex items-center gap-3 mb-2"},[e("div",{class:"p-3 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg"},[e("i",{class:"fa-solid fa-boxes-stacked text-white text-xl"})]),e("span",null,"Tambah Stock Adjustment")]),e("p",{class:"text-gray-600 ml-16"},"Buat penyesuaian stok inventory baru")],-1))])]),e("div",oe,[e("form",{onSubmit:k(L,["prevent"]),onKeydown:t[4]||(t[4]=b(k(()=>{},["prevent"]),["enter"]))},[e("div",ne,[t[12]||(t[12]=e("div",{class:"flex items-center gap-2 mb-5"},[e("div",{class:"p-2 bg-blue-100 rounded-lg"},[e("i",{class:"fa-solid fa-info-circle text-blue-600"})]),e("h3",{class:"text-lg font-bold text-gray-800"},"Informasi Dasar")],-1)),e("div",le,[e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[e("i",{class:"fa-solid fa-calendar-day text-blue-500 mr-2"}),f(" Tanggal ")],-1)),u(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=s=>d(o).date=s),class:"w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",required:""},null,512),[[m,d(o).date]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[e("i",{class:"fa-solid fa-warehouse text-blue-500 mr-2"}),f(" Gudang ")],-1)),u(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>d(o).warehouse_id=s),class:"w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white",required:""},[t[8]||(t[8]=e("option",{value:""},"Pilih Gudang",-1)),(a(!0),r(x,null,y(S.warehouses,s=>(a(),r("option",{key:s.id,value:s.id},c(s.name),9,ie))),128))],512),[[I,d(o).warehouse_id]])]),e("div",ae,[t[11]||(t[11]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[e("i",{class:"fa-solid fa-tag text-blue-500 mr-2"}),f(" Tipe Adjustment ")],-1)),u(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>d(o).type=s),class:"w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white",required:""},t[10]||(t[10]=[e("option",{value:""},"Pilih Tipe",-1),e("option",{value:"in"},"Stock In",-1),e("option",{value:"out"},"Stock Out",-1)]),512),[[I,d(o).type]])])])]),e("div",re,[e("div",{class:"flex items-center justify-between mb-5"},[t[14]||(t[14]=e("div",{class:"flex items-center gap-2"},[e("div",{class:"p-2 bg-indigo-100 rounded-lg"},[e("i",{class:"fa-solid fa-list-check text-indigo-600"})]),e("h3",{class:"text-lg font-bold text-gray-800"},"Detail Items")],-1)),e("button",{type:"button",onClick:$,class:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded-xl shadow-md hover:shadow-lg transition-all font-semibold"},t[13]||(t[13]=[e("i",{class:"fa-solid fa-plus"},null,-1),f(" Tambah Item ")]))]),e("div",de,[e("table",ue,[t[17]||(t[17]=e("thead",{class:"bg-gradient-to-r from-indigo-600 to-indigo-700"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-bold text-white uppercase tracking-wider"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-box text-indigo-200"}),e("span",null,"Item")])]),e("th",{class:"px-4 py-3 text-right text-xs font-bold text-white uppercase tracking-wider"},[e("div",{class:"flex items-center justify-end gap-2"},[e("i",{class:"fa-solid fa-calculator text-indigo-200"}),e("span",null,"Qty")])]),e("th",{class:"px-4 py-3 text-left text-xs font-bold text-white uppercase tracking-wider"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-ruler text-indigo-200"}),e("span",null,"Unit")])]),e("th",{class:"px-4 py-3 text-left text-xs font-bold text-white uppercase tracking-wider"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-note-sticky text-indigo-200"}),e("span",null,"Note")])]),e("th",{class:"px-4 py-3 text-center text-xs font-bold text-white uppercase tracking-wider"},[e("div",{class:"flex items-center justify-center gap-2"},[e("i",{class:"fa-solid fa-trash text-indigo-200"}),e("span",null,"Action")])])])],-1)),e("tbody",pe,[(a(!0),r(x,null,y(d(o).items,(s,i)=>(a(),r("tr",{key:s._rowKey||i,class:"hover:bg-indigo-50 transition-colors"},[e("td",ge,[e("div",fe,[u(e("input",{id:`item-input-${i}`,type:"text","onUpdate:modelValue":n=>s.item_name=n,onInput:n=>V(i,n),onFocus:n=>V(i,n),onBlur:n=>G(i),onKeydown:[b(n=>h(i,n),["down"]),b(n=>h(i,n),["up"]),b(n=>h(i,n),["enter"]),b(n=>h(i,n),["esc"])],class:"w-full px-4 py-2 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",required:"",autocomplete:"off",placeholder:"Cari nama item..."},null,40,me),[[m,s.item_name]]),(a(),N(H,{to:"body"},[s.showDropdown&&s.suggestions&&s.suggestions.length>0?(a(),r("div",{key:0,style:R(J(i)),id:`autocomplete-dropdown-${i}`,class:"fixed z-[9999] bg-white border-2 border-blue-200 rounded-xl shadow-2xl max-w-xs w-[260px] max-h-96 overflow-auto mt-1"},[(a(!0),r(x,null,y(s.suggestions,(n,K)=>(a(),r("div",{key:n.id,id:`autocomplete-item-${i}-${K}`,onMousedown:k(Ne=>C(i,n),["prevent"]),class:Z(["px-4 py-3 flex justify-between items-center cursor-pointer transition-colors",s.highlightedIndex===K?"bg-blue-100":"hover:bg-blue-50"])},[e("div",null,[e("div",he,c(n.name),1),e("div",xe,c(n.sku),1)]),e("div",ye,c(n.unit),1)],42,be))),128))],12,ce)):_("",!0)])),s.loading?(a(),r("div",we,t[15]||(t[15]=[e("i",{class:"fa fa-spinner fa-spin text-blue-500"},null,-1)]))):_("",!0)])]),e("td",ve,[u(e("input",{type:"number",min:"0.01",step:"0.01","onUpdate:modelValue":n=>s.qty=n,class:"w-full px-4 py-2 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-right",required:""},null,8,_e),[[m,s.qty]])]),e("td",ke,[s.available_units&&s.available_units.length?u((a(),r("select",{key:0,"onUpdate:modelValue":n=>s.selected_unit=n,onChange:n=>E(i,n),class:"w-full px-4 py-2 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white"},[(a(!0),r(x,null,y(s.available_units,n=>(a(),r("option",{key:n,value:n},c(n),9,De))),128))],40,Ie)),[[I,s.selected_unit]]):u((a(),r("input",{key:1,type:"text","onUpdate:modelValue":n=>s.unit=n,class:"w-full px-4 py-2 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",required:""},null,8,Se)),[[m,s.unit]])]),e("td",Be,[u(e("input",{type:"text","onUpdate:modelValue":n=>s.note=n,class:"w-full px-4 py-2 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",placeholder:"Optional"},null,8,Ce),[[m,s.note]])]),e("td",Ve,[e("button",{type:"button",onClick:n=>z(i),disabled:d(o).items.length===1,class:"inline-flex items-center justify-center w-10 h-10 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},t[16]||(t[16]=[e("i",{class:"fa-solid fa-trash"},null,-1)]),8,je)])]))),128))])])])]),e("div",Ae,[t[18]||(t[18]=e("div",{class:"flex items-center gap-2 mb-5"},[e("div",{class:"p-2 bg-amber-100 rounded-lg"},[e("i",{class:"fa-solid fa-note-sticky text-amber-600"})]),e("h3",{class:"text-lg font-bold text-gray-800"},"Alasan / Catatan")],-1)),u(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=s=>d(o).reason=s),class:"w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all resize-none",rows:"3",placeholder:"Masukkan alasan atau catatan untuk adjustment ini...",required:""},null,512),[[m,d(o).reason]])]),e("div",Ue,[v(d(O),{href:l.route("food-inventory-adjustment.index"),class:"px-6 py-2.5 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-xl transition-all font-semibold border-2 border-gray-200 hover:border-gray-300"},{default:w(()=>t[19]||(t[19]=[e("i",{class:"fa-solid fa-times mr-2"},null,-1),f(" Batal ")])),_:1},8,["href"]),e("button",{type:"submit",class:"px-6 py-2.5 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-xl shadow-lg hover:shadow-xl transition-all font-semibold transform hover:-translate-y-0.5",disabled:p.value},[p.value?(a(),r("span",qe,t[20]||(t[20]=[e("i",{class:"fa fa-spinner"},null,-1)]))):(a(),r("span",Me,t[21]||(t[21]=[e("i",{class:"fa-solid fa-save mr-2"},null,-1)]))),f(" "+c(p.value?"Menyimpan...":"Simpan Adjustment"),1)],8,Te)])],32)]),p.value?(a(),r("div",Ke,t[22]||(t[22]=[e("div",{class:"bg-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3"},[e("div",{class:"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e("span",{class:"font-semibold text-gray-700"},"Menyimpan...")],-1)]))):_("",!0)])]),_:1}))}};export{Ye as default};
