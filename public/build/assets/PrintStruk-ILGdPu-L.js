import{E as R}from"./jspdf.es.min-CsdEihPL.js";import{c as U,a as C,L as z,B as j,D as m,G as O,N as M}from"./vendor-vue-g7iCcTkf.js";import"./app-CXnLHfhT.js";import"./vendor-utils-CpgP2uT4.js";import"./vendor-charts-CuqD4wLC.js";async function q({sale:i,items:o,customer:r,warehouse:c,division:u,showReprintLabel:L=!1}){let e=0;e+=15,e+=25,e+=8,e+=10,e+=8,o&&o.length?o.forEach(s=>{const p=s.item_name.length>20?Math.ceil(s.item_name.length/20):1;e+=p*3.5+8}):e+=8,e+=12,e+=15;const t=new R({unit:"mm",format:[80,Math.max(297,e)]});let n=10;if(L&&(t.setFontSize(8),t.setFont(void 0,"normal"),t.text("reprint",78,7,{align:"right"})),t.setFontSize(13),t.setFont(void 0,"bold"),t.text("RETAIL WAREHOUSE SALE",40,n,{align:"center"}),n+=6,t.setFontSize(10),t.text("JUSTUS GROUP",40,n,{align:"center"}),n+=5,t.setFont(void 0,"bold"),(u!=null&&u.name||c!=null&&c.name)&&(t.text(`${(u==null?void 0:u.name)||""}${u!=null&&u.name&&(c!=null&&c.name)?" - ":""}${(c==null?void 0:c.name)||""}`,40,n,{align:"center"}),n+=5),t.setFont(void 0,"normal"),t.setFontSize(9),t.text(`No: ${(i==null?void 0:i.number)||""}`,2,n),n+=4.5,t.text(`Tanggal: ${B((i==null?void 0:i.sale_date)||(i==null?void 0:i.created_at))}`,2,n),n+=4.5,t.text(`Customer: ${(r==null?void 0:r.name)||""}`,2,n),n+=4.5,r!=null&&r.code&&(t.text(`Kode: ${r.code}`,2,n),n+=4.5),r!=null&&r.phone&&(t.text(`Telp: ${r.phone}`,2,n),n+=4.5),n+=2,t.line(2,n,78,n),n+=4,o&&o.length?o.forEach(s=>{const p=String(s.qty||0),a=String(s.unit||"").substring(0,4),f=String(s.item_name||"");let F=`${p} ${a.padEnd(4)} ${f}`;if(F.length>32){const b=f.split(" ");let d=`${p} ${a.padEnd(4)} `,D=d.length;for(let $=0;$<b.length;$++){const x=b[$];D+x.length+1<=32?(d+=($===0?"":" ")+x,D=d.length):(t.text(d,2,n),n+=3.5,d="    "+x,D=d.length)}d.trim()&&(t.text(d,2,n),n+=3.5)}else t.text(F,2,n),n+=3.5;const T=`    @${I(s.price||0)} = ${I(s.subtotal||0)}`;t.text(T,2,n),n+=4.5}):(t.text("TIDAK ADA ITEM",2,n),n+=8),n+=2,t.line(2,n,78,n),n+=4,t.setFontSize(10),t.setFont(void 0,"bold"),t.text(`TOTAL: ${I((i==null?void 0:i.total_amount)||0)}`,2,n),n+=6,t.setFontSize(10),t.setFont(void 0,"bold"),t.text("Terima kasih",40,n,{align:"center"}),i!=null&&i.notes){t.setFontSize(8),t.setFont(void 0,"normal"),t.text("Catatan:",2,n),n+=3;const s=String(i.notes);if(s.length<=32)t.text(s,2,n),n+=3.5;else{const p=s.split(" ");let a="";for(const f of p)a.length+f.length+1<=32?a+=(a?" ":"")+f:(a&&(t.text(a,2,n),n+=3.5),a=f);a&&(t.text(a,2,n),n+=3.5)}}return t}function I(i){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(i)}function B(i){return new Date(i).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"})}const G={class:"print-controls"},K={id:"struk",class:"struk-print"},H={class:"pre-struk"},v="/images/logojustusgroup.png",Z={__name:"PrintStruk",props:{sale:Object,items:Array,customer:Object,warehouse:Object,division:Object},setup(i){const o=i;function r(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function c(e){return new Date(e).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"})}const u=U(()=>{var t,n,s,p,a,f,F,T,b,d,D,$,x,_;let e=[];if(e.push("RETAIL WAREHOUSE SALE"),e.push("JUSTUS GROUP"),(t=o.division)!=null&&t.name||(n=o.warehouse)!=null&&n.name){const g=`${((s=o.division)==null?void 0:s.name)||""}${(p=o.division)!=null&&p.name&&((a=o.warehouse)!=null&&a.name)?" - ":""}${((f=o.warehouse)==null?void 0:f.name)||""}`;e.push(g)}if(e.push("--------------------------------"),e.push(`No: ${((F=o.sale)==null?void 0:F.number)||""}`),e.push(`Tanggal: ${c(((T=o.sale)==null?void 0:T.sale_date)||((b=o.sale)==null?void 0:b.created_at))}`),e.push(`Customer: ${((d=o.customer)==null?void 0:d.name)||""}`),(D=o.customer)!=null&&D.code&&e.push(`Kode: ${o.customer.code}`),($=o.customer)!=null&&$.phone&&e.push(`Telp: ${o.customer.phone}`),e.push("--------------------------------"),o.items&&o.items.length>0?o.items.forEach(g=>{const y=String(g.qty||0),l=String(g.unit||"").substring(0,4),S=String(g.item_name||""),N=32-(y.length+1+l.length+1);if(S.length<=N)e.push(`${y} ${l.padEnd(4)} ${S}`);else{const k=S.split(" ");let h=`${y} ${l.padEnd(4)} `,w=h.length;for(let E=0;E<k.length;E++){const A=k[E];w+A.length+1<=32?(h+=(E===0?"":" ")+A,w=h.length):(e.push(h),h="    "+A,w=h.length)}h.trim()&&e.push(h)}const P=`    @${r(g.price||0)} = ${r(g.subtotal||0)}`;e.push(P)}):e.push("TIDAK ADA ITEM"),e.push("--------------------------------"),e.push(`TOTAL: ${r(((x=o.sale)==null?void 0:x.total_amount)||0)}`),(_=o.sale)!=null&&_.notes){e.push("--------------------------------"),e.push("Catatan:");const g=String(o.sale.notes);if(g.length<=32)e.push(g);else{const y=g.split(" ");let l="";for(const S of y)l.length+S.length+1<=32?l+=(l?" ":"")+S:(l&&e.push(l),l=S);l&&e.push(l)}}return e.join(`
`)});C(()=>{setTimeout(()=>{window.print()},500)});async function L(){var e;try{const t=await q({sale:o.sale,items:o.items,customer:o.customer,warehouse:o.warehouse,division:o.division}),n=`Retail_Sale_${((e=o.sale)==null?void 0:e.number)||"Unknown"}.pdf`;t.save(n)}catch(t){console.error("Error generating PDF:",t),alert("Gagal generate PDF: "+t.message)}}return(e,t)=>(j(),z("div",null,[m("div",G,[m("button",{onClick:t[0]||(t[0]=n=>e.window.print()),class:"print-btn"},t[1]||(t[1]=[m("i",{class:"fa-solid fa-print"},null,-1),O(" Print ")])),m("button",{onClick:L,class:"download-btn"},t[2]||(t[2]=[m("i",{class:"fa-solid fa-download"},null,-1),O(" Download PDF ")]))]),m("div",K,[m("div",{class:"logo-wrap"},[m("img",{src:v,alt:"Logo",class:"logo"})]),m("pre",H,M(u.value),1),t[3]||(t[3]=m("div",{class:"footer"},[m("div",{class:"thanks"},"Terima kasih")],-1))])]))}};export{Z as default};
