import{P as T,r as g,c as q,a as F,j as z,w as M,L as i,E as d,B as a,D as s,N as u,O as E,H as m,J as x,Q as o,I as v,R as H,F as _,M as k,V as f,G as h,l as L}from"./vendor-vue-g7iCcTkf.js";import{S as w}from"./app-BoyRvw0M.js";import"./vendor-utils-CpgP2uT4.js";import"./vendor-charts-CuqD4wLC.js";const G={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},I={class:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto"},J={class:"px-6 py-4 border-b border-gray-200 flex justify-between items-center"},K={class:"text-lg font-semibold text-gray-900"},Q={class:"space-y-4"},W={key:0,class:"mt-1 text-sm text-red-600"},X={key:0,class:"mt-1 text-sm text-red-600"},Y={key:0,class:"mt-1 text-sm text-red-600"},Z=["value"],ee={key:0,class:"mt-1 text-sm text-red-600"},te={key:0,class:"mt-1 text-sm text-red-600"},se={class:"relative"},ne={key:0,class:"mt-1 text-sm text-red-600"},oe=["value","disabled"],re={key:0,class:"mt-1 text-sm text-red-600"},le={class:"flex items-center gap-2"},ie={class:"border-t pt-4"},ae={class:"mb-4"},ue={key:0,class:"mt-1 text-sm text-red-600"},de={key:0,class:"mb-4"},me={class:"mb-3"},ce={key:0,class:"mt-2 flex items-center gap-2"},pe={class:"text-xs text-gray-600"},ye={key:0,class:"border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto bg-white"},be={key:0},fe=["checked","onChange"],xe={class:"flex-1"},ge={class:"flex items-center gap-2"},ve={class:"font-medium text-gray-900"},_e={class:"text-xs text-gray-500 mt-1"},ke={class:"font-mono"},he={key:0,class:"ml-2"},we={key:0,class:"text-xs px-2 py-0.5 bg-blue-100 text-blue-700 rounded"},Ae={key:1,class:"p-4 text-center text-gray-500"},Ce={key:2,class:"p-4 text-center text-gray-500"},Oe={key:1,class:"mt-2 space-y-1"},Me={class:"flex flex-wrap gap-2"},Se=["onClick"],Ve={key:0,class:"mt-1 text-sm text-red-600"},Pe={class:"border-t pt-4"},Ue={class:"mb-4"},$e={class:"flex items-center gap-2"},De={key:0,class:"mt-1 text-sm text-red-600"},Ee={key:0,class:"space-y-4"},Le={class:"space-y-2 border border-gray-300 rounded-lg p-3"},je={class:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded"},Be={class:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded"},Re={class:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded"},Ne={class:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded"},Te={key:0,class:"mt-1 text-sm text-red-600"},qe={class:"mt-6 flex justify-end gap-3"},Fe=["disabled"],ze={key:0,class:"fa-solid fa-spinner fa-spin"},Ke={__name:"ChartOfAccountFormModal",props:{show:Boolean,mode:String,chartOfAccount:Object,parents:Array,menus:Array,allCoAs:Array},emits:["close","success"],setup(p,{emit:j}){const r=p,S=j,t=T({code:"",name:"",type:"Asset",parent_id:null,description:"",is_active:!0,show_in_menu_payment:!1,static_or_dynamic:null,menu_id:[],mode_payment:[],budget_limit:null,default_counter_account_id:null}),c=g(""),y=g(!1),A=g(null),V=q(()=>{if(!r.menus||!Array.isArray(r.menus))return[];let l=r.menus;if(c.value){const e=c.value.toLowerCase();l=r.menus.filter(n=>n.name&&n.name.toLowerCase().includes(e)||n.code&&n.code.toLowerCase().includes(e)||n.route&&n.route.toLowerCase().includes(e)||n.parent&&n.parent.name&&n.parent.name.toLowerCase().includes(e))}return l.sort((e,n)=>e.parent_id&&n.parent_id||!e.parent_id&&!n.parent_id?(e.name||"").localeCompare(n.name||""):e.parent_id?1:-1)}),C=l=>l.parent?`${l.parent.name} > ${l.name}`:l.name;function P(l){const e=l.id;(!t.menu_id||!Array.isArray(t.menu_id))&&(t.menu_id=[]);const n=t.menu_id.indexOf(e);n>-1?t.menu_id.splice(n,1):t.menu_id.push(e),$()}function U(l){return!t.menu_id||!Array.isArray(t.menu_id)?!1:t.menu_id.includes(l)}function $(){if(!t.menu_id||t.menu_id.length===0){c.value="";return}const l=r.menus.filter(e=>t.menu_id.includes(e.id));l.length===0?c.value="":l.length===1?c.value=C(l[0]):c.value=`${l.length} menu dipilih`}function B(l){if(!r.menus)return"";const e=r.menus.find(n=>n.id===l);return e?C(e):`Menu #${l}`}function R(){t.menu_id=[],c.value="",y.value=!1}function D(l){A.value&&!A.value.contains(l.target)&&(y.value=!1)}F(()=>{document.addEventListener("click",D)}),z(()=>{document.removeEventListener("click",D)}),M(()=>r.show,l=>{var e;if(l&&r.mode==="edit"&&r.chartOfAccount)if(t.code=r.chartOfAccount.code||"",t.name=r.chartOfAccount.name||"",t.type=r.chartOfAccount.type||"Asset",t.parent_id=r.chartOfAccount.parent_id||null,t.description=r.chartOfAccount.description||"",t.is_active=r.chartOfAccount.is_active==1,t.show_in_menu_payment=r.chartOfAccount.show_in_menu_payment==1,t.static_or_dynamic=r.chartOfAccount.static_or_dynamic||null,t.menu_id=r.chartOfAccount.menu_id||null,r.chartOfAccount.mode_payment?Array.isArray(r.chartOfAccount.mode_payment)?t.mode_payment=r.chartOfAccount.mode_payment:t.mode_payment=[r.chartOfAccount.mode_payment]:t.mode_payment=[],t.budget_limit=r.chartOfAccount.budget_limit||null,t.default_counter_account_id=r.chartOfAccount.default_counter_account_id||null,t.menu_id&&r.menus){const n=r.menus.find(O=>O.id===t.menu_id);n&&(c.value=n.name)}else c.value="";else l&&r.mode==="create"&&(t.reset(),t.type="Asset",t.parent_id=((e=r.chartOfAccount)==null?void 0:e.parent_id)||null,t.is_active=!0,t.show_in_menu_payment=!1,t.static_or_dynamic=null,t.menu_id=[],t.mode_payment=[],t.budget_limit=null,t.default_counter_account_id=null,c.value="")}),M(()=>t.menu_id,()=>{$()},{deep:!0}),M(()=>t.static_or_dynamic,l=>{l!=="static"&&(t.menu_id=null,c.value="")});const b=g(!1);function N(){b.value=!0,r.mode==="create"?t.post("/chart-of-accounts",{preserveScroll:!0,onSuccess:()=>{w.fire("Berhasil","Chart of Account berhasil dibuat!","success"),S("success")},onError:l=>{w.fire("Error",Object.values(l).flat().join(", "),"error")},onFinish:()=>{b.value=!1}}):t.put(`/chart-of-accounts/${r.chartOfAccount.id}`,{preserveScroll:!0,onSuccess:()=>{w.fire("Berhasil","Chart of Account berhasil diperbarui!","success"),S("success")},onError:l=>{w.fire("Error",Object.values(l).flat().join(", "),"error")},onFinish:()=>{b.value=!1}})}return(l,e)=>p.show?(a(),i("div",G,[s("div",I,[s("div",J,[s("h3",K,u(p.mode==="create"?"Buat Chart of Account Baru":"Edit Chart of Account"),1),s("button",{onClick:e[0]||(e[0]=n=>l.$emit("close")),class:"text-gray-400 hover:text-gray-600"},e[21]||(e[21]=[s("i",{class:"fa-solid fa-times text-xl"},null,-1)]))]),s("form",{onSubmit:E(N,["prevent"]),class:"p-6"},[s("div",Q,[s("div",null,[e[22]||(e[22]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Code *",-1)),m(s("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>o(t).code=n),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Contoh: 1000"},null,512),[[x,o(t).code]]),o(t).errors.code?(a(),i("div",W,u(o(t).errors.code),1)):d("",!0)]),s("div",null,[e[23]||(e[23]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Name *",-1)),m(s("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>o(t).name=n),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nama Chart of Account"},null,512),[[x,o(t).name]]),o(t).errors.name?(a(),i("div",X,u(o(t).errors.name),1)):d("",!0)]),s("div",null,[e[25]||(e[25]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Type *",-1)),m(s("select",{"onUpdate:modelValue":e[3]||(e[3]=n=>o(t).type=n),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},e[24]||(e[24]=[H('<option value="Asset">Asset</option><option value="Liability">Liability</option><option value="Equity">Equity</option><option value="Revenue">Revenue</option><option value="Expense">Expense</option>',5)]),512),[[v,o(t).type]]),o(t).errors.type?(a(),i("div",Y,u(o(t).errors.type),1)):d("",!0)]),s("div",null,[e[27]||(e[27]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Parent Account (Optional)",-1)),m(s("select",{"onUpdate:modelValue":e[4]||(e[4]=n=>o(t).parent_id=n),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[e[26]||(e[26]=s("option",{value:null},"Tidak ada parent (Root Account)",-1)),(a(!0),i(_,null,k(p.parents,n=>(a(),i("option",{key:n.id,value:n.id},u(n.display||`${n.code} - ${n.name} (${n.type})`),9,Z))),128))],512),[[v,o(t).parent_id]]),e[28]||(e[28]=s("p",{class:"mt-1 text-xs text-gray-500"},"Pilih parent jika ini adalah child account",-1)),o(t).errors.parent_id?(a(),i("div",ee,u(o(t).errors.parent_id),1)):d("",!0)]),s("div",null,[e[29]||(e[29]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Description",-1)),m(s("textarea",{"onUpdate:modelValue":e[5]||(e[5]=n=>o(t).description=n),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Deskripsi Chart of Account"},null,512),[[x,o(t).description]]),o(t).errors.description?(a(),i("div",te,u(o(t).errors.description),1)):d("",!0)]),s("div",null,[e[31]||(e[31]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Budget Limit",-1)),s("div",se,[e[30]||(e[30]=s("span",{class:"absolute left-3 top-2 text-gray-500"},"Rp",-1)),m(s("input",{"onUpdate:modelValue":e[6]||(e[6]=n=>o(t).budget_limit=n),type:"number",step:"0.01",min:"0",class:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00"},null,512),[[x,o(t).budget_limit]])]),e[32]||(e[32]=s("p",{class:"mt-1 text-xs text-gray-500"},"Masukkan budget limit untuk COA ini (opsional)",-1)),o(t).errors.budget_limit?(a(),i("div",ne,u(o(t).errors.budget_limit),1)):d("",!0)]),s("div",null,[e[34]||(e[34]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Default Counter Account (Akun Lawan) ",-1)),m(s("select",{"onUpdate:modelValue":e[7]||(e[7]=n=>o(t).default_counter_account_id=n),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[e[33]||(e[33]=s("option",{value:null},"Tidak ada (kosongkan)",-1)),(a(!0),i(_,null,k(p.allCoAs,n=>(a(),i("option",{key:n.id,value:n.id,disabled:p.mode==="edit"&&p.chartOfAccount&&n.id===p.chartOfAccount.id},u(n.code)+" - "+u(n.name)+" ("+u(n.type)+") ",9,oe))),128))],512),[[v,o(t).default_counter_account_id]]),e[35]||(e[35]=s("p",{class:"mt-1 text-xs text-gray-500"}," Pilih akun lawan default untuk memudahkan pembuatan jurnal. Saat membuat jurnal dengan akun ini, akun lawan akan terisi otomatis. ",-1)),o(t).errors.default_counter_account_id?(a(),i("div",re,u(o(t).errors.default_counter_account_id),1)):d("",!0)]),s("div",null,[s("label",le,[m(s("input",{"onUpdate:modelValue":e[8]||(e[8]=n=>o(t).is_active=n),type:"checkbox",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,512),[[f,o(t).is_active]]),e[36]||(e[36]=s("span",{class:"text-sm font-medium text-gray-700"},"Active",-1))])]),s("div",ie,[e[44]||(e[44]=s("h4",{class:"text-sm font-semibold text-gray-700 mb-3"},"Static or Dynamic",-1)),s("div",ae,[e[38]||(e[38]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Static or Dynamic",-1)),m(s("select",{"onUpdate:modelValue":e[9]||(e[9]=n=>o(t).static_or_dynamic=n),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},e[37]||(e[37]=[s("option",{value:null},"Pilih tipe",-1),s("option",{value:"static"},"Static",-1),s("option",{value:"dynamic"},"Dynamic",-1)]),512),[[v,o(t).static_or_dynamic]]),e[39]||(e[39]=s("p",{class:"mt-1 text-xs text-gray-500"},"Pilih tipe COA: Static (terikat menu) atau Dynamic (tidak terikat menu)",-1)),o(t).errors.static_or_dynamic?(a(),i("div",ue,u(o(t).errors.static_or_dynamic),1)):d("",!0)]),o(t).static_or_dynamic==="static"?(a(),i("div",de,[e[42]||(e[42]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[h(" Pilih Menu "),s("span",{class:"text-red-500"},"*")],-1)),s("div",me,[m(s("input",{"onUpdate:modelValue":e[10]||(e[10]=n=>c.value=n),onFocus:e[11]||(e[11]=n=>y.value=!0),onInput:e[12]||(e[12]=n=>y.value=!0),onClick:e[13]||(e[13]=n=>y.value=!0),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Cari menu...",autocomplete:"off"},null,544),[[x,c.value]]),o(t).menu_id&&o(t).menu_id.length>0?(a(),i("div",ce,[s("span",pe,u(o(t).menu_id.length)+" menu dipilih",1),s("button",{type:"button",onClick:R,class:"text-xs text-red-600 hover:text-red-700"}," Hapus semua ")])):d("",!0)]),s("div",{class:"relative",ref_key:"menuDropdownRef",ref:A},[y.value||c.value?(a(),i("div",ye,[V.value.length>0?(a(),i("div",be,[(a(!0),i(_,null,k(V.value,n=>(a(),i("label",{key:n.id,onClick:e[14]||(e[14]=E(()=>{},["stop"])),class:L(["flex items-center gap-3 px-4 py-3 hover:bg-blue-50 cursor-pointer border-b border-gray-200 last:border-b-0 transition",{"bg-blue-50":U(n.id)}])},[s("input",{type:"checkbox",checked:U(n.id),onChange:O=>P(n),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,40,fe),s("div",xe,[s("div",ge,[n.icon?(a(),i("i",{key:0,class:L([n.icon,"text-gray-400 text-sm"])},null,2)):d("",!0),s("div",ve,u(C(n)),1)]),s("div",_e,[s("span",ke,u(n.code),1),n.route?(a(),i("span",he,"â€¢ "+u(n.route),1)):d("",!0)])]),n.parent_id?d("",!0):(a(),i("span",we,"Parent"))],2))),128))])):r.menus&&r.menus.length===0?(a(),i("div",Ae," Tidak ada menu tersedia ")):(a(),i("div",Ce," Tidak ada menu ditemukan "))])):d("",!0),!y.value&&o(t).menu_id&&o(t).menu_id.length>0?(a(),i("div",Oe,[e[41]||(e[41]=s("div",{class:"text-xs font-medium text-gray-700 mb-1"},"Menu yang dipilih:",-1)),s("div",Me,[(a(!0),i(_,null,k(o(t).menu_id,n=>(a(),i("span",{key:n,class:"inline-flex items-center gap-1 px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded"},[h(u(B(n))+" ",1),s("button",{type:"button",onClick:O=>P({id:n}),class:"text-blue-600 hover:text-blue-800"},e[40]||(e[40]=[s("i",{class:"fa-solid fa-times"},null,-1)]),8,Se)]))),128))])])):d("",!0)],512),e[43]||(e[43]=s("p",{class:"mt-1 text-xs text-gray-500"},"Pilih satu atau lebih menu dari erp_menu yang akan digunakan untuk COA ini",-1)),o(t).errors.menu_id?(a(),i("div",Ve,u(o(t).errors.menu_id),1)):d("",!0)])):d("",!0)]),s("div",Pe,[e[53]||(e[53]=s("h4",{class:"text-sm font-semibold text-gray-700 mb-3"},"Payment Menu Settings",-1)),s("div",Ue,[s("label",$e,[m(s("input",{"onUpdate:modelValue":e[15]||(e[15]=n=>o(t).show_in_menu_payment=n),type:"checkbox",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,512),[[f,o(t).show_in_menu_payment]]),e[45]||(e[45]=s("span",{class:"text-sm font-medium text-gray-700"},"Show in Menu Payment",-1))]),e[46]||(e[46]=s("p",{class:"mt-1 text-xs text-gray-500"},"Centang untuk menampilkan COA ini di menu payment",-1)),o(t).errors.show_in_menu_payment?(a(),i("div",De,u(o(t).errors.show_in_menu_payment),1)):d("",!0)]),o(t).show_in_menu_payment?(a(),i("div",Ee,[s("div",null,[e[51]||(e[51]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[h(" Mode Payment "),s("span",{class:"text-red-500"},"*")],-1)),s("div",Le,[s("label",je,[m(s("input",{type:"checkbox",value:"pr_ops","onUpdate:modelValue":e[16]||(e[16]=n=>o(t).mode_payment=n),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,512),[[f,o(t).mode_payment]]),e[47]||(e[47]=s("span",{class:"text-sm text-gray-700"},"Purchase Requisition (PR Ops)",-1))]),s("label",Be,[m(s("input",{type:"checkbox",value:"purchase_payment","onUpdate:modelValue":e[17]||(e[17]=n=>o(t).mode_payment=n),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,512),[[f,o(t).mode_payment]]),e[48]||(e[48]=s("span",{class:"text-sm text-gray-700"},"Payment Application",-1))]),s("label",Re,[m(s("input",{type:"checkbox",value:"travel_application","onUpdate:modelValue":e[18]||(e[18]=n=>o(t).mode_payment=n),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,512),[[f,o(t).mode_payment]]),e[49]||(e[49]=s("span",{class:"text-sm text-gray-700"},"Travel Application",-1))]),s("label",Ne,[m(s("input",{type:"checkbox",value:"kasbon","onUpdate:modelValue":e[19]||(e[19]=n=>o(t).mode_payment=n),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,512),[[f,o(t).mode_payment]]),e[50]||(e[50]=s("span",{class:"text-sm text-gray-700"},"Kasbon",-1))])]),e[52]||(e[52]=s("p",{class:"mt-1 text-xs text-gray-500"},"Pilih satu atau lebih mode payment sesuai dengan menu Purchase Requisition Ops",-1)),o(t).errors.mode_payment?(a(),i("div",Te,u(o(t).errors.mode_payment),1)):d("",!0)])])):d("",!0)])]),s("div",qe,[s("button",{type:"button",onClick:e[20]||(e[20]=n=>l.$emit("close")),class:"px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition"}," Batal "),s("button",{type:"submit",disabled:b.value,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[b.value?(a(),i("i",ze)):d("",!0),h(" "+u(b.value?"Menyimpan...":p.mode==="create"?"Simpan":"Update"),1)],8,Fe)])],32)])])):d("",!0)}};export{Ke as default};
