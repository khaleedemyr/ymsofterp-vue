import{r as C,a as oe,L as i,B as n,x as V,Q as le,U as re,C as ae,D as e,E as k,N as l,G as h,F as P,M as I,H as $,V as ie,I as ne,J as Q}from"./vendor-vue-g7iCcTkf.js";import{A as de}from"./AppLayout-1Wm1ZPw9.js";import{a as ce}from"./vendor-utils-CpgP2uT4.js";import{S as R}from"./app-BPKNzj_F.js";import{E as me}from"./jspdf.es.min-Ci0NznKN.js";import{J as ue}from"./JsBarcode-7kUKaxTf.js";import{Q as ge}from"./browser-CCaIc0XY.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-CVHTvH7j.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const be={class:"max-w-7xl mx-auto py-8 px-2"},pe={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"},xe={key:1,class:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mb-4"},fe={class:"flex items-center justify-between mb-6"},he={class:"flex items-center gap-2"},ye={class:"py-12"},ve={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},_e={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},we={class:"p-6 bg-white border-b border-gray-200"},Pe={class:"mb-8"},ke={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},De={class:"mt-1 text-sm text-gray-900"},Se={class:"mt-1 text-sm text-gray-900"},Ce={class:"mt-1 text-sm text-gray-900"},Ie={class:"mt-1 text-sm text-gray-900"},Ne={class:"mt-1 text-sm text-gray-900"},Fe={class:"mt-1 text-sm text-gray-900"},Be={class:"mb-8"},Ee={class:"min-w-full divide-y divide-gray-200"},Le={class:"bg-white divide-y divide-gray-200"},Ae=["rowspan"],$e=["rowspan"],Ue={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Te={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},We={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Me={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Re={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},qe={class:"max-w-3xl w-full mx-auto"},He={key:0,class:"bg-white rounded-2xl shadow p-6 mb-6"},Oe={class:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"},Ve=["href"],Qe={key:1},ze=["href"],je={key:1},Ge={class:"mb-8"},Je={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ye={class:"mb-4"},Xe={class:"mt-1 text-sm text-gray-900"},Ke={class:"mb-4"},Ze={class:"mt-1 text-sm text-gray-900"},et=["href"],tt={key:0},st={class:"text-sm text-gray-900"},ot={key:2,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},lt={class:"bg-white rounded-lg shadow-xl w-full max-w-4xl mx-4"},rt={class:"p-6"},at={class:"flex justify-between items-center mb-4"},it={class:"space-y-4"},nt={class:"space-y-2 max-h-60 overflow-y-auto"},dt=["value"],ct={class:"flex-1"},mt={class:"font-medium text-sm"},ut={class:"text-xs text-gray-600"},gt={key:0,class:"mt-2"},bt=["onUpdate:modelValue"],pt=["value"],xt={key:1,class:"mt-2"},ft={class:"text-xs text-gray-500"},ht={key:2,class:"mt-2"},yt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},vt={class:"flex justify-end gap-3 mt-6"},$t={__name:"Show",props:{butcherProcess:{type:Object,required:!0}},setup(a){const y=a,N=C(!1),D=C([]),g=C({}),_=C({}),m=C({processDate:"",batchNumber:""});oe(async()=>{var d,t,x;if(console.log("ButcherProcess Show component mounted"),console.log("Props butcherProcess:",y.butcherProcess),m.value.processDate=((d=y.butcherProcess)==null?void 0:d.process_date)||"",m.value.batchNumber=((t=y.butcherProcess)==null?void 0:t.number)||"",console.log("Label data:",m.value),(x=y.butcherProcess)!=null&&x.items){console.log("Items count:",y.butcherProcess.items.length);for(const s of y.butcherProcess.items){if(console.log("=== PROCESSING ITEM FOR BARCODE LOADING ==="),console.log("Full item object:",s),console.log("item.pcs_item_id:",s.pcs_item_id),console.log("item.pcs_item_name:",s.pcs_item_name),s.pcs_item_id){console.log("Fetching barcodes for PCS Item ID:",s.pcs_item_id);try{const c=await ce.get(`/api/items/${s.pcs_item_id}/barcodes`);console.log("API Response:",c.data),g.value[s.pcs_item_id]=c.data.barcodes||[],g.value[s.pcs_item_id].length>0?(_.value[s.pcs_item_id]=g.value[s.pcs_item_id][0].barcode,console.log("✅ Successfully set barcode for item",s.pcs_item_id,":",_.value[s.pcs_item_id])):console.log("❌ No barcodes found for item",s.pcs_item_id),console.log("Barcodes array for PCS item",s.pcs_item_id,":",g.value[s.pcs_item_id]),console.log("Selected barcode for PCS item",s.pcs_item_id,":",_.value[s.pcs_item_id])}catch(c){console.error("❌ Error loading barcodes for PCS item:",s.pcs_item_id,c),g.value[s.pcs_item_id]=[]}}else console.log("❌ PCS Item ID is undefined for item:",s);console.log("=== END PROCESSING ITEM ===")}console.log("=== FINAL BARCODE STATUS ==="),console.log("barcodes.value:",g.value),console.log("selectedBarcodes.value:",_.value),console.log("=== END FINAL STATUS ===")}});const U=d=>new Date(d).toLocaleDateString("id-ID"),z=d=>new Date(d).toLocaleString("id-ID");function j(d){const t=[];let x=null,s=null;return d.forEach(c=>{var f;const r=((f=c.wholeItem)==null?void 0:f.name)||c.whole_item_name||"-";r!==x&&(s={key:r,items:[]},t.push(s),x=r),s.items.push(c)}),t}const G=()=>{if(D.value.length===0){R.fire("Error","Please select at least one item to print labels","error");return}if(!m.value.processDate||!m.value.batchNumber){R.fire("Error","Please fill all required fields","error");return}const d=y.butcherProcess.items.filter(t=>D.value.includes(t.id));for(const t of d)if(!_.value[t.pcs_item_id]){R.fire("Error",`No barcode selected for item: ${t.pcs_item_name}`,"error");return}J()},J=()=>{const o=new me({orientation:"landscape",unit:"mm",format:[297,210]}),w=y.butcherProcess.items.filter(p=>D.value.includes(p.id));console.log("Selected items:",w),console.log("Barcodes loaded:",g.value);let b=5,u=5;for(const p of w){console.log("Processing item for PDF:",p),console.log("Item ID:",p.id),console.log("PCS Item ID:",p.pcs_item_id);const W=_.value[p.pcs_item_id];if(console.log("Selected barcode for PCS item",p.pcs_item_id,":",W),!W){console.warn("No barcode selected for PCS item:",p.pcs_item_name||"Unknown");continue}const M=W;console.log("Using barcode:",M),u+100>292&&(u=5,b+=55,b+50>205&&(o.addPage(),b=5)),o.setDrawColor(0,0,0),o.setLineWidth(.5),o.rect(u,b,100,50);const q=70,S=18,F=3,B=document.createElement("canvas");B.width=q*F,B.height=S*F,ue(B,M,{width:1.5*F,height:S*F,displayValue:!1});const Y=u+5;o.addImage(B,"PNG",Y,b+3,q,S),o.setFontSize(8),o.setFont(void 0,"bold"),o.text(M,u+5,b+S+6,{align:"left"});const H=`http://localhost:8000/items/${p.pcs_item_id}/detail`;console.log("QR Code URL:",H);const E=document.createElement("canvas");E.width=20*3,E.height=20*3;try{ge.toCanvas(E,H,{width:20*3,margin:1,color:{dark:"#000000",light:"#FFFFFF"}},function(A){if(A)console.error("QR Code generation error:",A);else{const te=u+100-25,se=b+50-25;o.addImage(E,"PNG",te,se,20,20)}})}catch(A){console.error("QR Code generation failed:",A)}let v=b+S+12;o.setFontSize(9),o.setFont(void 0,"bold");const X=p.pcs_item_name||"Unknown Item";o.text(X.toUpperCase(),u+5,v,{align:"left"}),v+=3,o.setFontSize(10),o.setFont(void 0,"normal"),o.text(`PROCESS DATE: ${T(m.value.processDate)}`,u+5,v,{align:"left"}),v+=3.5,o.setFontSize(10),o.setFont(void 0,"normal"),o.text(`BATCH NUMBER: ${m.value.batchNumber}`,u+5,v,{align:"left"}),v+=3.5;const K=new Date(m.value.processDate),O=p.pcs_item_exp||0;console.log("Expire calculation for item:",p.pcs_item_name),console.log("Butcher date:",m.value.processDate),console.log("Exp days from items table:",O);const L=new Date(K);L.setDate(L.getDate()+O),console.log("Calculated expire date:",L.toISOString().split("T")[0]);const Z=T(L.toISOString().split("T")[0]);o.setFontSize(10),o.setFont(void 0,"normal"),o.text(`EXP: ${Z}`,u+5,v,{align:"left"}),v+=3.5;const ee=T(m.value.processDate);o.setFontSize(10),o.setFont(void 0,"normal"),o.text(`READY TO SALE: ${ee}`,u+5,v,{align:"left"}),u+=105}o.save(`butcher_process_labels_${m.value.batchNumber}.pdf`)},T=d=>{if(!d)return"-";if(typeof d=="string"&&d.includes("-")&&d.split("-").length===3){const r=d.split("-");if(r[0].length===2&&r[1].length===2&&r[2].length===4){const f=r[0],o=r[1],w=r[2],u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(o)-1]||o;return`${f}-${u}-${w}`}}const t=new Date(d),x=String(t.getDate()).padStart(2,"0"),s=t.toLocaleDateString("en-US",{month:"short"}),c=t.getFullYear();return`${x}-${s}-${c}`};return(d,t)=>(n(),i(P,null,[V(le(re),{title:"Butcher Process Details"}),V(de,null,{default:ae(()=>{var x;return[e("div",be,[a.butcherProcess?!a.butcherProcess.items||a.butcherProcess.items.length===0?(n(),i("div",xe,[t[8]||(t[8]=e("h3",null,"Warning: No items found for this Butcher Process",-1)),e("p",null,"Butcher Process ID: "+l(a.butcherProcess.id),1),e("p",null,"Number: "+l(a.butcherProcess.number),1)])):k("",!0):(n(),i("div",pe,[t[7]||(t[7]=e("h3",null,"Error: Butcher Process data not found",-1)),e("p",null,"Props received: "+l(y),1)])),e("div",fe,[e("div",he,[e("button",{onClick:t[0]||(t[0]=s=>d.$inertia.visit("/butcher-processes")),class:"text-blue-500 hover:underline"},t[9]||(t[9]=[e("i",{class:"fa fa-arrow-left"},null,-1),h(" Kembali")])),t[10]||(t[10]=e("h1",{class:"text-2xl font-bold flex items-center gap-2 ml-4"},[e("i",{class:"fa-solid fa-cut text-red-500"}),h(" Butcher Detail ")],-1))]),e("button",{onClick:t[1]||(t[1]=s=>N.value=!0),class:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors"},t[11]||(t[11]=[e("i",{class:"fas fa-print mr-2"},null,-1),h(" Print Label ")]))]),e("div",ye,[e("div",ve,[e("div",_e,[e("div",we,[e("div",Pe,[t[18]||(t[18]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Basic Information",-1)),e("div",ke,[e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700"},"Process Number",-1)),e("p",De,l(a.butcherProcess.number),1)]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700"},"Process Date",-1)),e("p",Se,l(U(a.butcherProcess.process_date)),1)]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700"},"Warehouse",-1)),e("p",Ce,l((x=a.butcherProcess.warehouse)==null?void 0:x.name),1)]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700"},"Good Receive",-1)),e("p",Ie,l(a.butcherProcess.gr_number||"-"),1)]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700"},"Created By",-1)),e("p",Ne,l(a.butcherProcess.created_by_nama_lengkap||"-"),1)]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700"},"Created At",-1)),e("p",Fe,l(z(a.butcherProcess.created_at)),1)])])]),e("div",Be,[t[20]||(t[20]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Items",-1)),e("table",Ee,[t[19]||(t[19]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Whole Item"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Whole Qty"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"PCS Item"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"PCS Qty"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Unit"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"MAC /Gram"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"MAC /Pcs")])],-1)),e("tbody",Le,[(n(!0),i(P,null,I(j(a.butcherProcess.items),(s,c)=>(n(),i(P,{key:c},[(n(!0),i(P,null,I(s.items,(r,f)=>{var o,w,b;return n(),i("tr",{key:r.id},[f===0?(n(),i("td",{key:0,class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",rowspan:s.items.length},l(((o=r.wholeItem)==null?void 0:o.name)||r.whole_item_name||"-"),9,Ae)):k("",!0),f===0?(n(),i("td",{key:1,class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",rowspan:s.items.length},l(r.whole_qty),9,$e)):k("",!0),e("td",Ue,l(((w=r.pcsItem)==null?void 0:w.name)||r.pcs_item_name||"-"),1),e("td",Te,l(r.pcs_qty),1),e("td",We,l((b=r.unit)==null?void 0:b.name),1),e("td",Me,l(r.details&&r.details.length>0?Number(r.details[0].mac_pcs).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"-"),1),e("td",Re,l(r.details&&r.details.length>0&&r.small_conversion_qty?(Number(r.details[0].mac_pcs)*Number(r.small_conversion_qty)).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"-"),1)])}),128))],64))),128))])])]),e("div",qe,[a.butcherProcess.items.length&&a.butcherProcess.items[0].details&&a.butcherProcess.items[0].details.length?(n(),i("div",He,[e("div",Oe,[e("div",null,[t[21]||(t[21]=e("b",null,"Slaughter Date:",-1)),h(" "+l(U(a.butcherProcess.items[0].details[0].slaughter_date)),1)]),e("div",null,[t[22]||(t[22]=e("b",null,"Packing Date:",-1)),h(" "+l(U(a.butcherProcess.items[0].details[0].packing_date)),1)]),e("div",null,[t[23]||(t[23]=e("b",null,"Batch Est:",-1)),h(" "+l(a.butcherProcess.items[0].details[0].batch_est),1)]),e("div",null,[t[24]||(t[24]=e("b",null,"Qty Purchase:",-1)),h(" "+l(a.butcherProcess.items[0].details[0].qty_purchase),1)]),e("div",null,[t[25]||(t[25]=e("b",null,"Susut Air Qty:",-1)),h(" "+l(a.butcherProcess.items[0].details[0].susut_air_qty),1)]),e("div",null,[t[26]||(t[26]=e("b",null,"Susut Air Unit:",-1)),h(" "+l(a.butcherProcess.items[0].details[0].susut_air_unit),1)]),e("div",null,[t[27]||(t[27]=e("b",null,"Attachment PDF:",-1)),a.butcherProcess.items[0].details[0].attachment_pdf?(n(),i("a",{key:0,href:`/storage/${a.butcherProcess.items[0].details[0].attachment_pdf}`,target:"_blank",class:"text-blue-600 underline"},"PDF",8,Ve)):(n(),i("span",Qe,"-"))]),e("div",null,[t[28]||(t[28]=e("b",null,"Upload Image:",-1)),a.butcherProcess.items[0].details[0].upload_image?(n(),i("a",{key:0,href:`/storage/${a.butcherProcess.items[0].details[0].upload_image}`,target:"_blank",class:"text-blue-600 underline"},"Image",8,ze)):(n(),i("span",je,"-"))])])])):k("",!0)]),e("div",Ge,[t[33]||(t[33]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Halal Certificates",-1)),e("div",Je,[(n(!0),i(P,null,I(a.butcherProcess.certificates,s=>(n(),i("div",{key:s.id,class:"border rounded-lg p-4"},[e("div",Ye,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700"},"Producer Name",-1)),e("p",Xe,l(s.producer_name),1)]),e("div",Ke,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium text-gray-700"},"Certificate Number",-1)),e("p",Ze,l(s.certificate_number),1)]),e("div",null,[t[32]||(t[32]=e("label",{class:"block text-sm font-medium text-gray-700"},"Certificate File",-1)),e("a",{href:s.file_url,target:"_blank",class:"mt-1 inline-flex items-center text-sm text-indigo-600 hover:text-indigo-900"},t[31]||(t[31]=[e("svg",{class:"h-5 w-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1),h(" View Certificate ")]),8,et)])]))),128))])]),a.butcherProcess.notes?(n(),i("div",tt,[t[34]||(t[34]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Notes",-1)),e("p",st,l(a.butcherProcess.notes),1)])):k("",!0)])])])]),N.value?(n(),i("div",ot,[e("div",lt,[e("div",rt,[e("div",at,[t[36]||(t[36]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Print Butcher Process Labels",-1)),e("button",{onClick:t[2]||(t[2]=s=>N.value=!1),class:"text-gray-400 hover:text-gray-600"},t[35]||(t[35]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",it,[e("div",null,[t[39]||(t[39]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Select PCS Items to Print Labels",-1)),e("div",nt,[(n(!0),i(P,null,I(a.butcherProcess.items,s=>{var c,r,f;return n(),i("div",{key:s.id,class:"flex items-center gap-3 p-3 border rounded-lg"},[$(e("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":t[3]||(t[3]=o=>D.value=o),class:"rounded border-gray-300"},null,8,dt),[[ie,D.value]]),e("div",ct,[e("div",mt,l(((c=s.pcsItem)==null?void 0:c.name)||s.pcs_item_name),1),e("div",ut," Qty: "+l(s.pcs_qty)+" "+l((r=s.unit)==null?void 0:r.name)+" | Whole: "+l(((f=s.wholeItem)==null?void 0:f.name)||s.whole_item_name)+" ("+l(s.whole_qty)+") ",1),g.value[s.pcs_item_id]&&g.value[s.pcs_item_id].length>1?(n(),i("div",gt,[t[37]||(t[37]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Select Barcode:",-1)),$(e("select",{"onUpdate:modelValue":o=>_.value[s.pcs_item_id]=o,class:"w-full text-xs px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"},[(n(!0),i(P,null,I(g.value[s.pcs_item_id],o=>(n(),i("option",{key:o.barcode,value:o.barcode},l(o.barcode),9,pt))),128))],8,bt),[[ne,_.value[s.pcs_item_id]]])])):g.value[s.pcs_item_id]&&g.value[s.pcs_item_id].length===1?(n(),i("div",xt,[e("div",ft," Barcode: "+l(g.value[s.pcs_item_id][0].barcode),1)])):(n(),i("div",ht,t[38]||(t[38]=[e("div",{class:"text-xs text-red-500"}," No barcode available ",-1)])))])])}),128))])]),e("div",yt,[e("div",null,[t[40]||(t[40]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Process Date",-1)),$(e("input",{type:"date","onUpdate:modelValue":t[4]||(t[4]=s=>m.value.processDate=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500"},null,512),[[Q,m.value.processDate]])]),e("div",null,[t[41]||(t[41]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Batch Number",-1)),$(e("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=s=>m.value.batchNumber=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Batch number"},null,512),[[Q,m.value.batchNumber]])])])]),e("div",vt,[e("button",{onClick:t[6]||(t[6]=s=>N.value=!1),class:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors"}," Cancel "),e("button",{onClick:G,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"},t[42]||(t[42]=[e("i",{class:"fas fa-print mr-2"},null,-1),h(" Print Labels ")]))])])])])):k("",!0)])]}),_:1})],64))}};export{$t as default};
