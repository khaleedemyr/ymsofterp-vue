import{r as y,c as M,w as S,L as o,E as m,B as n,D as t,G as D,l as p,N as d,O as j,F as _,H as f,J as g,I as N,M as K,R as O}from"./vendor-vue-g7iCcTkf.js";import{a as V}from"./vendor-utils-CpgP2uT4.js";import{S as z}from"./app-DvUgkxHf.js";import"./vendor-charts-CuqD4wLC.js";const P={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},$={class:"bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto"},L={class:"flex items-center justify-between p-6 border-b border-gray-200"},R={class:"text-xl font-bold text-gray-800 flex items-center gap-2"},q={key:0,class:"text-red-500 text-xs mt-1"},G={key:0,class:"text-red-500 text-xs mt-1"},H={key:0,class:"text-red-500 text-xs mt-1"},I=["value"],J={key:0,class:"text-red-500 text-xs mt-1"},Q={class:"bg-blue-50 border border-blue-200 rounded-lg p-3"},W={key:0,class:"mt-2 p-2 bg-white border border-blue-300 rounded"},X={class:"flex items-center gap-2"},Y={class:"font-mono text-sm font-bold text-blue-800 bg-blue-100 px-2 py-1 rounded"},Z={key:1,class:"mt-2 p-2 bg-white border border-blue-300 rounded"},ee={key:0,class:"text-red-500 text-xs mt-1"},te={key:0,class:"text-red-500 text-xs mt-1"},ae={class:"flex gap-3 pt-4"},se=["disabled"],re=["disabled"],le={key:0,class:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"},ue={__name:"MasterReportFormModal",props:{show:Boolean,mode:String,item:Object,type:String,departemens:Array},emits:["close","success"],setup(v,{emit:B}){const a=v,w=B,r=y({nama_departemen:"",kode_departemen:"",nama_area:"",departemen_id:"",deskripsi:"",status:"A"}),s=y({}),b=y(!1),c=y(""),k=y(!1),i=M(()=>a.mode==="edit"),C=M(()=>a.type==="departemen"?i.value?"Edit Departemen":"Tambah Departemen Baru":i.value?"Edit Area":"Tambah Area Baru");S([()=>a.show,()=>a.item,()=>a.type],()=>{a.show&&(E(),i.value&&a.item&&(a.type==="departemen"?r.value={nama_departemen:a.item.nama_departemen||"",kode_departemen:a.item.kode_departemen||"",deskripsi:a.item.deskripsi||"",status:a.item.status||"A"}:r.value={nama_area:a.item.nama_area||"",departemen_id:a.item.departemen_id||"",deskripsi:a.item.deskripsi||"",status:a.item.status||"A"}))}),S(()=>r.value.departemen_id,()=>{a.type==="area"&&!i.value&&F()});function E(){r.value={nama_departemen:"",kode_departemen:"",nama_area:"",departemen_id:"",deskripsi:"",status:"A"},s.value={}}function h(){w("close")}async function F(){if(!r.value.departemen_id){c.value="";return}k.value=!0;try{const u=await V.get("/master-report/next-area-code",{params:{departemen_id:r.value.departemen_id}});u.data.success&&(c.value=u.data.next_code)}catch(u){console.error("Error fetching next area code:",u),c.value=""}finally{k.value=!1}}async function T(){var u,e,l;b.value=!0,s.value={};try{const x=i.value?`/master-report/${a.item.id}?type=${a.type}`:`/master-report?type=${a.type}`,U=i.value?"put":"post",A=await V[U](x,{...r.value,type:a.type});A.data.success&&w("success",A.data.message)}catch(x){((u=x.response)==null?void 0:u.status)===422?s.value=x.response.data.errors:z.fire("Error",((l=(e=x.response)==null?void 0:e.data)==null?void 0:l.message)||"Terjadi kesalahan","error")}finally{b.value=!1}}return(u,e)=>v.show?(n(),o("div",P,[t("div",$,[t("div",L,[t("h2",R,[t("i",{class:p(v.type==="departemen"?"fa-solid fa-building text-blue-500":"fa-solid fa-map-marker-alt text-green-500")},null,2),D(" "+d(C.value),1)]),t("button",{onClick:h,class:"text-gray-400 hover:text-gray-600 transition"},e[6]||(e[6]=[t("i",{class:"fa-solid fa-times text-xl"},null,-1)]))]),t("form",{onSubmit:j(T,["prevent"]),class:"p-6 space-y-4"},[v.type==="departemen"?(n(),o(_,{key:0},[t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nama Departemen *",-1)),f(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>r.value.nama_departemen=l),type:"text",class:p(["w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"border-red-500":s.value.nama_departemen}]),placeholder:"Masukkan nama departemen"},null,2),[[g,r.value.nama_departemen]]),s.value.nama_departemen?(n(),o("p",q,d(s.value.nama_departemen[0]),1)):m("",!0)]),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Kode Departemen *",-1)),f(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>r.value.kode_departemen=l),type:"text",class:p(["w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition font-mono",{"border-red-500":s.value.kode_departemen}]),placeholder:"Masukkan kode departemen"},null,2),[[g,r.value.kode_departemen]]),s.value.kode_departemen?(n(),o("p",G,d(s.value.kode_departemen[0]),1)):m("",!0)])],64)):(n(),o(_,{key:1},[t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nama Area *",-1)),f(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>r.value.nama_area=l),type:"text",class:p(["w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"border-red-500":s.value.nama_area}]),placeholder:"Masukkan nama area"},null,2),[[g,r.value.nama_area]]),s.value.nama_area?(n(),o("p",H,d(s.value.nama_area[0]),1)):m("",!0)]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Departemen *",-1)),f(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>r.value.departemen_id=l),class:p(["w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"border-red-500":s.value.departemen_id}])},[e[10]||(e[10]=t("option",{value:""},"Pilih Departemen",-1)),(n(!0),o(_,null,K(v.departemens,l=>(n(),o("option",{key:l.id,value:l.id},d(l.nama_departemen),9,I))),128))],2),[[N,r.value.departemen_id]]),s.value.departemen_id?(n(),o("p",J,d(s.value.departemen_id[0]),1)):m("",!0)]),t("div",Q,[e[15]||(e[15]=O('<div class="flex items-center gap-2"><i class="fa-solid fa-info-circle text-blue-500"></i><span class="text-sm font-medium text-blue-700">Kode Area Otomatis</span></div><p class="text-xs text-blue-600 mt-1"> Kode area akan dibuat otomatis dengan sequence berdasarkan data terakhir. <br><span class="font-mono text-xs">Format: OPS + 3 digit nomor urut</span></p>',2)),c.value?(n(),o("div",W,[t("div",X,[e[12]||(e[12]=t("i",{class:"fa-solid fa-eye text-blue-500"},null,-1)),e[13]||(e[13]=t("span",{class:"text-xs font-medium text-blue-700"},"Preview Kode:",-1)),t("span",Y,d(c.value),1)])])):k.value?(n(),o("div",Z,e[14]||(e[14]=[t("div",{class:"flex items-center gap-2"},[t("div",{class:"animate-spin rounded-full h-3 w-3 border-2 border-blue-500 border-t-transparent"}),t("span",{class:"text-xs text-blue-600"},"Mengambil kode berikutnya...")],-1)]))):m("",!0)])],64)),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Deskripsi",-1)),f(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=l=>r.value.deskripsi=l),rows:"3",class:p(["w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition resize-none",{"border-red-500":s.value.deskripsi}]),placeholder:"Masukkan deskripsi (opsional)"},null,2),[[g,r.value.deskripsi]]),s.value.deskripsi?(n(),o("p",ee,d(s.value.deskripsi[0]),1)):m("",!0)]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Status *",-1)),f(t("select",{"onUpdate:modelValue":e[5]||(e[5]=l=>r.value.status=l),class:p(["w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",{"border-red-500":s.value.status}])},e[17]||(e[17]=[t("option",{value:"A"},"Aktif",-1),t("option",{value:"N"},"Non-Aktif",-1)]),2),[[N,r.value.status]]),s.value.status?(n(),o("p",te,d(s.value.status[0]),1)):m("",!0)]),t("div",ae,[t("button",{type:"button",onClick:h,class:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition font-medium",disabled:b.value}," Batal ",8,se),t("button",{type:"submit",class:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium flex items-center justify-center gap-2",disabled:b.value},[b.value?(n(),o("div",le)):(n(),o("i",{key:1,class:p(i.value?"fa-solid fa-save":"fa-solid fa-plus")},null,2)),D(" "+d(b.value?"Menyimpan...":i.value?"Simpan":"Tambah"),1)],8,re)])],32)])])):m("",!0)}};export{ue as default};
