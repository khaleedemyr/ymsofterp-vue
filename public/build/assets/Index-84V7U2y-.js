import{r as c,w as X,A as Z,B as r,C as L,D as t,L as l,E as x,x as ee,G as f,Q as te,S as ae,H as _,J as A,F as B,M as D,N as u,l as $,I as se,W as m}from"./vendor-vue-g7iCcTkf.js";import{A as oe}from"./AppLayout-U5X72hCR.js";import{S as i}from"./app-CMkuePvF.js";import{a as re}from"./vendor-utils-CpgP2uT4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-DCdSPjRr.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const ne={class:"w-full py-8 px-0"},le={class:"flex justify-between items-center mb-6"},ue={class:"flex flex-wrap gap-3 mb-4 items-center"},ie={class:"bg-white rounded-2xl shadow-2xl overflow-x-auto transition-all"},de={class:"w-full min-w-full divide-y divide-gray-200"},pe={key:0},ce={class:"px-6 py-3 font-mono font-semibold text-blue-700"},fe={class:"px-6 py-3"},be={class:"px-6 py-3"},xe={class:"px-6 py-3"},me={class:"px-6 py-3"},ge={class:"px-6 py-3"},he={class:"px-6 py-3"},ve={class:"px-6 py-3"},ye={class:"px-6 py-3"},we={class:"flex gap-2 flex-wrap"},ke=["onClick"],_e=["onClick"],Ce=["onClick"],Se=["onClick"],Te={class:"flex justify-end mt-4 gap-2"},Ae=["disabled","onClick","innerHTML"],Be={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40"},De={class:"bg-white rounded-xl shadow-2xl w-full max-w-md p-6"},je={class:"mb-4"},Oe=["value"],Me={class:"flex justify-end gap-3"},Ne=["disabled"],Ee={key:0,class:"fa fa-spinner fa-spin mr-2"},Je={__name:"Index",props:{transfers:Object,filters:Object,outlets:Object,user:Object,users:Array,canDelete:Boolean},setup(b){var E,P,V;const n=b,h=c(((E=n.filters)==null?void 0:E.search)||""),v=c(((P=n.filters)==null?void 0:P.from)||""),y=c(((V=n.filters)==null?void 0:V.to)||""),C=c(!1),w=c(null),d=c([]),k=c(!1);X(()=>n.filters,s=>{h.value=(s==null?void 0:s.search)||"",v.value=(s==null?void 0:s.from)||"",y.value=(s==null?void 0:s.to)||""},{immediate:!0});function F(s){return s?new Date(s).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"}):"-"}function j(s){var e;return!s||!n.outlets?"-":((e=n.outlets[s])==null?void 0:e.nama_outlet)||"-"}function O(){m.get("/outlet-transfer",{search:h.value,from:v.value,to:y.value},{preserveState:!0,replace:!0})}function H(){O()}function M(){O()}function U(s){s&&m.visit(s,{preserveState:!0,replace:!0})}function W(s){m.visit(`/outlet-transfer/${s}`)}function z(s){return{draft:"Draft",submitted:"Menunggu Approval",approved:"Disetujui",rejected:"Ditolak"}[s]||s}function J(s){return{draft:"bg-gray-100 text-gray-800",submitted:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"}[s]||"bg-gray-100 text-gray-800"}function G(s){const a=((s==null?void 0:s.approval_flows)||[]).filter(o=>(o==null?void 0:o.status)==="PENDING");return a.sort((o,p)=>(o.approval_level??0)-(p.approval_level??0)),a[0]||null}function Y(s){var g;if(!n.user||!((g=s.warehouse_outlet_to)!=null&&g.name))return!1;const e=n.user.id_jabatan,a=n.user.status;if(n.user.id_role==="5af56935b011a"&&a==="A")return!0;const p=G(s);if(p)return p.approver_id==n.user.id;switch(s.warehouse_outlet_to.name){case"Kitchen":return[163,174,180,345,346,347,348,349].includes(e)&&a==="A";case"Bar":return[175,182,323].includes(e)&&a==="A";case"Service":return[176,322,164,321].includes(e)&&a==="A";default:return!1}}function q(s){s&&(w.value=s,d.value=[],C.value=!0)}function N(){C.value=!1,w.value=null,d.value=[]}async function K(){if(w.value){if(!d.value||d.value.length===0){i.fire("Error!","Pilih minimal 1 approver.","error");return}k.value=!0;try{await re.post(route("outlet-transfer.submit",w.value),{approvers:d.value}),N(),i.fire("Berhasil!","Transfer berhasil di-submit untuk approval.","success"),m.reload({preserveScroll:!0})}catch{i.fire("Error!","Terjadi kesalahan saat submit transfer.","error")}finally{k.value=!1}}}function Q(s){s&&i.fire({title:"Approve Transfer?",text:"Transfer akan disetujui dan stock akan dipindahkan.",icon:"question",showCancelButton:!0,confirmButtonColor:"#28a745",cancelButtonColor:"#d33",confirmButtonText:"Ya, Approve!",cancelButtonText:"Batal",input:"textarea",inputPlaceholder:"Catatan approval (opsional)",inputAttributes:{"aria-label":"Catatan approval"}}).then(e=>{e.isConfirmed&&m.post(route("outlet-transfer.approve",s),{action:"approve",comments:e.value||""},{onSuccess:()=>{i.fire("Berhasil!","Transfer berhasil di-approve.","success")},onError:()=>{i.fire("Error!","Terjadi kesalahan saat approve transfer.","error")}})})}function R(s){s&&i.fire({title:"Apakah Anda yakin?",text:"Data yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"}).then(e=>{e.isConfirmed&&m.delete(route("outlet-transfer.destroy",s),{onSuccess:()=>{i.fire("Terhapus!","Data berhasil dihapus.","success")},onError:()=>{i.fire("Error!","Terjadi kesalahan saat menghapus data.","error")}})})}return(s,e)=>(r(),Z(oe,null,{default:L(()=>[t("div",ne,[t("div",le,[e[5]||(e[5]=t("h1",{class:"text-2xl font-bold text-gray-800 flex items-center gap-2"},[t("i",{class:"fa-solid fa-right-left"}),f(" Pindah Outlet ")],-1)),ee(te(ae),{href:s.route("outlet-transfer.create"),class:"bg-gradient-to-r from-blue-500 to-blue-700 text-white px-4 py-2 rounded-xl shadow-lg hover:shadow-2xl transition-all font-semibold"},{default:L(()=>e[4]||(e[4]=[f(" + Buat Pindah Outlet ")])),_:1},8,["href"])]),t("div",ue,[_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),onInput:H,type:"text",placeholder:"Cari nomor transfer/warehouse outlet...",class:"w-64 px-4 py-2 rounded-xl border border-blue-200 shadow focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition"},null,544),[[A,h.value]]),_(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=a=>v.value=a),onChange:M,class:"px-2 py-2 rounded-xl border border-blue-200 shadow focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition",placeholder:"Dari tanggal"},null,544),[[A,v.value]]),e[6]||(e[6]=t("span",null,"-",-1)),_(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=a=>y.value=a),onChange:M,class:"px-2 py-2 rounded-xl border border-blue-200 shadow focus:ring-2 focus:ring-blue-400 focus-border-blue-400 transition",placeholder:"Sampai tanggal"},null,544),[[A,y.value]])]),t("div",ie,[t("table",de,[e[12]||(e[12]=t("thead",{class:"bg-gradient-to-r from-blue-50 to-blue-100"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider rounded-tl-2xl"},"Nomor"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Tanggal"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Outlet Asal"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Warehouse Outlet Asal"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Outlet Tujuan"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Warehouse Outlet Tujuan"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Status"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Dibuat Oleh"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider rounded-tr-2xl"},"Aksi")])],-1)),t("tbody",null,[!b.transfers.data||!b.transfers.data.length?(r(),l("tr",pe,e[7]||(e[7]=[t("td",{colspan:"9",class:"text-center py-10 text-gray-400"},"Belum ada data Pindah Outlet.",-1)]))):x("",!0),(r(!0),l(B,null,D(b.transfers.data,a=>{var o,p,S,g,I;return r(),l("tr",{key:a.id,class:"hover:bg-blue-50 transition shadow-sm"},[t("td",ce,u(a.transfer_number),1),t("td",fe,u(F(a.transfer_date)),1),t("td",be,u(j((o=a.warehouse_outlet_from)==null?void 0:o.outlet_id)),1),t("td",xe,u((p=a.warehouse_outlet_from)==null?void 0:p.name),1),t("td",me,u(j((S=a.warehouse_outlet_to)==null?void 0:S.outlet_id)),1),t("td",ge,u((g=a.warehouse_outlet_to)==null?void 0:g.name),1),t("td",he,[t("span",{class:$(["px-2 py-1 text-xs font-semibold rounded-full",J(a.status)])},u(z(a.status)),3)]),t("td",ve,u((I=a.creator)==null?void 0:I.nama_lengkap),1),t("td",ye,[t("div",we,[t("button",{onClick:T=>W(a.id),class:"inline-flex items-center btn btn-xs bg-blue-100 text-blue-800 hover:bg-blue-200 rounded px-2 py-1 font-semibold transition"},e[8]||(e[8]=[t("i",{class:"fa fa-eye mr-1"},null,-1),f(" Detail ")]),8,ke),a.status==="draft"?(r(),l("button",{key:0,onClick:T=>q(a.id),class:"inline-flex items-center btn btn-xs bg-green-100 text-green-800 hover:bg-green-200 rounded px-2 py-1 font-semibold transition"},e[9]||(e[9]=[t("i",{class:"fa fa-paper-plane mr-1"},null,-1),f(" Submit ")]),8,_e)):x("",!0),a.status==="submitted"&&Y(a)?(r(),l("button",{key:1,onClick:T=>Q(a.id),class:"inline-flex items-center btn btn-xs bg-yellow-100 text-yellow-800 hover:bg-yellow-200 rounded px-2 py-1 font-semibold transition"},e[10]||(e[10]=[t("i",{class:"fa fa-check mr-1"},null,-1),f(" Approve ")]),8,Ce)):x("",!0),a.status==="draft"&&n.canDelete?(r(),l("button",{key:2,onClick:T=>R(a.id),class:"inline-flex items-center btn btn-xs bg-red-100 text-red-700 hover:bg-red-200 rounded px-2 py-1 font-semibold transition"},e[11]||(e[11]=[t("i",{class:"fa fa-trash mr-1"},null,-1),f(" Hapus ")]),8,Se)):x("",!0)])])])}),128))])])]),t("div",Te,[(r(!0),l(B,null,D(b.transfers.links,a=>(r(),l("button",{key:a.label,disabled:!a.url,onClick:o=>U(a.url),innerHTML:a.label,class:$(["px-3 py-1 rounded-lg border text-sm font-semibold",[a.active?"bg-blue-600 text-white shadow-lg":"bg-white text-blue-700 hover:bg-blue-50",a.url?"cursor-pointer":"opacity-50 cursor-not-allowed"]])},null,10,Ae))),128))])]),C.value?(r(),l("div",Be,[t("div",De,[e[16]||(e[16]=t("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"Submit untuk Approval",-1)),t("div",je,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Pilih Approvers (berurutan dari terendah ke tertinggi)",-1)),_(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>d.value=a),multiple:"",size:"8",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},[(r(!0),l(B,null,D(b.users||[],a=>{var o;return r(),l("option",{key:a.id,value:a.id},u(a.nama_lengkap)+" - "+u(((o=a.jabatan)==null?void 0:o.nama_jabatan)||"-"),9,Oe)}),128))],512),[[se,d.value]]),e[14]||(e[14]=t("p",{class:"mt-2 text-xs text-gray-500"},"Jika ingin multi approval, pilih lebih dari 1 approver. Approver level tertinggi akan eksekusi pindah stok saat approve terakhir.",-1))]),t("div",Me,[t("button",{onClick:N,class:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600"}," Batal "),t("button",{onClick:K,disabled:k.value||d.value.length===0,class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50"},[k.value?(r(),l("i",Ee)):x("",!0),e[15]||(e[15]=f(" Submit "))],8,Ne)])])])):x("",!0)]),_:1}))}};export{Je as default};
