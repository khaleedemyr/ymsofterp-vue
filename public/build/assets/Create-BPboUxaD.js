import{$ as xe,c as O,r as b,w as $,a as Se,b as Te,A as Ce,B as n,C as F,D as s,G as p,N as d,O as G,L as u,E as m,H as x,I as P,J as N,F as D,M as j,l as oe,x as qe,Q as Ae,W as R}from"./vendor-vue-g7iCcTkf.js";import{A as Ie}from"./AppLayout-hxs5t3XP.js";import{a as q}from"./vendor-utils-CpgP2uT4.js";import{S as y}from"./app-D6rf3j_5.js";import{s as Be}from"./vue-multiselect.esm-V-bx43V9.js";/* empty css                            */import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-D4k-zQf5.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const De={class:"min-h-screen bg-gray-50 py-8 px-4 md:px-8"},je={class:"w-full max-w-5xl mx-auto bg-white rounded-2xl shadow-2xl p-6 md:p-8"},Ve={class:"text-2xl font-bold mb-8 flex items-center gap-2 text-green-700"},$e={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Fe=["disabled"],Ue=["value"],Me=["value"],Ee={class:"space-y-4"},Oe={class:"flex justify-between items-center"},Ge=["disabled"],Pe={key:0,class:"text-center py-8 text-gray-400 border-2 border-dashed rounded-lg"},Re={class:"flex justify-between items-start mb-2"},We={class:"font-medium text-gray-800"},Le=["onClick","disabled"],Ke={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},He={class:"md:col-span-2"},Qe={class:"flex items-center justify-between"},ze={class:"font-medium text-gray-900"},Xe={class:"text-sm text-gray-500"},Je={key:0},Ye={key:1},Ze={key:2},et={key:0,class:"text-xs text-yellow-600 mt-1"},tt={key:0,class:"ml-1"},at=["onUpdate:modelValue","disabled"],st=["value","disabled"],lt={class:"md:col-span-2"},ot=["onUpdate:modelValue"],it={class:"flex justify-center pt-2"},nt=["disabled"],ut={key:0,class:"mb-6"},rt={class:"mb-4"},dt={class:"relative"},mt={key:0,class:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto"},vt=["onMousedown"],pt={class:"font-medium"},ct={class:"text-sm text-gray-600"},ft={key:0,class:"text-xs text-blue-600 font-medium"},_t={key:0,class:"space-y-2"},bt={class:"flex items-center space-x-3"},yt={class:"flex items-center space-x-2"},gt=["onClick"],ht=["onClick"],kt={class:"flex items-center space-x-2"},wt={class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},xt={class:"font-medium"},St={class:"text-sm text-gray-600"},Tt={key:0,class:"text-xs text-blue-600 font-medium"},Ct=["onClick"],qt={key:1,class:"text-sm text-amber-600 bg-amber-50 border border-amber-200 rounded-md p-3"},At={class:"flex justify-between items-center mt-8"},It={class:"flex items-center gap-2 text-sm text-gray-500"},Bt={key:0},Nt={key:1},Dt={class:"flex justify-end gap-2"},jt=["disabled"],Vt={key:0},$t={key:1},Ft=["disabled"],Ut={key:0},Mt={key:1},Et={__name:"Create",props:{outlets:Array,items:Array,warehouse_outlets:Array,header:Object,details:Array,approvalFlows:Array,isEdit:Boolean},setup(W){var J,Y,Z,ee,te,ae;const r=W,L=xe(),A=O(()=>{var a,e;return((e=(a=L.props.auth)==null?void 0:a.user)==null?void 0:e.id_outlet)||""}),I=b(r.warehouse_outlets||[]),U=O(()=>r.isEdit||!1);function K(){return{id:Date.now()+Math.random(),item_id:"",item_name:"",selectedItem:null,qty:"",unit_id:"",unit_name:"",note:"",stock:null}}const t=b({header_id:((J=r.header)==null?void 0:J.id)||null,type:((Y=r.header)==null?void 0:Y.type)||"internal_use",date:((Z=r.header)==null?void 0:Z.date)||"",outlet_id:((ee=r.header)==null?void 0:ee.outlet_id)||(A.value==1?"":A.value),notes:((te=r.header)==null?void 0:te.notes)||"",items:r.details&&r.details.length>0?r.details.map(a=>{const e=r.items.find(l=>l.id==a.item_id)||null;return{id:Date.now()+Math.random(),item_id:a.item_id,item_name:a.item_name||"",selectedItem:e,qty:a.qty,unit_id:a.unit_id,unit_name:a.unit_name||"",note:a.note||"",stock:null}}):[K()],warehouse_outlet_id:((ae=r.header)==null?void 0:ae.warehouse_outlet_id)||"",approvers:r.approvalFlows&&r.approvalFlows.length>0?r.approvalFlows.map(a=>({id:a.approver_id,name:a.name,email:a.email,jabatan:a.jabatan})):[]}),c=b(null),V=b(null),S=b(!1),T=b(!1),h=b(!1),C=b(""),k=b([]),w=b(!1),ie=O(()=>A.value!=1),v=b(!1);$(()=>t.value.outlet_id,async a=>{if((!U.value||!t.value.warehouse_outlet_id)&&(t.value.warehouse_outlet_id=""),a&&A.value==1)try{const e=await q.get(`/api/warehouse-outlets/by-outlet/${a}`);I.value=e.data}catch(e){console.error("Error fetching warehouse outlets:",e),I.value=[]}else a&&A.value!=1?I.value=r.warehouse_outlets.filter(e=>e.outlet_id==a):I.value=[]},{immediate:!0}),Se(async()=>{if(U.value&&t.value.warehouse_outlet_id)for(let a=0;a<t.value.items.length;a++)t.value.items[a].item_id&&await B(a)});function H(){t.value.items.push(K())}function ne(a){t.value.items.length!==1&&t.value.items.splice(a,1)}function ue(a,e){!a||!a.id||(t.value.items[e].item_id=a.id,t.value.items[e].item_name=a.name,t.value.items[e].selectedItem=a,de(e,a.id),t.value.warehouse_outlet_id&&t.value.outlet_id&&B(e))}function re(a){t.value.items[a].item_id="",t.value.items[a].item_name="",t.value.items[a].selectedItem=null,t.value.items[a].unit_id="",t.value.items[a].unit_name="",t.value.items[a].stock=null}async function de(a,e){if(e){const l=await q.get(`/outlet-internal-use-waste/get-item-units/${e}`);l.data.units&&l.data.units.length>0?(t.value.items[a].unit_id=l.data.units[0].id,t.value.items[a].unit_name=l.data.units[0].name):(t.value.items[a].unit_id="",t.value.items[a].unit_name="")}else t.value.items[a].unit_id="",t.value.items[a].unit_name=""}function me(a){return a.unit_name||""}async function ve(){if(!t.value.warehouse_outlet_id||!t.value.outlet_id)return{valid:!1,message:"Pilih outlet dan warehouse outlet terlebih dahulu"};for(let a=0;a<t.value.items.length;a++){const e=t.value.items[a];if(!(!e.item_id||!e.qty||e.qty<=0))if(e.stock){if(Number(e.stock.qty_small||0)<=0)return{valid:!1,message:`Stok item "${e.item_name||"Item"}" tidak tersedia (stock: 0). Tidak dapat menyimpan draft.`}}else try{if(await B(a),t.value.items[a].stock&&Number(t.value.items[a].stock.qty_small||0)<=0)return{valid:!1,message:`Stok item "${t.value.items[a].item_name||"Item"}" tidak tersedia (stock: 0). Tidak dapat menyimpan draft.`}}catch(l){console.warn("Could not fetch stock for item:",l)}}return{valid:!0}}async function pe(){if(!t.value.warehouse_outlet_id||!t.value.outlet_id)return{valid:!1,message:"Pilih outlet dan warehouse outlet terlebih dahulu"};if(t.value.items.filter(e=>e.item_id&&e.qty>0).length===0)return{valid:!1,message:"Tidak ada item yang dapat di-submit. Silakan tambahkan item terlebih dahulu."};for(let e=0;e<t.value.items.length;e++){const l=t.value.items[e];if(!(!l.item_id||!l.qty||l.qty<=0)){if(!l.stock)try{await B(e)}catch(i){console.warn("Could not fetch stock for item:",i)}if(l.stock){const i=Number(l.stock.qty_small||0),o=Number(l.qty||0);if(i<=0)return{valid:!1,message:`Stok item "${l.item_name||"Item"}" tidak tersedia (stock: 0). Tidak dapat di-submit.`};if(o>i)return{valid:!1,message:`Qty item "${l.item_name||"Item"}" (${o}) melebihi stok yang tersedia (${i.toFixed(2)}). Tidak dapat di-submit.`}}else return{valid:!1,message:`Stok item "${l.item_name||"Item"}" tidak ditemukan. Tidak dapat di-submit.`}}}return{valid:!0}}async function ce(){var l,i;if(T.value){console.log("Autosave already in progress, skipping...");return}if(!t.value.type||!t.value.date||!t.value.outlet_id||!t.value.warehouse_outlet_id){console.log("Autosave skipped: Missing required fields",{type:t.value.type,date:t.value.date,outlet_id:t.value.outlet_id,warehouse_outlet_id:t.value.warehouse_outlet_id});return}const a=t.value.items.filter(o=>o.item_id&&o.qty>0);console.log("Autosave: Triggered",{type:t.value.type,date:t.value.date,outlet_id:t.value.outlet_id,warehouse_outlet_id:t.value.warehouse_outlet_id,validItemsCount:a.length,totalItemsCount:t.value.items.length}),T.value=!0,S.value=!0;const e={type:t.value.type,date:t.value.date,outlet_id:t.value.outlet_id,warehouse_outlet_id:t.value.warehouse_outlet_id,notes:t.value.notes,items:t.value.items.filter(o=>o.item_id&&o.qty>0).map(o=>({item_id:o.item_id,qty:o.qty,unit_id:o.unit_id,note:o.note||null})),approvers:t.value.approvers.map(o=>o.id),autosave:!0};console.log("Autosave: Saving draft for outlet:",t.value.outlet_id,"warehouse:",t.value.warehouse_outlet_id,"type:",t.value.type);try{const o=await q.post(route("outlet-internal-use-waste.store"),e,{headers:{Accept:"application/json","Content-Type":"application/json"}});o.data.success?(o.data.header_id&&(t.value.header_id=o.data.header_id,console.log("✅ Autosave: Draft saved/updated with header_id:",o.data.header_id)),V.value=new Date):console.error("❌ Autosave failed: Response not successful",o.data)}catch(o){console.error("❌ Autosave failed:",o),console.error("Error details:",{message:o.message,response:(l=o.response)==null?void 0:l.data,status:(i=o.response)==null?void 0:i.status})}finally{S.value=!1,T.value=!1}}$(()=>[t.value.type,t.value.date,t.value.outlet_id,t.value.warehouse_outlet_id,t.value.notes,t.value.items,t.value.approvers],()=>{if(!T.value){if(h.value||v.value){console.log("Autosave skipped: Submit or save in progress");return}c.value&&clearTimeout(c.value),c.value=setTimeout(()=>{!h.value&&!v.value&&!T.value&&(console.log("Autosave: Triggered after 3 seconds"),ce())},3e3)}},{deep:!0});async function fe(){var l,i;if(v.value||h.value){console.log("Save draft: Already in progress, skipping...");return}for(v.value=!0,c.value&&(clearTimeout(c.value),c.value=null);T.value;)await new Promise(o=>setTimeout(o,100));const a=await ve();if(!a.valid){y.fire({icon:"error",title:"Validasi Gagal",text:a.message,confirmButtonText:"OK",confirmButtonColor:"#EF4444"}),v.value=!1;return}const e={type:t.value.type,date:t.value.date,outlet_id:t.value.outlet_id,warehouse_outlet_id:t.value.warehouse_outlet_id,notes:t.value.notes,items:t.value.items.map(o=>({item_id:o.item_id,qty:o.qty,unit_id:o.unit_id,note:o.note||null})),approvers:t.value.approvers.map(o=>o.id),autosave:!1};try{const o=await q.post(route("outlet-internal-use-waste.store"),e,{headers:{Accept:"application/json","Content-Type":"application/json"}});o.data.success&&(o.data.header_id&&(t.value.header_id=o.data.header_id,console.log("Save draft: Draft saved/updated with header_id:",o.data.header_id)),V.value=new Date,y.fire({icon:"success",title:"Berhasil",text:"Draft berhasil disimpan",timer:1500,showConfirmButton:!1}))}catch(o){console.error("Save draft failed:",o);const f=((i=(l=o.response)==null?void 0:l.data)==null?void 0:i.message)||o.message||"Gagal menyimpan draft";y.fire({icon:"error",title:"Gagal",text:f,confirmButtonText:"OK",confirmButtonColor:"#EF4444"})}finally{v.value=!1}}async function Q(){var a,e,l;if(h.value){console.log("Submit already in progress, ignoring duplicate call");return}if(v.value){console.log("Already loading, ignoring submit call");return}for(h.value=!0,c.value&&(clearTimeout(c.value),c.value=null);T.value;)await new Promise(i=>setTimeout(i,100));try{if((t.value.type==="r_and_d"||t.value.type==="marketing"||t.value.type==="wrong_maker"||t.value.type==="training")&&(!t.value.approvers||t.value.approvers.length===0)){y.fire({icon:"error",title:"Validasi Gagal",text:"Tipe ini wajib memiliki minimal 1 approver"}),h.value=!1;return}const o=await pe();if(!o.valid){y.fire({icon:"error",title:"Validasi Stock Gagal",text:o.message,confirmButtonText:"OK",confirmButtonColor:"#EF4444"}),h.value=!1;return}v.value=!0;const f={type:t.value.type,date:t.value.date,outlet_id:t.value.outlet_id,warehouse_outlet_id:t.value.warehouse_outlet_id,notes:t.value.notes,items:t.value.items.filter(_=>_.item_id&&_.qty>0).map(_=>({item_id:_.item_id,qty:_.qty,unit_id:_.unit_id,note:_.note||null})),approvers:t.value.approvers.map(_=>_.id)},se=t.value.header_id?route("outlet-internal-use-waste.submit",t.value.header_id):route("outlet-internal-use-waste.store-and-submit"),le=t.value.header_id?{approvers:t.value.approvers.map(_=>_.id)}:f;console.log("Calling submit endpoint:",se,le);const g=await q.post(se,le,{headers:{Accept:"application/json","Content-Type":"application/json"}});if(console.log("Submit response:",g.data),g.data.success){if(g.data.current_status&&g.data.current_status!=="DRAFT"&&g.data.current_status!==g.data.status){y.fire({icon:"info",title:"Sudah Di-submit",text:"Data ini sudah di-submit sebelumnya. Status: "+g.data.current_status,timer:2e3,showConfirmButton:!1}).then(()=>{R.visit(route("outlet-internal-use-waste.index"))});return}y.fire({icon:"success",title:"Berhasil",text:g.data.message||"Data berhasil di-submit",timer:1500,showConfirmButton:!1}).then(()=>{R.visit(route("outlet-internal-use-waste.index"))})}else y.fire({icon:"error",title:"Gagal Submit",text:g.data.message||"Gagal submit data",confirmButtonText:"OK",confirmButtonColor:"#EF4444"})}catch(i){console.error("Submit failed:",i),console.error("Error response:",(a=i.response)==null?void 0:a.data);const o=((l=(e=i.response)==null?void 0:e.data)==null?void 0:l.message)||i.message||"Gagal submit data";y.fire({icon:"error",title:"Gagal Submit",text:o,confirmButtonText:"OK",confirmButtonColor:"#EF4444"})}finally{v.value=!1,h.value=!1}}function _e(){R.visit(route("outlet-internal-use-waste.index"))}let M=null;const be=()=>{M&&clearTimeout(M),C.value.length>=2?M=setTimeout(()=>{z(C.value)},300):(k.value=[],w.value=!1)},ye=()=>{C.value.length>=2&&z(C.value)},ge=()=>{setTimeout(()=>{w.value=!1},200)},z=async(a="")=>{if(!a||a.length<2){k.value=[],w.value=!1;return}try{const e=await q.get("/outlet-internal-use-waste/approvers",{params:{search:a},headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}});e.data.success?(k.value=e.data.users,w.value=!0):(k.value=[],w.value=!1)}catch(e){console.error("Failed to load approvers:",e),k.value=[],w.value=!1}},he=a=>{t.value.approvers.find(e=>e.id===a.id)||t.value.approvers.push(a),C.value="",w.value=!1,k.value=[]},ke=a=>{t.value.approvers.splice(a,1)},X=(a,e)=>{const l=t.value.approvers.splice(a,1)[0];t.value.approvers.splice(e,0,l)};$(()=>L.props.flash,a=>{a!=null&&a.error&&y.fire({icon:"error",title:"Gagal Menyimpan Data",html:a.error,confirmButtonText:"OK",confirmButtonColor:"#EF4444",width:"600px"})},{immediate:!0});async function B(a){const e=t.value.items[a];if(!(!e.item_id||!t.value.warehouse_outlet_id||!t.value.outlet_id))try{const l=await q.get("/api/outlet-inventory/stock",{params:{item_id:e.item_id,warehouse_outlet_id:t.value.warehouse_outlet_id,outlet_id:t.value.outlet_id}});e.stock=l.data}catch(l){console.error("Error fetching stock:",l),e.stock={qty_small:0,qty_medium:0,qty_large:0,unit_small:"",unit_medium:"",unit_large:""}}}function E(a){return a==null?0:Number(a)%1===0?Number(a):Number(a).toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:2})}function we(a){if(!a.stock)return"Stok: 0";const e=Number(a.stock.qty_small||0),l=Number(a.stock.qty_medium||0),i=Number(a.stock.qty_large||0);let o="Stok: ";const f=[];return(e>0||a.stock.unit_small)&&f.push(`${E(e)} ${a.stock.unit_small||""}`),(l>0||a.stock.unit_medium)&&f.push(`${E(l)} ${a.stock.unit_medium||""}`),(i>0||a.stock.unit_large)&&f.push(`${E(i)} ${a.stock.unit_large||""}`),f.length===0?"Stok: 0":o+f.join(" | ")}return $(()=>t.value.warehouse_outlet_id,a=>{t.value.items.forEach((e,l)=>{e.item_id&&a&&B(l)})}),Te(()=>{c.value&&clearTimeout(c.value)}),(a,e)=>(n(),Ce(Ie,null,{default:F(()=>[s("div",De,[s("div",je,[s("h1",Ve,[e[7]||(e[7]=s("i",{class:"fa-solid fa-recycle text-green-500"},null,-1)),p(" "+d(U.value?"Edit":"Input")+" Category Cost Outlet ",1)]),s("form",{onSubmit:[G(Q,["prevent"]),e[6]||(e[6]=G(()=>{},["prevent","stop"]))],class:"space-y-5"},[s("div",$e,[s("div",null,[e[9]||(e[9]=s("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Tipe",-1)),x(s("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>t.value.type=l),class:"input input-bordered w-full",required:""},e[8]||(e[8]=[s("option",{value:""},"Pilih Tipe",-1),s("option",{value:"internal_use"},"Internal Use",-1),s("option",{value:"spoil"},"Spoil",-1),s("option",{value:"waste"},"Waste",-1),s("option",{value:"r_and_d"},"R & D",-1),s("option",{value:"marketing"},"Marketing",-1),s("option",{value:"non_commodity"},"Non Commodity",-1),s("option",{value:"guest_supplies"},"Guest Supplies",-1),s("option",{value:"wrong_maker"},"Wrong Maker",-1),s("option",{value:"training"},"Training",-1)]),512),[[P,t.value.type]])]),s("div",null,[e[10]||(e[10]=s("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Tanggal",-1)),x(s("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=l=>t.value.date=l),class:"input input-bordered w-full",required:""},null,512),[[N,t.value.date]])]),s("div",null,[e[12]||(e[12]=s("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Outlet",-1)),x(s("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.outlet_id=l),disabled:ie.value,class:"input input-bordered w-full",required:""},[e[11]||(e[11]=s("option",{value:""},"Pilih Outlet",-1)),(n(!0),u(D,null,j(r.outlets,l=>(n(),u("option",{key:l.id_outlet,value:l.id_outlet},d(l.nama_outlet),9,Ue))),128))],8,Fe),[[P,t.value.outlet_id]])]),s("div",null,[e[14]||(e[14]=s("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Warehouse Outlet",-1)),x(s("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.warehouse_outlet_id=l),class:"input input-bordered w-full",required:""},[e[13]||(e[13]=s("option",{value:""},"Pilih Warehouse Outlet",-1)),(n(!0),u(D,null,j(I.value,l=>(n(),u("option",{key:l.id,value:l.id},d(l.name),9,Me))),128))],512),[[P,t.value.warehouse_outlet_id]])])]),s("div",Ee,[s("div",Oe,[e[16]||(e[16]=s("h3",{class:"font-semibold text-gray-700"},"Items",-1)),s("button",{type:"button",onClick:H,class:"btn btn-sm btn-primary",disabled:!t.value.warehouse_outlet_id},e[15]||(e[15]=[s("i",{class:"fa fa-plus mr-1"},null,-1),p(" Tambah Item ")]),8,Ge)]),t.value.items.length===0?(n(),u("div",Pe,e[17]||(e[17]=[s("i",{class:"fa fa-box-open text-4xl mb-2"},null,-1),s("p",null,'Belum ada item. Klik "Tambah Item" untuk menambahkan.',-1)]))):m("",!0),(n(!0),u(D,null,j(t.value.items,(l,i)=>(n(),u("div",{key:l.id||i,class:"bg-white border rounded-lg p-4 space-y-4 relative"},[s("div",Re,[s("h4",We,"Item #"+d(i+1),1),s("button",{type:"button",onClick:o=>ne(i),class:oe(["px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition-colors text-sm font-medium",t.value.items.length===1?"opacity-50 cursor-not-allowed":""]),disabled:t.value.items.length===1,title:"Hapus Item"},e[18]||(e[18]=[s("i",{class:"fa fa-trash mr-1"},null,-1),p(" Hapus ")]),10,Le)]),s("div",Ke,[s("div",He,[e[21]||(e[21]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Item",-1)),qe(Ae(Be),{modelValue:l.selectedItem,"onUpdate:modelValue":o=>l.selectedItem=o,options:W.items,searchable:!0,"close-on-select":!0,"show-labels":!1,placeholder:"Cari dan pilih item...",label:"name","track-by":"id",disabled:!t.value.warehouse_outlet_id,onSelect:o=>ue(o,i),onRemove:()=>re(i),class:"multiselect-custom"},{option:F(({option:o})=>[s("div",Qe,[s("div",null,[s("div",ze,d(o.name),1),s("div",Xe,[o.small_unit_name?(n(),u("span",Je,"Small: "+d(o.small_unit_name),1)):m("",!0),o.medium_unit_name?(n(),u("span",Ye," | Medium: "+d(o.medium_unit_name),1)):m("",!0),o.large_unit_name?(n(),u("span",Ze," | Large: "+d(o.large_unit_name),1)):m("",!0)])])])]),noResult:F(()=>e[19]||(e[19]=[s("div",{class:"text-center py-2 text-gray-500"},[s("i",{class:"fa-solid fa-search mr-2"}),p(" Tidak ada item yang ditemukan ")],-1)])),noOptions:F(()=>e[20]||(e[20]=[s("div",{class:"text-center py-2 text-gray-500"},[s("i",{class:"fa-solid fa-box mr-2"}),p(" Tidak ada item tersedia ")],-1)])),_:2},1032,["modelValue","onUpdate:modelValue","options","disabled","onSelect","onRemove"]),t.value.warehouse_outlet_id?m("",!0):(n(),u("div",et," Pilih warehouse outlet terlebih dahulu untuk melihat stok. ")),l.stock?(n(),u("div",{key:1,class:oe(["text-xs mt-1",Number(l.stock.qty_small||0)<=0?"text-red-600 font-bold":"text-gray-500"])},[p(" Stok: "+d(we(l))+" ",1),Number(l.stock.qty_small||0)<=0?(n(),u("span",tt,"⚠️ Stock tidak tersedia")):m("",!0)],2)):m("",!0)]),s("div",null,[e[22]||(e[22]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Qty",-1)),x(s("input",{type:"number",min:"0.01",step:"0.01","onUpdate:modelValue":o=>l.qty=o,class:"input input-bordered w-full",required:"",disabled:!t.value.warehouse_outlet_id||!l.item_id},null,8,at),[[N,l.qty,void 0,{number:!0}]])]),s("div",null,[e[23]||(e[23]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Unit",-1)),s("input",{type:"text",value:me(l),class:"input input-bordered w-full bg-gray-50",readonly:"",disabled:!l.item_id},null,8,st)]),s("div",lt,[e[24]||(e[24]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Note",-1)),x(s("textarea",{"onUpdate:modelValue":o=>l.note=o,class:"input input-bordered w-full",placeholder:"Catatan item (opsional)",rows:"3"},null,8,ot),[[N,l.note]])])])]))),128)),s("div",it,[s("button",{type:"button",onClick:H,class:"btn btn-sm btn-primary",disabled:!t.value.warehouse_outlet_id},e[25]||(e[25]=[s("i",{class:"fa fa-plus mr-1"},null,-1),p(" Tambah Item ")]),8,nt)])]),s("div",null,[e[26]||(e[26]=s("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Catatan Umum",-1)),x(s("textarea",{"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.notes=l),class:"input input-bordered w-full",rows:"2",placeholder:"Catatan tambahan"},null,512),[[N,t.value.notes]])]),t.value.type==="r_and_d"||t.value.type==="marketing"||t.value.type==="wrong_maker"||t.value.type==="training"?(n(),u("div",ut,[e[32]||(e[32]=s("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Approval Flow",-1)),e[33]||(e[33]=s("p",{class:"text-sm text-gray-600 mb-4"},"Tambahkan approver dalam urutan dari level terendah ke tertinggi. Approver pertama akan menjadi level terendah, dan approver terakhir akan menjadi level tertinggi.",-1)),s("div",rt,[s("div",dt,[x(s("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>C.value=l),type:"text",placeholder:"Cari user berdasarkan nama, email, atau jabatan...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",onInput:be,onFocus:ye,onBlur:ge},null,544),[[N,C.value]]),w.value&&k.value.length>0?(n(),u("div",mt,[(n(!0),u(D,null,j(k.value,l=>(n(),u("div",{key:l.id,onMousedown:G(i=>he(l),["prevent"]),class:"px-3 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-200 last:border-b-0"},[s("div",pt,d(l.name),1),s("div",ct,d(l.email),1),l.jabatan?(n(),u("div",ft,d(l.jabatan),1)):m("",!0)],40,vt))),128))])):m("",!0)])]),t.value.approvers.length>0?(n(),u("div",_t,[e[30]||(e[30]=s("h4",{class:"font-medium text-gray-700"},"Urutan Approval (Terendah ke Tertinggi):",-1)),(n(!0),u(D,null,j(t.value.approvers,(l,i)=>(n(),u("div",{key:l.id,class:"flex items-center justify-between p-3 bg-gray-50 border border-gray-200 rounded-md"},[s("div",bt,[s("div",yt,[i>0?(n(),u("button",{key:0,onClick:o=>X(i,i-1),class:"p-1 text-gray-500 hover:text-gray-700",title:"Pindah ke atas"},e[27]||(e[27]=[s("i",{class:"fa fa-arrow-up"},null,-1)]),8,gt)):m("",!0),i<t.value.approvers.length-1?(n(),u("button",{key:1,onClick:o=>X(i,i+1),class:"p-1 text-gray-500 hover:text-gray-700",title:"Pindah ke bawah"},e[28]||(e[28]=[s("i",{class:"fa fa-arrow-down"},null,-1)]),8,ht)):m("",!0)]),s("div",kt,[s("span",wt," Level "+d(i+1),1),s("div",null,[s("div",xt,d(l.name),1),s("div",St,d(l.email),1),l.jabatan?(n(),u("div",Tt,d(l.jabatan),1)):m("",!0)])])]),s("button",{onClick:o=>ke(i),class:"text-red-600 hover:text-red-800",title:"Hapus"},e[29]||(e[29]=[s("i",{class:"fa fa-trash"},null,-1)]),8,Ct)]))),128))])):(n(),u("div",qt,e[31]||(e[31]=[s("i",{class:"fa fa-exclamation-triangle mr-2"},null,-1),p(" Wajib menambahkan minimal 1 approver untuk tipe ini. ")])))])):m("",!0),s("div",At,[s("div",It,[S.value?(n(),u("span",Bt,e[34]||(e[34]=[s("i",{class:"fa fa-spinner fa-spin"},null,-1),p(" Menyimpan otomatis... ")]))):V.value?(n(),u("span",Nt,[e[35]||(e[35]=s("i",{class:"fa fa-check text-green-500"},null,-1)),p(" Terakhir disimpan: "+d(new Date(V.value).toLocaleTimeString("id-ID")),1)])):m("",!0)]),s("div",Dt,[s("button",{type:"button",class:"btn btn-ghost px-6 py-2 rounded-lg",onClick:_e},"Batal"),s("button",{type:"button",onClick:fe,class:"btn bg-gray-500 text-white px-6 py-2 rounded-lg font-bold shadow hover:shadow-xl transition-all",disabled:v.value||S.value},[v.value&&!S.value?(n(),u("span",Vt,e[36]||(e[36]=[s("i",{class:"fa fa-spinner fa-spin"},null,-1),p(" Menyimpan... ")]))):(n(),u("span",$t," Simpan Draft "))],8,jt),s("button",{type:"button",onClick:Q,class:"btn bg-gradient-to-r from-green-500 to-green-700 text-white px-8 py-2 rounded-lg font-bold shadow hover:shadow-xl transition-all",disabled:v.value||S.value},[v.value&&!S.value?(n(),u("span",Ut,e[37]||(e[37]=[s("i",{class:"fa fa-spinner fa-spin"},null,-1),p(" Submit... ")]))):(n(),u("span",Mt," Submit "))],8,Ft)])])],32)])])]),_:1}))}},Yt=Ne(Et,[["__scopeId","data-v-fe9a8bd1"]]);export{Yt as default};
