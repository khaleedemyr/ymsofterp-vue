import{r as g,c as $,a as Y,w as B,A as G,B as i,C as Z,D as s,L as n,E as v,H as I,J as tt,F as f,M as S,N as o,I as T,G as h,l as F,W as et}from"./vendor-vue-g7iCcTkf.js";import{A as st}from"./AppLayout-1Wm1ZPw9.js";import{a as lt}from"./vendor-utils-CpgP2uT4.js";import"./app-BPKNzj_F.js";import"./vendor-charts-CuqD4wLC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-CVHTvH7j.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const at={class:"max-w-7xl mx-auto py-8 px-4"},it={class:"flex flex-col md:flex-row md:items-center gap-4 mb-4"},nt={class:"flex items-center gap-2"},ot=["disabled"],ut=["value"],rt={class:"flex items-center gap-2"},dt=["value"],mt={class:"flex items-center gap-2"},pt=["value"],ct=["disabled"],gt={key:0,class:"animate-spin mr-2"},_t={key:1,class:"mr-2"},yt=["disabled"],xt={key:0,class:"animate-spin mr-2"},ft={key:1,class:"mr-2"},ht={key:0,class:"bg-red-50 border-l-4 border-red-400 text-red-800 p-4 rounded my-8 text-center font-semibold"},vt={key:1,class:"bg-blue-50 border-l-4 border-blue-400 text-blue-800 p-4 rounded my-8 text-center font-semibold"},bt={key:2,class:"bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 p-4 rounded my-8 text-center font-semibold"},kt={key:3,class:"bg-white rounded-xl shadow-lg overflow-hidden"},St={class:"min-w-full divide-y divide-gray-200"},Dt={class:"bg-white divide-y divide-gray-200"},wt={key:0},$t=["onClick"],qt={class:"px-6 py-3 font-semibold text-blue-700",colspan:"8"},Ct={class:"flex items-center gap-2"},Ot={class:"text-xs font-normal text-gray-600"},Lt=["onClick"],At={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Et={class:"flex items-center gap-2"},It={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-700"},Ft={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-700"},Tt={class:"px-6 py-4 whitespace-nowrap text-sm text-right"},jt={key:0},Mt={key:0},Nt={key:1},Wt={class:"px-6 py-4 whitespace-nowrap text-sm text-right"},Qt={key:0},Bt={key:0},Kt={key:1},Vt={class:"px-6 py-4 whitespace-nowrap text-sm text-right"},Rt={key:0},Ut={key:0},Pt={key:1},Ht={class:"px-6 py-4 whitespace-nowrap text-sm"},Jt={key:0,class:"bg-gray-50"},Xt={colspan:"8",class:"px-6 py-4"},zt={key:0,class:"text-center py-4"},Yt={key:1,class:"overflow-x-auto"},Gt={class:"min-w-full divide-y divide-gray-200 text-sm"},Zt={class:"bg-white divide-y divide-gray-200"},te={key:0,class:"bg-yellow-50 font-semibold"},ee={class:"px-4 py-2 text-gray-700"},se={class:"px-4 py-2 text-right text-gray-700"},le={class:"px-4 py-2 text-gray-700"},ae={class:"px-4 py-2 text-right text-gray-700"},ie={class:"px-4 py-2 text-right text-gray-700"},ne={class:"px-4 py-2 text-right text-gray-700"},oe={class:"px-4 py-2 text-gray-700"},ue={class:"px-4 py-2 text-gray-700"},re={key:2,class:"text-center py-4 text-gray-500 text-sm"},de={key:0},me={key:1},pe={key:2},ce={class:"text-xs mt-1"},ge={key:4,class:"flex justify-between items-center mt-4"},_e={class:"text-sm text-gray-600"},$e={__name:"StockPosition",props:{stocks:Array,outlets:Array,user_outlet_id:[String,Number],warehouse_outlets:Array,error:String},setup(q){const m=q,C=g(""),j=g(25);g(1);const p=g(""),_=g(""),D=g(!1),w=g(!1),O=$(()=>p.value||_.value);Y(()=>{m.user_outlet_id&&String(m.user_outlet_id)!=="1"&&(p.value=String(m.user_outlet_id))});const M=$(()=>String(m.user_outlet_id)==="1"),K=$(()=>{let t=m.warehouse_outlets;return!M.value&&m.user_outlet_id&&(t=t.filter(e=>String(e.outlet_id)===String(m.user_outlet_id))),p.value&&(t=t.filter(e=>String(e.outlet_id)===String(p.value))),t}),N=$(()=>{let t=m.stocks;if(p.value&&(t=t.filter(l=>String(l.outlet_id)===String(p.value))),_.value&&(t=t.filter(l=>String(l.warehouse_outlet_id)===String(_.value))),!C.value)return t;const e=C.value.toLowerCase();return t.filter(l=>l.item_name&&l.item_name.toLowerCase().includes(e)||l.outlet_name&&l.outlet_name.toLowerCase().includes(e)||l.category_name&&l.category_name.toLowerCase().includes(e))}),b=$(()=>{const t={};return N.value.forEach(e=>{const l=e.category_name||null;t[l]||(t[l]=[]),t[l].push(e)}),t}),x=g([]),k=g([]),d=g({}),L=g({}),A=g({});function r(t){return`${t.item_id}-${t.outlet_id}-${t.warehouse_outlet_id||"null"}`}function V(t){const e=x.value.indexOf(t);e>-1?x.value.splice(e,1):x.value.push(t)}async function R(t){const e=r(t),l=k.value.indexOf(e);l>-1?k.value.splice(l,1):(k.value.push(e),!d.value[e]&&!A.value[e]&&await U(t))}async function U(t){var l,y;const e=r(t);A.value[e]=!0;try{const a={item_id:t.item_id,outlet_id:t.outlet_id};t.warehouse_outlet_id&&(a.warehouse_outlet_id=t.warehouse_outlet_id),console.log("Fetching item detail with params:",a);const u=await lt.get("/outlet-inventory/stock-card/detail",{params:a,withCredentials:!0,headers:{"X-Requested-With":"XMLHttpRequest"}});if(console.log("Response received:",u.data),u.data&&u.data.cards){const E=Array.isArray(u.data.cards)?u.data.cards:[];d.value={...d.value,[e]:E},u.data.saldo_awal&&(L.value={...L.value,[e]:u.data.saldo_awal}),console.log("Item details set for key:",e,"Count:",E.length),console.log("All itemDetails:",d.value)}else console.warn("No cards data in response:",u.data),d.value={...d.value,[e]:[]}}catch(a){console.error("Error fetching item detail:",a),console.error("Error response:",(l=a.response)==null?void 0:l.data),console.error("Error status:",(y=a.response)==null?void 0:y.status),d.value[e]=[]}finally{A.value[e]=!1}}function W(t,e=null){if(e==="in"){const l=[];return t.in_qty_small>0&&l.push(`${c(t.in_qty_small)} ${t.small_unit_name||""}`),t.in_qty_medium>0&&l.push(`${c(t.in_qty_medium)} ${t.medium_unit_name||""}`),t.in_qty_large>0&&l.push(`${c(t.in_qty_large)} ${t.large_unit_name||""}`),l.length>0?l.join(" | "):"-"}else if(e==="out"){const l=[];return t.out_qty_small>0&&l.push(`${c(t.out_qty_small)} ${t.small_unit_name||""}`),t.out_qty_medium>0&&l.push(`${c(t.out_qty_medium)} ${t.medium_unit_name||""}`),t.out_qty_large>0&&l.push(`${c(t.out_qty_large)} ${t.large_unit_name||""}`),l.length>0?l.join(" | "):"-"}else return"-"}function Q(t){if(!t)return"-";if(t.small!==void 0||t.medium!==void 0||t.large!==void 0){const l=[];return t.small!==void 0&&t.small!==null&&l.push(`${c(t.small)} ${t.small_unit_name||""}`),t.medium!==void 0&&t.medium!==null&&l.push(`${c(t.medium)} ${t.medium_unit_name||""}`),t.large!==void 0&&t.large!==null&&l.push(`${c(t.large)} ${t.large_unit_name||""}`),l.length>0?l.join(" | "):"-"}const e=[];return t.saldo_qty_small!==void 0&&t.saldo_qty_small!==null&&e.push(`${c(t.saldo_qty_small)} ${t.small_unit_name||""}`),t.saldo_qty_medium!==void 0&&t.saldo_qty_medium!==null&&e.push(`${c(t.saldo_qty_medium)} ${t.medium_unit_name||""}`),t.saldo_qty_large!==void 0&&t.saldo_qty_large!==null&&e.push(`${c(t.saldo_qty_large)} ${t.large_unit_name||""}`),e.length>0?e.join(" | "):"-"}function c(t){return t==null?"0":Number(t)%1===0?Number(t).toLocaleString("id-ID"):Number(t).toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:2})}function P(){const t=new Date,e=t.getFullYear(),l=t.getMonth();return new Date(e,l,1).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"})}B(()=>m.stocks,()=>{if(m.stocks&&m.stocks.length>0){const t=Object.keys(b.value);x.value=t}},{immediate:!0});function H(){const t=Object.keys(b.value);x.value=t}function J(){x.value=[]}B(p,()=>{_.value=""});function X(){if(!O.value){alert("Silakan pilih minimal satu filter terlebih dahulu!");return}D.value=!0;const t={outlet_id:p.value||"",warehouse_outlet_id:_.value||""};Object.keys(t).forEach(e=>{t[e]||delete t[e]}),et.get("/outlet-inventory/stock-position",t,{preserveState:!0,preserveScroll:!0,onSuccess:()=>{D.value=!1},onError:e=>{D.value=!1,console.error("Error loading data:",e)}})}function z(){if(!O.value){alert("Silakan pilih minimal satu filter terlebih dahulu!");return}if(m.stocks.length===0){alert("Tidak ada data untuk di-export. Silakan load data terlebih dahulu!");return}w.value=!0;const t=new URLSearchParams({outlet_id:p.value||"",warehouse_outlet_id:_.value||""});p.value||t.delete("outlet_id"),_.value||t.delete("warehouse_outlet_id");const e=`/outlet-inventory/stock-position/export?${t.toString()}`,l=document.createElement("a");l.href=e,l.download="",document.body.appendChild(l),l.click(),document.body.removeChild(l),setTimeout(()=>{w.value=!1},2e3)}return(t,e)=>(i(),G(st,null,{default:Z(()=>[s("div",at,[e[28]||(e[28]=s("h1",{class:"text-2xl font-bold mb-6"},"Laporan Stok Akhir Outlet",-1)),s("div",it,[I(s("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>C.value=l),type:"text",placeholder:"Cari nama barang atau outlet...",class:"px-4 py-2 border border-gray-300 rounded-lg w-full md:w-64 focus:ring-blue-500 focus:border-blue-500"},null,512),[[tt,C.value]]),s("div",nt,[e[5]||(e[5]=s("label",{class:"text-sm"},"Outlet",-1)),I(s("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>p.value=l),class:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500",disabled:!M.value},[e[4]||(e[4]=s("option",{value:""},"Semua Outlet",-1)),(i(!0),n(f,null,S(q.outlets,l=>(i(),n("option",{key:l.id,value:l.id},o(l.name),9,ut))),128))],8,ot),[[T,p.value]])]),s("div",rt,[e[7]||(e[7]=s("label",{class:"text-sm"},"Warehouse Outlet",-1)),I(s("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>_.value=l),class:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500"},[e[6]||(e[6]=s("option",{value:""},"Semua Warehouse Outlet",-1)),(i(!0),n(f,null,S(K.value,l=>(i(),n("option",{key:l.id,value:l.id},o(l.name),9,dt))),128))],512),[[T,_.value]])]),s("div",mt,[e[8]||(e[8]=s("label",{class:"text-sm"},"Tampilkan",-1)),I(s("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>j.value=l),class:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500"},[(i(),n(f,null,S([10,25,50,100],l=>s("option",{key:l,value:l},o(l),9,pt)),64))],512),[[T,j.value]]),e[9]||(e[9]=s("span",{class:"text-sm"},"data",-1))]),s("button",{onClick:X,disabled:D.value,class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md font-semibold hover:bg-blue-700"},[D.value?(i(),n("span",gt,e[10]||(e[10]=[s("i",{class:"fas fa-spinner"},null,-1)]))):(i(),n("span",_t,e[11]||(e[11]=[s("i",{class:"fas fa-sync-alt"},null,-1)]))),e[12]||(e[12]=h(" Load Data "))],8,ct),s("button",{onClick:z,disabled:w.value||!O.value||q.stocks.length===0,class:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-md font-semibold hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed"},[w.value?(i(),n("span",xt,e[13]||(e[13]=[s("i",{class:"fas fa-spinner"},null,-1)]))):(i(),n("span",ft,e[14]||(e[14]=[s("i",{class:"fas fa-file-excel"},null,-1)]))),h(" "+o(w.value?"Exporting...":"Export Excel"),1)],8,yt)]),m.error?(i(),n("div",ht,o(m.error),1)):O.value?q.stocks.length===0?(i(),n("div",bt,e[16]||(e[16]=[s("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1),h(" Tidak ada data stok untuk filter yang dipilih. Coba ubah filter atau pilih kombinasi filter yang berbeda. ")]))):(i(),n("div",kt,[s("table",St,[e[27]||(e[27]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Kategori"),s("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Nama Barang"),s("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Outlet"),s("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Warehouse Outlet"),s("th",{class:"px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider"},"Qty Small"),s("th",{class:"px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider"},"Qty Medium"),s("th",{class:"px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider"},"Qty Large"),s("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Tanggal Update")])],-1)),s("tbody",Dt,[Object.keys(b.value).length===0?(i(),n("tr",wt,e[17]||(e[17]=[s("td",{colspan:"8",class:"text-center py-10 text-gray-400"},"Tidak ada data stok.",-1)]))):(i(!0),n(f,{key:1},S(b.value,(l,y)=>(i(),n(f,{key:y||"no-category"},[s("tr",{class:"bg-blue-50 hover:bg-blue-100 cursor-pointer",onClick:a=>V(y||"no-category")},[s("td",qt,[s("div",Ct,[s("i",{class:F(x.value.includes(y||"no-category")?"fa-solid fa-chevron-down":"fa-solid fa-chevron-right")},null,2),s("span",null,o(y||"Tanpa Kategori"),1),s("span",Ot,"("+o(l.length)+" item)",1)])])],8,$t),x.value.includes(y||"no-category")?(i(!0),n(f,{key:0},S(l,a=>(i(),n(f,{key:a.item_id+"-"+a.outlet_id+"-"+a.warehouse_outlet_id},[s("tr",{class:F(["hover:bg-gray-50 transition cursor-pointer",{"bg-blue-50":k.value.includes(r(a))}]),onClick:u=>R(a)},[e[18]||(e[18]=s("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},null,-1)),s("td",At,[s("div",Et,[s("i",{class:F(k.value.includes(r(a))?"fa-solid fa-chevron-down text-blue-600":"fa-solid fa-chevron-right text-gray-400")},null,2),s("span",null,o(a.item_name),1)])]),s("td",It,o(a.outlet_name),1),s("td",Ft,o(a.warehouse_outlet_name||"-"),1),s("td",Tt,[a.qty_small>0?(i(),n("span",jt,[h(o(Number(a.qty_small).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2}))+" ",1),a.small_unit_name?(i(),n("span",Mt,o(a.small_unit_name),1)):v("",!0)])):(i(),n("span",Nt,"-"))]),s("td",Wt,[a.qty_medium>0?(i(),n("span",Qt,[h(o(Number(a.qty_medium).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2}))+" ",1),a.medium_unit_name?(i(),n("span",Bt,o(a.medium_unit_name),1)):v("",!0)])):(i(),n("span",Kt,"-"))]),s("td",Vt,[a.qty_large>0?(i(),n("span",Rt,[h(o(Number(a.qty_large).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2}))+" ",1),a.large_unit_name?(i(),n("span",Ut,o(a.large_unit_name),1)):v("",!0)])):(i(),n("span",Pt,"-"))]),s("td",Ht,o(a.updated_at?new Date(a.updated_at).toLocaleString():"-"),1)],10,Lt),k.value.includes(r(a))?(i(),n("tr",Jt,[s("td",Xt,[A.value[r(a)]?(i(),n("div",zt,e[19]||(e[19]=[s("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},null,-1),s("p",{class:"mt-2 text-gray-600 text-sm"},"Memuat detail transaksi...",-1)]))):d.value[r(a)]&&Array.isArray(d.value[r(a)])&&d.value[r(a)].length>0?(i(),n("div",Yt,[s("table",Gt,[e[24]||(e[24]=s("thead",{class:"bg-gray-100"},[s("tr",null,[s("th",{class:"px-4 py-2 text-left text-xs font-bold text-gray-700 uppercase"},"Tanggal"),s("th",{class:"px-4 py-2 text-right text-xs font-bold text-gray-700 uppercase"},"Masuk (Qty)"),s("th",{class:"px-4 py-2 text-right text-xs font-bold text-gray-700 uppercase"},"Keluar (Qty)"),s("th",{class:"px-4 py-2 text-right text-xs font-bold text-gray-700 uppercase"},"Saldo (Qty)"),s("th",{class:"px-4 py-2 text-left text-xs font-bold text-gray-700 uppercase"},"Referensi"),s("th",{class:"px-4 py-2 text-left text-xs font-bold text-gray-700 uppercase"},"Keterangan")])],-1)),s("tbody",Zt,[L.value[r(a)]?(i(),n("tr",te,[s("td",ee,o(P()),1),e[20]||(e[20]=s("td",{class:"px-4 py-2 text-right text-gray-700"},"-",-1)),e[21]||(e[21]=s("td",{class:"px-4 py-2 text-right text-gray-700"},"-",-1)),s("td",se,o(Q(L.value[r(a)])),1),e[22]||(e[22]=s("td",{class:"px-4 py-2 text-gray-700"},"Saldo Awal Bulan",-1)),e[23]||(e[23]=s("td",{class:"px-4 py-2 text-gray-700"},"Saldo akhir bulan sebelumnya",-1))])):v("",!0),(i(!0),n(f,null,S(d.value[r(a)],(u,E)=>(i(),n("tr",{key:u.id,class:F(E===d.value[r(a)].length-1?"bg-yellow-200 font-bold":"hover:bg-gray-50")},[s("td",le,o(u.date?new Date(u.date).toLocaleDateString("id-ID"):"-"),1),s("td",ae,o(W(u,"in")),1),s("td",ie,o(W(u,"out")),1),s("td",ne,o(Q(u)),1),s("td",oe,o(u.reference_type?u.reference_type+(u.reference_id?" #"+u.reference_id:""):"-"),1),s("td",ue,o(u.description||"-"),1)],2))),128))])])])):(i(),n("div",re,[d.value[r(a)]===void 0?(i(),n("div",de,e[25]||(e[25]=[s("p",null,"Memuat data...",-1)]))):d.value[r(a)]&&d.value[r(a)].length===0?(i(),n("div",me," Tidak ada data transaksi untuk item ini. ")):(i(),n("div",pe,[e[26]||(e[26]=s("p",null,"Data tidak tersedia.",-1)),s("p",ce,"Debug: "+o(JSON.stringify(d.value[r(a)])),1)]))]))])])):v("",!0)],64))),128)):v("",!0)],64))),128))])])])):(i(),n("div",vt,e[15]||(e[15]=[s("i",{class:"fas fa-info-circle mr-2"},null,-1),h(' Silakan pilih minimal satu filter (Outlet atau Warehouse Outlet), kemudian klik tombol "Load Data" untuk melihat laporan stok akhir. ')]))),Object.keys(b.value).length>0?(i(),n("div",ge,[s("div",_e,[h(" Total "+o(Object.keys(b.value).length)+" kategori, "+o(N.value.length)+" item ",1),s("button",{onClick:H,class:"ml-4 text-blue-600 hover:text-blue-800 text-sm"},"Expand All"),s("button",{onClick:J,class:"ml-2 text-blue-600 hover:text-blue-800 text-sm"},"Collapse All")])])):v("",!0)])]),_:1}))}};export{$e as default};
