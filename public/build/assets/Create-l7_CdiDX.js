import{r as Q,P as z,c as Y,a as H,A,B as l,C as W,D as n,G as x,O as V,H as c,Q as u,L as r,F as p,M as h,N as d,I as k,J as _,E as m,l as T,Z as b,T as J,Y as R,W as Z}from"./vendor-vue-g7iCcTkf.js";import{A as X}from"./AppLayout-CLYhXf-W.js";import{a as v}from"./vendor-utils-CpgP2uT4.js";import{S as y}from"./app-DdwtQE43.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-CauiUg4O.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const ee={class:"max-w-5xl w-full mx-auto py-8 px-2"},te={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},se=["value"],oe=["value","disabled"],ne={key:0,class:"text-red-600 text-sm mb-2"},ae={class:"w-full min-w-full divide-y divide-gray-200"},ie={class:"px-3 py-2 min-w-[260px]"},le={class:"relative"},re=["id","onUpdate:modelValue","onInput","onFocus","onBlur","onKeydown"],ue=["id"],de=["id","onMousedown"],me={class:"font-medium"},ce={class:"text-xs text-gray-500"},ge={class:"text-sm text-gray-600"},pe={key:0,class:"absolute right-2 top-2"},he={key:1,class:"text-xs text-yellow-600 mt-1"},_e={key:2,class:"text-xs text-gray-500 mt-1"},fe={key:0,class:"text-xs text-red-500 mt-1"},be={class:"px-3 py-2 min-w-[100px]"},ye=["onUpdate:modelValue"],we={key:0,class:"text-xs text-red-500 mt-1"},xe={key:1,class:"text-xs text-red-500 mt-1"},ke={class:"px-3 py-2 min-w-[100px]"},ve=["onUpdate:modelValue","onChange"],Ie=["value"],De=["onUpdate:modelValue"],$e={key:2,class:"text-xs text-red-500 mt-1"},Se={class:"px-3 py-2 min-w-[100px]"},qe={class:"px-3 py-2 min-w-[120px]"},Ce={class:"px-3 py-2"},Be=["onClick","disabled"],Ue=["disabled"],Ae={class:"flex justify-end gap-2"},Ve=["disabled"],Qe={__name:"Create",props:{warehouses:Array},setup(I){const D=Q(!1),s=z({source_warehouse_id:"",target_warehouse_id:"",date:new Date().toISOString().split("T")[0],items:[$()],note:""});function $(){return{item_id:"",item_name:"",qty:"",selected_unit:"",available_units:[],price:0,total:0,stock:null,note:"",suggestions:[],showDropdown:!1,loading:!1,highlightedIndex:-1,_rowKey:Date.now()+"-"+Math.random()}}function N(){s.items.push($())}function M(o){s.items.length!==1&&s.items.splice(o,1)}function S(){Z.visit("/warehouse-sales")}function q(o,t){const e=t.target.value,i=s.items[o];i.item_id="",i.item_name=e,i.showDropdown=!0,j(o,e)}function K(o){setTimeout(()=>{s.items[o].showDropdown=!1},200)}function f(o,t){const e=s.items[o];!e.showDropdown||!e.suggestions.length||(t.key==="ArrowDown"?(t.preventDefault(),e.highlightedIndex=(e.highlightedIndex+1)%e.suggestions.length):t.key==="ArrowUp"?(t.preventDefault(),e.highlightedIndex=(e.highlightedIndex-1+e.suggestions.length)%e.suggestions.length):t.key==="Enter"?(t.preventDefault(),e.highlightedIndex>=0&&e.suggestions[e.highlightedIndex]&&C(o,e.suggestions[e.highlightedIndex])):t.key==="Escape"&&(e.showDropdown=!1))}async function j(o,t){if(!t||t.length<2||!s.source_warehouse_id){s.items[o].suggestions=[],s.items[o].highlightedIndex=-1;return}s.items[o].loading=!0;try{const e=await v.get("/items/search-for-warehouse-transfer",{params:{q:t,warehouse_id:s.source_warehouse_id}});let i=Array.isArray(e.data)?e.data:[];s.items[o].suggestions=i.map(a=>({...a,available_units:[a.unit_small,a.unit_medium,a.unit_large].filter(Boolean),unit_small:a.unit_small,unit_medium:a.unit_medium,unit_large:a.unit_large,small_unit_id:a.small_unit_id,medium_unit_id:a.medium_unit_id,large_unit_id:a.large_unit_id})),s.items[o].showDropdown=!0,s.items[o].highlightedIndex=0}catch{s.items[o].suggestions=[],s.items[o].highlightedIndex=-1}finally{s.items[o].loading=!1}}function C(o,t){s.items[o].item_id=t.id,s.items[o].item_name=t.name,s.items[o].available_units=[t.unit_small,t.unit_medium,t.unit_large].filter(Boolean),s.items[o].selected_unit="",s.items[o].suggestions=[],s.items[o].showDropdown=!1,s.items[o].highlightedIndex=-1,F(o)}async function F(o){const t=s.items[o];if(!(!t.item_id||!s.source_warehouse_id))try{const e=await v.get("/api/inventory/stock",{params:{item_id:t.item_id,warehouse_id:s.source_warehouse_id}});t.stock=e.data}catch{t.stock={qty_small:0,qty_medium:0,qty_large:0}}}function G(o,t){s.items[o].selected_unit=t.target.value,P(o)}async function P(o){const t=s.items[o];if(!(!t.item_id||!t.selected_unit||!s.source_warehouse_id))try{const e=await v.get("/api/warehouse-sales/item-price",{params:{item_id:t.item_id,warehouse_id:s.source_warehouse_id,unit_type:t.selected_unit}});t.price=e.data.price||0,B(o)}catch{t.price=0,B(o)}}function B(o){const t=s.items[o];t.total=(Number(t.qty)||0)*(Number(t.price)||0)}function g(o){return o==null?0:Number(o)%1===0?Number(o):Number(o).toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:2})}const w=Y(()=>s.source_warehouse_id&&s.target_warehouse_id&&s.source_warehouse_id!==s.target_warehouse_id);function E(o){if(!o.stock)return"Stok: 0";const t=Number(o.stock.qty_small||0),e=Number(o.stock.qty_medium||0),i=Number(o.stock.qty_large||0);return`Stok: ${g(t)} ${o.stock.unit_small||""} | ${g(e)} ${o.stock.unit_medium||""} | ${g(i)} ${o.stock.unit_large||""}`}async function L(){if(!s.source_warehouse_id||!s.target_warehouse_id||s.source_warehouse_id===s.target_warehouse_id){alert("Gudang asal dan tujuan harus diisi dan tidak boleh sama!");return}for(const[t,e]of s.items.entries()){if(!e.item_id){alert(`Item ke-${t+1} belum dipilih!`);return}if(!e.selected_unit){alert(`Unit item ke-${t+1} belum dipilih!`);return}if(!e.qty||e.qty<=0){alert(`Qty item ke-${t+1} harus diisi!`);return}if(e.stock&&e.qty>e.stock.qty_small){alert(`Qty item ke-${t+1} melebihi stok!`);return}}(await y.fire({title:"Simpan Data?",text:"Apakah Anda yakin ingin menyimpan Penjualan Antar Gudang ini?",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Simpan",cancelButtonText:"Batal",allowOutsideClick:!1})).isConfirmed&&(y.fire({title:"Menyimpan...",text:"Mohon tunggu sebentar",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1,didOpen:()=>{y.showLoading()}}),D.value=!0,s.post(route("warehouse-sales.store"),{onFinish:()=>{D.value=!1,y.close()}}))}function O(o){const e=document.querySelectorAll('input[placeholder="Cari nama item..."]')[o];if(!e)return{};const i=e.getBoundingClientRect();return{left:i.left+"px",top:i.bottom+"px",width:i.width+"px",position:"fixed",zIndex:9999}}return H(()=>{if(!s.date){const o=new Date,t=o.getFullYear(),e=String(o.getMonth()+1).padStart(2,"0"),i=String(o.getDate()).padStart(2,"0");s.date=`${t}-${e}-${i}`}}),(o,t)=>(l(),A(X,null,{default:W(()=>[n("div",ee,[n("div",{class:"flex items-center gap-2 mb-6"},[n("button",{onClick:S,class:"text-blue-500 hover:underline"},t[4]||(t[4]=[n("i",{class:"fa fa-arrow-left"},null,-1),x(" Kembali")])),t[5]||(t[5]=n("h1",{class:"text-2xl font-bold text-gray-800 flex items-center gap-2 ml-4"},[n("i",{class:"fas fa-exchange-alt text-blue-500"}),x(" Buat Penjualan Antar Gudang ")],-1))]),n("form",{onSubmit:V(L,["prevent"]),class:"space-y-6"},[n("div",te,[n("div",null,[t[7]||(t[7]=n("label",{class:"block text-sm font-medium text-gray-700"},"Gudang Asal",-1)),c(n("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>u(s).source_warehouse_id=e),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500",required:""},[t[6]||(t[6]=n("option",{value:""},"Pilih Gudang Asal",-1)),(l(!0),r(p,null,h(I.warehouses,e=>(l(),r("option",{key:e.id,value:e.id},d(e.name),9,se))),128))],512),[[k,u(s).source_warehouse_id]])]),n("div",null,[t[9]||(t[9]=n("label",{class:"block text-sm font-medium text-gray-700"},"Gudang Tujuan",-1)),c(n("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>u(s).target_warehouse_id=e),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500",required:""},[t[8]||(t[8]=n("option",{value:""},"Pilih Gudang Tujuan",-1)),(l(!0),r(p,null,h(I.warehouses,e=>(l(),r("option",{key:e.id,value:e.id,disabled:e.id===u(s).source_warehouse_id},d(e.name),9,oe))),128))],512),[[k,u(s).target_warehouse_id]])]),n("div",null,[t[10]||(t[10]=n("label",{class:"block text-sm font-medium text-gray-700"},"Tanggal",-1)),c(n("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=e=>u(s).date=e),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500",required:""},null,512),[[_,u(s).date]])]),n("div",null,[t[11]||(t[11]=n("label",{class:"block text-sm font-medium text-gray-700"},"Keterangan",-1)),c(n("textarea",{"onUpdate:modelValue":t[3]||(t[3]=e=>u(s).note=e),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[_,u(s).note]])])]),n("div",null,[t[16]||(t[16]=n("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Detail Item",-1)),w.value?m("",!0):(l(),r("div",ne," Pilih gudang asal dan tujuan terlebih dahulu, dan pastikan tidak sama. ")),n("div",{class:T(["overflow-x-auto",{"pointer-events-none opacity-60":!w.value}])},[n("table",ae,[t[14]||(t[14]=n("thead",{class:"bg-gradient-to-r from-blue-50 to-blue-100"},[n("tr",null,[n("th",{class:"px-3 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Item"),n("th",{class:"px-3 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Qty"),n("th",{class:"px-3 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Unit"),n("th",{class:"px-3 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Harga"),n("th",{class:"px-3 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Total"),n("th",{class:"px-3 py-2"})])],-1)),n("tbody",null,[(l(!0),r(p,null,h(u(s).items,(e,i)=>(l(),r("tr",{key:e._rowKey||i},[n("td",ie,[n("div",le,[c(n("input",{id:`item-input-${i}`,type:"text","onUpdate:modelValue":a=>e.item_name=a,onInput:a=>q(i,a),onFocus:a=>q(i,a),onBlur:a=>K(i),onKeydown:[b(a=>f(i,a),["down"]),b(a=>f(i,a),["up"]),b(a=>f(i,a),["enter"]),b(a=>f(i,a),["esc"])],class:"w-full rounded border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:"",autocomplete:"off",placeholder:"Cari nama item..."},null,40,re),[[_,e.item_name]]),(l(),A(J,{to:"body"},[e.showDropdown&&e.suggestions&&e.suggestions.length>0?(l(),r("div",{key:0,style:R(O(i)),id:`autocomplete-dropdown-${i}`,class:"fixed z-[9999] bg-white border border-blue-200 rounded shadow max-w-xs w-[260px] max-h-96 overflow-auto mt-1"},[(l(!0),r(p,null,h(e.suggestions,(a,U)=>(l(),r("div",{key:a.id,id:`autocomplete-item-${i}-${U}`,onMousedown:V(Te=>C(i,a),["prevent"]),class:T(["px-3 py-2 flex justify-between items-center cursor-pointer",e.highlightedIndex===U?"bg-blue-100":"hover:bg-blue-50"])},[n("div",null,[n("div",me,d(a.name),1),n("div",ce,d(a.sku),1)]),n("div",ge,d(a.unit),1)],42,de))),128))],12,ue)):m("",!0)])),e.loading?(l(),r("div",pe,t[12]||(t[12]=[n("i",{class:"fa fa-spinner fa-spin text-blue-400"},null,-1)]))):m("",!0),u(s).source_warehouse_id?m("",!0):(l(),r("div",he," Pilih warehouse terlebih dahulu untuk mencari item. ")),e.stock?(l(),r("div",_e," Stok: "+d(E(e)),1)):m("",!0)]),u(s).errors[`items.${i}.item_id`]?(l(),r("div",fe,d(u(s).errors[`items.${i}.item_id`]),1)):m("",!0)]),n("td",be,[c(n("input",{type:"number",min:"0.01",step:"0.01","onUpdate:modelValue":a=>e.qty=a,class:"w-full rounded border-gray-300",required:""},null,8,ye),[[_,e.qty]]),u(s).errors[`items.${i}.qty`]?(l(),r("div",we,d(u(s).errors[`items.${i}.qty`]),1)):m("",!0),e.stock&&e.qty>e.stock.qty_small?(l(),r("div",xe,"Qty melebihi stok!")):m("",!0)]),n("td",ke,[e.available_units&&e.available_units.length?c((l(),r("select",{key:0,"onUpdate:modelValue":a=>e.selected_unit=a,onChange:a=>G(i,a),class:"w-full rounded border-gray-300"},[(l(!0),r(p,null,h(e.available_units,a=>(l(),r("option",{key:a,value:a},d(a),9,Ie))),128))],40,ve)),[[k,e.selected_unit]]):c((l(),r("input",{key:1,type:"text","onUpdate:modelValue":a=>e.unit=a,class:"w-full rounded border-gray-300",required:""},null,8,De)),[[_,e.unit]]),u(s).errors[`items.${i}.unit`]?(l(),r("div",$e,d(u(s).errors[`items.${i}.unit`]),1)):m("",!0)]),n("td",Se,[n("span",null,d(g(e.price)),1)]),n("td",qe,d(g(e.total)),1),n("td",Ce,[n("button",{type:"button",onClick:a=>M(i),class:"text-red-500 hover:text-red-700",disabled:u(s).items.length===1},t[13]||(t[13]=[n("i",{class:"fa fa-trash"},null,-1)]),8,Be)])]))),128))])])],2),n("button",{type:"button",onClick:N,class:"mt-2 px-3 py-1 rounded bg-blue-100 text-blue-700 font-semibold hover:bg-blue-200",disabled:!w.value},t[15]||(t[15]=[n("i",{class:"fa fa-plus"},null,-1),x(" Tambah Item")]),8,Ue)]),n("div",Ae,[n("button",{type:"button",onClick:S,class:"px-4 py-2 rounded bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300"},"Batal"),n("button",{type:"submit",disabled:u(s).processing,class:"px-4 py-2 rounded bg-blue-600 text-white font-semibold hover:bg-blue-700 disabled:opacity-50"},"Simpan",8,Ve)])],32)])]),_:1}))}};export{Qe as default};
