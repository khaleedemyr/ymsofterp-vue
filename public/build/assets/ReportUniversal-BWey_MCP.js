import{$ as at,c as C,r as u,w as lt,a as ot,A as rt,B as r,C as V,D as t,L as s,E as h,F as m,M as _,N as n,l as O,G as c,H as S,J as W,I as F,x as st,_ as nt,W as z}from"./vendor-vue-g7iCcTkf.js";import{A as it}from"./AppLayout-BdiuRSin.js";import{a as R}from"./vendor-utils-CpgP2uT4.js";import{S as B}from"./app-xIQ7JztA.js";import{_ as dt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-LiNpoaCg.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const ut={class:"w-full min-h-screen py-8 px-4 md:px-6"},ct={key:0,class:"mb-6 grid grid-cols-1 md:grid-cols-2 gap-4"},pt={class:"flex items-center justify-between"},bt={class:"text-xs font-semibold text-blue-600 uppercase tracking-wide mb-1"},gt={class:"text-2xl font-bold text-blue-900"},xt={class:"p-3 bg-blue-500 rounded-xl"},ft={class:"bg-gradient-to-br from-amber-50 to-yellow-50 border-2 border-amber-200 rounded-2xl shadow-lg p-6 mb-6"},mt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},yt=["value"],vt=["disabled"],ht={key:0,value:""},_t=["value"],wt={key:0,class:"text-xs text-gray-500 mt-1 block"},kt=["value"],At={class:"mt-6 flex justify-end gap-3"},Ot=["disabled"],St={key:0,class:"fa fa-spinner fa-spin relative z-10"},Dt={key:1,class:"fa fa-file-excel relative z-10"},Ct={class:"relative z-10"},Nt=["disabled"],Tt={key:0,class:"fa fa-spinner fa-spin relative z-10"},jt={key:1,class:"fa fa-search relative z-10"},Ft={class:"relative z-10"},Bt={key:1,class:"bg-white rounded-2xl shadow-lg border border-gray-100 p-16 text-center"},Lt={key:2,class:"overflow-x-auto bg-white rounded-2xl shadow-lg border border-gray-100"},Et={class:"min-w-full divide-y divide-gray-200"},Mt={class:"bg-white divide-y divide-gray-200"},It={class:"hover:bg-gradient-to-r hover:from-blue-50 hover:to-transparent transition-all duration-200 group"},Ut={class:"px-4 py-4 align-top"},Vt=["onClick"],Wt={class:"px-6 py-4 whitespace-nowrap"},zt={class:"flex items-center"},Rt={class:"font-mono font-bold text-blue-700"},Kt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Pt={class:"px-6 py-4 whitespace-nowrap"},$t={class:"px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-blue-700"},qt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Gt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-600"},Ht={class:"px-6 py-4 text-sm text-gray-700"},Jt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Qt={colspan:"8",class:"bg-gray-50 px-0 py-0"},Xt={class:"rounded-lg border border-blue-100 bg-blue-50/60 shadow-inner mx-4 my-2 overflow-x-auto"},Yt={key:0,class:"text-gray-400 py-6 text-center"},Zt={key:1},te={class:"w-full text-xs"},ee={class:"px-4 py-2 border-b"},ae={class:"px-4 py-2 border-b text-right"},le={class:"px-4 py-2 border-b"},oe={class:"px-4 py-2 border-b text-right"},re={class:"px-4 py-2 border-b text-right font-semibold"},se={class:"px-4 py-2 border-b"},ne={key:0,class:"bg-blue-50 border-t-2 border-blue-300"},ie={class:"px-4 py-2 border-b font-bold text-right text-lg text-blue-700"},de={key:2,class:"text-gray-400 py-6 text-center"},ue={key:0,class:"bg-gray-100 border-t-2 border-gray-400"},ce={class:"px-6 py-4 text-right font-bold text-gray-900 text-xl"},pe={key:3,class:"bg-white rounded-2xl shadow-lg border border-gray-100 p-16 text-center"},be={key:4,class:"bg-white rounded-2xl shadow-lg border border-gray-100 p-16 text-center"},ge={__name:"ReportUniversal",props:{data:Array,types:Array,warehouse_outlets:Array,outlets:Array,filters:Object,total_per_type:Object,user_outlet_id:Number},setup(K){var L,E,M,I,U;const o=K,P=at(),$=C(()=>{var l;return((l=P.props.auth)==null?void 0:l.user)||{}}),p=C(()=>o.user_outlet_id===1),N=C(()=>{if(o.user_outlet_id&&o.user_outlet_id!==1&&o.outlets){const l=o.outlets.find(e=>e.id===o.user_outlet_id);return l?l.id:""}return""}),D=u(((L=o.filters)==null?void 0:L.type)||""),w=u(((E=o.filters)==null?void 0:E.warehouse_outlet_id)||""),f=u(p.value?((M=o.filters)==null?void 0:M.outlet_id)||"":N.value),b=u(((I=o.filters)==null?void 0:I.from)||""),g=u(((U=o.filters)==null?void 0:U.to)||""),y=u([]);async function T(l){if(!l){if(p.value)y.value=o.warehouse_outlets||[];else{const a=o.user_outlet_id||$.value.id_outlet;y.value=(o.warehouse_outlets||[]).filter(i=>i.outlet_id==a)}return}const e=Number(l);if(p.value)try{const a=await R.get(`/api/outlet-food-inventory-adjustment/warehouse-outlets?outlet_id=${l}`);y.value=a.data||[]}catch(a){console.error("Error fetching warehouse outlets:",a),y.value=(o.warehouse_outlets||[]).filter(i=>Number(i.outlet_id)===e)}else y.value=(o.warehouse_outlets||[]).filter(a=>Number(a.outlet_id)===e)}const k=u({}),d=u({}),j=u({}),x=u(!1),A=u(!1);lt(f,async l=>{w.value="",await T(l)},{immediate:!0}),ot(()=>{f.value?T(f.value):T(null)});function q(){if(!b.value||!g.value){B.fire({icon:"warning",title:"Filter Wajib",text:"Filter tanggal (Dari dan Sampai) wajib diisi untuk melihat laporan.",confirmButtonText:"OK",confirmButtonColor:"#F59E0B"});return}x.value=!0,z.get(route("outlet-food-inventory-adjustment.report-universal"),{type:D.value,warehouse_outlet_id:w.value,outlet_id:p.value?f.value:N.value||o.user_outlet_id,from:b.value,to:g.value},{preserveState:!0,preserveScroll:!0,replace:!0,onFinish:()=>{x.value=!1},onError:()=>{x.value=!1}})}function G(l){return l?new Date(l).toLocaleDateString("id-ID"):"-"}function H(l){return l==="in"?"Stock In":l==="out"?"Stock Out":l}function J(l){return l==="in"?"bg-gradient-to-r from-green-100 to-green-50 text-green-800 border border-green-200":l==="out"?"bg-gradient-to-r from-red-100 to-red-50 text-red-800 border border-red-200":"bg-gradient-to-r from-gray-100 to-gray-50 text-gray-800 border border-gray-200"}function Q(){z.visit(route("outlet-food-inventory-adjustment.index"))}function X(){if(!b.value||!g.value){B.fire({icon:"warning",title:"Filter Wajib",text:"Filter tanggal (Dari dan Sampai) wajib diisi untuk export.",confirmButtonText:"OK",confirmButtonColor:"#F59E0B"});return}if(!o.data||o.data.length===0){B.fire({icon:"warning",title:"Tidak Ada Data",text:"Tidak ada data untuk diekspor. Silakan load data terlebih dahulu.",confirmButtonText:"OK",confirmButtonColor:"#F59E0B"});return}A.value=!0;const l=new URLSearchParams({type:D.value||"",warehouse_outlet_id:w.value||"",outlet_id:p.value?f.value||"":N.value||o.user_outlet_id,from:b.value,to:g.value});window.location.href=route("outlet-food-inventory-adjustment.report-universal.export")+"?"+l.toString(),setTimeout(()=>{A.value=!1},2e3)}function Y(l){k.value[l]=!k.value[l],k.value[l]&&!d.value[l]&&(j.value[l]=!0,R.get(`/api/outlet-food-inventory-adjustment/${l}/report-details`).then(e=>{e.data&&e.data.success&&e.data.details?d.value[l]=e.data.details:d.value[l]=[]}).catch(e=>{console.error("Error loading details for row",l,":",e),d.value[l]=[]}).finally(()=>{j.value[l]=!1}))}function v(l){return l==null||isNaN(l)?"-":"Rp "+Number(l).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}function Z(l){return l==null||isNaN(l)?"0":Number(l).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}function tt(l){return!l||!Array.isArray(l)||l.length===0?0:l.reduce((e,a)=>{const i=a.subtotal_mac!==null&&a.subtotal_mac!==void 0?Number(a.subtotal_mac):0;return e+i},0)}const et=C(()=>!o.data||!Array.isArray(o.data)||o.data.length===0?0:o.data.reduce((l,e)=>{const a=e.subtotal_mac!==null&&e.subtotal_mac!==void 0?Number(e.subtotal_mac):0;return l+a},0));return(l,e)=>(r(),rt(it,null,{default:V(()=>[t("div",ut,[t("div",{class:"mb-6"},[t("button",{onClick:Q,class:"group mb-4 inline-flex items-center gap-2 px-4 py-2 text-gray-600 hover:text-blue-600 transition-colors duration-200"},e[5]||(e[5]=[t("i",{class:"fa fa-arrow-left group-hover:-translate-x-1 transition-transform duration-200"},null,-1),t("span",{class:"font-medium"},"Kembali",-1)])),e[6]||(e[6]=t("div",{class:"flex items-center gap-4"},[t("div",{class:"p-3 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl shadow-lg"},[t("i",{class:"fa fa-chart-bar text-white text-2xl"})]),t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"Laporan Outlet Stock Adjustment"),t("p",{class:"text-gray-600 mt-1"},"Laporan penyesuaian stok outlet dengan perhitungan MAC")])],-1))]),o.total_per_type&&Object.keys(o.total_per_type).length?(r(),s("div",ct,[(r(!0),s(m,null,_(o.types.filter(a=>a.value),a=>(r(),s("div",{key:a.value,class:"p-5 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl border-2 border-blue-200 shadow-lg hover:shadow-xl transition-shadow duration-200"},[t("div",pt,[t("div",null,[t("div",bt,n(a.label),1),t("div",gt,n(v(o.total_per_type[a.value]||0)),1)]),t("div",xt,[t("i",{class:O([a.value==="in"?"fa fa-arrow-down":"fa fa-arrow-up","text-white text-xl"])},null,2)])])]))),128))])):h("",!0),t("div",ft,[e[15]||(e[15]=t("div",{class:"flex items-start gap-3 mb-4 p-3 bg-amber-100 rounded-xl border border-amber-300"},[t("div",{class:"flex-shrink-0 p-2 bg-amber-500 rounded-lg"},[t("i",{class:"fa fa-info-circle text-white"})]),t("div",{class:"text-sm text-amber-900"},[t("strong",{class:"block mb-1"},"Penting:"),t("p",null,[c("Filter tanggal (Dari dan Sampai) wajib diisi dan maksimal range 3 bulan untuk mencegah timeout server. Hanya data yang sudah "),t("strong",null,"approved"),c(" yang akan ditampilkan.")])])],-1)),t("div",mt,[t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[t("i",{class:"fa fa-calendar text-gray-400 mr-2"}),c("Dari "),t("span",{class:"text-red-500"},"*")],-1)),S(t("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),required:"",class:"w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 shadow-sm hover:shadow-md"},null,512),[[W,b.value]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[t("i",{class:"fa fa-calendar text-gray-400 mr-2"}),c("Sampai "),t("span",{class:"text-red-500"},"*")],-1)),S(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=a=>g.value=a),required:"",class:"w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 shadow-sm hover:shadow-md"},null,512),[[W,g.value]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[t("i",{class:"fa fa-tag text-gray-400 mr-2"}),c("Tipe ")],-1)),S(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>D.value=a),class:"w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 shadow-sm hover:shadow-md"},[(r(!0),s(m,null,_(o.types,a=>(r(),s("option",{key:a.value,value:a.value},n(a.label),9,yt))),128))],512),[[F,D.value]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[t("i",{class:"fa fa-store text-gray-400 mr-2"}),c("Outlet ")],-1)),S(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>f.value=a),disabled:!p.value,class:O(["w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 shadow-sm hover:shadow-md",{"bg-gray-100 cursor-not-allowed":!p.value}])},[p.value?(r(),s("option",ht,"Semua")):h("",!0),(r(!0),s(m,null,_(o.outlets,a=>(r(),s("option",{key:a.id,value:a.id},n(a.name),9,_t))),128))],10,vt),[[F,f.value]]),p.value?h("",!0):(r(),s("span",wt,"(Outlet Anda)"))]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[t("i",{class:"fa fa-warehouse text-gray-400 mr-2"}),c("Warehouse Outlet ")],-1)),S(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>w.value=a),class:"w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 shadow-sm hover:shadow-md"},[e[11]||(e[11]=t("option",{value:""},"Semua",-1)),(r(!0),s(m,null,_(y.value,a=>(r(),s("option",{key:a.id,value:a.id},n(a.name),9,kt))),128))],512),[[F,w.value]])])]),t("div",At,[t("button",{onClick:X,disabled:!b.value||!g.value||x.value||A.value||!o.data||o.data.length===0,class:"group relative px-8 py-3 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 font-semibold flex items-center gap-2 overflow-hidden disabled:opacity-50 disabled:cursor-not-allowed"},[e[13]||(e[13]=t("span",{class:"absolute inset-0 bg-gradient-to-r from-emerald-600 to-emerald-700 opacity-0 group-hover:opacity-100 transition-opacity duration-300"},null,-1)),A.value?(r(),s("i",St)):(r(),s("i",Dt)),t("span",Ct,n(A.value?"Exporting...":"Export Excel"),1)],8,Ot),t("button",{onClick:q,disabled:!b.value||!g.value||x.value,class:"group relative px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 font-semibold flex items-center gap-2 overflow-hidden disabled:opacity-50 disabled:cursor-not-allowed"},[e[14]||(e[14]=t("span",{class:"absolute inset-0 bg-gradient-to-r from-blue-600 to-blue-700 opacity-0 group-hover:opacity-100 transition-opacity duration-300"},null,-1)),x.value?(r(),s("i",Tt)):(r(),s("i",jt)),t("span",Ft,n(x.value?"Loading...":"Load Data"),1)],8,Nt)])]),x.value?(r(),s("div",Bt,e[16]||(e[16]=[t("div",{class:"inline-block animate-spin rounded-full h-16 w-16 border-4 border-blue-200 border-t-blue-500 mb-6"},null,-1),t("p",{class:"text-gray-600 font-semibold text-lg"},"Memuat data laporan...",-1),t("p",{class:"text-gray-400 text-sm mt-2"},"Mohon tunggu sebentar",-1)]))):o.data&&o.data.length>0?(r(),s("div",Lt,[t("table",Et,[e[24]||(e[24]=t("thead",{class:"bg-gradient-to-r from-gray-50 to-gray-100"},[t("tr",null,[t("th",{class:"w-12"}),t("th",{class:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"No. Adjustment"),t("th",{class:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Tanggal"),t("th",{class:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Tipe"),t("th",{class:"px-6 py-4 text-right text-xs font-bold text-gray-700 uppercase tracking-wider"},"Subtotal MAC"),t("th",{class:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Outlet"),t("th",{class:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Warehouse Outlet"),t("th",{class:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Alasan"),t("th",{class:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Dibuat Oleh")])],-1)),t("tbody",Mt,[(r(!0),s(m,null,_(o.data,a=>(r(),s(m,{key:a.id},[t("tr",It,[t("td",Ut,[t("button",{onClick:i=>Y(a.id),class:"p-2 bg-gray-100 hover:bg-blue-100 text-gray-600 hover:text-blue-600 rounded-lg transition-all duration-200 group-hover:scale-110 focus:outline-none"},[t("i",{class:O([k.value[a.id]?"fa fa-chevron-down":"fa fa-chevron-right","text-xs"])},null,2)],8,Vt)]),t("td",Wt,[t("div",zt,[e[17]||(e[17]=t("div",{class:"flex-shrink-0 h-10 w-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center mr-3 shadow-md"},[t("i",{class:"fa fa-file-alt text-white text-sm"})],-1)),t("span",Rt,n(a.number||"-"),1)])]),t("td",Kt,n(G(a.date)),1),t("td",Pt,[t("span",{class:O([J(a.type),"px-3 py-1.5 rounded-full text-xs font-bold shadow-sm"])},[t("i",{class:O([a.type==="in"?"fa fa-arrow-down":"fa fa-arrow-up","mr-1"])},null,2),c(" "+n(H(a.type)),1)],2)]),t("td",$t,n(v(a.subtotal_mac||0)),1),t("td",qt,n(a.outlet_name),1),t("td",Gt,n(a.warehouse_outlet_name),1),t("td",Ht,n(a.reason||"-"),1),t("td",Jt,n(a.creator_name||"-"),1)]),st(nt,{name:"fade-expand"},{default:V(()=>[k.value[a.id]?(r(),s("tr",{key:"detail-"+a.id},[e[21]||(e[21]=t("td",null,null,-1)),t("td",Qt,[t("div",Xt,[j.value[a.id]?(r(),s("div",Yt,"Loading...")):d.value[a.id]&&d.value[a.id].length?(r(),s("div",Zt,[t("table",te,[e[20]||(e[20]=t("thead",{class:"sticky top-0 z-10 bg-blue-100/80"},[t("tr",null,[t("th",{class:"px-4 py-2 border-b font-semibold text-gray-700"},"Item"),t("th",{class:"px-4 py-2 border-b font-semibold text-gray-700 text-right"},"Qty"),t("th",{class:"px-4 py-2 border-b font-semibold text-gray-700"},"Unit"),t("th",{class:"px-4 py-2 border-b font-semibold text-gray-700 text-right"},[c("MAC"),t("br"),c("(per unit)")]),t("th",{class:"px-4 py-2 border-b font-semibold text-gray-700 text-right"},"Subtotal MAC"),t("th",{class:"px-4 py-2 border-b font-semibold text-gray-700"},"Catatan")])],-1)),t("tbody",null,[(r(!0),s(m,null,_(d.value[a.id],i=>(r(),s("tr",{key:i.id,class:"hover:bg-blue-100/60 transition-colors"},[t("td",ee,n(i.item_name||"-"),1),t("td",ae,n(Z(i.qty)),1),t("td",le,n(i.unit||"-"),1),t("td",oe,n(v(i.mac||0)),1),t("td",re,n(v(i.subtotal_mac||0)),1),t("td",se,n(i.note||"-"),1)]))),128)),d.value[a.id]&&Array.isArray(d.value[a.id])&&d.value[a.id].length>0?(r(),s("tr",ne,[e[18]||(e[18]=t("td",{colspan:"4",class:"px-4 py-2 border-b font-bold text-right text-gray-900"},"Total MAC",-1)),t("td",ie,n(v(tt(d.value[a.id]))),1),e[19]||(e[19]=t("td",{class:"px-4 py-2 border-b"},null,-1))])):h("",!0)])])])):(r(),s("div",de,"Tidak ada detail."))])])])):h("",!0)]),_:2},1024)],64))),128))]),o.data&&o.data.length>0?(r(),s("tfoot",ue,[t("tr",null,[e[22]||(e[22]=t("td",{colspan:"4",class:"px-6 py-4 text-right font-bold text-gray-900 text-lg"}," GRAND TOTAL MAC ",-1)),t("td",ce,n(v(et.value)),1),e[23]||(e[23]=t("td",{colspan:"4",class:"px-6 py-4"},null,-1))])])):h("",!0)])])):b.value&&g.value?(r(),s("div",pe,e[25]||(e[25]=[t("div",{class:"p-4 bg-gray-100 rounded-full inline-block mb-6"},[t("i",{class:"fa fa-info-circle text-gray-400 text-5xl"})],-1),t("p",{class:"text-gray-600 font-semibold text-lg"},"Tidak ada data untuk filter yang dipilih.",-1),t("p",{class:"text-gray-400 text-sm mt-2"},"Coba ubah filter atau pilih range tanggal yang berbeda.",-1)]))):(r(),s("div",be,e[26]||(e[26]=[t("div",{class:"p-4 bg-blue-100 rounded-full inline-block mb-6"},[t("i",{class:"fa fa-calendar-alt text-blue-400 text-5xl"})],-1),t("p",{class:"text-gray-600 font-semibold text-lg"},"Silakan isi filter tanggal",-1),t("p",{class:"text-gray-400 text-sm mt-2"},'Pilih range tanggal dan klik tombol "Load Data" untuk melihat data.',-1)])))])]),_:1}))}},Se=dt(ge,[["__scopeId","data-v-62dfe1db"]]);export{Se as default};
