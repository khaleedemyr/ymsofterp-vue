import{r as d,w as $,L as n,E as N,B as o,D as t,N as m,G as f,F as B,M as C,O,H as _,I as S,J as D,l as H}from"./vendor-vue-g7iCcTkf.js";import{a as b}from"./vendor-utils-CpgP2uT4.js";import{S as r}from"./app-ErXbte2J.js";import"./vendor-charts-CuqD4wLC.js";const L={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 transition-all"},U={class:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl mx-auto p-0 animate-fade-in"},j={class:"px-8 pt-8 pb-2"},q={class:"flex items-center gap-2 mb-6"},z={class:"text-2xl font-bold text-gray-900"},J={key:0,class:"text-center py-4"},K={key:1},Y={class:"w-full border rounded mb-4"},Q={class:"py-2 px-3"},R={class:"py-2 px-3 font-mono"},W={class:"py-2 px-3"},X={class:"py-2 px-3 text-center"},Z=["onClick"],ee=["onClick"],te={key:0},se={key:2,class:"border-t pt-4 mt-4"},ae={class:"font-semibold mb-2"},le=["value"],re={__name:"PinManagementModal",props:{show:Boolean,userId:[String,Number],userName:String},emits:["close"],setup(g,{emit:M}){const y=g,E=M,p=d([]),h=d([]),u=d(!1),c=d(!1),v=d(!1),l=d({id:null,outlet_id:"",pin:"",is_active:!0});function x(){u.value=!0,b.get(`/admin/users/${y.userId}/pins`).then(a=>{p.value=a.data.pins||[],h.value=a.data.outlets||[]}).catch(a=>{var s,i,P,w,I;console.error("Error fetching pins:",a),p.value=[],h.value=[];let e="Gagal memuat data PIN";((s=a.response)==null?void 0:s.status)===401?e="Anda harus login untuk mengakses data ini":((i=a.response)==null?void 0:i.status)===403?e="Anda tidak memiliki akses untuk mengelola PIN":((P=a.response)==null?void 0:P.status)===404?e="Data PIN tidak ditemukan":(I=(w=a.response)==null?void 0:w.data)!=null&&I.message&&(e=a.response.data.message),r.fire("Error",e,"error")}).finally(()=>{u.value=!1})}$(()=>y.show,a=>{a&&x()});function G(){v.value=!1,l.value={id:null,outlet_id:"",pin:"",is_active:!0},c.value=!0}function T(a){v.value=!0,l.value={...a,outlet_id:a.outlet_id,is_active:!!a.is_active},c.value=!0}function k(){c.value=!1}function A(){u.value=!0;const a={outlet_id:l.value.outlet_id,pin:l.value.pin,is_active:l.value.is_active?1:0};v.value&&l.value.id?b.put(`/admin/user-pins/${l.value.id}`,a).then(()=>{r.fire("Berhasil","PIN berhasil diupdate","success"),x(),k()}).catch(e=>{var s,i;r.fire("Gagal",((i=(s=e.response)==null?void 0:s.data)==null?void 0:i.message)||"Gagal update PIN","error")}).finally(()=>u.value=!1):b.post(`/admin/users/${y.userId}/pins`,a).then(()=>{r.fire("Berhasil","PIN berhasil ditambahkan","success"),x(),k()}).catch(e=>{var s,i;r.fire("Gagal",((i=(s=e.response)==null?void 0:s.data)==null?void 0:i.message)||"Gagal tambah PIN","error")}).finally(()=>u.value=!1)}function F(a){r.fire({title:"Hapus PIN?",text:"PIN akan dihapus permanen",icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, hapus",cancelButtonText:"Batal"}).then(e=>{e.isConfirmed&&(u.value=!0,b.delete(`/admin/user-pins/${a}`).then(()=>{r.fire("Berhasil","PIN dihapus","success"),x()}).catch(()=>{r.fire("Gagal","Gagal hapus PIN","error")}).finally(()=>u.value=!1))})}function V(){E("close")}return(a,e)=>g.show?(o(),n("div",L,[t("div",U,[t("div",j,[t("div",q,[e[3]||(e[3]=t("i",{class:"fa-solid fa-key text-blue-500 text-2xl"},null,-1)),t("h3",z,"Kelola PIN - "+m(g.userName),1)]),t("div",{class:"mb-4 flex justify-between items-center"},[t("button",{onClick:G,class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 flex items-center gap-2"},e[4]||(e[4]=[t("i",{class:"fa-solid fa-plus"},null,-1),f(" Tambah PIN ")])),t("button",{onClick:V,class:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200 flex items-center gap-2"},e[5]||(e[5]=[t("i",{class:"fa-solid fa-xmark"},null,-1),f(" Tutup ")]))]),u.value?(o(),n("div",J,e[6]||(e[6]=[t("i",{class:"fa fa-spinner fa-spin text-blue-600 text-2xl"},null,-1),f(" Memuat data... ")]))):(o(),n("div",K,[t("table",Y,[e[10]||(e[10]=t("thead",null,[t("tr",{class:"bg-gray-100"},[t("th",{class:"py-2 px-3 text-left"},"Outlet"),t("th",{class:"py-2 px-3 text-left"},"PIN"),t("th",{class:"py-2 px-3 text-left"},"Status"),t("th",{class:"py-2 px-3 text-center"},"Aksi")])],-1)),t("tbody",null,[(o(!0),n(B,null,C(p.value||[],s=>(o(),n("tr",{key:s.id,class:"border-b"},[t("td",Q,m(s.nama_outlet||"-"),1),t("td",R,m(s.pin),1),t("td",W,[t("span",{class:H(s.is_active?"text-green-600":"text-gray-400")},m(s.is_active?"Aktif":"Nonaktif"),3)]),t("td",X,[t("button",{onClick:i=>T(s),class:"text-blue-600 hover:underline mr-2"},e[7]||(e[7]=[t("i",{class:"fa fa-edit"},null,-1),f(" Edit")]),8,Z),t("button",{onClick:i=>F(s.id),class:"text-red-600 hover:underline"},e[8]||(e[8]=[t("i",{class:"fa fa-trash"},null,-1),f(" Hapus")]),8,ee)])]))),128)),!p.value||p.value.length===0?(o(),n("tr",te,e[9]||(e[9]=[t("td",{colspan:"4",class:"text-center text-gray-400 py-4"},"Belum ada PIN",-1)]))):N("",!0)])])])),c.value?(o(),n("div",se,[t("h4",ae,m(v.value?"Edit":"Tambah")+" PIN",1),t("form",{onSubmit:O(A,["prevent"]),class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium mb-1"},"Outlet",-1)),_(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>l.value.outlet_id=s),class:"form-input w-full",required:""},[e[11]||(e[11]=t("option",{value:""},"Pilih Outlet",-1)),(o(!0),n(B,null,C(h.value||[],s=>(o(),n("option",{key:s.id_outlet,value:s.id_outlet},m(s.nama_outlet),9,le))),128))],512),[[S,l.value.outlet_id]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium mb-1"},"PIN",-1)),_(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.value.pin=s),type:"text",maxlength:"20",class:"form-input w-full font-mono",required:""},null,512),[[D,l.value.pin]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium mb-1"},"Status",-1)),_(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.value.is_active=s),class:"form-input w-full"},e[14]||(e[14]=[t("option",{value:!0},"Aktif",-1),t("option",{value:!1},"Nonaktif",-1)]),512),[[S,l.value.is_active]])]),t("div",{class:"flex items-end gap-2"},[e[16]||(e[16]=t("button",{type:"submit",class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"},"Simpan",-1)),t("button",{type:"button",onClick:k,class:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200"},"Batal")])],32)])):N("",!0)])])])):N("",!0)}};export{re as default};
