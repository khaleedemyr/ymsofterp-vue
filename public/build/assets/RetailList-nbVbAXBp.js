import{r as m,a as B,L as r,B as o,A as E,D as t,F as c,M as d,E as p,O as A,T as L,N as i}from"./vendor-vue-g7iCcTkf.js";import{a as F,f as P}from"./vendor-utils-CpgP2uT4.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{i as T}from"./id-C4ThNj35.js";const $={class:"retail-list"},q={key:0,class:"flex justify-center py-4"},G={key:1,class:"text-center py-4 text-gray-500"},V={key:2,class:"space-y-4"},H={class:"p-4 border-b"},z={class:"text-sm text-gray-600"},O={class:"text-sm text-gray-600"},U={class:"mt-1"},X={class:"text-sm font-medium"},J={class:"text-sm text-gray-600"},K={class:"p-4"},Q={class:"grid grid-cols-4 gap-2"},W=["onClick"],Y=["src"],Z={key:0,class:"mt-2"},tt={class:"text-sm text-gray-600 hover:text-gray-800"},et={class:"p-4 border-t"},st={class:"space-y-3"},at={class:"font-medium"},ot={class:"text-sm text-gray-600"},nt={key:0,class:"mt-2"},rt={class:"flex flex-wrap gap-2"},lt=["onClick"],it=["src"],ct={class:"font-medium"},dt={class:"mt-4 pt-3 border-t flex justify-between items-center"},ut={class:"text-lg font-semibold"},mt={class:"p-4"},_t=["src"],k=4,ft={__name:"RetailList",props:{taskId:{type:[Number,String],required:!0}},setup(w,{expose:I}){const M=w,u=m([]),_=m(!0),f=m(!1),g=m("");B(()=>{h()});async function h(){_.value=!0;try{const e=await F.get(`/api/retail/task/${M.taskId}`);e.data.success&&(console.log("Retail data received:",e.data.data),u.value=e.data.data,u.value.forEach(s=>{s.items.forEach(a=>{console.log(`Item ${a.id} barang_images:`,a.barang_images)})}))}catch(e){console.error("Error loading retail data:",e)}finally{_.value=!1}}function R(e){const s=new Date(e);return P(s,"dd MMM yyyy HH:mm",{locale:T})}function v(e){return e==null||isNaN(e)?"0":new Intl.NumberFormat("id-ID").format(e)}function y(e){return Array.isArray(e)?e.filter(s=>s.nama_barang!=="Invoice"):[]}function j(e){return e!=null&&e.items?y(e.items).reduce((s,a)=>{const n=parseFloat(a.subtotal)||0;return s+n},0):0}function C(e){return e.items.reduce((a,n)=>{var l;return a+(((l=n.invoice_images)==null?void 0:l.length)||0)},0)>k}function D(e){return e.items.reduce((a,n)=>{var l;return a+(((l=n.invoice_images)==null?void 0:l.length)||0)},0)-k}function b(e){g.value=e,f.value=!0}function x(){f.value=!1,g.value=""}return I({loadRetailData:h}),(e,s)=>(o(),r("div",$,[_.value?(o(),r("div",q,s[1]||(s[1]=[t("i",{class:"fas fa-spinner fa-spin text-blue-500 text-xl"},null,-1)]))):u.value.length===0?(o(),r("div",G," Belum ada data retail ")):(o(),r("div",V,[(o(!0),r(c,null,d(u.value,a=>(o(),r("div",{key:a.id,class:"bg-white rounded-lg shadow"},[t("div",H,[t("div",null,[s[2]||(s[2]=t("h3",{class:"font-medium"},"Retail",-1)),t("p",z,"Dibuat oleh: "+i(a.created_by_name),1),t("p",O,i(R(a.created_at)),1),t("div",U,[t("p",X,i(a.nama_toko),1),t("p",J,i(a.alamat_toko),1)])])]),t("div",K,[t("div",Q,[(o(!0),r(c,null,d(a.items,n=>(o(),r(c,{key:n.id},[(o(!0),r(c,null,d(n.invoice_images,l=>(o(),r("div",{key:l.id,class:"aspect-square rounded-lg overflow-hidden border cursor-pointer",onClick:N=>b(l.url)},[t("img",{src:l.url,class:"w-full h-full object-cover"},null,8,Y)],8,W))),128))],64))),128))]),C(a)?(o(),r("div",Z,[t("button",tt," +"+i(D(a))+" more ",1)])):p("",!0)]),t("div",et,[t("div",st,[(o(!0),r(c,null,d(y(a.items),n=>(o(),r("div",{key:n.id,class:"flex justify-between items-center"},[t("div",null,[t("p",at,i(n.nama_barang),1),t("p",ot,i(n.qty)+" x Rp "+i(v(n.harga_barang)),1),n.barang_images&&n.barang_images.length>0?(o(),r("div",nt,[t("div",rt,[(o(!0),r(c,null,d(n.barang_images,l=>(o(),r("div",{key:l.id,class:"w-16 h-16 rounded-lg overflow-hidden border cursor-pointer",onClick:N=>b(l.url)},[t("img",{src:l.url,class:"w-full h-full object-cover"},null,8,it)],8,lt))),128))])])):p("",!0)]),t("p",ct,"Rp "+i(v(n.subtotal)),1)]))),128))]),t("div",dt,[s[3]||(s[3]=t("p",{class:"font-medium"},"Grand Total",-1)),t("p",ut,"Rp "+i(v(j(a))),1)])])]))),128))])),(o(),E(L,{to:"body"},[f.value?(o(),r("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:x},[t("div",{class:"bg-white rounded-lg max-w-3xl max-h-[90vh] overflow-hidden",onClick:s[0]||(s[0]=A(()=>{},["stop"]))},[t("div",{class:"p-2 border-b flex justify-between items-center"},[s[5]||(s[5]=t("h3",{class:"text-lg font-semibold"},"Preview Image",-1)),t("button",{onClick:x,class:"text-gray-500 hover:text-gray-700"},s[4]||(s[4]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",mt,[t("img",{src:g.value,class:"max-w-full max-h-[70vh] object-contain"},null,8,_t)])])])):p("",!0)]))]))}},yt=S(ft,[["__scopeId","data-v-f6b9b837"]]);export{yt as default};
