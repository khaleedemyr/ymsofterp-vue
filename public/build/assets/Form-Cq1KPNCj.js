import{r as m,k as $,c as z,a as H,w as R,A as J,B as l,C as X,D as t,G as _,O as Y,L as a,E as h,H as p,l as M,F as G,M as q,N as c,I as P,J as V,V as Z,W as A}from"./vendor-vue-g7iCcTkf.js";import{A as ee}from"./AppLayout-DUleG9B8.js";import{a as C}from"./vendor-utils-CpgP2uT4.js";import{S as v}from"./app-P14ApjUf.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-BD6EyRcy.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const te={class:"max-w-7xl mx-auto py-8 px-2"},oe={class:"bg-white rounded-xl shadow-lg p-6"},re={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},se=["disabled"],le=["value"],ae={key:0,class:"text-xs text-gray-500 mt-1"},ie=["disabled"],ne=["value"],ue={key:0,class:"text-xs text-blue-600 mt-1"},de={key:1,class:"text-xs text-gray-500 mt-1"},ce=["disabled"],ge=["value"],_e={key:0,class:"text-xs text-blue-600 mt-1"},me={key:1,class:"text-xs text-gray-500 mt-1"},fe={key:2,class:"text-xs text-orange-600 mt-1"},ve={class:"md:col-span-2"},pe={key:0,class:"bg-white rounded-xl shadow-lg p-6"},ye={key:0,class:"text-center py-8"},xe={key:1,class:"text-center py-8 text-gray-500"},be={key:2,class:"space-y-4"},he={class:"flex items-center justify-between mb-3"},we={class:"flex-1"},ke={class:"font-semibold text-gray-800"},Oe={class:"text-sm text-gray-600"},Ee={class:"text-sm text-gray-600"},Re={class:"font-medium text-orange-600"},Ge={class:"text-sm text-gray-600"},qe={class:"font-medium text-blue-600"},Ce={class:"flex items-center gap-2"},De=["id","value"],Se=["for"],je={key:0,class:"mt-3 p-3 bg-orange-50 rounded-lg"},Me={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Pe=["max","onUpdate:modelValue","placeholder"],Ve=["value"],Be={class:"text-xs text-gray-500 mt-1"},Ue={class:"flex justify-end gap-4"},Fe=["disabled"],Le={key:0},We={key:1},Xe={__name:"Form",props:{user:Object,outlets:Array,warehouseOutlets:Array,goodReceives:Array},setup(I){var L,W;const y=I,w=m(!1),D=m(!1),x=m(!1),b=m(!1),g=m([]),u=m([]),i=$({}),S=m(null),k=m([]),f=m([]),O=z(()=>{var s;return((s=y.user)==null?void 0:s.id_outlet)===1}),r=$({outlet_food_good_receive_id:"",outlet_id:((L=y.user)==null?void 0:L.id_outlet)===1?"":((W=y.user)==null?void 0:W.id_outlet)||"",warehouse_outlet_id:"",return_date:new Date().toISOString().split("T")[0],notes:""});H(()=>{k.value=y.warehouseOutlets||[],f.value=y.goodReceives||[],!O.value&&r.outlet_id&&(console.log("Loading warehouse outlets for outlet_id:",r.outlet_id),j())}),R(()=>r.outlet_id,s=>{s?j():(k.value=[],f.value=[],r.warehouse_outlet_id="",r.outlet_food_good_receive_id="",g.value=[],u.value=[],Object.keys(i).forEach(e=>delete i[e]))}),R(()=>r.warehouse_outlet_id,s=>{s?B():(f.value=[],r.outlet_food_good_receive_id="",g.value=[],u.value=[],Object.keys(i).forEach(e=>delete i[e]))}),R(()=>r.outlet_food_good_receive_id,s=>{if(s){const e=f.value.find(o=>o.id==s);e&&(S.value=e,U())}else S.value=null,g.value=[],u.value=[],Object.keys(i).forEach(e=>delete i[e])}),R(u,s=>{Object.keys(i).forEach(e=>{s.includes(parseInt(e))||delete i[e]}),s.forEach(e=>{if(!i[e]){const o=g.value.find(n=>n.gr_item_id==e);o&&(i[e]=o.received_qty)}})});async function j(){var s,e,o;if(!r.outlet_id){console.log("No outlet_id selected, skipping warehouse outlets load");return}console.log("Loading warehouse outlets for outlet_id:",r.outlet_id),x.value=!0;try{const n=await C.get("/api/warehouse-outlets",{params:{outlet_id:r.outlet_id,status:"active"}});console.log("Warehouse outlets response:",n.data),k.value=n.data,r.warehouse_outlet_id="",r.outlet_food_good_receive_id="",f.value=[],g.value=[],u.value=[],Object.keys(i).forEach(d=>delete i[d])}catch(n){console.error("Error loading warehouse outlets:",n),console.error("Error response:",(s=n.response)==null?void 0:s.data),v.fire({icon:"error",title:"Error",text:"Gagal memuat warehouse outlet: "+(((o=(e=n.response)==null?void 0:e.data)==null?void 0:o.error)||n.message)})}finally{x.value=!1}}async function B(){if(!(!r.outlet_id||!r.warehouse_outlet_id)){b.value=!0;try{const s=await C.get("/api/outlet-food-return/get-good-receives",{params:{outlet_id:r.outlet_id,warehouse_outlet_id:r.warehouse_outlet_id}});f.value=s.data,r.outlet_food_good_receive_id="",g.value=[],u.value=[],Object.keys(i).forEach(e=>delete i[e])}catch(s){console.error("Error loading good receives:",s),v.fire({icon:"error",title:"Error",text:"Gagal memuat Good Receive"})}finally{b.value=!1}}}async function U(){if(r.outlet_food_good_receive_id){D.value=!0;try{const s=await C.get("/api/outlet-food-return/get-good-receive-items",{params:{good_receive_id:r.outlet_food_good_receive_id,outlet_id:r.outlet_id,warehouse_outlet_id:r.warehouse_outlet_id}});g.value=s.data,u.value=[],Object.keys(i).forEach(e=>delete i[e])}catch(s){console.error("Error loading items:",s),v.fire({icon:"error",title:"Error",text:"Gagal memuat item dari Good Receive"})}finally{D.value=!1}}}async function N(){var s,e;if(u.value.length===0){v.fire({icon:"warning",title:"Peringatan",text:"Pilih minimal satu item untuk di-return"});return}for(const o of u.value){const n=i[o],d=g.value.find(E=>E.gr_item_id==o);if(!n||n<=0){v.fire({icon:"error",title:"Error",text:`Qty return untuk ${d==null?void 0:d.item_name} harus lebih dari 0`});return}if(n>d.received_qty){v.fire({icon:"error",title:"Error",text:`Qty return untuk ${d.item_name} tidak boleh melebihi qty yang diterima (${d.received_qty})`});return}}w.value=!0;try{const o=u.value.map(d=>{const E=g.value.find(K=>K.gr_item_id==d);return{gr_item_id:d,item_id:E.item_id,return_qty:parseFloat(i[d]),unit_id:E.unit_id}}),n=await C.post("/outlet-food-return",{...r,items:o});n.data.success&&v.fire({icon:"success",title:"Berhasil",text:n.data.message,timer:2e3,showConfirmButton:!1}).then(()=>{A.visit("/outlet-food-return")})}catch(o){console.error("Error submitting form:",o),v.fire({icon:"error",title:"Error",text:((e=(s=o.response)==null?void 0:s.data)==null?void 0:e.message)||"Gagal menyimpan return"})}finally{w.value=!1}}function F(){A.visit("/outlet-food-return")}function T(s){return!s&&s!==0?"0.00":parseFloat(s).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}function Q(s){return s?new Date(s).toLocaleDateString("id-ID"):"-"}return(s,e)=>(l(),J(ee,null,{default:X(()=>[t("div",te,[t("div",{class:"flex justify-between items-center mb-6"},[e[7]||(e[7]=t("h1",{class:"text-2xl font-bold text-gray-800 flex items-center gap-2"},[t("i",{class:"fa-solid fa-undo text-orange-500"}),_(" Buat Return Outlet Food ")],-1)),t("button",{onClick:F,class:"bg-gray-500 text-white px-4 py-2 rounded-xl shadow-lg hover:shadow-2xl transition-all font-semibold"},e[6]||(e[6]=[t("i",{class:"fa fa-arrow-left mr-2"},null,-1),_(" Kembali ")]))]),t("form",{onSubmit:Y(N,["prevent"]),class:"space-y-6"},[t("div",oe,[e[18]||(e[18]=t("h3",{class:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"},[t("i",{class:"fa-solid fa-info-circle text-orange-500"}),_(" Informasi Return ")],-1)),t("div",re,[t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Pilih Outlet *",-1)),p(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>r.outlet_id=o),onChange:j,disabled:!O.value,class:M(["w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",{"bg-gray-100":!O.value}]),required:""},[e[8]||(e[8]=t("option",{value:""},"-- Pilih Outlet --",-1)),(l(!0),a(G,null,q(y.outlets,o=>(l(),a("option",{key:o.id_outlet,value:o.id_outlet},c(o.nama_outlet),9,le))),128))],42,se),[[P,r.outlet_id]]),O.value?h("",!0):(l(),a("p",ae," Outlet sudah ditentukan berdasarkan user login "))]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Pilih Warehouse Outlet *",-1)),p(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.warehouse_outlet_id=o),onChange:B,disabled:!r.outlet_id||x.value,class:M(["w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",{"bg-gray-100":!r.outlet_id||x.value}]),required:""},[e[10]||(e[10]=t("option",{value:""},"-- Pilih Warehouse Outlet --",-1)),(l(!0),a(G,null,q(k.value,o=>(l(),a("option",{key:o.id,value:o.id},c(o.name),9,ne))),128))],42,ie),[[P,r.warehouse_outlet_id]]),x.value?(l(),a("p",ue,e[11]||(e[11]=[t("i",{class:"fa fa-spinner fa-spin mr-1"},null,-1),_(" Memuat warehouse outlet... ")]))):r.outlet_id?h("",!0):(l(),a("p",de," Pilih outlet terlebih dahulu "))]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Pilih Good Receive *",-1)),p(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>r.outlet_food_good_receive_id=o),onChange:U,disabled:!r.warehouse_outlet_id||b.value,class:M(["w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",{"bg-gray-100":!r.warehouse_outlet_id||b.value}]),required:""},[e[13]||(e[13]=t("option",{value:""},"-- Pilih Good Receive --",-1)),(l(!0),a(G,null,q(f.value,o=>(l(),a("option",{key:o.id,value:o.id},c(o.number)+" - "+c(Q(o.receive_date)),9,ge))),128))],42,ce),[[P,r.outlet_food_good_receive_id]]),b.value?(l(),a("p",_e,e[14]||(e[14]=[t("i",{class:"fa fa-spinner fa-spin mr-1"},null,-1),_(" Memuat Good Receive... ")]))):r.warehouse_outlet_id?r.warehouse_outlet_id&&f.value.length===0?(l(),a("p",fe," Tidak ada Good Receive dalam 24 jam terakhir ")):h("",!0):(l(),a("p",me," Pilih warehouse outlet terlebih dahulu "))]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tanggal Return *",-1)),p(t("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=o=>r.return_date=o),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",required:""},null,512),[[V,r.return_date]])]),t("div",ve,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Catatan",-1)),p(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.notes=o),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",placeholder:"Catatan untuk return ini..."},null,512),[[V,r.notes]])])])]),S.value?(l(),a("div",pe,[e[25]||(e[25]=t("h3",{class:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"},[t("i",{class:"fa-solid fa-boxes text-orange-500"}),_(" Item yang Dapat Di-Return ")],-1)),D.value?(l(),a("div",ye,e[19]||(e[19]=[t("i",{class:"fa fa-spinner fa-spin text-2xl text-orange-500 mb-2"},null,-1),t("p",{class:"text-gray-600"},"Memuat item...",-1)]))):g.value.length===0?(l(),a("div",xe,e[20]||(e[20]=[t("i",{class:"fa fa-box-open text-4xl mb-2"},null,-1),t("p",null,"Tidak ada item yang dapat di-return dari Good Receive ini.",-1)]))):(l(),a("div",be,[(l(!0),a(G,null,q(g.value,o=>(l(),a("div",{key:o.gr_item_id,class:"border border-gray-200 rounded-lg p-4"},[t("div",he,[t("div",we,[t("h4",ke,c(o.item_name),1),t("p",Oe,"SKU: "+c(o.sku),1),t("p",Ee,[e[21]||(e[21]=_(" Qty yang dapat di-return: ")),t("span",Re,c(o.received_qty)+" "+c(o.unit_name),1)]),t("p",Ge,[e[22]||(e[22]=_(" Stok saat ini: ")),t("span",qe,c(T(o.current_stock||0))+" "+c(o.small_unit_name||o.unit_name),1)])]),t("div",Ce,[p(t("input",{type:"checkbox",id:`item_${o.gr_item_id}`,"onUpdate:modelValue":e[5]||(e[5]=n=>u.value=n),value:o.gr_item_id,class:"h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"},null,8,De),[[Z,u.value]]),t("label",{for:`item_${o.gr_item_id}`,class:"text-sm font-medium text-gray-700"}," Pilih untuk return ",8,Se)])]),u.value.includes(o.gr_item_id)?(l(),a("div",je,[t("div",Me,[t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Qty Return *",-1)),p(t("input",{type:"number",step:"0.01",min:"0.01",max:o.received_qty,"onUpdate:modelValue":n=>i[o.gr_item_id]=n,class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",placeholder:`Maksimal ${o.received_qty} ${o.unit_name}`,required:""},null,8,Pe),[[V,i[o.gr_item_id]]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Unit",-1)),t("input",{type:"text",value:o.unit_name,class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100",readonly:""},null,8,Ve)])]),t("p",Be," Maksimal: "+c(o.received_qty)+" "+c(o.unit_name),1)])):h("",!0)]))),128))]))])):h("",!0),t("div",Ue,[t("button",{type:"button",onClick:F,class:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Batal "),t("button",{type:"submit",disabled:w.value||u.value.length===0,class:"px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[w.value?(l(),a("span",Le,e[26]||(e[26]=[t("i",{class:"fa fa-spinner fa-spin mr-2"},null,-1),_(" Menyimpan... ")]))):(l(),a("span",We,e[27]||(e[27]=[t("i",{class:"fa fa-save mr-2"},null,-1),_(" Simpan Return ")])))],8,Fe)])],32)])]),_:1}))}};export{Xe as default};
