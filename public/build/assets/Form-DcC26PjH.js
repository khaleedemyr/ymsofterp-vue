import{r as u,c as L,w as A,b as K,L as o,B as l,D as t,E as y,x as W,G as m,H as C,J as Q,I as X,F as S,M as G,N as r,O as Y,C as Z,l as ee}from"./vendor-vue-g7iCcTkf.js";import{a as B}from"./vendor-utils-CpgP2uT4.js";import{S as N}from"./app-BGYKUG_N.js";import{_ as te}from"./Modal-BBL5yay4.js";import"./vendor-charts-CuqD4wLC.js";const se={class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40"},ae={class:"bg-white rounded-xl shadow-2xl w-full max-w-lg p-6 relative max-h-[90vh] overflow-y-auto"},oe={key:0},le={class:"mb-4"},ie={class:"flex gap-2 mb-2"},ne={key:0,class:"mb-2"},re={key:0,class:"mb-2"},de=["value"],ue={key:1},ce={class:"mb-4"},pe={class:"font-bold text-blue-700 mb-2"},me={class:"text-sm text-gray-600 mb-2"},ve={class:"mb-6"},ye={class:"bg-blue-50 border-l-4 border-blue-400 p-3 mb-3"},xe={class:"text-sm font-semibold text-blue-800"},fe={class:"min-w-full divide-y divide-gray-200 mb-4"},be={class:"px-2 py-1"},ge={class:"text-xs text-gray-400"},he=["onClick","disabled"],_e={class:"px-2 py-1 text-right"},we={class:"text-xs text-gray-400"},ke={class:"px-2 py-1 text-right"},qe=["onUpdate:modelValue","max","onInput"],Ce={key:0,class:"text-red-500 text-xs mt-1"},Se={class:"flex justify-end gap-2 mt-4"},Ge=["disabled"],Ve={key:0,class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Fe={key:2,class:"text-red-500 mt-2"},Me={class:"p-4 min-w-[320px] max-w-[90vw]"},Qe={key:0,class:"text-center py-8"},Be={key:1},Ne={class:"mb-2"},Oe={class:"mb-2"},De={key:0},Ie={key:1,class:"italic text-gray-400"},Re={class:"mb-2"},Te={key:0},Pe={key:1,class:"italic text-gray-400"},He={key:0,class:"mb-2"},$e={class:"flex flex-wrap gap-2 mt-1"},Ue=["src"],je={key:2,class:"text-red-500 text-center py-4"},We={__name:"Form",emits:["close"],setup(ze,{emit:$}){const U=$,g=u(""),x=u(null),h=u([]),O=u(!1),f=u(""),_=u(!1),w=u([]),b=u(""),v=u(!1),k=u(!1),n=u({}),V=u(!1),q=u("");let c=null;const j=L(()=>{const a={};return h.value.forEach(e=>{const s=e.warehouse_division_name||"Tanpa Division";a[s]||(a[s]=[]),a[s].push(e)}),a}),D=async()=>{var a,e;f.value="";try{const s=await B.post(route("food-good-receive.fetch-po"),{po_number:g.value});x.value=s.data.po,h.value=s.data.items.map(p=>({...p,quantity:parseFloat(p.quantity)||0,qty_received:parseFloat(p.quantity)||0})),O.value=!0,q.value=""}catch(s){f.value=((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.message)||"PO tidak ditemukan"}},I=a=>{var d;a.qty_error="";const e=parseFloat(a.qty_received)||0,s=parseFloat(a.quantity)||0;if(e==null||isNaN(e))return a.qty_error="Jumlah harus diisi",!1;if(e<0)return a.qty_error="Jumlah tidak boleh negatif",!1;const p=s*.1,i=s+p;return e>i?(a.qty_error=`Jumlah tidak boleh melebihi ${s} + 10% (${i.toFixed(2)})`,!1):((d=e.toString().split(".")[1])==null?void 0:d.length)>2?(a.qty_error="Maksimal 2 angka di belakang koma",!1):!0},z=async()=>{var e,s,p,i;if(f.value="",v.value=!0,!h.value.every(d=>I(d))){v.value=!1,await N.fire({icon:"error",title:"Validasi Gagal",text:"Mohon periksa kembali jumlah yang diterima"});return}try{await B.post(route("food-good-receive.store"),{po_id:x.value.id,supplier_id:x.value.supplier_id,receive_date:new Date().toISOString().slice(0,10),items:h.value.map(d=>({po_item_id:d.id,item_id:d.item_id,qty_ordered:parseFloat(d.quantity)||0,qty_received:parseFloat(d.qty_received)||0,unit_id:d.unit_id||1})),notes:q.value||""}),v.value=!1,await N.fire({icon:"success",title:"Berhasil",text:"Good Receive berhasil disimpan",timer:1500,showConfirmButton:!1}),F(),window.location.reload()}catch(d){v.value=!1,await N.fire({icon:"error",title:"Gagal",text:((s=(e=d.response)==null?void 0:e.data)==null?void 0:s.message)||"Gagal simpan Good Receive"}),f.value=((i=(p=d.response)==null?void 0:p.data)==null?void 0:i.message)||"Gagal simpan Good Receive"}},R=()=>{_.value=!1,c&&c.stop().then(()=>c.clear()).catch(()=>{})};A(_,async a=>{if(a)if(window.Html5Qrcode)T();else{const e=document.createElement("script");e.src="https://unpkg.com/html5-qrcode",e.onload=T,document.body.appendChild(e)}});async function T(){var a;window.Html5Qrcode&&(w.value=await window.Html5Qrcode.getCameras(),b.value=((a=w.value[0])==null?void 0:a.id)||"",P())}function P(){!window.Html5Qrcode||!b.value||(c&&c.stop().then(()=>c.clear()),c=new window.Html5Qrcode("qr-reader"),c.start(b.value,{fps:10,qrbox:200},a=>{g.value=a,R(),D()}))}function J(){P()}async function E(a){if(a.item_id){V.value=!0,k.value=!0;try{const e=await B.get(`/api/items/${a.item_id}/detail`);n.value=e.data.item}catch{n.value={error:"Gagal mengambil data item"}}finally{V.value=!1}}}function H(){k.value=!1,n.value={}}function F(){k.value||U("close")}return K(()=>{if(c)try{c.stop().then(()=>c.clear()).catch(()=>{})}catch{}}),(a,e)=>(l(),o("div",se,[t("div",ae,[e[22]||(e[22]=t("h2",{class:"text-xl font-bold mb-4 flex items-center gap-2"},[t("i",{class:"fa-solid fa-truck"}),m(" Buat Good Receive ")],-1)),t("button",{onClick:F,class:"absolute top-4 right-4 text-gray-400 hover:text-red-500"},e[4]||(e[4]=[t("i",{class:"fa-solid fa-xmark text-2xl"},null,-1)])),O.value?(l(),o("div",ue,[t("div",ce,[t("div",pe,"PO: "+r(x.value.number),1),t("div",me,"Supplier: "+r(x.value.supplier_id)+" | Tanggal: "+r(x.value.date),1)]),t("form",{onSubmit:Y(z,["prevent"])},[t("div",ve,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[t("i",{class:"fa-solid fa-comment mr-2"}),m(" Keterangan (Opsional) ")],-1)),C(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=s=>q.value=s),rows:"3",placeholder:"Masukkan keterangan tambahan untuk Good Receive ini...",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"},null,512),[[Q,q.value]]),e[10]||(e[10]=t("div",{class:"text-xs text-gray-500 mt-1"}," Keterangan ini akan disimpan bersama dengan data Good Receive ",-1))]),(l(!0),o(S,null,G(j.value,(s,p)=>(l(),o("div",{key:p,class:"mb-6"},[t("div",ye,[t("h3",xe,[e[11]||(e[11]=t("i",{class:"fa fa-building mr-2"},null,-1)),m(" "+r(p||"Tanpa Division"),1)])]),t("table",fe,[e[13]||(e[13]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 py-1 text-left text-xs font-medium text-gray-500 uppercase"},"Barang"),t("th",{class:"px-2 py-1 text-right text-xs font-medium text-gray-500 uppercase"},"Qty PO"),t("th",{class:"px-2 py-1 text-right text-xs font-medium text-gray-500 uppercase"},"Qty Diterima")]),t("tr",null,[t("th",{colspan:"3",class:"px-2 py-1 text-center text-xs text-blue-600 bg-blue-50"},[t("i",{class:"fa fa-info-circle mr-1"}),m(" Toleransi maksimal 10% dari Qty PO ")])])],-1)),t("tbody",null,[(l(!0),o(S,null,G(s,(i,d)=>(l(),o("tr",{key:i.id},[t("td",be,[m(r(i.item_name)+" ",1),t("span",ge,"("+r(i.unit_name)+")",1),t("button",{type:"button",class:"ml-1 px-2 py-1 rounded bg-yellow-100 text-yellow-800 text-xs font-semibold hover:bg-yellow-200 border border-yellow-300 flex items-center gap-1",onClick:M=>E(i),disabled:!i.item_id},e[12]||(e[12]=[t("i",{class:"fa fa-info-circle"},null,-1),m(" SPS ")]),8,he)]),t("td",_e,[m(r(i.quantity)+" ",1),t("div",we,"+10%: "+r((i.quantity*1.1).toFixed(2)),1)]),t("td",ke,[C(t("input",{"onUpdate:modelValue":M=>i.qty_received=M,type:"number",min:"0",max:i.quantity*1.1,step:"0.01",class:ee(["w-20 px-2 py-1 border rounded",{"border-red-500":i.qty_error}]),required:"",onInput:M=>I(i)},null,42,qe),[[Q,i.qty_received,void 0,{number:!0}]]),i.qty_error?(l(),o("div",Ce,r(i.qty_error),1)):y("",!0)])]))),128))])])]))),128)),t("div",Se,[t("button",{type:"button",onClick:F,class:"bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg"},"Batal"),t("button",{type:"submit",disabled:v.value,class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-2"},[v.value?(l(),o("svg",Ve,e[14]||(e[14]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):y("",!0),t("span",null,r(v.value?"Menyimpan...":"Simpan"),1)],8,Ge)])],32)])):(l(),o("div",oe,[t("div",le,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Scan QR Code atau Input Nomor PO",-1)),t("div",ie,[C(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),type:"text",placeholder:"Nomor PO",class:"flex-1 px-4 py-2 border border-gray-300 rounded-lg"},null,512),[[Q,g.value]]),t("button",{onClick:D,class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg"},"Cari"),t("button",{onClick:e[1]||(e[1]=s=>_.value=!0),class:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg",type:"button"},e[5]||(e[5]=[t("i",{class:"fa-solid fa-qrcode"},null,-1)]))]),_.value?(l(),o("div",ne,[w.value.length>1?(l(),o("div",re,[C(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>b.value=s),onChange:J,class:"border rounded px-2 py-1"},[(l(!0),o(S,null,G(w.value,s=>(l(),o("option",{key:s.id,value:s.id},r(s.label),9,de))),128))],544),[[X,b.value]])])):y("",!0),e[6]||(e[6]=t("div",{id:"qr-reader",style:{width:"100%"}},null,-1)),t("button",{onClick:R,class:"mt-2 bg-gray-300 hover:bg-gray-400 text-gray-700 px-3 py-1 rounded"},"Tutup Scanner")])):y("",!0),e[8]||(e[8]=t("div",{class:"text-xs text-gray-400"},"Jika kamera tersedia, bisa gunakan scanner QR code",-1))])])),f.value?(l(),o("div",Fe,r(f.value),1)):y("",!0),W(te,{show:k.value,onClose:H},{default:Z(()=>[t("div",Me,[t("div",{class:"flex justify-between items-center mb-2"},[e[16]||(e[16]=t("h2",{class:"text-lg font-bold text-gray-700"},"Detail Item",-1)),t("button",{onClick:H,class:"text-gray-400 hover:text-gray-700"},e[15]||(e[15]=[t("i",{class:"fa fa-times"},null,-1)]))]),V.value?(l(),o("div",Qe,e[17]||(e[17]=[t("i",{class:"fa fa-spinner fa-spin text-blue-400 text-2xl"},null,-1)]))):n.value&&!n.value.error?(l(),o("div",Be,[t("div",Ne,[e[18]||(e[18]=t("span",{class:"font-semibold"},"Nama:",-1)),m(" "+r(n.value.name),1)]),t("div",Oe,[e[19]||(e[19]=t("span",{class:"font-semibold"},"Deskripsi:",-1)),n.value.description?(l(),o("span",De,r(n.value.description),1)):(l(),o("span",Ie,"(Tidak ada deskripsi)"))]),t("div",Re,[e[20]||(e[20]=t("span",{class:"font-semibold"},"Spesifikasi:",-1)),n.value.specification?(l(),o("span",Te,r(n.value.specification),1)):(l(),o("span",Pe,"(Tidak ada spesifikasi)"))]),n.value.images&&n.value.images.length?(l(),o("div",He,[e[21]||(e[21]=t("span",{class:"font-semibold"},"Gambar:",-1)),t("div",$e,[(l(!0),o(S,null,G(n.value.images,s=>(l(),o("img",{key:s.id,src:s.path.startsWith("http")?s.path:"/storage/"+s.path,class:"w-24 h-24 object-contain border rounded bg-white"},null,8,Ue))),128))])])):y("",!0)])):n.value&&n.value.error?(l(),o("div",je,r(n.value.error),1)):y("",!0)])]),_:1},8,["show"])])]))}};export{We as default};
