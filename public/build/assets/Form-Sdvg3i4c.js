import{$ as te,r as I,P as oe,w as L,A as N,B as r,C as R,x as K,D as o,Q as i,U as se,Z as C,O as U,H as p,J as h,L as u,F as f,M as b,N as m,I as j,E as g,l as $,T as le,Y as ne,G as A,S as ie}from"./vendor-vue-g7iCcTkf.js";import{A as ae}from"./AppLayout-DFHlgV7Y.js";import{S as _}from"./app-BAhc_I4B.js";import{a as B}from"./vendor-utils-CpgP2uT4.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-Cwic3ZqH.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const ue={class:"py-12"},de={class:"max-w-3xl mx-auto sm:px-6 lg:px-8"},me={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},pe={class:"p-6 bg-white border-b border-gray-200"},ce={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},ge=["disabled"],_e=["value"],he=["disabled"],fe={value:""},be=["value"],ve={class:"mb-6"},ye={class:"mb-6"},we={key:0,class:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md"},xe={key:1,class:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md"},ke={class:"overflow-x-auto"},Ie={class:"min-w-full divide-y divide-gray-200"},Ce={class:"bg-white divide-y divide-gray-200"},Ae={class:"px-3 py-2 min-w-[200px]"},Se={class:"relative"},De=["id","onUpdate:modelValue","onInput","onFocus","onBlur","onKeydown","disabled","placeholder"],je=["id"],Be=["id","onMousedown"],Ve={class:"font-medium"},Ue={class:"text-xs text-gray-500"},$e={class:"text-sm text-gray-600"},Te={key:0,class:"absolute right-2 top-2"},Me={class:"px-3 py-2 min-w-[100px]"},qe=["onUpdate:modelValue"],Fe={class:"px-3 py-2 min-w-[100px]"},Oe=["onUpdate:modelValue","onChange"],Pe=["value"],Ee=["onUpdate:modelValue"],Le={class:"px-3 py-2 min-w-[120px]"},Ne=["onUpdate:modelValue"],Re={class:"px-3 py-2"},Ke=["onClick","disabled"],Ge=["disabled"],ze={class:"mb-6"},We={class:"mb-6"},He={class:"mb-4"},Qe={class:"relative"},Xe={key:0,class:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto"},Ye=["onClick"],Je={class:"font-medium"},Ze={class:"text-sm text-gray-600"},et={key:0,class:"text-xs text-blue-600 font-medium"},tt={key:0,class:"space-y-2"},ot={class:"flex items-center space-x-3"},st={class:"flex items-center space-x-2"},lt=["onClick"],nt=["onClick"],it={class:"flex items-center space-x-2"},at={class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},rt={class:"font-medium"},ut={class:"text-sm text-gray-600"},dt={key:0,class:"text-xs text-blue-600 font-medium"},mt=["onClick"],pt={class:"flex justify-end gap-3"},ct=["disabled"],gt={key:0,class:"flex items-center gap-2"},_t={key:1},ht={__name:"Form",props:{outlets:Array,items:Array,outlet_selectable:Boolean,user_outlet_id:[String,Number],warehouse_outlets:Array},setup(T){const V=te(),d=T;console.log("Props received:",{outlets:d.outlets,outlet_selectable:d.outlet_selectable,user_outlet_id:d.user_outlet_id,warehouse_outlets:d.warehouse_outlets});const x=I(d.warehouse_outlets||[]),t=oe({date:new Date().toISOString().split("T")[0],outlet_id:d.outlet_selectable?"":String(d.user_outlet_id),type:"",reason:"",items:[M()],warehouse_outlet_id:"",approvers:[]});console.log("Form initialized with outlet_id:",t.outlet_id),console.log("Page props auth user:",V.props.auth.user),console.log("Region ID from page props:",V.props.auth.user.region_id);function M(){return{item_id:"",item_name:"",qty:"",unit:"",selected_unit:"",available_units:[],note:"",suggestions:[],showDropdown:!1,highlightedIndex:-1,loading:!1}}const v=I(!1),y=I(""),k=I([]),S=I(!1),q=async(l="")=>{if(l.length<2){k.value=[],S.value=!1;return}try{const e=await B.get("/outlet-food-inventory-adjustment/approvers",{params:{search:l},headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}});e.data.success&&(k.value=e.data.users,S.value=!0)}catch(e){console.error("Failed to load approvers:",e),k.value=[]}},G=l=>{t.approvers.find(e=>e.id===l.id)||t.approvers.push(l),y.value="",S.value=!1},z=l=>{t.approvers.splice(l,1)},F=(l,e)=>{const s=t.approvers.splice(l,1)[0];t.approvers.splice(e,0,s)};L(()=>t.outlet_id,async l=>{l?await W(l):(x.value=[],t.warehouse_outlet_id="")});async function W(l){try{const e=await B.get("/api/outlet-food-inventory-adjustment/warehouse-outlets",{params:{outlet_id:l}});x.value=e.data,t.warehouse_outlet_id&&!x.value.find(s=>s.id==t.warehouse_outlet_id)&&(t.warehouse_outlet_id="")}catch(e){console.error("Error loading warehouse outlets:",e),x.value=[],t.warehouse_outlet_id=""}}function H(){t.items.push(M())}function Q(l){t.items.length!==1&&t.items.splice(l,1)}async function X(l,e){if(console.log("fetchItemSuggestions called",l,e),console.log("form.outlet_id:",t.outlet_id),console.log("form.warehouse_outlet_id:",t.warehouse_outlet_id),!e||e.length<2){console.log("Query too short, returning"),t.items[l].suggestions=[],t.items[l].highlightedIndex=-1;return}if(!t.outlet_id){console.log("No outlet_id selected, returning"),t.items[l].suggestions=[],t.items[l].highlightedIndex=-1;return}if(!t.warehouse_outlet_id){console.log("No warehouse_outlet_id selected, returning"),t.items[l].suggestions=[],t.items[l].highlightedIndex=-1;return}t.items[l].loading=!0;try{const a=(await B.get(`/api/outlets/${t.outlet_id}`)).data.region_id;console.log("Region ID from outlet:",a);const n={q:e,outlet_id:t.outlet_id,region_id:a};console.log("Making API request with params:",n);const w=await B.get("/items/search-for-outlet-stock-adjustment",{params:n});console.log("API result:",w.data);let E=Array.isArray(w.data)?w.data:[];t.items[l].suggestions=E.map(c=>({...c,available_units:[c.unit_small,c.unit_medium,c.unit_large].filter(Boolean),unit_small:c.unit_small,unit_medium:c.unit_medium,unit_large:c.unit_large,small_unit_id:c.small_unit_id,medium_unit_id:c.medium_unit_id,large_unit_id:c.large_unit_id})),t.items[l].showDropdown=!0,t.items[l].highlightedIndex=0,console.log("Suggestions:",t.items[l].suggestions),console.log("showDropdown:",t.items[l].showDropdown)}catch(s){console.error("API error:",s),t.items[l].suggestions=[],t.items[l].highlightedIndex=-1}finally{t.items[l].loading=!1}}function O(l,e){t.items[l].item_id=e.id,t.items[l].item_name=e.name,t.items[l].unit=e.unit_small||e.unit||"",t.items[l].selected_unit=e.unit_small||e.unit||"",t.items[l].available_units=[e.unit_small,e.unit_medium,e.unit_large].filter(Boolean),t.items[l].suggestions=[],t.items[l].showDropdown=!1,t.items[l].highlightedIndex=-1}function P(l,e){const s=e.target.value;t.items[l].item_id="",t.items[l].item_name=s,t.items[l].showDropdown=!0,X(l,s)}function Y(l){setTimeout(()=>{t.items[l].showDropdown=!1},200)}function D(l,e){const s=t.items[l];!s.showDropdown||!s.suggestions.length||(e.key==="ArrowDown"?(e.preventDefault(),s.highlightedIndex=(s.highlightedIndex+1)%s.suggestions.length):e.key==="ArrowUp"?(e.preventDefault(),s.highlightedIndex=(s.highlightedIndex-1+s.suggestions.length)%s.suggestions.length):e.key==="Enter"?(e.preventDefault(),s.highlightedIndex>=0&&s.suggestions[s.highlightedIndex]&&O(l,s.suggestions[s.highlightedIndex])):e.key==="Escape"&&(s.showDropdown=!1))}function J(l,e){t.items[l].unit=e.target.value}function Z(l){const e=document.getElementById(`item-input-${l}`);if(!e)return{};const s=e.getBoundingClientRect();return{position:"fixed",left:`${s.left}px`,top:`${s.bottom}px`,width:`${s.width}px`,zIndex:99999}}function ee(){if(!v.value){if(!t.date||!t.outlet_id||!t.warehouse_outlet_id||!t.type||!t.reason){_.fire({icon:"error",title:"Validasi Gagal",text:"Semua field wajib diisi."});return}if(!t.items.length||t.items.some(l=>!l.item_id||!l.qty||!l.selected_unit)){_.fire({icon:"error",title:"Validasi Gagal",text:"Setiap item wajib dipilih, qty dan unit diisi."});return}if(!t.approvers||t.approvers.length===0){_.fire({icon:"error",title:"Validasi Gagal",text:"Approver wajib diisi minimal 1 orang."});return}_.fire({title:"Konfirmasi Simpan",text:"Apakah Anda yakin ingin menyimpan outlet stock adjustment ini?",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, simpan!",cancelButtonText:"Batal",showLoaderOnConfirm:!0,preConfirm:()=>{v.value=!0;const l={...t.data(),approvers:t.approvers.map(e=>e.id)};return t.transform(()=>l).post(route("outlet-food-inventory-adjustment.store"),{onSuccess:e=>{var s;if((s=e.props.flash)!=null&&s.error){_.fire({icon:"error",title:"Gagal Menyimpan Data",html:e.props.flash.error,confirmButtonText:"OK",confirmButtonColor:"#EF4444",width:"600px"}),v.value=!1;return}_.fire("Berhasil","Outlet stock adjustment berhasil disimpan!","success")},onError:e=>{let s="Gagal menyimpan data.";if(e.error)s=e.error;else if(typeof e=="string")s=e;else if(typeof e=="object"){const a=[];for(const n in e)Array.isArray(e[n])?a.push(...e[n]):a.push(e[n]);a.length>0&&(s=a.join("<br>"))}_.fire({icon:"error",title:"Gagal Menyimpan Data",html:s,confirmButtonText:"OK",confirmButtonColor:"#EF4444",width:"600px"})},onFinish:()=>{v.value=!1}})},allowOutsideClick:()=>!_.isLoading()})}}return L(()=>V.props.flash,l=>{l!=null&&l.error&&_.fire({icon:"error",title:"Gagal Menyimpan Data",html:l.error,confirmButtonText:"OK",confirmButtonColor:"#EF4444",width:"600px"})},{immediate:!0}),(l,e)=>(r(),N(ae,null,{default:R(()=>[K(i(se),{title:"Tambah Outlet Stock Adjustment"}),o("div",ue,[o("div",de,[o("div",me,[o("div",pe,[o("form",{onSubmit:U(ee,["prevent"]),onKeydown:e[8]||(e[8]=C(U(()=>{},["prevent"]),["enter"]))},[o("div",ce,[o("div",null,[e[9]||(e[9]=o("label",{class:"block text-sm font-medium text-gray-700"},"Tanggal",-1)),p(o("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=s=>i(t).date=s),class:"mt-1 block w-full rounded-md border-gray-300",required:""},null,512),[[h,i(t).date]])]),o("div",null,[e[10]||(e[10]=o("label",{class:"block text-sm font-medium text-gray-700"},"Outlet",-1)),p(o("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>i(t).outlet_id=s),class:"mt-1 block w-full rounded-md border-gray-300",required:"",disabled:!d.outlet_selectable},[(r(!0),u(f,null,b(T.outlets,s=>(r(),u("option",{key:s.id,value:s.id},m(s.name),9,_e))),128))],8,ge),[[j,i(t).outlet_id]])]),o("div",null,[e[11]||(e[11]=o("label",{class:"block text-sm font-medium text-gray-700"},"Warehouse Outlet",-1)),p(o("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>i(t).warehouse_outlet_id=s),class:"mt-1 block w-full rounded-md border-gray-300",required:"",disabled:!i(t).outlet_id},[o("option",fe,m(i(t).outlet_id?"Pilih Warehouse Outlet":"Pilih outlet terlebih dahulu"),1),(r(!0),u(f,null,b(x.value,s=>(r(),u("option",{key:s.id,value:s.id},m(s.name),9,be))),128))],8,he),[[j,i(t).warehouse_outlet_id]])])]),o("div",ve,[e[13]||(e[13]=o("label",{class:"block text-sm font-medium text-gray-700"},"Tipe Adjustment",-1)),p(o("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>i(t).type=s),class:"mt-1 block w-full rounded-md border-gray-300",required:""},e[12]||(e[12]=[o("option",{value:""},"Pilih Tipe",-1),o("option",{value:"in"},"Stock In",-1),o("option",{value:"out"},"Stock Out",-1)]),512),[[j,i(t).type]])]),o("div",ye,[e[20]||(e[20]=o("div",{class:"flex justify-between items-center mb-2"},[o("label",{class:"block text-sm font-medium text-gray-700"},"Items")],-1)),!i(t).outlet_id&&d.outlet_selectable?(r(),u("div",we,e[14]||(e[14]=[o("div",{class:"flex items-center"},[o("i",{class:"fa fa-exclamation-triangle text-yellow-600 mr-2"}),o("span",{class:"text-sm text-yellow-800"},"Pilih outlet terlebih dahulu sebelum menambahkan item")],-1)]))):g("",!0),i(t).outlet_id&&!i(t).warehouse_outlet_id?(r(),u("div",xe,e[15]||(e[15]=[o("div",{class:"flex items-center"},[o("i",{class:"fa fa-exclamation-triangle text-yellow-600 mr-2"}),o("span",{class:"text-sm text-yellow-800"},"Pilih warehouse outlet terlebih dahulu sebelum menambahkan item")],-1)]))):g("",!0),o("div",ke,[o("table",Ie,[e[18]||(e[18]=o("thead",{class:"bg-gray-50"},[o("tr",null,[o("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Item"),o("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Qty"),o("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Unit"),o("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Note"),o("th",{class:"px-3 py-2"})])],-1)),o("tbody",Ce,[(r(!0),u(f,null,b(i(t).items,(s,a)=>(r(),u("tr",{key:a},[o("td",Ae,[o("div",Se,[p(o("input",{id:`item-input-${a}`,type:"text","onUpdate:modelValue":n=>s.item_name=n,onInput:n=>P(a,n),onFocus:n=>P(a,n),onBlur:n=>Y(a),onKeydown:[C(n=>D(a,n),["down"]),C(n=>D(a,n),["up"]),C(n=>D(a,n),["enter"]),C(n=>D(a,n),["esc"])],class:$(["w-full rounded border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",!i(t).outlet_id&&d.outlet_selectable||i(t).outlet_id&&!i(t).warehouse_outlet_id?"bg-gray-100 cursor-not-allowed":""]),disabled:!i(t).outlet_id&&d.outlet_selectable||i(t).outlet_id&&!i(t).warehouse_outlet_id,required:"",autocomplete:"off",placeholder:!i(t).outlet_id&&d.outlet_selectable?"Pilih outlet terlebih dahulu":i(t).outlet_id&&!i(t).warehouse_outlet_id?"Pilih warehouse outlet terlebih dahulu":"Cari nama item..."},null,42,De),[[h,s.item_name]]),(r(),N(le,{to:"body"},[s.showDropdown&&s.suggestions&&s.suggestions.length>0?(r(),u("div",{key:0,style:ne(Z(a)),id:`autocomplete-dropdown-${a}`,class:"fixed z-[99999] bg-white border border-blue-200 rounded shadow max-w-xs w-[260px] max-h-96 overflow-auto mt-1"},[(r(!0),u(f,null,b(s.suggestions,(n,w)=>(r(),u("div",{key:n.id,id:`autocomplete-item-${a}-${w}`,onMousedown:U(E=>O(a,n),["prevent"]),class:$(["px-3 py-2 flex justify-between items-center cursor-pointer",s.highlightedIndex===w?"bg-blue-100":"hover:bg-blue-50"])},[o("div",null,[o("div",Ve,m(n.name),1),o("div",Ue,m(n.sku),1)]),o("div",$e,m(n.unit_small||n.unit||""),1)],42,Be))),128))],12,je)):g("",!0)])),s.loading?(r(),u("div",Te,e[16]||(e[16]=[o("i",{class:"fa fa-spinner fa-spin text-blue-400"},null,-1)]))):g("",!0)])]),o("td",Me,[p(o("input",{type:"number",min:"0.01",step:"0.01","onUpdate:modelValue":n=>s.qty=n,class:"w-full rounded border-gray-300",required:""},null,8,qe),[[h,s.qty]])]),o("td",Fe,[s.available_units&&s.available_units.length?p((r(),u("select",{key:0,"onUpdate:modelValue":n=>s.selected_unit=n,onChange:n=>J(a,n),class:"w-full rounded border-gray-300"},[(r(!0),u(f,null,b(s.available_units,n=>(r(),u("option",{key:n,value:n},m(n),9,Pe))),128))],40,Oe)),[[j,s.selected_unit]]):p((r(),u("input",{key:1,type:"text","onUpdate:modelValue":n=>s.unit=n,class:"w-full rounded border-gray-300",required:""},null,8,Ee)),[[h,s.unit]])]),o("td",Le,[p(o("input",{type:"text","onUpdate:modelValue":n=>s.note=n,class:"w-full rounded border-gray-300"},null,8,Ne),[[h,s.note]])]),o("td",Re,[o("button",{type:"button",onClick:n=>Q(a),class:"text-red-500 hover:text-red-700",disabled:i(t).items.length===1},e[17]||(e[17]=[o("i",{class:"fa fa-trash"},null,-1)]),8,Ke)])]))),128))])])]),o("button",{type:"button",onClick:H,class:$(["mt-3 px-4 py-2 rounded font-semibold",!i(t).outlet_id&&d.outlet_selectable||i(t).outlet_id&&!i(t).warehouse_outlet_id?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-100 text-blue-700 hover:bg-blue-200"]),disabled:!i(t).outlet_id&&d.outlet_selectable||i(t).outlet_id&&!i(t).warehouse_outlet_id},e[19]||(e[19]=[o("i",{class:"fa fa-plus"},null,-1),A(" Tambah Item ")]),10,Ge)]),o("div",ze,[e[21]||(e[21]=o("label",{class:"block text-sm font-medium text-gray-700"},"Alasan / Catatan",-1)),p(o("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=s=>i(t).reason=s),class:"mt-1 block w-full rounded-md border-gray-300",required:""},null,512),[[h,i(t).reason]])]),o("div",We,[e[26]||(e[26]=o("h3",{class:"text-lg font-medium text-gray-900 mb-4"},[A("Approval Flow "),o("span",{class:"text-red-500"},"*")],-1)),e[27]||(e[27]=o("div",{class:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4"},[o("div",{class:"flex"},[o("div",{class:"flex-shrink-0"},[o("i",{class:"fa fa-info-circle text-yellow-400"})]),o("div",{class:"ml-3"},[o("p",{class:"text-sm text-yellow-700"},[o("strong",null,"Catatan:"),A(" Tambahkan Nama Regional dan Cost Control Manager sebagai approver. ")])])])],-1)),e[28]||(e[28]=o("p",{class:"text-sm text-gray-600 mb-4"},"Tambahkan approvers minimal 1 orang. Urutan approval dari bawah ke atas (Level 1 = terendah, Level terakhir = tertinggi).",-1)),o("div",He,[o("div",Qe,[p(o("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>y.value=s),type:"text",placeholder:"Search users by name, email, or jabatan...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",onInput:e[6]||(e[6]=s=>q(y.value)),onFocus:e[7]||(e[7]=s=>y.value.length>=2&&q(y.value))},null,544),[[h,y.value]]),S.value&&k.value.length>0?(r(),u("div",Xe,[(r(!0),u(f,null,b(k.value,s=>(r(),u("div",{key:s.id,onClick:a=>G(s),class:"px-3 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-200 last:border-b-0"},[o("div",Je,m(s.name),1),o("div",Ze,m(s.email),1),s.jabatan?(r(),u("div",et,m(s.jabatan),1)):g("",!0)],8,Ye))),128))])):g("",!0)])]),i(t).approvers.length>0?(r(),u("div",tt,[e[25]||(e[25]=o("h4",{class:"font-medium text-gray-700"},"Approval Order (Lowest to Highest):",-1)),(r(!0),u(f,null,b(i(t).approvers,(s,a)=>(r(),u("div",{key:s.id,class:"flex items-center justify-between p-3 rounded-md bg-gray-50 border border-gray-200"},[o("div",ot,[o("div",st,[a>0?(r(),u("button",{key:0,onClick:n=>F(a,a-1),class:"p-1 text-gray-500 hover:text-gray-700",title:"Move Up"},e[22]||(e[22]=[o("i",{class:"fa fa-arrow-up"},null,-1)]),8,lt)):g("",!0),a<i(t).approvers.length-1?(r(),u("button",{key:1,onClick:n=>F(a,a+1),class:"p-1 text-gray-500 hover:text-gray-700",title:"Move Down"},e[23]||(e[23]=[o("i",{class:"fa fa-arrow-down"},null,-1)]),8,nt)):g("",!0)]),o("div",it,[o("span",at," Level "+m(a+1),1),o("div",null,[o("div",rt,m(s.name),1),o("div",ut,m(s.email),1),s.jabatan?(r(),u("div",dt,m(s.jabatan),1)):g("",!0)])])]),o("button",{onClick:n=>z(a),class:"p-1 text-red-500 hover:text-red-700",title:"Remove Approver"},e[24]||(e[24]=[o("i",{class:"fa fa-times"},null,-1)]),8,mt)]))),128))])):g("",!0)]),o("div",pt,[K(i(ie),{href:l.route("outlet-food-inventory-adjustment.index"),class:"px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 font-semibold"},{default:R(()=>e[29]||(e[29]=[A(" Cancel ")])),_:1},8,["href"]),o("button",{type:"submit",class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 font-semibold",disabled:v.value},[v.value?(r(),u("span",gt,e[30]||(e[30]=[o("div",{class:"loader"},null,-1),A(" Saving... ")]))):(r(),u("span",_t,"Save"))],8,ct)])],32)])])])])]),_:1}))}},St=re(ht,[["__scopeId","data-v-ee288d8c"]]);export{St as default};
