import{r as i,c as p,w as z,A as Q,B as r,C as ie,D as e,H as g,E as x,G,l as P,J as V,L as s,F as N,M as T,N as l,I as $,X,W as ue}from"./vendor-vue-g7iCcTkf.js";import{A as be}from"./AppLayout-D6FAfGlz.js";import{a as pe}from"./vendor-utils-CpgP2uT4.js";import me from"./OrderDetailModal-BHITCRZf.js";import"./app-dzBjFUgD.js";import"./vendor-charts-CuqD4wLC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-CUUHZNnG.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const ye={class:"max-w-7xl mx-auto py-8 px-4"},ge={class:"flex border-b border-gray-200 mb-6"},xe={class:"flex flex-wrap items-end gap-4 mb-6"},ce=["value"],ve={class:"flex-1 min-w-[180px]"},fe=["placeholder"],he={class:"flex items-center gap-2"},ke=["value"],_e=["value"],De=["disabled"],Ge={key:0,class:"animate-spin mr-2"},Pe={key:1,class:"mr-2"},Ne=["href"],Te=["href"],we={class:"mb-8"},Ce={class:"bg-white rounded-xl shadow overflow-x-auto"},Oe={class:"min-w-full border border-gray-300"},Me={key:0},Ee={class:"px-4 py-2 border border-gray-200"},Re={class:"px-4 py-2 border border-gray-200"},Se={class:"px-4 py-2 border border-gray-200"},Ue={class:"px-4 py-2 border border-gray-200 text-right"},Ve={class:"px-4 py-2 border border-gray-200 text-center"},$e={class:"px-4 py-2 border border-gray-200 text-right"},Be={key:0},Le={class:"bg-gray-100 font-semibold"},je={class:"px-4 py-3 text-center"},Ae={class:"px-4 py-3 text-right"},Ie={class:"bg-white rounded-xl shadow overflow-x-auto"},Fe={class:"min-w-full border border-gray-300"},He={key:0},Je={class:"px-4 py-2 border border-gray-200"},Ke={class:"px-4 py-2 border border-gray-200"},We=["onClick"],ze={class:"px-4 py-2 border border-gray-200"},Qe={class:"px-4 py-2 border border-gray-200"},Xe={class:"px-4 py-2 border border-gray-200"},qe={class:"font-medium"},Ye={key:0,class:"text-gray-500 text-sm"},Ze={class:"px-4 py-2 border border-gray-200 text-right"},et={class:"px-4 py-2 border border-gray-200 text-right"},tt={key:0,class:"flex justify-between items-center mt-4"},at={class:"text-sm text-gray-600"},lt={class:"flex gap-1"},ot=["disabled"],rt={class:"px-2"},st=["disabled"],dt={class:"mb-6 p-4 bg-violet-50 rounded-xl border border-violet-200"},nt={class:"flex flex-wrap gap-6 text-sm"},it={class:"font-bold text-violet-900 ml-2"},ut={class:"font-bold text-violet-900 ml-2"},bt={class:"bg-white rounded-xl shadow overflow-x-auto"},pt={class:"min-w-full border border-gray-300"},mt={key:0},yt={class:"px-4 py-2 border border-gray-200"},gt={class:"px-4 py-2 border border-gray-200"},xt=["onClick"],ct={class:"px-4 py-2 border border-gray-200"},vt={class:"px-4 py-2 border border-gray-200"},ft={class:"px-4 py-2 border border-gray-200 text-right"},ht={class:"px-4 py-2 border border-gray-200 text-right font-medium text-violet-700"},kt={class:"px-4 py-2 border border-gray-200"},_t={key:0,class:"flex justify-between items-center mt-4"},Dt={class:"text-sm text-gray-600"},Gt={class:"flex gap-1"},Pt=["disabled"],Nt={class:"px-2"},Tt=["disabled"],Lt={__name:"ReportRekapDiskon",props:{detail:Array,summary:Array,detailGlobal:Array,summaryGlobal:Object,outlets:Array,filters:Object,total:Number,totalGlobal:Number,perPage:Number,page:Number,perPageGlobal:Number,pageGlobal:Number},setup(n){var F,H,J,K;const d=n,m=i("promo"),w=i(!1),C=i(null),B=i(!1),q=p(()=>(d.outlets||[]).map(t=>typeof t=="object"&&t!==null&&"value"in t?{value:t.value,label:t.label??t.value}:{value:t,label:t})),c=i(((F=d.filters)==null?void 0:F.date_from)||""),v=i(((H=d.filters)==null?void 0:H.date_to)||""),f=i(((J=d.filters)==null?void 0:J.kode_outlet)||""),h=i(((K=d.filters)==null?void 0:K.search)||""),_=i(d.perPage??25),u=i(d.page??1),D=i(d.perPageGlobal??25),b=i(d.pageGlobal??1),E=i(!1),L=p(()=>(u.value-1)*_.value),Y=p(()=>{var o;return Math.min(L.value+(((o=d.detail)==null?void 0:o.length)??0),d.total??0)}),R=p(()=>Math.ceil((d.total??0)/_.value)||1),j=p(()=>(b.value-1)*D.value),Z=p(()=>{var o;return Math.min(j.value+(((o=d.detailGlobal)==null?void 0:o.length)??0),d.totalGlobal??0)}),S=p(()=>Math.ceil((d.totalGlobal??0)/D.value)||1),ee=p(()=>(d.summary??[]).reduce((o,t)=>o+(Number(t.jumlah_pemakaian)||0),0)),te=p(()=>(d.summary??[]).reduce((o,t)=>o+(Number(t.total_discount)||0),0)),U=p(()=>{const o={};return c.value&&(o.date_from=c.value),v.value&&(o.date_to=v.value),f.value&&(o.kode_outlet=f.value),h.value&&(o.search=h.value),new URLSearchParams(o).toString()}),ae=p(()=>{const o=route("report.rekap-diskon.export-promo");return U.value?`${o}?${U.value}`:o}),le=p(()=>{const o=route("report.rekap-diskon.export-global");return U.value?`${o}?${U.value}`:o});function oe(){u.value>1&&(u.value--,O())}function re(){u.value<R.value&&(u.value++,O())}function se(){b.value>1&&(b.value--,O())}function de(){b.value<S.value&&(b.value++,O())}z([c,v,f,h,_],()=>{u.value=1}),z([c,v,f,h,D],()=>{b.value=1});function O(){E.value=!0,ue.get("/report-rekap-diskon",{date_from:c.value,date_to:v.value,kode_outlet:f.value,search:h.value,perPage:_.value,page:u.value,perPageGlobal:D.value,pageGlobal:b.value},{preserveState:!0,preserveScroll:!0,onFinish:()=>E.value=!1})}async function A(o){var t,M;if(o){B.value=!0,C.value=null,w.value=!1;try{const{data:y}=await pe.get(`/api/report-rekap-diskon/order/${encodeURIComponent(o)}`);C.value=y,w.value=!0}catch(y){C.value={nomor:o,items:[],error:((M=(t=y==null?void 0:y.response)==null?void 0:t.data)==null?void 0:M.error)||"Gagal memuat detail order."},w.value=!0}finally{B.value=!1}}}function k(o){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(o||0)}function I(o){if(!o)return"-";const t=new Date(o);return isNaN(t.getTime())?o:t.toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}return(o,t)=>(r(),Q(be,null,{default:ie(()=>{var M,y,W;return[e("div",ye,[t[36]||(t[36]=e("h1",{class:"text-2xl font-bold mb-4 flex items-center gap-2"},[e("i",{class:"fas fa-tags text-blue-600"}),G(" Rekap Diskon ")],-1)),e("div",ge,[e("button",{type:"button",onClick:t[0]||(t[0]=a=>m.value="promo"),class:P(["px-4 py-2.5 text-sm font-medium border-b-2 transition",m.value==="promo"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"])},t[9]||(t[9]=[e("i",{class:"fas fa-tag mr-1.5"},null,-1),G(" Diskon Promo ")]),2),e("button",{type:"button",onClick:t[1]||(t[1]=a=>m.value="global"),class:P(["px-4 py-2.5 text-sm font-medium border-b-2 transition",m.value==="global"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"])},t[10]||(t[10]=[e("i",{class:"fas fa-university mr-1.5"},null,-1),G(" Diskon Bank & Lainnya ")]),2)]),e("div",xe,[e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium mb-1"},"Tanggal Dari",-1)),g(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>c.value=a),type:"date",class:"rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 px-3 py-2"},null,512),[[V,c.value]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium mb-1"},"Tanggal Sampai",-1)),g(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>v.value=a),type:"date",class:"rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 px-3 py-2"},null,512),[[V,v.value]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium mb-1"},"Outlet",-1)),g(e("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>f.value=a),class:"rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 px-3 py-2 min-w-[180px]"},[t[13]||(t[13]=e("option",{value:""},"Semua Outlet",-1)),(r(!0),s(N,null,T(q.value,a=>(r(),s("option",{key:a.value,value:a.value},l(a.label),9,ce))),128))],512),[[$,f.value]])]),e("div",ve,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium mb-1"},"Cari",-1)),g(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>h.value=a),type:"text",placeholder:m.value==="promo"?"No order, paid number, nama/kode promo...":"No order, paid number, alasan diskon...",class:"w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 px-3 py-2"},null,8,fe),[[V,h.value]])]),e("div",he,[t[16]||(t[16]=e("label",{class:"text-sm"},"Tampilkan",-1)),m.value==="promo"?g((r(),s("select",{key:0,"onUpdate:modelValue":t[6]||(t[6]=a=>_.value=a),class:"rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 px-2 py-2"},[(r(),s(N,null,T([10,25,50,100],a=>e("option",{key:a,value:a},l(a),9,ke)),64))],512)),[[$,_.value]]):g((r(),s("select",{key:1,"onUpdate:modelValue":t[7]||(t[7]=a=>D.value=a),class:"rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 px-2 py-2"},[(r(),s(N,null,T([10,25,50,100],a=>e("option",{key:"g"+a,value:a},l(a),9,_e)),64))],512)),[[$,D.value]]),t[17]||(t[17]=e("span",{class:"text-sm"},"data",-1))]),e("button",{onClick:O,disabled:E.value,class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 disabled:opacity-50"},[E.value?(r(),s("span",Ge,t[18]||(t[18]=[e("i",{class:"fas fa-spinner"},null,-1)]))):(r(),s("span",Pe,t[19]||(t[19]=[e("i",{class:"fas fa-sync-alt"},null,-1)]))),t[20]||(t[20]=G(" Muat Data "))],8,De),e("a",{href:ae.value,class:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700",title:"Export data Diskon Promo ke Excel"},t[21]||(t[21]=[e("i",{class:"fas fa-file-excel mr-2"},null,-1),G(" Export Excel (Promo) ")]),8,Ne),e("a",{href:le.value,class:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700",title:"Export data Diskon Bank & Lainnya ke Excel"},t[22]||(t[22]=[e("i",{class:"fas fa-file-excel mr-2"},null,-1),G(" Export Excel (Bank & Lainnya) ")]),8,Te)]),g(e("div",null,[e("div",we,[t[26]||(t[26]=e("h2",{class:"text-lg font-semibold mb-3 text-gray-800"},"Rekap per Promo",-1)),e("div",Ce,[e("table",Oe,[t[25]||(t[25]=e("thead",null,[e("tr",{class:"bg-blue-600 text-white"},[e("th",{class:"px-4 py-2 border border-gray-300 text-left"},"Nama Promo"),e("th",{class:"px-4 py-2 border border-gray-300 text-left"},"Kode"),e("th",{class:"px-4 py-2 border border-gray-300 text-left"},"Tipe"),e("th",{class:"px-4 py-2 border border-gray-300 text-right"},"Value"),e("th",{class:"px-4 py-2 border border-gray-300 text-center"},"Jumlah Pemakaian"),e("th",{class:"px-4 py-2 border border-gray-300 text-right"},"Total Diskon (alokasi)")])],-1)),e("tbody",null,[n.summary.length?x("",!0):(r(),s("tr",Me,t[23]||(t[23]=[e("td",{colspan:"6",class:"text-center py-6 text-gray-400"},"Tidak ada data.",-1)]))),(r(!0),s(N,null,T(n.summary,a=>(r(),s("tr",{key:a.promo_id,class:"hover:bg-gray-50"},[e("td",Ee,l(a.promo_name),1),e("td",Re,l(a.promo_code),1),e("td",Se,l(a.promo_type||"-"),1),e("td",Ue,l(a.promo_value!=null?a.promo_value:"-"),1),e("td",Ve,l(a.jumlah_pemakaian),1),e("td",$e,l(k(a.total_discount)),1)]))),128))]),n.summary.length?(r(),s("tfoot",Be,[e("tr",Le,[t[24]||(t[24]=e("td",{colspan:"4",class:"px-4 py-3 text-right"},"Total",-1)),e("td",je,l(ee.value),1),e("td",Ae,l(k(te.value)),1)])])):x("",!0)])]),t[27]||(t[27]=e("p",{class:"text-xs text-gray-500 mt-1"},"Total diskon per promo dialokasikan proporsional jika satu order memakai lebih dari satu promo.",-1))]),e("div",null,[t[30]||(t[30]=e("h2",{class:"text-lg font-semibold mb-3 text-gray-800"},"Detail Transaksi (order_promos status=active)",-1)),e("div",Ie,[e("table",Fe,[t[29]||(t[29]=e("thead",null,[e("tr",{class:"bg-yellow-300 text-gray-900"},[e("th",{class:"px-4 py-2 border border-gray-300"},"Tanggal"),e("th",{class:"px-4 py-2 border border-gray-300"},"No. Order"),e("th",{class:"px-4 py-2 border border-gray-300"},"Paid Number"),e("th",{class:"px-4 py-2 border border-gray-300"},"Nama Outlet"),e("th",{class:"px-4 py-2 border border-gray-300"},"Promo"),e("th",{class:"px-4 py-2 border border-gray-300 text-right"},"Discount Order"),e("th",{class:"px-4 py-2 border border-gray-300 text-right"},"Grand Total")])],-1)),e("tbody",null,[n.detail.length?x("",!0):(r(),s("tr",He,t[28]||(t[28]=[e("td",{colspan:"7",class:"text-center py-10 text-gray-400"},"Tidak ada data.",-1)]))),(r(!0),s(N,null,T(n.detail,a=>(r(),s("tr",{key:a.order_promo_id,class:"hover:bg-gray-50"},[e("td",Je,l(I(a.order_created_at)),1),e("td",Ke,[e("button",{type:"button",onClick:ne=>A(a.order_id),class:"text-blue-600 hover:text-blue-800 underline font-medium text-left"},l(a.order_nomor),9,We)]),e("td",ze,l(a.paid_number||"-"),1),e("td",Qe,l(a.outlet_name||"-"),1),e("td",Xe,[e("span",qe,l(a.promo_name),1),a.promo_code?(r(),s("span",Ye," ("+l(a.promo_code)+")",1)):x("",!0)]),e("td",Ze,l(k(a.order_discount)),1),e("td",et,l(k(a.order_grand_total)),1)]))),128))])])]),n.total>0?(r(),s("div",tt,[e("div",at," Menampilkan "+l(L.value+1)+" - "+l(Y.value)+" dari "+l(n.total)+" data ",1),e("div",lt,[e("button",{onClick:oe,disabled:u.value===1,class:P(["px-3 py-1 rounded border text-sm disabled:opacity-50",u.value===1?"bg-gray-200 text-gray-400":"bg-white text-blue-700 hover:bg-blue-50"])}," < ",10,ot),e("span",rt,"Halaman "+l(u.value)+" / "+l(R.value),1),e("button",{onClick:re,disabled:u.value===R.value,class:P(["px-3 py-1 rounded border text-sm disabled:opacity-50",u.value===R.value?"bg-gray-200 text-gray-400":"bg-white text-blue-700 hover:bg-blue-50"])}," > ",10,st)])])):x("",!0)])],512),[[X,m.value==="promo"]]),g(e("div",null,[e("div",dt,[t[33]||(t[33]=e("h2",{class:"text-lg font-semibold text-violet-900 mb-2"},"Rekap Diskon Global (Bank & Lainnya)",-1)),e("div",nt,[e("div",null,[t[31]||(t[31]=e("span",{class:"text-violet-600"},"Total Transaksi",-1)),e("span",it,l(((M=n.summaryGlobal)==null?void 0:M.total_transaksi)??0),1)]),e("div",null,[t[32]||(t[32]=e("span",{class:"text-violet-600"},"Total Nominal Diskon",-1)),e("span",ut,l(k((y=n.summaryGlobal)==null?void 0:y.total_nominal)),1)])])]),e("div",bt,[e("table",pt,[t[35]||(t[35]=e("thead",null,[e("tr",{class:"bg-violet-600 text-white"},[e("th",{class:"px-4 py-2 border border-gray-300"},"Tanggal"),e("th",{class:"px-4 py-2 border border-gray-300"},"No. Order"),e("th",{class:"px-4 py-2 border border-gray-300"},"Paid Number"),e("th",{class:"px-4 py-2 border border-gray-300"},"Nama Outlet"),e("th",{class:"px-4 py-2 border border-gray-300 text-right"},"Grand Total"),e("th",{class:"px-4 py-2 border border-gray-300 text-right"},"Nominal Diskon"),e("th",{class:"px-4 py-2 border border-gray-300"},"Alasan / Keterangan")])],-1)),e("tbody",null,[(W=n.detailGlobal)!=null&&W.length?x("",!0):(r(),s("tr",mt,t[34]||(t[34]=[e("td",{colspan:"7",class:"text-center py-10 text-gray-400"},"Tidak ada data.",-1)]))),(r(!0),s(N,null,T(n.detailGlobal,a=>(r(),s("tr",{key:a.id,class:"hover:bg-gray-50"},[e("td",yt,l(I(a.created_at)),1),e("td",gt,[e("button",{type:"button",onClick:ne=>A(a.id),class:"text-blue-600 hover:text-blue-800 underline font-medium text-left"},l(a.nomor),9,xt)]),e("td",ct,l(a.paid_number||"-"),1),e("td",vt,l(a.outlet_name||"-"),1),e("td",ft,l(k(a.grand_total)),1),e("td",ht,l(k(a.manual_discount_amount)),1),e("td",kt,l(a.manual_discount_reason||"-"),1)]))),128))])])]),n.totalGlobal>0?(r(),s("div",_t,[e("div",Dt," Menampilkan "+l(j.value+1)+" - "+l(Z.value)+" dari "+l(n.totalGlobal)+" data ",1),e("div",Gt,[e("button",{onClick:se,disabled:b.value===1,class:P(["px-3 py-1 rounded border text-sm disabled:opacity-50",b.value===1?"bg-gray-200 text-gray-400":"bg-white text-blue-700 hover:bg-blue-50"])}," < ",10,Pt),e("span",Nt,"Halaman "+l(b.value)+" / "+l(S.value),1),e("button",{onClick:de,disabled:b.value===S.value,class:P(["px-3 py-1 rounded border text-sm disabled:opacity-50",b.value===S.value?"bg-gray-200 text-gray-400":"bg-white text-blue-700 hover:bg-blue-50"])}," > ",10,Tt)])])):x("",!0)],512),[[X,m.value==="global"]]),w.value&&C.value?(r(),Q(me,{key:0,order:C.value,onClose:t[8]||(t[8]=a=>w.value=!1)},null,8,["order"])):x("",!0)])]}),_:1}))}};export{Lt as default};
