import{P as fe,r as h,c as N,w as ge,A as ve,B as r,C as be,x as K,D as t,L as u,E as v,Q as b,U as ye,Z as W,O as V,H as g,F as k,M as q,N as d,I as H,J as y,G as C,l as he,V as xe}from"./vendor-vue-g7iCcTkf.js";import{A as we}from"./AppLayout-DS2U8tWW.js";import{a as G}from"./vendor-utils-CpgP2uT4.js";import{S as E}from"./app-Vi2dpKR6.js";import{s as ke}from"./vue-multiselect.esm-V-bx43V9.js";/* empty css                            */import{_ as qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-Do674Z4r.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const Ce={class:"py-12"},Ue={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Se={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Pe={class:"p-6 bg-white border-b border-gray-200"},Ne={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},Ve=["value"],Ae={class:"mb-6 relative"},Be={key:0,class:"absolute z-10 bg-white border w-full rounded shadow max-h-60 overflow-auto"},$e=["onMousedown"],Ie={class:"font-semibold"},Re={class:"text-xs text-gray-500"},Ee={key:1,class:"absolute right-2 top-2"},Me={key:0,class:"mb-4 p-4 border rounded bg-blue-50"},je={class:"text-sm mt-1"},Te={class:"font-mono"},Ge={class:"text-sm"},Fe={class:"text-sm"},De={key:1,class:"mb-8"},Qe={class:"overflow-x-auto"},Le={class:"w-full min-w-full divide-y divide-gray-200"},Oe={class:"bg-gradient-to-r from-blue-50 to-blue-100"},Ke={class:"px-4 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},We={class:"px-2 py-2"},He=["checked","onChange"],Je={class:"px-4 py-2"},ze={class:"px-4 py-2"},Ye={class:"px-4 py-2"},Ze={class:"px-4 py-2"},Xe={class:"px-4 py-2"},et=["onUpdate:modelValue","max","disabled"],tt={key:0,class:"text-xs text-red-600 mt-1"},st={class:"px-4 py-2"},ot={class:"px-4 py-2"},lt={class:"px-4 py-2"},it=["disabled"],nt={class:"mb-6"},at=["onClick"],dt={class:"font-semibold"},rt={class:"ml-2 text-sm text-gray-500"},ut={class:"flex gap-2"},ct=["onClick"],mt=["onClick"],pt={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},_t={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ft={key:0,class:"p-4 bg-gray-50 border-t"},gt={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},vt=["onUpdate:modelValue"],bt=["onUpdate:modelValue"],yt=["onUpdate:modelValue"],ht=["onUpdate:modelValue"],xt=["onChange"],wt={key:0,class:"text-xs text-green-700 mt-1"},kt=["onChange"],qt={key:0,class:"text-xs text-green-700 mt-1"},Ct={key:1,class:"mt-2"},Ut=["src"],St={class:"grid grid-cols-1 lg:grid-cols-12 gap-3 mb-2 items-center text-xs font-medium text-gray-600 bg-gray-50 p-2 rounded"},Pt={class:"lg:col-span-1"},Nt={class:"lg:col-span-4"},Vt={class:"lg:col-span-2"},At=["onUpdate:modelValue"],Bt=["value"],$t={key:0,class:"text-xs text-red-600 mt-1"},It={key:1,class:"text-xs text-orange-600 mt-1"},Rt={key:2,class:"text-xs text-blue-600 mt-1"},Et={class:"lg:col-span-1"},Mt=["onUpdate:modelValue"],jt={class:"lg:col-span-1"},Tt=["onUpdate:modelValue","placeholder"],Gt={class:"lg:col-span-1 text-center"},Ft={class:"text-sm text-gray-600"},Dt={class:"lg:col-span-1"},Qt={class:"flex items-center gap-1 text-sm"},Lt=["onUpdate:modelValue"],Ot={class:"lg:col-span-1"},Kt=["onClick"],Wt={class:"lg:col-span-2 text-xs text-blue-700 font-semibold leading-tight"},Ht={key:0},Jt=["onClick"],zt={class:"flex gap-2 items-center mt-1"},Yt=["onUpdate:modelValue","placeholder"],Zt=["onClick"],Xt={class:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg"},es={class:"font-mono"},ts={class:"font-mono"},ss={class:"mb-6"},os={class:"flex justify-between items-center mb-4"},ls=["onUpdate:modelValue"],is=["onUpdate:modelValue"],ns=["onChange"],as={class:"col-span-full flex justify-end"},ds=["onClick"],rs={class:"mb-6"},us={class:"flex justify-end"},cs=["disabled"],ms={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-30"},ps={__name:"Create",props:{warehouses:Array,units:Array,pcsItems:Array},setup(F){var O;const A=F;if(console.log("PCS Items from props:",((O=A.pcsItems)==null?void 0:O.length)||0),A.pcsItems){const l=A.pcsItems.find(e=>{var o;return(o=e.name)==null?void 0:o.includes("Beef Picanha 200gr")});l&&console.log("Found Picanha item in props:",l)}const a=fe({warehouse_id:"",good_receive_id:"",items:[],certificates:[],notes:""}),$=h(""),I=h([]),M=h(!1),B=h(!1),U=h(null),x=h([]),p=h({}),w=h({}),J=["MT","BK","BP","SP","SF"],z=N(()=>(A.pcsItems||[]).filter(l=>J.includes(l.category_code))),j=h(!1),f=h({}),R=h(!1),Y=async l=>{M.value=!0;try{const e=await G.get("/api/good-receives/autocomplete",{params:{q:l,warehouse_id:a.warehouse_id}});I.value=e.data,B.value=!0}finally{M.value=!1}},Z=async l=>{U.value=l,a.good_receive_id=l.id,$.value=`${l.gr_number} - ${l.supplier_name} (${l.receive_date})`,B.value=!1;const e=await G.get(`/api/good-receives/${l.id}/items`);console.log("Whole items:",e.data),x.value=e.data,x.value.forEach(o=>{p.value[o.id]||(p.value[o.id]={checked:!1,qty:""})}),a.items=[]},X=()=>{x.value.filter(e=>{var o,s,n;return((o=p.value[e.id])==null?void 0:o.checked)&&Number((s=p.value[e.id])==null?void 0:s.qty)>0&&Number((n=p.value[e.id])==null?void 0:n.qty)<=e.sisa_qty}).forEach(e=>{const o=Number(p.value[e.id].qty);a.items.push({whole_item_id:Number(e.item_id),whole_item_name:e.name,whole_qty:o,whole_unit:e.unit,qty_purchase:e.qty_received??o,pcs:[],susut_air:{qty:"",unit:e.unit},small_conversion_qty:e.small_conversion_qty,po_price:e.po_price,po_unit_id:e.po_unit_id,small_unit_id:e.small_unit_id}),e.sisa_qty=(e.sisa_qty??0)-o,p.value[e.id].checked=!1,p.value[e.id].qty="",console.log("item yang di-add:",e)})},ee=(l,e)=>{p.value[l]||(p.value[l]={checked:!1,qty:""}),p.value[l].checked=e},te=l=>{a.items[l].pcs.push({pcs_item_id:"",pcs_item_name:"",pcs_unit:"",pcs_qty:"",qty:"",costs_0:!1,unit_options:[],unit_id:""})},se=(l,e)=>{a.items[l].pcs.splice(e,1)},oe=()=>{f.value={};let l=!0;return a.warehouse_id||(f.value.warehouse_id="Warehouse is required",l=!1),a.good_receive_id||(f.value.good_receive_id="Good Receive is required",l=!1),(!a.items||a.items.length===0)&&(f.value.items="At least one item must be added",l=!1),a.items.forEach((e,o)=>{e.whole_item_id||(f.value[`items.${o}.whole_item_id`]="Whole item is required",l=!1),(!e.whole_qty||e.whole_qty<=0)&&(f.value[`items.${o}.whole_qty`]="Whole quantity must be greater than 0",l=!1),(!e.pcs||e.pcs.length===0)&&(f.value[`items.${o}.pcs`]="At least one PCS item must be added",l=!1),e.pcs.forEach((s,n)=>{(!s.pcs_item_id||typeof s.pcs_item_id=="object"&&!s.pcs_item_id.id)&&(f.value[`items.${o}.pcs.${n}.pcs_item_id`]="PCS item is required",l=!1),s.unit_id||(f.value[`items.${o}.pcs.${n}.unit_id`]="Unit is required",l=!1),(!s.pcs_qty||s.pcs_qty<=0)&&(f.value[`items.${o}.pcs.${n}.pcs_qty`]="PCS quantity must be greater than 0",l=!1)})}),!a.certificates||a.certificates.length===0?(f.value.certificates="At least one halal certificate is required",l=!1):a.certificates.forEach((e,o)=>{e.producer_name||(f.value[`certificates.${o}.producer_name`]="Producer name is required",l=!1),e.certificate_number||(f.value[`certificates.${o}.certificate_number`]="Certificate number is required",l=!1),e.file||(f.value[`certificates.${o}.file`]="Certificate file is required",l=!1)}),l},le=async()=>{var e,o;if(j.value||R.value)return;if(!oe()){E.fire({icon:"error",title:"Validation Error",html:Object.values(f.value).join("<br>"),confirmButtonText:"OK"});return}if((await E.fire({title:"Konfirmasi Simpan",text:"Apakah Anda yakin ingin menyimpan butcher process ini?",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, simpan!",cancelButtonText:"Batal"})).isConfirmed){j.value=!0,R.value=!0;try{await ie()}catch(s){console.error("Error submitting form:",s),E.fire({icon:"error",title:"Gagal",text:((o=(e=s.response)==null?void 0:e.data)==null?void 0:o.message)||s.message||"Terjadi error saat simpan data."})}finally{j.value=!1,R.value=!1}}},ie=async()=>{a.items=a.items.filter(o=>o.whole_item_id),console.log("form.items (before flatten):",JSON.stringify(a.items,null,2));const l=[];a.items.forEach((o,s)=>{(o.pcs||[]).forEach((n,i)=>{var c,m;let _=0;n.costs_0||(_=((c=P.value[s])==null?void 0:c[i])||0),l.push({whole_item_id:o.whole_item_id,whole_item_name:o.whole_item_name,whole_qty:o.whole_qty,whole_unit:o.whole_unit,slaughter_date:o.slaughter_date,packing_date:o.packing_date,batch_est:o.batch_est,qty_purchase:o.qty_purchase,susut_air:o.susut_air,pcs_item_id:((m=n.pcs_item_id)==null?void 0:m.id)||n.pcs_item_id,pcs_item_name:n.pcs_item_name,pcs_qty:n.pcs_qty,unit_id:n.unit_id,costs_0:n.costs_0,qty:n.qty,qty_kg:n.qty,mac_pcs:_}),console.log("KIRIM mac_pcs:",_,"costs_0:",n.costs_0,"pcs:",n.pcs_item_name)})}),console.log("flatItems (to be sent):",JSON.stringify(l,null,2));const e=new FormData;e.append("warehouse_id",a.warehouse_id),e.append("good_receive_id",a.good_receive_id),e.append("items",JSON.stringify(l)),a.items.forEach((o,s)=>{o.attachment_pdf&&e.append(`items_files[${s}][attachment_pdf]`,o.attachment_pdf),o.upload_image&&e.append(`items_files[${s}][upload_image]`,o.upload_image)}),a.certificates&&a.certificates.length>0&&(e.append("certificates",JSON.stringify(a.certificates)),a.certificates.forEach((o,s)=>{o.file&&e.append(`certificate_files[${s}]`,o.file)}));try{const o=await G.post(route("butcher-processes.store"),e,{headers:{"Content-Type":"multipart/form-data"}});if(o.data.success)await E.fire({icon:"success",title:"Berhasil",text:"Butcher process berhasil disimpan!"}),window.location.href=route("butcher-processes.index");else throw new Error(o.data.message||"Failed to create butcher process")}catch(o){throw o}};function ne(l,e){const o=l.target.files[0];e.upload_image=o,e.upload_image_preview&&URL.revokeObjectURL(e.upload_image_preview),e.upload_image_preview=o?URL.createObjectURL(o):""}function ae(l,e){e.whole_item_id&&p.value[e.whole_item_id]&&(p.value[e.whole_item_id].qty="",p.value[e.whole_item_id].checked=!1),a.items.splice(l,1),w.value[l]=!1}function de(l,e){const o=a.items[l].pcs[e],s=o.pcs_item_id;if(s&&s.id){o.pcs_item_name=s.name,o.small_conversion_qty=s.small_conversion_qty||1,console.log("Selected item:",s.name),console.log("Small unit:",s.small_unit_id,s.small_unit_name),console.log("Medium unit:",s.medium_unit_id,s.medium_unit_name),console.log("Large unit:",s.large_unit_id,s.large_unit_name);const n=[],i=new Set,_=[{id:s.small_unit_id,name:s.small_unit_name},{id:s.medium_unit_id,name:s.medium_unit_name},{id:s.large_unit_id,name:s.large_unit_name}];if(console.log("Units to add:",_),_.forEach(c=>{if(console.log("Processing unit:",c),c.id&&c.name){const m=`${c.id}-${c.name}`;console.log("Unit key:",m),i.has(m)?console.log("Unit already exists, skipping:",c):(n.push({id:c.id,name:c.name}),i.add(m),console.log("Added unit:",c))}else console.log("Unit has null/empty id or name, skipping:",c)}),console.log("After deduplication, unit options:",n),n.length===0&&(s.small_unit_id||s.medium_unit_id||s.large_unit_id)){console.log("No unit options after deduplication, trying fallback...");const c=_.find(m=>m.id&&m.name);c?(n.push({id:c.id,name:c.name}),console.log("Added fallback unit:",c)):console.log("No fallback unit found")}console.log("Final unit options:",n),o.unit_options=n,n.length===1?(o.unit_id=n[0].id,console.log("Auto-selected unit:",n[0].id,n[0].name)):(o.unit_id="",console.log("No auto-select, unit_id set to empty. Unit options count:",n.length))}else o.pcs_item_name="",o.small_conversion_qty=1,o.unit_options=[],o.unit_id=""}const D=l=>{Y(l.target.value)},re=()=>{setTimeout(()=>{B.value=!1},200)};ge(()=>a.warehouse_id,()=>{$.value="",I.value=[],B.value=!1,U.value=null,x.value=[],a.good_receive_id="",a.items=[]});function S(l){return l==null||isNaN(l)?"-":"Rp "+Number(l).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}const Q=N(()=>{if(!a.items.length)return 0;const l=L(a.items[0]),e=Number(a.items[0].whole_qty||0)*(Number(a.items[0].small_conversion_qty)||1);return l*e}),ue=N(()=>{let l=0;return a.items.forEach(e=>{Array.isArray(e.pcs)&&e.pcs.forEach(o=>{if(!o.costs_0){const s=Number(o.qty||0);l+=s*1e3}})}),l}),ce=N(()=>{const l=Number(Q.value),e=Number(ue.value);return e>0?l/e:0}),P=N(()=>a.items.map(l=>Array.isArray(l.pcs)?l.pcs.map(e=>ce.value):[])),me=N(()=>!P.value.length||!P.value[0].length?0:P.value[0][0]);function L(l){const e=Number(l.po_price),o=Number(l.small_conversion_qty);return!e||!o?0:e/o}function T(l){var o;const e=(o=A.units)==null?void 0:o.find(s=>s.id==l);return e?e.name:"-"}const pe=l=>{const e=a.items[l],o=Number(e.whole_qty||0),s=e.pcs.reduce((i,_)=>i+Number(_.qty||0),0);let n=o-s;n=n>0?n:0,e.susut_air.qty=Number(n.toFixed(2))};function _e(l,e){var i,_,c;const o=(_=(i=a.items[l])==null?void 0:i.pcs)==null?void 0:_[e];if(!o||!o.pcs_item_id||o.costs_0)return 0;const s=((c=P.value[l])==null?void 0:c[e])||0,n=Number(o.small_conversion_qty)||1;return s*n}return(l,e)=>(r(),ve(we,null,{default:be(()=>{var o;return[K(b(ye),{title:"Create Butcher Process"}),t("div",Ce,[t("div",Ue,[t("div",Se,[t("div",Pe,[t("form",{onSubmit:V(le,["prevent"]),onKeydown:e[5]||(e[5]=W(V(()=>{},["prevent"]),["enter"]))},[t("div",Ne,[t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-gray-700"},"Warehouse",-1)),g(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>b(a).warehouse_id=s),class:"mt-1 block w-full rounded-md border-gray-300",required:"",onKeydown:e[1]||(e[1]=W(V(()=>{},["prevent"]),["enter"]))},[e[6]||(e[6]=t("option",{value:""},"Select Warehouse",-1)),(r(!0),u(k,null,q(F.warehouses,s=>(r(),u("option",{key:s.id,value:s.id},d(s.name),9,Ve))),128))],544),[[H,b(a).warehouse_id]])])]),t("div",Ae,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700"},"Good Receive",-1)),g(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>$.value=s),onInput:D,onFocus:D,onBlur:re,type:"text",class:"mt-1 block w-full rounded-md border-gray-300",placeholder:"Cari nomor/tanggal/supplier...",autocomplete:"off",required:""},null,544),[[y,$.value]]),B.value&&I.value.length?(r(),u("div",Be,[(r(!0),u(k,null,q(I.value,s=>(r(),u("div",{key:s.id,onMousedown:V(n=>Z(s),["prevent"]),class:"px-4 py-2 cursor-pointer hover:bg-blue-50"},[t("div",Ie,d(s.gr_number),1),t("div",Re,d(s.receive_date)+" - "+d(s.supplier_name),1)],40,$e))),128))])):v("",!0),M.value?(r(),u("div",Ee,e[8]||(e[8]=[t("i",{class:"fa fa-spinner fa-spin text-blue-400"},null,-1)]))):v("",!0)]),U.value?(r(),u("div",Me,[e[11]||(e[11]=t("div",{class:"font-semibold text-blue-800"},"Good Receive Info",-1)),t("div",je,[e[10]||(e[10]=C("Nomor: ")),t("span",Te,d(U.value.gr_number),1)]),t("div",Ge,"Tanggal: "+d(U.value.receive_date),1),t("div",Fe,"Supplier: "+d(U.value.supplier_name),1)])):v("",!0),x.value.length?(r(),u("div",De,[e[20]||(e[20]=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Items in Good Receive",-1)),t("div",Qe,[t("table",Le,[t("thead",Oe,[t("tr",null,[e[12]||(e[12]=t("th",null,null,-1)),e[13]||(e[13]=t("th",{class:"px-4 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"SKU",-1)),e[14]||(e[14]=t("th",{class:"px-4 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Item Name",-1)),e[15]||(e[15]=t("th",{class:"px-4 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Qty",-1)),e[16]||(e[16]=t("th",{class:"px-4 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"SISA QTY",-1)),e[17]||(e[17]=t("th",{class:"px-4 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Qty to Butcher",-1)),e[18]||(e[18]=t("th",{class:"px-4 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Unit",-1)),e[19]||(e[19]=t("th",{class:"px-4 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Harga PO",-1)),t("th",Ke,"Harga per "+d(T((o=l.item)==null?void 0:o.small_unit_id)||"Small Unit"),1)])]),t("tbody",null,[(r(!0),u(k,null,q(x.value,s=>{var n,i,_;return r(),u("tr",{key:s.id},[t("td",We,[t("input",{type:"checkbox",checked:!!((n=p.value[s.id])!=null&&n.checked),onChange:c=>ee(s.id,c.target.checked)},null,40,He)]),t("td",Je,d(s.sku),1),t("td",ze,d(s.name),1),t("td",Ye,d(s.qty_received??0),1),t("td",Ze,d(s.sisa_qty??0),1),t("td",Xe,[g(t("input",{type:"number","onUpdate:modelValue":c=>p.value[s.id].qty=c,min:"0.01",max:s.sisa_qty,step:"0.01",disabled:!((i=p.value[s.id])!=null&&i.checked),class:"w-24 rounded border-gray-300"},null,8,et),[[y,p.value[s.id].qty,void 0,{number:!0}]]),(_=p.value[s.id])!=null&&_.qty&&Number(p.value[s.id].qty)>s.sisa_qty?(r(),u("div",tt," Qty to Butcher tidak boleh melebihi sisa qty ("+d(s.sisa_qty)+") ",1)):v("",!0)]),t("td",st,d(s.unit),1),t("td",ot,d(S(s.po_price))+" / "+d(T(s==null?void 0:s.po_unit_id)),1),t("td",lt,d(S(L(s)))+" / "+d(T(s==null?void 0:s.small_unit_id)),1)])}),128))])])]),t("button",{type:"button",class:"mt-2 px-3 py-1 rounded bg-blue-600 text-white font-semibold hover:bg-blue-700",onClick:X,disabled:!Object.values(p.value).some(s=>s.checked&&Number(s.qty)>0)||x.value.some(s=>{var n,i;return((n=p.value[s.id])==null?void 0:n.qty)&&Number((i=p.value[s.id])==null?void 0:i.qty)>s.sisa_qty})}," Add to Butcher ",8,it)])):v("",!0),t("div",nt,[e[47]||(e[47]=t("div",{class:"flex justify-between items-center mb-4"},[t("h3",{class:"text-lg font-medium text-gray-900"},"Butcher Output (PCS Items)")],-1)),(r(!0),u(k,null,q(b(a).items,(s,n)=>(r(),u("div",{key:n,class:"mb-4 border rounded-lg"},[t("div",{class:"flex items-center justify-between px-4 py-2 cursor-pointer bg-gray-50 rounded-t-lg",onClick:i=>w.value[n]=!w.value[n]},[t("div",null,[t("span",dt,d(s.whole_item_name),1),t("span",rt,"Qty: "+d(s.whole_qty)+" "+d(s.whole_unit),1)]),t("div",ut,[t("button",{type:"button",class:"text-red-600",onClick:V(i=>ae(n,s),["stop"]),title:"Delete"},e[21]||(e[21]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,ct),t("button",{type:"button",class:"text-blue-600",onClick:V(i=>w.value[n]=!w.value[n],["stop"]),title:"Expand/Collapse"},[w.value[n]?(r(),u("svg",pt,e[22]||(e[22]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"},null,-1)]))):(r(),u("svg",_t,e[23]||(e[23]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])))],8,mt)])],8,at),w.value[n]?(r(),u("div",ft,[t("div",gt,[t("div",null,[e[24]||(e[24]=t("label",{class:"block text-xs font-medium text-gray-700"},"Slaughter Date",-1)),g(t("input",{"onUpdate:modelValue":i=>s.slaughter_date=i,type:"date",class:"mt-1 block w-full rounded-md border-gray-300"},null,8,vt),[[y,s.slaughter_date]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-xs font-medium text-gray-700"},"Packing Date",-1)),g(t("input",{"onUpdate:modelValue":i=>s.packing_date=i,type:"date",class:"mt-1 block w-full rounded-md border-gray-300"},null,8,bt),[[y,s.packing_date]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-xs font-medium text-gray-700"},"Batch/EST",-1)),g(t("input",{"onUpdate:modelValue":i=>s.batch_est=i,type:"text",class:"mt-1 block w-full rounded-md border-gray-300"},null,8,yt),[[y,s.batch_est]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-xs font-medium text-gray-700"},"Qty Purchase",-1)),g(t("input",{"onUpdate:modelValue":i=>s.qty_purchase=i,type:"number",min:"0",step:"0.01",class:"mt-1 block w-full rounded-md border-gray-300"},null,8,ht),[[y,s.qty_purchase]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-xs font-medium text-gray-700"},"Attachment PDF",-1)),t("input",{type:"file",accept:"application/pdf",onChange:i=>s.attachment_pdf=i.target.files[0],class:"mt-1 block w-full"},null,40,xt),s.attachment_pdf?(r(),u("div",wt,d(s.attachment_pdf.name),1)):v("",!0)]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-xs font-medium text-gray-700"},"Upload Image",-1)),t("input",{type:"file",accept:"image/*",onChange:i=>ne(i,s),class:"mt-1 block w-full"},null,40,kt),s.upload_image?(r(),u("div",qt,d(s.upload_image.name),1)):v("",!0),s.upload_image_preview?(r(),u("div",Ct,[t("img",{src:s.upload_image_preview,alt:"Preview",class:"max-h-32 rounded border"},null,8,Ut)])):v("",!0)])]),e[41]||(e[41]=t("div",{class:"mb-2 font-semibold"},"PCS Items",-1)),e[42]||(e[42]=t("div",{class:"text-xs text-gray-600 mb-2"},[t("i",{class:"fas fa-info-circle mr-1"}),C(" Pilih item PCS, kemudian pilih unit yang tersedia untuk item tersebut (Small, Medium, atau Large) ")],-1)),t("div",St,[e[30]||(e[30]=t("div",{class:"lg:col-span-4"},"Item PCS",-1)),e[31]||(e[31]=t("div",{class:"lg:col-span-2"},"Unit",-1)),e[32]||(e[32]=t("div",{class:"lg:col-span-1"},"Qty PCS",-1)),t("div",Pt,"Qty ("+d(s.whole_unit)+")",1),e[33]||(e[33]=t("div",{class:"lg:col-span-1"},"Unit",-1)),e[34]||(e[34]=t("div",{class:"lg:col-span-1"},"Costs 0",-1)),e[35]||(e[35]=t("div",{class:"lg:col-span-1"},"Action",-1)),e[36]||(e[36]=t("div",{class:"lg:col-span-2"},"MAC Preview",-1))]),(r(!0),u(k,null,q(s.pcs,(i,_)=>{var c;return r(),u("div",{key:_,class:"grid grid-cols-1 lg:grid-cols-12 gap-3 mb-3 items-center relative"},[t("div",Nt,[K(b(ke),{modelValue:i.pcs_item_id,"onUpdate:modelValue":m=>i.pcs_item_id=m,options:z.value,searchable:!0,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Pilih atau cari item PCS...","track-by":"id",label:"name","preselect-first":!1,onChange:m=>de(n,_),class:"w-full"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),t("div",Vt,[g(t("select",{"onUpdate:modelValue":m=>i.unit_id=m,class:he(["rounded border-gray-300 w-full",{"border-red-300":!i.unit_id&&i.pcs_item_id}])},[e[37]||(e[37]=t("option",{value:""},"Pilih Unit",-1)),(r(!0),u(k,null,q(i.unit_options||[],m=>(r(),u("option",{key:m.id,value:m.id},d(m.name),9,Bt))),128))],10,At),[[H,i.unit_id]]),!i.unit_id&&i.pcs_item_id&&i.unit_options&&i.unit_options.length>0?(r(),u("div",$t," Unit harus dipilih ")):v("",!0),i.pcs_item_id&&(!i.unit_options||i.unit_options.length===0)?(r(),u("div",It,e[38]||(e[38]=[t("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1),C(" Item ini tidak memiliki unit yang valid. Silakan periksa konfigurasi unit di master data item. ")]))):v("",!0),i.pcs_item_id&&i.unit_options&&i.unit_options.length===1?(r(),u("div",Rt,e[39]||(e[39]=[t("i",{class:"fas fa-info-circle mr-1"},null,-1),C(" Item ini hanya memiliki 1 unit yang tersedia. ")]))):v("",!0)]),t("div",Et,[g(t("input",{"onUpdate:modelValue":m=>i.pcs_qty=m,type:"number",min:"0.01",step:"0.01",placeholder:"Qty PCS",class:"rounded border-gray-300 w-full"},null,8,Mt),[[y,i.pcs_qty]])]),t("div",jt,[g(t("input",{"onUpdate:modelValue":m=>i.qty=m,type:"number",min:"0.01",step:"0.01",placeholder:"Qty ("+s.whole_unit+")",class:"rounded border-gray-300 w-full"},null,8,Tt),[[y,i.qty]])]),t("div",Gt,[t("span",Ft,d(s.whole_unit),1)]),t("div",Dt,[t("label",Qt,[g(t("input",{type:"checkbox","onUpdate:modelValue":m=>i.costs_0=m},null,8,Lt),[[xe,i.costs_0]]),e[40]||(e[40]=C(" Costs 0"))])]),t("div",Ot,[t("button",{type:"button",class:"text-red-600 hover:text-red-800 text-sm",onClick:m=>se(n,_)},"Delete",8,Kt)]),t("div",Wt,[t("div",null,"MAC /Gram: "+d(S(i.costs_0?0:((c=P.value[n])==null?void 0:c[_])||0)),1),i.pcs_item_id&&(typeof i.pcs_item_id=="object"?i.pcs_item_id.id:i.pcs_item_id)?(r(),u("div",Ht,"MAC /Pcs: "+d(S(i.costs_0?0:_e(n,_))),1)):v("",!0)])])}),128)),t("button",{type:"button",class:"mt-2 px-3 py-1 rounded bg-blue-100 text-blue-700 font-semibold hover:bg-blue-200",onClick:i=>te(n)},"+ Add PCS Item",8,Jt),e[43]||(e[43]=t("div",{class:"mt-4 font-semibold"},"Susut Air",-1)),t("div",zt,[g(t("input",{"onUpdate:modelValue":i=>s.susut_air.qty=i,type:"number",min:"0",step:"0.01",placeholder:"Qty ("+s.whole_unit+")",class:"rounded border-gray-300"},null,8,Yt),[[y,s.susut_air.qty]]),t("button",{type:"button",class:"px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200",onClick:i=>pe(n)}," Hitung ",8,Zt),t("span",null,d(s.whole_unit),1)])])):v("",!0)]))),128)),t("div",Xt,[e[46]||(e[46]=t("div",{class:"font-semibold mb-1"},"Preview Perhitungan:",-1)),t("div",null,[e[44]||(e[44]=C("Total Cost: ")),t("span",es,d(S(Q.value)),1)]),t("div",null,[e[45]||(e[45]=C("MAC Gram: ")),t("span",ts,d(S(me.value)),1)])])]),t("div",ss,[t("div",os,[e[48]||(e[48]=t("h3",{class:"text-lg font-medium text-gray-900"},"Halal Certificates",-1)),t("button",{type:"button",onClick:e[3]||(e[3]=()=>b(a).certificates.push({producer_name:"",certificate_number:"",file:null})),class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"}," Add Certificate ")]),(r(!0),u(k,null,q(b(a).certificates,(s,n)=>(r(),u("div",{key:n,class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4 p-4 border rounded-md"},[t("div",null,[e[49]||(e[49]=t("label",{class:"block text-sm font-medium text-gray-700"},"Producer Name",-1)),g(t("input",{"onUpdate:modelValue":i=>s.producer_name=i,type:"text",class:"mt-1 block w-full rounded-md border-gray-300",required:""},null,8,ls),[[y,s.producer_name]])]),t("div",null,[e[50]||(e[50]=t("label",{class:"block text-sm font-medium text-gray-700"},"Certificate Number",-1)),g(t("input",{"onUpdate:modelValue":i=>s.certificate_number=i,type:"text",class:"mt-1 block w-full rounded-md border-gray-300",required:""},null,8,is),[[y,s.certificate_number]])]),t("div",null,[e[51]||(e[51]=t("label",{class:"block text-sm font-medium text-gray-700"},"Certificate File",-1)),t("input",{type:"file",onChange:i=>s.file=i.target.files[0],class:"mt-1 block w-full",accept:".pdf,.jpg,.jpeg,.png",required:""},null,40,ns)]),t("div",as,[t("button",{type:"button",onClick:()=>b(a).certificates.splice(n,1),class:"text-red-600 hover:text-red-900"}," Remove ",8,ds)])]))),128))]),t("div",rs,[e[52]||(e[52]=t("label",{class:"block text-sm font-medium text-gray-700"},"Notes",-1)),g(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=s=>b(a).notes=s),rows:"3",class:"mt-1 block w-full rounded-md border-gray-300"},null,512),[[y,b(a).notes]])]),t("div",us,[t("button",{type:"submit",class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",disabled:b(a).processing},d(b(a).processing?"Saving...":"Save"),9,cs)])],32)])])])]),R.value?(r(),u("div",ms,e[53]||(e[53]=[t("div",{class:"bg-white px-6 py-4 rounded shadow flex items-center gap-2"},[t("span",{class:"loader border-2 border-blue-500 border-t-transparent rounded-full w-6 h-6 animate-spin"}),t("span",null,"Menyimpan...")],-1)]))):v("",!0)]}),_:1}))}},Us=qe(ps,[["__scopeId","data-v-bed4b7c8"]]);export{Us as default};
