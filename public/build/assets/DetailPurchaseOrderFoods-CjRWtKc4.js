import{r as I,c as y,A as G,B as i,C as L,D as e,x as M,G as n,l as D,L as d,E as u,N as a,F as $,M as V,W as c}from"./vendor-vue-g7iCcTkf.js";import{A as q}from"./AppLayout-zB0hvXOw.js";import{S as m}from"./app-BgZdqVzD.js";import{a as R}from"./vendor-utils-CpgP2uT4.js";import E from"./PrintPreviewModal-B1nrP7KC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-C4ea0y0B.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const W={class:"py-12"},_={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},K={class:"mb-4"},U=["disabled"],z={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},H={class:"p-6 bg-white border-b border-gray-200"},J={class:"grid grid-cols-2 gap-4 mb-6"},Q={class:"space-y-2"},X={class:"text-gray-600"},Y={key:0,class:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4"},Z={class:"grid grid-cols-2 gap-4"},tt={class:"space-y-2"},et={class:"space-y-2"},st={class:"mb-6"},ot={class:"overflow-x-auto"},at={class:"min-w-full divide-y divide-gray-200"},nt={class:"bg-white divide-y divide-gray-200"},rt={class:"px-6 py-4 whitespace-nowrap"},it={class:"px-6 py-4 whitespace-nowrap"},lt={class:"px-6 py-4 whitespace-nowrap"},dt={class:"px-6 py-4 whitespace-nowrap"},pt={class:"px-6 py-4 whitespace-nowrap"},ut={class:"bg-gray-50"},mt={class:"px-6 py-4 font-medium"},gt={key:0,class:"bg-gray-50"},ft={class:"px-6 py-4 font-medium text-blue-600"},ct={class:"bg-gray-100"},xt={class:"px-6 py-4 font-bold text-lg text-green-600"},bt={key:1,class:"mt-6"},vt={class:"bg-gray-50 p-4 rounded-lg"},yt={key:0},wt={key:1},ht={class:"mt-6"},kt={class:"space-y-4"},Pt={class:"bg-gray-50 p-4 rounded-lg"},Ot={key:0},St={key:0},At={key:1},Bt={class:"bg-gray-50 p-4 rounded-lg"},jt={key:0},Ct={key:0},It={key:1},Et={__name:"DetailPurchaseOrderFoods",props:{po:{type:Object,required:!0},roSupplierInfo:{type:Object,default:null},user:{type:Object,required:!0}},setup(s){const r=s;I("");const b=I(!1),w=y(()=>r.user.id_role==="5af56935b011a"&&r.user.status==="A"),h=y(()=>(r.user.id_jabatan===168&&r.user.status==="A"||w.value)&&r.po.status==="draft"&&!r.po.purchasing_manager_approved_at),k=y(()=>((r.user.id_jabatan===152||r.user.id_jabatan===381)&&r.user.status==="A"||w.value)&&r.po.status==="draft"&&r.po.purchasing_manager_approved_at&&!r.po.gm_finance_approved_at),v=o=>o?new Date(o).toLocaleDateString("id-ID"):"-",P=o=>o?new Date(o).toLocaleString("id-ID"):"-",T=o=>{const t={draft:"bg-gray-100 text-gray-800",pending_gm_finance:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"};return`px-2 py-1 rounded-full text-xs font-medium ${t[o]||t.draft}`},O=()=>r.po.items.reduce((o,t)=>o+(Number(t.total)||0),0),N=()=>{const o=O();if(r.po.ppn_enabled){const t=o*.11;return o+t}return o},g=o=>(typeof o!="number"&&(o=Number(o)||0),"Rp "+o.toLocaleString("id-ID"));async function S(o){const{value:t}=await m.fire({title:o?"Approve PO?":"Reject PO?",input:"textarea",inputLabel:"Catatan (opsional)",inputValue:"",showCancelButton:!0,confirmButtonText:o?"Approve":"Reject",cancelButtonText:"Batal"});if(t!==void 0)try{(await R.post(route("po-foods.approve",r.po.id),{approved:o,note:t})).data.success&&(await m.fire({icon:"success",title:"Berhasil",text:o?"PO berhasil diapprove!":"PO berhasil direject!"}),c.reload())}catch{m.fire("Gagal","Terjadi kesalahan saat approve","error")}}async function A(o){const{value:t}=await m.fire({title:o?"Approve PO?":"Reject PO?",input:"textarea",inputLabel:"Catatan (opsional)",inputValue:"",showCancelButton:!0,confirmButtonText:o?"Approve":"Reject",cancelButtonText:"Batal"});if(t!==void 0)try{(await R.post(route("po-foods.approve-gm-finance",r.po.id),{approved:o,note:t})).data.success&&(await m.fire({icon:"success",title:"Berhasil",text:o?"PO berhasil diapprove!":"PO berhasil direject!"}),c.reload())}catch{m.fire("Gagal","Terjadi kesalahan saat approve","error")}}function F(){try{const o=sessionStorage.getItem("po-foods-filters");if(o){const t=JSON.parse(o),l=new URLSearchParams;t.search&&l.append("search",t.search),t.status&&l.append("status",t.status),t.from&&l.append("from",t.from),t.to&&l.append("to",t.to),t.perPage&&l.append("perPage",t.perPage);const f=l.toString(),x=f?`/po-foods?${f}`:"/po-foods";c.visit(x)}else c.visit("/po-foods")}catch(o){console.error("Error restoring filters:",o),c.visit("/po-foods")}}return(o,t)=>(i(),G(q,null,{default:L(()=>{var l,f,x,B;return[e("div",W,[e("div",_,[e("div",K,[e("button",{onClick:F,class:"text-blue-500 hover:underline"},t[6]||(t[6]=[e("i",{class:"fa fa-arrow-left"},null,-1),n(" Kembali")])),e("button",{onClick:t[0]||(t[0]=p=>b.value=!0),class:D(["ml-4 px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200",s.po.status!=="approved"?"opacity-50 cursor-not-allowed":""]),disabled:s.po.status!=="approved",title:"PO harus berstatus approved untuk preview"},t[7]||(t[7]=[e("i",{class:"fas fa-print mr-2"},null,-1),n(" Preview PO ")]),10,U)]),e("div",z,[e("div",H,[t[38]||(t[38]=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight mb-6"}," Detail Purchase Order Foods ",-1)),e("div",J,[e("div",null,[t[14]||(t[14]=e("h3",{class:"text-lg font-semibold mb-2"},"Informasi PO",-1)),e("div",Q,[e("p",null,[t[8]||(t[8]=e("span",{class:"font-medium"},"Nomor PO:",-1)),n(" "+a(s.po.number),1)]),e("p",null,[t[9]||(t[9]=e("span",{class:"font-medium"},"Tanggal:",-1)),n(" "+a(v(s.po.date)),1)]),e("p",null,[t[10]||(t[10]=e("span",{class:"font-medium"},"Status:",-1)),e("span",{class:D(T(s.po.status))},a(s.po.status),3)]),e("p",null,[t[11]||(t[11]=e("span",{class:"font-medium"},"Supplier:",-1)),n(" "+a((l=s.po.supplier)==null?void 0:l.name),1)]),e("p",null,[t[12]||(t[12]=e("span",{class:"font-medium"},"Tanggal Kedatangan:",-1)),n(" "+a(v(s.po.arrival_date)),1)]),e("p",null,[t[13]||(t[13]=e("span",{class:"font-medium"},"Dibuat oleh:",-1)),n(" "+a((f=s.po.creator)==null?void 0:f.nama_lengkap),1)])])]),e("div",null,[t[15]||(t[15]=e("h3",{class:"text-lg font-semibold mb-2"},"Catatan",-1)),e("p",X,a(s.po.notes||"-"),1)])]),s.roSupplierInfo?(i(),d("div",Y,[t[22]||(t[22]=e("h3",{class:"text-lg font-semibold mb-3 text-green-800"},"Informasi RO Supplier",-1)),e("div",Z,[e("div",tt,[e("p",null,[t[16]||(t[16]=e("span",{class:"font-medium text-green-700"},"Nomor RO:",-1)),n(" "+a(s.roSupplierInfo.ro_number),1)]),e("p",null,[t[17]||(t[17]=e("span",{class:"font-medium text-green-700"},"Tanggal RO:",-1)),n(" "+a(v(s.roSupplierInfo.ro_date)),1)]),e("p",null,[t[18]||(t[18]=e("span",{class:"font-medium text-green-700"},"Outlet:",-1)),n(" "+a(s.roSupplierInfo.outlet_name),1)]),e("p",null,[t[19]||(t[19]=e("span",{class:"font-medium text-green-700"},"Warehouse Outlet:",-1)),n(" "+a(s.roSupplierInfo.warehouse_outlet_name),1)])]),e("div",et,[e("p",null,[t[20]||(t[20]=e("span",{class:"font-medium text-green-700"},"Pembuat RO:",-1)),n(" "+a(s.roSupplierInfo.ro_creator),1)]),e("p",null,[t[21]||(t[21]=e("span",{class:"font-medium text-green-700"},"Deskripsi RO:",-1)),n(" "+a(s.roSupplierInfo.ro_description||"-"),1)])])])])):u("",!0),e("div",st,[t[27]||(t[27]=e("h3",{class:"text-lg font-semibold mb-4"},"Daftar Item",-1)),e("div",ot,[e("table",at,[t[26]||(t[26]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Item"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Qty"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Unit"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Harga"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total")])],-1)),e("tbody",nt,[(i(!0),d($,null,V(s.po.items,p=>{var j,C;return i(),d("tr",{key:p.id},[e("td",rt,a((j=p.item)==null?void 0:j.name),1),e("td",it,a(p.quantity),1),e("td",lt,a((C=p.unit)==null?void 0:C.name),1),e("td",dt,a(g(p.price)),1),e("td",pt,a(g(p.total)),1)])}),128))]),e("tfoot",null,[e("tr",ut,[t[23]||(t[23]=e("td",{colspan:"4",class:"px-6 py-4 text-right font-medium"},"Subtotal:",-1)),e("td",mt,a(g(s.po.subtotal||O())),1)]),s.po.ppn_enabled?(i(),d("tr",gt,[t[24]||(t[24]=e("td",{colspan:"4",class:"px-6 py-4 text-right font-medium text-blue-600"},"PPN (11%):",-1)),e("td",ft,a(g(s.po.ppn_amount||0)),1)])):u("",!0),e("tr",ct,[t[25]||(t[25]=e("td",{colspan:"4",class:"px-6 py-4 text-right font-bold text-lg"},"Grand Total:",-1)),e("td",xt,a(g(s.po.grand_total||N())),1)])])])])]),h.value||k.value?(i(),d("div",bt,[t[28]||(t[28]=e("h3",{class:"text-lg font-semibold mb-4"},"Approval",-1)),e("div",vt,[h.value?(i(),d("div",yt,[e("button",{onClick:t[1]||(t[1]=p=>S(!0)),class:"px-4 py-2 rounded bg-green-600 text-white font-semibold hover:bg-green-700 mr-2"},"Approve (Purchasing Manager)"),e("button",{onClick:t[2]||(t[2]=p=>S(!1)),class:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700"},"Reject")])):u("",!0),k.value?(i(),d("div",wt,[e("button",{onClick:t[3]||(t[3]=p=>A(!0)),class:"px-4 py-2 rounded bg-green-600 text-white font-semibold hover:bg-green-700 mr-2"},"Approve (GM Finance)"),e("button",{onClick:t[4]||(t[4]=p=>A(!1)),class:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700"},"Reject")])):u("",!0)])])):u("",!0),e("div",ht,[t[37]||(t[37]=e("h3",{class:"text-lg font-semibold mb-4"},"Riwayat Approval",-1)),e("div",kt,[e("div",Pt,[t[32]||(t[32]=e("h4",{class:"font-medium mb-2"},"Purchasing Manager",-1)),s.po.purchasing_manager_approved_at?(i(),d("div",Ot,[t[29]||(t[29]=e("span",{class:"text-green-600 font-semibold"},"Approved",-1)),t[30]||(t[30]=n(" oleh ")),e("b",null,a(((x=s.po.purchasing_manager)==null?void 0:x.nama_lengkap)||s.po.purchasing_manager_approved_by),1),n(" pada "+a(P(s.po.purchasing_manager_approved_at))+" ",1),s.po.purchasing_manager_note?(i(),d("span",St,"- Note: "+a(s.po.purchasing_manager_note),1)):u("",!0)])):(i(),d("div",At,t[31]||(t[31]=[e("span",{class:"text-gray-500"},"Belum di-approve",-1)])))]),e("div",Bt,[t[36]||(t[36]=e("h4",{class:"font-medium mb-2"},"GM Finance",-1)),s.po.gm_finance_approved_at?(i(),d("div",jt,[t[33]||(t[33]=e("span",{class:"text-green-600 font-semibold"},"Approved",-1)),t[34]||(t[34]=n(" oleh ")),e("b",null,a(((B=s.po.gm_finance)==null?void 0:B.nama_lengkap)||s.po.gm_finance_approved_by),1),n(" pada "+a(P(s.po.gm_finance_approved_at))+" ",1),s.po.gm_finance_note?(i(),d("span",Ct,"- Note: "+a(s.po.gm_finance_note),1)):u("",!0)])):(i(),d("div",It,t[35]||(t[35]=[e("span",{class:"text-gray-500"},"Belum di-approve",-1)])))])])])])])])]),M(E,{show:b.value,po:s.po,onClose:t[5]||(t[5]=p=>b.value=!1)},null,8,["show","po"])]}),_:1}))}};export{Et as default};
