import{$ as Je,c as M,r as v,w as E,a as Qe,j as Ye,A as ye,B as i,C as Ze,D as t,L as r,E as g,G as _,N as c,F as x,M as w,l as $,H as K,I as ae,J as A,Z,T as Xe,Y as et,O as tt,n as at,W as lt}from"./vendor-vue-g7iCcTkf.js";import{A as st}from"./AppLayout-nEB-Gr2i.js";import{a as k}from"./vendor-utils-CpgP2uT4.js";import{S}from"./app-YbzOJwkz.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-DIps1Q-A.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const ot={class:"max-w-5xl w-full mx-auto py-8 px-2"},nt={class:"flex items-center gap-4 mb-6"},ut={key:0,class:"mb-4 ml-16"},it={class:"inline-flex items-center gap-2 bg-blue-50 text-blue-800 px-4 py-2 rounded-xl font-semibold"},rt={class:"font-bold"},dt={class:"mb-6"},ct={class:"flex gap-4"},mt=["onClick"],vt={class:"mb-6"},gt=["required"],pt=["value"],bt={class:"mb-6"},ft={key:0,class:"mt-1 text-sm text-red-500"},yt={key:1},ht=["disabled"],_t={key:2,class:"text-center py-8"},xt={key:3,class:"bg-red-50 border-l-4 border-red-500 p-4 mb-6"},wt={class:"flex"},kt={class:"ml-3"},Ot={class:"text-sm text-red-700"},St={key:4,class:"bg-red-50 border-l-4 border-red-500 p-4 mb-6"},It={class:"font-bold text-blue-700 mb-1"},Rt={class:"ml-2 text-gray-700 text-sm"},Tt={class:"inline-block w-20 font-semibold"},qt={class:"inline-block w-32 font-mono"},Ct={key:0,class:"inline-block text-xs text-gray-600 ml-2"},Dt={key:0},jt={key:5,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Bt={class:"bg-white rounded-2xl p-6 max-w-2xl w-full mx-4"},Kt={class:"flex justify-between items-center mb-4"},Mt={key:0,class:"space-y-4"},Et={class:"grid grid-cols-2 gap-4"},$t={class:"mt-1 font-semibold"},Nt={class:"mt-1 font-semibold"},Ft={class:"mt-1 font-semibold"},At={class:"border-t pt-4"},Ut={class:"flex flex-wrap gap-2"},Wt={class:"border-t pt-4"},Lt={class:"flex flex-wrap gap-2"},Pt={class:"border-t pt-4"},Vt={class:"flex flex-wrap gap-2"},zt={class:"border-t pt-4 flex justify-end gap-2"},Gt={key:6,class:"mb-6 flex gap-4"},Ht={key:7},Jt={key:0,class:"bg-white rounded-2xl shadow-2xl p-6"},Qt={key:0,class:"mb-2 text-yellow-700 bg-yellow-100 border-l-4 border-yellow-400 px-3 py-2 rounded"},Yt={key:1,class:"mb-2 text-blue-700 bg-blue-100 border-l-4 border-blue-400 px-3 py-2 rounded"},Zt={key:2,class:"text-center py-8"},Xt={key:3},ea={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},ta=["required"],aa=["value"],la={class:"mb-4"},sa=["disabled"],oa={key:0,class:"mb-4"},na=["value"],ua={class:"overflow-x-auto"},ia={class:"w-full min-w-full divide-y divide-gray-200"},ra={class:"px-3 py-2 min-w-[220px]"},da={class:"relative"},ca=["onUpdate:modelValue","onInput","onFocus","onBlur","onKeydown","disabled","id"],ma=["id"],va=["onMousedown"],ga={class:"font-medium"},pa={class:"text-sm text-gray-600"},ba={class:"px-3 py-2 min-w-[80px]"},fa=["value","onInput","disabled"],ya={class:"px-3 py-2 min-w-[80px]"},ha=["onUpdate:modelValue"],_a={class:"px-3 py-2 min-w-[100px]"},xa={class:"px-3 py-2 min-w-[120px] font-semibold"},wa={class:"px-3 py-2"},ka=["onClick","disabled"],Oa=["disabled"],Sa={class:"text-right font-bold text-xl mt-6"},Ia={key:8},Ra={class:"bg-white rounded-2xl shadow-2xl p-6"},Ta={key:0,class:"mb-2 text-yellow-700 bg-yellow-100 border-l-4 border-yellow-400 px-3 py-2 rounded"},qa={class:"mb-4 flex items-center gap-2"},Ca={key:0,class:"mb-2 text-yellow-700 bg-yellow-100 border-l-4 border-yellow-400 px-3 py-2 rounded"},Da={key:1,class:"mb-2 text-blue-700 bg-blue-100 border-l-4 border-blue-400 px-3 py-2 rounded"},ja={key:2,class:"text-center py-8"},Ba=["onClick"],Ka={class:"font-bold text-blue-700 text-lg"},Ma={key:0,class:"bg-white px-4 py-2"},Ea={key:0,class:"w-full text-sm"},$a={class:"py-2"},Na={class:"py-2"},Fa={class:"py-2"},Aa={class:"py-2"},Ua=["onUpdate:modelValue","onInput","disabled"],Wa={class:"py-2 font-semibold"},La={key:1,class:"text-gray-400 italic py-4 text-center"},Pa={class:"text-right font-bold text-xl mt-6"},Va={key:9,class:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"},za={class:"bg-white rounded-xl p-6 max-w-2xl w-full shadow-2xl",style:{"max-height":"90vh","overflow-y":"auto"}},Ga={class:"mb-2"},Ha={class:"mb-2"},Ja={class:"mb-2"},Qa={class:"mb-2",style:{"max-height":"400px","overflow-y":"auto"}},Ya={class:"font-semibold text-blue-700 mb-1"},Za={class:"w-full mb-2"},Xa={class:"bg-blue-50 font-bold"},el={colspan:"4",class:"text-right"},tl={class:"text-right font-bold text-lg mb-4"},al={class:"flex justify-end gap-2"},ll=["disabled"],sl={key:0},ol={key:1},bl={__name:"Form",props:{fo_mode:String,input_mode:String,user:Object,order:Object},setup(he){var be,fe;const b=he,{props:_e}=Je(),X=M(()=>{var a,e;return((e=(a=_e.value)==null?void 0:a.auth)==null?void 0:e.user)||{}}),j=v(b.input_mode||"pc"),m=v(b.fo_mode||""),D=v(!1),R=v(null),L=v(!1),I=v(""),O=v(!1),z=v([]),f=v(!1),P=v([]),N=v(""),G=v(!1),V=v(!1),ee=v(!1),T=v([]),q=v(null),te=new Date,xe=te.getFullYear(),we=String(te.getMonth()+1).padStart(2,"0"),ke=String(te.getDate()).padStart(2,"0"),le=v(`${xe}-${we}-${ke}`),n=v({tanggal:le.value,description:"",fo_schedule_id:null,arrival_date:"",items:[{item_id:"",item_name:"",qty:"",unit:"",price:0,subtotal:0,suggestions:[],showDropdown:!1,loading:!1,highlightedIndex:-1,_rowKey:Date.now()+"-"+Math.random()}]}),se=v([]);b.order&&(n.value.tanggal=b.order.tanggal,n.value.description=b.order.description,n.value.arrival_date=b.order.arrival_date||"",n.value.items=((be=b.order.items)==null?void 0:be.map(a=>({...a,suggestions:[],showDropdown:!1,loading:!1,highlightedIndex:-1,_rowKey:Date.now()+"-"+Math.random()})))||n.value.items,m.value=b.order.fo_mode,j.value=b.order.input_mode);const F=v(((fe=b.order)==null?void 0:fe.id)||null),B=M(()=>{var a,e;return b.user.region_id||((a=b.user.outlet)==null?void 0:a.region_id)||X.value.region_id||((e=X.value.outlet)==null?void 0:e.region_id)}),C=M(()=>b.user.id_outlet||X.value.id_outlet);function Oe(){if(m.value==="RO Tambahan"&&n.value.items.length>=6){S.fire({icon:"warning",title:"Maksimal 6 Item",text:"Anda hanya bisa input maksimal 6 item untuk FO Tambahan.",confirmButtonColor:"#3085d6"});return}n.value.items.push({item_id:"",item_name:"",qty:"",unit:"",price:0,subtotal:0,suggestions:[],showDropdown:!1,loading:!1,highlightedIndex:-1,_rowKey:Date.now()+"-"+Math.random()}),at(()=>{setTimeout(()=>{const a=n.value.items.length-1;se.value[a]&&se.value[a].focus()},0)})}function Se(a){n.value.items.length!==1&&n.value.items.splice(a,1)}const h=v([]),y=v([]);async function Ie(a){f.value=!0;try{const e=await k.get(`/api/items/by-fo-schedule/${a}`,{params:{region_id:B.value,outlet_id:C.value,exclude_supplier:!0}});h.value=e.data.items||[];const s={};h.value.forEach(o=>{const l=o.category_name&&o.category_name.trim()!==""?o.category_name:"Tanpa Kategori";s[o.category_id]||(s[o.category_id]={id:o.category_id,name:l,items:[]}),s[o.category_id].items.push({...o,qty:0,unit:o.unit_medium_name||o.unit_medium||o.unit_small||o.unit||"-",price:Q(o.price||0)})}),y.value=Object.values(s)}catch{h.value=[],y.value=[]}finally{f.value=!1}}function Re(a,e){if(!e||e.length<2){n.value.items[a].suggestions=[],n.value.items[a].highlightedIndex=-1;return}n.value.items[a].loading=!0;const s={q:e,outlet_id:C.value,region_id:B.value};k.get("/api/items/search",{params:s}).then(o=>{n.value.items[a].suggestions=o.data.items,n.value.items[a].showDropdown=!0,n.value.items[a].highlightedIndex=0,n.value.items[a].loading=!1}).catch(o=>{n.value.items[a].suggestions=[],n.value.items[a].showDropdown=!1,n.value.items[a].loading=!1})}function oe(a,e){var o;n.value.items[a].item_id=e.id,n.value.items[a].item_name=e.name,n.value.items[a].unit=e.unit_medium_name||e.unit_medium||e.unit_small||e.unit||"-";const s=e.price!==void 0?e.price:0;n.value.items[a].price=Q(s),n.value.items[a].qty="",n.value.items[a].subtotal=0,n.value.items[a].category_id=e.category_id,n.value.items[a].category_name=e.category_name||(((o=e.category)==null?void 0:o.name)??"Tanpa Kategori"),n.value.items[a].suggestions=[],n.value.items[a].showDropdown=!1,n.value.items[a].highlightedIndex=-1}function ne(a,e){const s=e.target.value;n.value.items[a].item_id="",n.value.items[a].item_name=s,n.value.items[a].showDropdown=!0,Re(a,s)}function Te(a){setTimeout(()=>{n.value.items[a].showDropdown=!1},200)}function H(a,e){const s=n.value.items[a];!s.showDropdown||!s.suggestions.length||(e.key==="ArrowDown"?(e.preventDefault(),s.highlightedIndex=(s.highlightedIndex+1)%s.suggestions.length):e.key==="ArrowUp"?(e.preventDefault(),s.highlightedIndex=(s.highlightedIndex-1+s.suggestions.length)%s.suggestions.length):e.key==="Enter"?(e.preventDefault(),s.highlightedIndex>=0&&s.suggestions[s.highlightedIndex]&&oe(a,s.suggestions[s.highlightedIndex])):e.key==="Escape"&&(s.showDropdown=!1))}function qe(a,e){const s=e.target.value.replace(/[^0-9.]/g,"");n.value.items[a].qty=s,Ce(a)}function Ce(a){const e=Number(n.value.items[a].price)||0,s=Number(n.value.items[a].qty)||0;n.value.items[a].subtotal=e*s}const U=v([]),J=v("");function De(a){U.value.includes(a)?U.value=U.value.filter(e=>e!==a):U.value.push(a)}function je(a){return J.value?a.items.filter(e=>e.name.toLowerCase().includes(J.value.toLowerCase())):a.items}function Be(a,e){if(m.value==="FO Tambahan"){let s=0;if(y.value.forEach(o=>{o.items.forEach(l=>{Number(l===a?e.replace(/[^0-9.]/g,""):l.qty)>0&&s++})}),s>6){S.fire({icon:"warning",title:"Maksimal 6 Item",text:"Anda hanya bisa input maksimal 6 item untuk RO Tambahan.",confirmButtonColor:"#3085d6"}),a.qty=0,ue();return}}a.qty=e.replace(/[^0-9.]/g,""),ue()}function ue(){const a=[];y.value.forEach(e=>{e.items.forEach(s=>{Number(s.qty)>0&&a.push({item_id:s.id,item_name:s.name,qty:s.qty,unit:s.unit_medium_name||s.unit_medium||s.unit_small||s.unit||"-",price:s.price,subtotal:(Number(s.qty)||0)*(Number(s.price)||0)})})}),n.value.items=a.length?a:[{item_id:"",item_name:"",qty:"",unit:"",price:0,subtotal:0,suggestions:[],showDropdown:!1,loading:!1,highlightedIndex:-1,_rowKey:Date.now()+"-"+Math.random()}]}const Ke=[{value:"RO Utama",label:"RO Utama"},{value:"RO Tambahan",label:"RO Tambahan"},{value:"RO Pengambilan",label:"RO Pengambilan"},{value:"RO Khusus",label:"RO Khusus"},{value:"RO Supplier",label:"RO Supplier"}],ie=()=>["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][new Date().getDay()];async function Me(){const a=T.value.find(s=>s.id==q.value);if(!q.value||!a){await S.fire({icon:"warning",title:"Pilih Warehouse Outlet",text:"Silakan pilih warehouse outlet terlebih dahulu sebelum memeriksa jadwal.",confirmButtonColor:"#3085d6"});return}if((await S.fire({icon:"question",title:"Konfirmasi Warehouse",html:`<div style='font-size:1.1em;'>Warehouse yang dipilih:<br><b>${a.name}</b><br><br>Apakah sudah benar?</div>`,showCancelButton:!0,confirmButtonText:"Ya, Benar",cancelButtonText:"Batal",focusCancel:!0,reverseButtons:!0})).isConfirmed){if(m.value==="RO Khusus"){if(O.value=!0,D.value=!1,I.value="",!y.value.length){f.value=!0;try{const s=await k.get("/api/items/by-fo-khusus",{params:{region_id:B.value,outlet_id:C.value,exclude_supplier:!0}});h.value=s.data.items||[];const o={};h.value.forEach(l=>{o[l.category_id]||(o[l.category_id]={id:l.category_id,name:l.category_name||"-",items:[]}),o[l.category_id].items.push({...l,qty:0})}),y.value=Object.values(o)}catch{h.value=[],y.value=[]}finally{f.value=!1}}return}if(m.value==="RO Supplier"){O.value=!0,D.value=!1,I.value="";try{const s=await k.get("/api/fo-schedules/check",{params:{fo_mode:m.value,day:ie(),region_id:B.value,outlet_id:C.value}});if(s.data.schedule&&s.data.schedule.is_active){const o=s.data.schedule.id;if(!h.value.length){f.value=!0;try{const l=await k.get(`/api/items/by-fo-schedule/${o}`,{params:{region_id:B.value,outlet_id:C.value}});h.value=l.data.items||[]}catch{h.value=[]}finally{f.value=!1}}if(!y.value.length){f.value=!0;try{const d=(await k.get(`/api/items/by-fo-schedule/${o}`,{params:{region_id:B.value,outlet_id:C.value}})).data.items||[],u={};d.forEach(p=>{const Y=p.category_name&&p.category_name.trim()!==""?p.category_name:"Tanpa Kategori";u[p.category_id]||(u[p.category_id]={id:p.category_id,name:Y,items:[]}),u[p.category_id].items.push({...p,qty:0,unit:p.unit_medium_name||p.unit_medium||p.unit_small||p.unit||"-",price:Q(p.price||0),subtotal:0})}),y.value=Object.values(u)}catch{y.value=[]}finally{f.value=!1}}}else{f.value=!0;try{const l=(await k.get("/api/items/by-fo-khusus",{params:{region_id:B.value,outlet_id:C.value}})).data.items||[];h.value=l;const d={};l.forEach(u=>{const p=u.category_name&&u.category_name.trim()!==""?u.category_name:"Tanpa Kategori";d[u.category_id]||(d[u.category_id]={id:u.category_id,name:p,items:[]}),d[u.category_id].items.push({...u,qty:0,unit:u.unit_medium_name||u.unit_medium||u.unit_small||u.unit||"-",price:Q(u.price||0),subtotal:0})}),y.value=Object.values(d)}catch{h.value=[],y.value=[]}finally{f.value=!1}}}catch(s){console.error("Error fetching schedule for RO Supplier:",s)}return}if(!m.value){I.value="Silakan pilih mode FO terlebih dahulu";return}L.value=!0,I.value="";try{const s=await k.get("/api/fo-schedules/check",{params:{fo_mode:m.value,day:ie(),region_id:B.value,outlet_id:C.value}});if(s.data.schedule)if(s.data.schedule.is_active){if((m.value==="RO Utama"||m.value==="RO Tambahan")&&(await k.post("/api/floor-order/check-exists",{tanggal:le.value,id_outlet:b.user.outlet.id_outlet,fo_mode:m.value,exclude_id:F.value,warehouse_outlet_id:q.value})).data.exists){S.fire({icon:"error",title:"Sudah Ada",text:`RO ${m.value} untuk hari ini sudah dibuat, tidak bisa membuat lagi. Edit RO Utama/RO Tambahan yang sudah ada jika ingin menambah pesanan.`,confirmButtonColor:"#3085d6"}),L.value=!1;return}R.value=s.data.schedule,n.value.fo_schedule_id=s.data.schedule.id,D.value=!0,O.value=!0}else I.value="Di luar jam operasional",D.value=!1,O.value=!1;else I.value="Tidak ada jadwal FO yang tersedia untuk hari ini",O.value=!1}catch{I.value="Gagal memeriksa jadwal RO",O.value=!1}finally{L.value=!1}}}async function Ee(){var a;(a=R.value)!=null&&a.id&&await Ie(R.value.id)}E(D,async a=>{var e;a&&((e=R.value)!=null&&e.id)&&await Ee()});function re(a){return a.items.reduce((e,s)=>e+(Number(s.price)||0)*(Number(s.qty)||0),0)}const $e=M(()=>y.value.reduce((a,e)=>a+re(e),0));async function Ne(){try{const a=await k.get("/api/fo-schedules/outlet-schedules",{params:{outlet_id:C.value,region_id:B.value}});z.value=a.data.schedules||[]}catch{z.value=[]}}E(I,a=>{a&&Ne()});const de=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Fe=M(()=>{const a={};return z.value.forEach(e=>{a[e.fo_mode]||(a[e.fo_mode]=[]),a[e.fo_mode].push(e)}),Object.keys(a).forEach(e=>{a[e]=a[e].slice().sort((s,o)=>de.indexOf(s.day)-de.indexOf(o.day))}),a});function Ae(a){const s=document.querySelectorAll('input[placeholder="Cari nama item..."]')[a];if(!s)return{};const o=s.getBoundingClientRect();return{left:o.left+"px",top:o.bottom+"px",width:o.width+"px",position:"fixed",zIndex:9999}}function Ue(a){const e=Number(a.price)||0,s=Number(a.qty)||0,o=e*s;return a.subtotal=o,o}const ce=M(()=>n.value.items.reduce((a,e)=>{const s=Number(e.price)||0,o=Number(e.qty)||0;return a+s*o},0));E(m,async a=>{if(a==="FO Khusus"){O.value=!0,D.value=!1,I.value="",f.value=!0;try{const e=await k.get("/api/items/by-fo-khusus",{params:{region_id:B.value,outlet_id:C.value,exclude_supplier:!0}});h.value=e.data.items||[];const s={};h.value.forEach(o=>{s[o.category_id]||(s[o.category_id]={id:o.category_id,name:o.category_name||"-",items:[]}),s[o.category_id].items.push({...o,qty:0})}),y.value=Object.values(s)}catch{h.value=[],y.value=[]}finally{f.value=!1}}});const We=M(()=>{let a=0;return y.value.forEach(e=>{e.items.forEach(s=>{Number(s.qty)>0&&a++})}),a>=6});async function Le(){try{const a=await k.get("/api/item-schedules/today");P.value=a.data.schedules||[],P.value.length>0?N.value="Item berikut wajib diorder hari ini: "+P.value.map(e=>e.item_name).join(", "):N.value=""}catch{P.value=[],N.value=""}}E(O,a=>{a&&Le()});function me(a){return P.value.some(e=>e.item_id==a)}function ve(a){if(j.value==="pc"&&O.value&&a.key==="F1"){a.preventDefault();const s=`item-input-${n.value.items.length-1}`,o=document.getElementById(s);o&&(o.focus(),o.select(),o.style.outline="2px solid #2563eb",o.style.boxShadow="0 0 0 2px rgba(37, 99, 235, 0.2)",setTimeout(()=>{o.style.outline="",o.style.boxShadow=""},1e3))}}Qe(()=>{window.addEventListener("keydown",ve),He()}),Ye(()=>{window.removeEventListener("keydown",ve)});function W(a){return a?"Rp "+Number(a).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2}):"Rp 0"}function Q(a){return!a||a<=0?0:Math.ceil(a/100)*100}let ge=null;function Pe(){clearTimeout(ge),ge=setTimeout(()=>{const a=n.value.items.map(e=>({item_id:e.item_id,item_name:e.item_name,qty:e.qty,unit:e.unit,price:e.price,subtotal:e.subtotal,category_id:e.category_id,category_name:e.category_name}));F.value&&k.put(`/floor-order/${F.value}`,{...n.value,items:a,fo_schedule_id:n.value.fo_schedule_id,warehouse_outlet_id:n.value.warehouse_outlet_id})},2e3)}E(n,Pe,{deep:!0}),E([O,D],([a,e])=>{if(a&&!e&&!F.value){const s=n.value.items.map(o=>({item_id:o.item_id,item_name:o.item_name,qty:o.qty,unit:o.unit,price:o.price,subtotal:o.subtotal,category_id:o.category_id,category_name:o.category_name}));k.post("/floor-order",{...n.value,items:s,fo_mode:m.value,input_mode:j.value,fo_schedule_id:n.value.fo_schedule_id,warehouse_outlet_id:n.value.warehouse_outlet_id}).then(ze)}});function Ve(){if(!n.value.arrival_date){ee.value=!0,S.fire({icon:"error",title:"Tanggal Kedatangan Wajib Diisi",text:"Silakan pilih tanggal kedatangan barang sebelum mengirim RO.",confirmButtonColor:"#3085d6"});return}if(!F.value){S.fire({icon:"error",title:"Tidak Bisa Submit",text:"Draft Order belum tersimpan. Silakan tunggu beberapa detik atau pastikan koneksi Anda stabil."});return}S.fire({icon:"question",title:"Konfirmasi Kirim RO",html:'<div style="font-size:1.1em;">Setelah dikirim, RO tidak dapat diubah.<br><br><b>Apakah Anda yakin ingin mengirim RO ini?</b></div>',showCancelButton:!0,confirmButtonText:"Ya, Kirim",cancelButtonText:"Batal",focusCancel:!0,reverseButtons:!0}).then(a=>{a.isConfirmed&&(V.value=!0,S.fire({title:"Mengirim...",text:"Mohon tunggu, RO sedang diproses.",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>{S.showLoading()}}),k.post(`/floor-order/${F.value}/submit`).then(()=>{V.value=!1,S.close(),G.value=!1,S.fire({icon:"success",title:"Berhasil!",text:"Floor Order berhasil dikirim.",confirmButtonColor:"#3085d6"}).then(()=>{lt.visit("/floor-order")})}).catch(e=>{var o,l;V.value=!1,S.close();const s=((l=(o=e.response)==null?void 0:o.data)==null?void 0:l.message)||"Terjadi kesalahan saat mengirim RO.";S.fire({icon:"error",title:"Gagal",text:s,confirmButtonText:"OK"})}))})}function ze(a){a&&a.data&&a.data.data&&a.data.data.floor_order_id&&(F.value=a.data.data.floor_order_id)}E(y,a=>{if(b.order&&j.value==="tab"&&Array.isArray(b.order.items)){const e={};b.order.items.forEach(s=>{e[s.item_id]=s.qty}),y.value.forEach(s=>{s.items.forEach(o=>{o.qty=e[o.id]||0})})}},{immediate:!0});const pe=M(()=>{const a={};return n.value.items.forEach(e=>{const s=e.category_name&&e.category_name.trim()!==""?e.category_name:e.category&&e.category.name?e.category.name:"Tanpa Kategori";a[s]||(a[s]=[]),a[s].push(e)}),a}),Ge=M(()=>{const a={};return Object.entries(pe.value).forEach(([e,s])=>{a[e]=s.reduce((o,l)=>o+(Number(l.subtotal)||0),0)}),a});async function He(){if(C.value)try{const a=await k.get("/api/warehouse-outlets",{params:{outlet_id:C.value,status:"active"}});T.value=Array.isArray(a.data)?a.data:[],T.value.length===1&&(q.value=T.value[0].id)}catch{T.value=[]}}return E(q,a=>{n.value.warehouse_outlet_id=a}),(a,e)=>(i(),ye(st,null,{default:Ze(()=>{var s,o;return[t("div",ot,[t("div",nt,[t("button",{onClick:e[0]||(e[0]=l=>a.$inertia.visit("/floor-order")),class:"text-blue-500 hover:underline"},e[15]||(e[15]=[t("i",{class:"fa fa-arrow-left"},null,-1),_(" Kembali")])),e[16]||(e[16]=t("h1",{class:"text-2xl font-bold text-gray-800 flex items-center gap-2 ml-4"},[t("i",{class:"fa-solid fa-calendar-check text-blue-500"}),_(" Buat Request Order (RO) ")],-1))]),(o=(s=b.user)==null?void 0:s.outlet)!=null&&o.nama_outlet?(i(),r("div",ut,[t("div",it,[e[17]||(e[17]=t("i",{class:"fa fa-store"},null,-1)),e[18]||(e[18]=_(" Outlet Anda: ")),t("span",rt,c(b.user.outlet.nama_outlet),1)])])):g("",!0),t("div",dt,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Mode Request Order (RO)",-1)),t("div",ct,[(i(),r(x,null,w(Ke,l=>t("button",{key:l.value,class:$(["px-4 py-2 rounded-lg font-semibold transition-all",m.value===l.value?"bg-blue-600 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"]),onClick:d=>m.value=l.value},c(l.label),11,mt)),64))])]),t("div",vt,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Pilih Warehouse Outlet",-1)),K(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>q.value=l),class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:T.value.length>1},[e[20]||(e[20]=t("option",{value:"",disabled:""},"Pilih Warehouse",-1)),(i(!0),r(x,null,w(T.value,l=>(i(),r("option",{key:l.id,value:l.id},c(l.name),9,pt))),128))],8,gt),[[ae,q.value]])]),t("div",bt,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[_("Tanggal Kedatangan "),t("span",{class:"text-red-500"},"*")],-1)),K(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=l=>n.value.arrival_date=l),class:$(["w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",{"border-red-500":!n.value.arrival_date&&ee.value}]),required:""},null,2),[[A,n.value.arrival_date]]),e[23]||(e[23]=t("p",{class:"mt-1 text-sm text-gray-500"},"Pilih tanggal kapan barang diharapkan tiba",-1)),!n.value.arrival_date&&ee.value?(i(),r("p",ft,"Tanggal kedatangan wajib diisi")):g("",!0)]),m.value&&!L.value?(i(),r("div",yt,[t("button",{onClick:Me,disabled:!m.value,class:"px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors"},e[24]||(e[24]=[t("i",{class:"fas fa-calendar-check mr-2"},null,-1),_(" Periksa Jadwal FO ")]),8,ht)])):g("",!0),L.value?(i(),r("div",_t,e[25]||(e[25]=[t("i",{class:"fas fa-spinner fa-spin text-blue-500 text-2xl"},null,-1),t("p",{class:"mt-2 text-gray-600"},"Memeriksa jadwal RO...",-1)]))):g("",!0),I.value&&m.value!=="RO Khusus"&&m.value!=="RO Supplier"?(i(),r("div",xt,[t("div",wt,[e[26]||(e[26]=t("div",{class:"flex-shrink-0"},[t("i",{class:"fas fa-exclamation-circle text-red-500"})],-1)),t("div",kt,[t("p",Ot,c(I.value),1)])])])):g("",!0),z.value.length&&m.value!=="RO Khusus"&&m.value!=="RO Supplier"?(i(),r("div",St,[e[29]||(e[29]=t("div",{class:"font-semibold text-gray-700 mb-1"},"Jadwal RO Outlet Anda:",-1)),(i(!0),r(x,null,w(Fe.value,(l,d)=>(i(),r("div",{key:d,class:"mb-3"},[t("div",It,c(d),1),t("ul",Rt,[(i(!0),r(x,null,w(l,u=>(i(),r("li",{key:u.id,class:"mb-1"},[t("span",Tt,c(u.day),1),t("span",qt,c(u.open_time)+" - "+c(u.close_time),1),u.warehouse_divisions&&u.warehouse_divisions.length?(i(),r("span",Ct,[e[27]||(e[27]=_(" [")),(i(!0),r(x,null,w(u.warehouse_divisions,(p,Y)=>(i(),r("span",{key:p.id},[_(c(p.name),1),Y<u.warehouse_divisions.length-1?(i(),r("span",Dt,", ")):g("",!0)]))),128)),e[28]||(e[28]=_("] "))])):g("",!0)]))),128))])]))),128))])):g("",!0),D.value?(i(),r("div",jt,[t("div",Bt,[t("div",Kt,[e[31]||(e[31]=t("h3",{class:"text-xl font-bold text-gray-800"},"Jadwal RO Tersedia",-1)),t("button",{onClick:e[3]||(e[3]=l=>D.value=!1),class:"text-gray-500 hover:text-gray-700"},e[30]||(e[30]=[t("i",{class:"fas fa-times"},null,-1)]))]),R.value?(i(),r("div",Mt,[t("div",Et,[t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-600"},"Mode RO",-1)),t("p",$t,c(R.value.fo_mode),1)]),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium text-gray-600"},"Hari",-1)),t("p",Nt,c(R.value.day),1)]),t("div",null,[e[34]||(e[34]=t("label",{class:"block text-sm font-medium text-gray-600"},"Jam Operasional",-1)),t("p",Ft,c(R.value.open_time)+" - "+c(R.value.close_time),1)])]),t("div",At,[e[35]||(e[35]=t("h4",{class:"font-semibold text-gray-800 mb-2"},"Warehouse Division",-1)),t("div",Ut,[(i(!0),r(x,null,w(R.value.warehouse_divisions,l=>(i(),r("span",{key:l.id,class:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm"},c(l.name),1))),128))])]),t("div",Wt,[e[36]||(e[36]=t("h4",{class:"font-semibold text-gray-800 mb-2"},"Region",-1)),t("div",Lt,[(i(!0),r(x,null,w(R.value.regions,l=>(i(),r("span",{key:l.id,class:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm"},c(l.name),1))),128))])]),t("div",Pt,[e[37]||(e[37]=t("h4",{class:"font-semibold text-gray-800 mb-2"},"Outlet",-1)),t("div",Vt,[(i(!0),r(x,null,w(R.value.outlets,l=>(i(),r("span",{key:l.id_outlet,class:"px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm"},c(l.nama_outlet),1))),128))])]),t("div",zt,[t("button",{onClick:e[4]||(e[4]=l=>D.value=!1),class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300"}," Batal "),t("button",{onClick:e[5]||(e[5]=l=>D.value=!1),class:"px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700"}," Lanjutkan ")])])):g("",!0)])])):g("",!0),O.value?(i(),r("div",Gt,[t("button",{class:$(["px-4 py-2 rounded-lg font-semibold",j.value==="pc"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"]),onClick:e[6]||(e[6]=l=>j.value="pc")},"Mode PC",2),t("button",{class:$(["px-4 py-2 rounded-lg font-semibold",j.value==="tab"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"]),onClick:e[7]||(e[7]=l=>j.value="tab")},"Mode Tab",2)])):g("",!0),j.value==="pc"&&O.value?(i(),r("div",Ht,[!I.value||I.value!=="Di luar jam operasional"?(i(),r("div",Jt,[N.value?(i(),r("div",Qt,c(N.value),1)):g("",!0),m.value==="RO Supplier"&&h.value.length>0?(i(),r("div",Yt,[e[38]||(e[38]=t("strong",null,"Info Jadwal RO Supplier:",-1)),_(" "+c(h.value.length)+" item tersedia sesuai jadwal hari ini. Item yang wajib diorder hari ini akan ditandai dengan background hijau (Anda tetap bisa memilih item lain). ",1)])):g("",!0),f.value?(i(),r("div",Zt,e[39]||(e[39]=[t("i",{class:"fas fa-spinner fa-spin text-blue-500 text-2xl"},null,-1),t("p",{class:"mt-2 text-gray-600"},"Memuat data item...",-1)]))):(i(),r("div",Xt,[t("div",ea,[t("div",null,[e[40]||(e[40]=t("label",{class:"block text-sm font-medium text-gray-700"},"Tanggal",-1)),K(t("input",{type:"date","onUpdate:modelValue":e[8]||(e[8]=l=>n.value.tanggal=l),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500",readonly:""},null,512),[[A,n.value.tanggal]])]),t("div",null,[e[42]||(e[42]=t("label",{class:"block text-sm font-medium text-gray-700"},"Warehouse Outlet",-1)),K(t("select",{"onUpdate:modelValue":e[9]||(e[9]=l=>q.value=l),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:T.value.length>1},[e[41]||(e[41]=t("option",{value:"",disabled:""},"Pilih Warehouse",-1)),(i(!0),r(x,null,w(T.value,l=>(i(),r("option",{key:l.id,value:l.id},c(l.name),9,aa))),128))],8,ta),[[ae,q.value]])])]),t("div",la,[e[43]||(e[43]=t("label",{class:"block text-sm font-medium text-gray-700"},"Keterangan",-1)),K(t("input",{type:"text","onUpdate:modelValue":e[10]||(e[10]=l=>n.value.description=l),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500",disabled:f.value},null,8,sa),[[A,n.value.description]])]),O.value&&T.value.length?(i(),r("div",oa,[e[45]||(e[45]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Pilih Warehouse Outlet",-1)),K(t("select",{"onUpdate:modelValue":e[11]||(e[11]=l=>q.value=l),class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},[e[44]||(e[44]=t("option",{value:""},"Pilih Warehouse",-1)),(i(!0),r(x,null,w(T.value,l=>(i(),r("option",{key:l.id,value:l.id},c(l.name),9,na))),128))],512),[[ae,q.value]])])):g("",!0),t("div",null,[e[49]||(e[49]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Detail Item",-1)),t("div",ua,[t("table",ia,[e[47]||(e[47]=t("thead",{class:"bg-gradient-to-r from-blue-50 to-blue-100"},[t("tr",null,[t("th",{class:"px-3 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Item"),t("th",{class:"px-3 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Qty"),t("th",{class:"px-3 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Unit"),t("th",{class:"px-3 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Harga"),t("th",{class:"px-3 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Subtotal"),t("th",{class:"px-3 py-2"})])],-1)),t("tbody",null,[(i(!0),r(x,null,w(n.value.items,(l,d)=>(i(),r("tr",{key:l._rowKey||d,class:$({"bg-lime-100 border-2 border-lime-500":me(l.item_id)})},[t("td",ra,[t("div",da,[K(t("input",{ref_for:!0,ref:"el => itemInputRefs.value[idx] = el",type:"text","onUpdate:modelValue":u=>l.item_name=u,onInput:u=>ne(d,u),onFocus:u=>ne(d,u),onBlur:u=>Te(d),onKeydown:[Z(u=>H(d,u),["down"]),Z(u=>H(d,u),["up"]),Z(u=>H(d,u),["enter"]),Z(u=>H(d,u),["esc"])],class:"w-full rounded border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:"",autocomplete:"off",placeholder:"Cari nama item...",disabled:f.value,id:`item-input-${d}`},null,40,ca),[[A,l.item_name]]),(i(),ye(Xe,{to:"body"},[l.showDropdown&&l.suggestions&&l.suggestions.length>0?(i(),r("div",{key:0,style:et(Ae(d)),id:`autocomplete-dropdown-${d}`,class:"fixed z-[9999] bg-white border border-blue-200 rounded shadow max-w-xs w-[220px] max-h-60 overflow-auto mt-1"},[(i(!0),r(x,null,w(l.suggestions,(u,p)=>(i(),r("div",{key:u.id,onMousedown:tt(Y=>oe(d,u),["prevent"]),class:$(["px-3 py-2 flex justify-between items-center cursor-pointer",l.highlightedIndex===p?"bg-blue-100":"hover:bg-blue-50"])},[t("div",ga,c(u.name),1),t("div",pa,c(u.unit),1)],42,va))),128))],12,ma)):g("",!0)]))])]),t("td",ba,[t("input",{type:"number",min:"0.01",step:"0.01",value:l.qty,onInput:u=>qe(d,u),class:"w-full rounded border-gray-300",required:"",disabled:f.value},null,40,fa)]),t("td",ya,[K(t("input",{type:"text","onUpdate:modelValue":u=>l.unit=u,class:"w-full rounded border-gray-300 bg-gray-100",readonly:""},null,8,ha),[[A,l.unit]])]),t("td",_a,c(W(l.price)),1),t("td",xa," Rp "+c(Ue(l).toLocaleString("id-ID")),1),t("td",wa,[t("button",{type:"button",onClick:u=>Se(d),class:"text-red-500 hover:text-red-700",disabled:n.value.items.length===1||f.value},e[46]||(e[46]=[t("i",{class:"fa fa-trash"},null,-1)]),8,ka)])],2))),128))])])]),t("button",{type:"button",onClick:Oe,class:"mt-2 px-3 py-1 rounded bg-blue-100 text-blue-700 font-semibold hover:bg-blue-200",disabled:f.value},e[48]||(e[48]=[t("i",{class:"fa fa-plus"},null,-1),_(" Tambah Item")]),8,Oa)]),t("div",Sa," Grand Total: Rp "+c(ce.value.toLocaleString("id-ID")),1)]))])):g("",!0)])):j.value==="tab"&&O.value?(i(),r("div",Ia,[t("div",Ra,[m.value==="FO Tambahan"?(i(),r("div",Ta,e[50]||(e[50]=[t("b",null,"Notes:",-1),_(" Hanya dapat order 6 item ")]))):g("",!0),t("div",qa,[K(t("input",{"onUpdate:modelValue":e[12]||(e[12]=l=>J.value=l),type:"text",placeholder:"Cari item...",class:"input w-full max-w-xs"},null,512),[[A,J.value]]),e[51]||(e[51]=t("i",{class:"fa fa-search text-gray-400"},null,-1))]),t("div",null,[N.value?(i(),r("div",Ca,c(N.value),1)):g("",!0),m.value==="RO Supplier"&&h.value.length>0?(i(),r("div",Da,[e[52]||(e[52]=t("strong",null,"Info Jadwal RO Supplier:",-1)),_(" "+c(h.value.length)+" item tersedia sesuai jadwal hari ini. Item yang wajib diorder hari ini akan ditandai dengan background hijau (Anda tetap bisa memilih item lain). ",1)])):g("",!0),f.value?(i(),r("div",ja,e[53]||(e[53]=[t("i",{class:"fas fa-spinner fa-spin text-blue-500 text-2xl"},null,-1),t("p",{class:"mt-2 text-gray-600"},"Memuat data item...",-1)]))):(i(!0),r(x,{key:3},w(y.value,l=>(i(),r("div",{key:l.id,class:"mb-4 border rounded-xl overflow-hidden"},[t("div",{onClick:d=>De(l.id),class:"flex items-center justify-between px-4 py-3 bg-blue-50 cursor-pointer select-none"},[t("span",Ka,c(l.name)+" (Rp "+c(re(l).toLocaleString("id-ID"))+") ",1),t("i",{class:$(U.value.includes(l.id)?"fa fa-chevron-up":"fa fa-chevron-down")},null,2)],8,Ba),U.value.includes(l.id)?(i(),r("div",Ma,[l.items&&l.items.length?(i(),r("table",Ea,[e[54]||(e[54]=t("thead",null,[t("tr",{class:"text-blue-700"},[t("th",{class:"py-2 text-left"},"Item"),t("th",{class:"py-2 text-left"},"Unit"),t("th",{class:"py-2 text-left"},"Harga/Medium"),t("th",{class:"py-2 text-left"},"Qty"),t("th",{class:"py-2 text-left"},"Subtotal")])],-1)),t("tbody",null,[(i(!0),r(x,null,w(je(l),d=>(i(),r("tr",{key:d.id,class:$({"bg-lime-100 border-2 border-lime-500":me(d.id)})},[t("td",$a,c(d.name),1),t("td",Na,c(d.unit_medium_name||d.unit_medium||d.unit||"-"),1),t("td",Fa,c(W(d.price)),1),t("td",Aa,[K(t("input",{type:"number",min:"0",class:"w-20 rounded border-gray-300","onUpdate:modelValue":u=>d.qty=u,onInput:u=>Be(d,u.target.value),disabled:We.value&&Number(d.qty)===0&&m.value==="FO Tambahan"},null,40,Ua),[[A,d.qty]])]),t("td",Wa,"Rp "+c(((d.price||0)*(Number(d.qty)||0)).toLocaleString("id-ID")),1)],2))),128))])])):(i(),r("div",La,"Tidak ada item"))])):g("",!0)]))),128))]),t("div",Pa," Grand Total: Rp "+c($e.value.toLocaleString("id-ID")),1)])])):g("",!0),t("button",{onClick:e[13]||(e[13]=l=>G.value=!0),class:"mt-8 px-6 py-2 rounded bg-blue-600 text-white font-bold text-lg hover:bg-blue-700"},"Submit"),G.value?(i(),r("div",Va,[t("div",za,[e[60]||(e[60]=t("h2",{class:"text-xl font-bold mb-4"},"Preview Request Order (RO)",-1)),t("div",Ga,[e[55]||(e[55]=t("b",null,"Tanggal:",-1)),_(" "+c(n.value.tanggal),1)]),t("div",Ha,[e[56]||(e[56]=t("b",null,"Warehouse Outlet:",-1)),_(" "+c((T.value.find(l=>l.id==q.value)||{}).name||"-"),1)]),t("div",Ja,[e[57]||(e[57]=t("b",null,"Keterangan:",-1)),_(" "+c(n.value.description),1)]),e[61]||(e[61]=t("div",{class:"mb-2"},[t("b",null,"Items:")],-1)),t("div",Qa,[(i(!0),r(x,null,w(pe.value,(l,d)=>(i(),r("div",{key:d,class:"mb-2"},[t("div",Ya,c(d),1),t("table",Za,[e[58]||(e[58]=t("thead",null,[t("tr",null,[t("th",null,"Item"),t("th",null,"Qty"),t("th",null,"Unit"),t("th",null,"Harga"),t("th",null,"Subtotal")])],-1)),t("tbody",null,[(i(!0),r(x,null,w(l,u=>(i(),r("tr",{key:u._rowKey||u.id},[t("td",null,c(u.item_name),1),t("td",null,c(u.qty),1),t("td",null,c(u.unit),1),t("td",null,c(W(u.price)),1),t("td",null,c(W(u.subtotal)),1)]))),128)),t("tr",Xa,[t("td",el,"Total "+c(d),1),t("td",null,c(W(Ge.value[d])),1)])])])]))),128))]),t("div",tl,"Grand Total: "+c(W(ce.value)),1),t("div",al,[t("button",{onClick:e[14]||(e[14]=l=>G.value=!1),class:"px-4 py-2 bg-gray-200 rounded"},"Batal"),t("button",{onClick:Ve,class:"px-4 py-2 bg-blue-600 text-white rounded",disabled:V.value},[V.value?(i(),r("span",sl,e[59]||(e[59]=[t("i",{class:"fa fa-spinner fa-spin"},null,-1),_(" Mengirim...")]))):(i(),r("span",ol,"Kirim"))],8,ll)])])])):g("",!0)])]}),_:1}))}};export{bl as default};
