import{r as d,a as oe,w as S,L as u,B as n,D as a,A as ie,E as T,N as s,O as se,H as _,J as D,G as M,I as j,F as b,M as g,l as re}from"./vendor-vue-g7iCcTkf.js";import{a as $}from"./vendor-utils-CpgP2uT4.js";import{u as ne,S as c}from"./app-BgZdqVzD.js";import ue from"./CameraModal-UOq4SzNh.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-charts-CuqD4wLC.js";const ce={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/40"},pe={class:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-2xl relative animate-fadeIn overflow-y-auto max-h-screen"},fe={class:"text-xl font-bold mb-4 text-gray-700"},me={class:"mb-4"},ve={class:"block text-sm font-semibold mb-1"},be=["placeholder"],ge={class:"mb-4"},he={class:"block text-sm font-semibold mb-1"},ye=["placeholder"],ke={class:"mb-4 flex gap-4"},xe={class:"flex-1"},_e={class:"block text-sm font-semibold mb-1 flex items-center gap-2"},we={value:""},Ce=["value"],$e={class:"flex-1"},Ee={class:"block text-sm font-semibold mb-1"},Ie={value:""},Ue=["value"],De={class:"mb-4"},Me={class:"block text-sm font-semibold mb-1"},Be={class:"mb-4"},Pe={class:"block text-sm font-semibold mb-1"},Le={class:"flex gap-2 mb-2"},Re={class:"flex gap-2 flex-wrap mt-2"},Se=["src"],Te=["onClick"],je={class:"flex gap-2 flex-wrap mt-2"},Fe=["src"],Oe=["onClick"],Ve={class:"mb-4"},Ae={class:"block text-sm font-semibold mb-1"},Ne={class:"flex gap-2 flex-wrap mt-2"},Ge=["src"],Ke=["src"],We=["onClick"],ze={class:"mb-4"},He={class:"block text-sm font-semibold mb-1"},Je={class:"flex gap-2 flex-wrap mt-2"},qe={class:"truncate max-w-[120px]"},Ye=["onClick"],Qe={class:"flex justify-end gap-2 mt-6"},Xe={type:"submit",class:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700"},Ze={__name:"CreateTaskModal",props:{outlet:[String,Number],ruko:[String,Number]},emits:["close","taskCreated"],setup(F,{emit:O}){$.defaults.withCredentials=!0;const B=F,w=O,{t:V}=ne(),o=d({title:"",description:"",category:"",priority:"",due_date:"",id_outlet:"",id_ruko:""}),P=d([]),E=d([]),m=d([]),p=d([]),h=d([]),y=d([]),I=d(null),U=d(null),k=d(!1),x=d("photo");oe(async()=>{P.value=(await $.get("/api/maintenance-labels")).data,E.value=(await $.get("/api/maintenance-priorities")).data,S(()=>B.outlet,e=>{o.value.id_outlet=e},{immediate:!0}),S(()=>B.ruko,e=>{o.value.id_ruko=e},{immediate:!0})});async function A(){const e=E.value.find(t=>t.id==o.value.priority);if(!e)return;if((await c.fire({title:`${e.priority} - ${e.max_days} hari`,html:`<div class='mb-2'>${e.description}</div><div class='text-xs text-gray-500 mt-2'>${V("create_task.wise_priority")}</div>`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No"})).isConfirmed){const t=new Date;t.setDate(t.getDate()+e.max_days),o.value.due_date=t.toISOString().slice(0,10)}else o.value.priority="",o.value.due_date=""}function N(e){switch(e){case"ToDo":return"TASK";case"InProgress":return"IN_PROGRESS";case"InReview":return"IN_REVIEW";case"Done":return"DONE";default:return e}}async function G(){var e,l;if(!o.value.id_outlet){c.fire("Error","Pilih outlet terlebih dahulu!","error");return}if(o.value.id_outlet==1&&!o.value.id_ruko){c.fire("Error","Pilih ruko terlebih dahulu!","error");return}if(!o.value.title){c.fire("Error","Judul task harus diisi!","error");return}if(!o.value.category){c.fire("Error","Kategori harus dipilih!","error");return}if(!o.value.priority){c.fire("Error","Prioritas harus dipilih!","error");return}if(!o.value.due_date){c.fire("Error","Due date harus diisi!","error");return}try{const t=new FormData;t.append("title",o.value.title),t.append("description",o.value.description),t.append("category",o.value.category),t.append("priority",o.value.priority),t.append("due_date",o.value.due_date),t.append("id_outlet",o.value.id_outlet||""),t.append("id_ruko",o.value.id_ruko||""),t.append("status",N("ToDo")),m.value.forEach((r,v)=>{const f=K(r,`photo_${v}.png`);f&&t.append("media[]",f)}),p.value.forEach((r,v)=>{if(r.blob instanceof Blob){const f=new File([r.blob],`video_${v}.webm`,{type:"video/webm"});t.append("media[]",f)}}),h.value.forEach(r=>{r.file instanceof File&&t.append("media[]",r.file)}),y.value.forEach(r=>{t.append("documents[]",r)});const i=await $.post("/api/maintenance-order",t,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0});if(i.data.success)W(),w("taskCreated"),w("close"),c.fire({title:"Sukses",text:"Task berhasil dibuat",icon:"success",timer:1500,showConfirmButton:!1});else throw new Error(i.data.error||"Gagal membuat task")}catch(t){console.error("Error creating task:",t),c.fire("Gagal",((l=(e=t.response)==null?void 0:e.data)==null?void 0:l.error)||t.message||"Gagal membuat task","error")}}function K(e,l){if(!e||typeof e!="string"||!e.includes(","))return null;var t=e.split(","),i=t[0].match(/:(.*?);/)[1],r=atob(t[1]),v=r.length,f=new Uint8Array(v);for(let C=0;C<v;++C)f[C]=r.charCodeAt(C);return new File([f],l,{type:i})}function W(){o.value.title="",o.value.description="",o.value.category="",o.value.priority="",o.value.due_date="",m.value=[],p.value.forEach(e=>{e.url&&URL.revokeObjectURL(e.url)}),p.value=[],h.value=[],y.value=[]}function L(e){const l=e.name.split(".").pop().toLowerCase();return["pdf"].includes(l)?{icon:"fa-file-pdf",color:"text-red-500"}:["doc","docx"].includes(l)?{icon:"fa-file-word",color:"text-blue-500"}:["xls","xlsx","csv"].includes(l)?{icon:"fa-file-excel",color:"text-green-500"}:{icon:"fa-file",color:"text-gray-400"}}function z(){R()?I.value&&I.value.click():(x.value="photo",k.value=!0)}function H(){R()?U.value&&U.value.click():(x.value="video",k.value=!0)}function J(e){for(const l of e.target.files){const t=new FileReader;t.onload=i=>m.value.push(i.target.result),t.readAsDataURL(l)}e.target.value=""}function q(e){for(const l of e.target.files){const t=URL.createObjectURL(l);p.value.push({blob:l,url:t})}e.target.value=""}function Y(e){m.value.splice(e,1)}function Q(e){var l;(l=p.value[e])!=null&&l.url&&URL.revokeObjectURL(p.value[e].url),p.value.splice(e,1)}function X(e){for(const l of e.target.files){const t=URL.createObjectURL(l);h.value.push({url:t,type:l.type,name:l.name,file:l})}e.target.value=""}function Z(e){h.value.splice(e,1)}function ee(e){for(const l of e.target.files)y.value.push(l);e.target.value=""}function te(e){y.value.splice(e,1)}function ae(e){x.value==="photo"?m.value.push(e):x.value==="video"&&p.value.push({blob:e,url:URL.createObjectURL(e)}),k.value=!1}function R(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function le(){c.fire({title:"Kategori Maintenance",html:`
      <div style='text-align:left'>
        <b>1. Mechanical</b><br>
        <span class='text-xs text-gray-500'>Berkaitan dengan sistem mekanis</span>
        <ul style='margin-left:1em; margin-bottom:0.5em'>
          <li>Genset</li>
          <li>Mesin Pompa Air</li>
          <li>Kitchen Exhaust Hood</li>
          <li>AC</li>
          <li>Dan lain-lain</li>
        </ul>
        <b>2. Electrical</b><br>
        <span class='text-xs text-gray-500'>Berkaitan dengan sistem kelistrikan dan elektronika</span>
        <ul style='margin-left:1em; margin-bottom:0.5em'>
          <li>Lampu</li>
          <li>Panel Listrik</li>
          <li>Stop Kontak</li>
          <li>Instalasi Kelistrikan</li>
          <li>Dan lain-lain</li>
        </ul>
        <b>3. Plumbing</b><br>
        <span class='text-xs text-gray-500'>Berkaitan dengan sistem perpipaan dalam suatu bangunan, mencakup instalasi saluran air bersih, air kotor, limbah, drainase, dan termasuk sistem gas</span>
        <ul style='margin-left:1em; margin-bottom:0.5em'>
          <li>Air Bersih / Kotor / IPAL</li>
          <li>Gas</li>
          <li>Toilet</li>
          <li>Water Toren</li>
          <li>Instalasi Pipa Air</li>
          <li>Dan lain-lain</li>
        </ul>
        <b>4. Machinery</b><br>
        <span class='text-xs text-gray-500'>Berkaitan dengan sistem pada penggunaan, pengoperasian, perawatan, dan pengelolaan mesin</span>
        <ul style='margin-left:1em; margin-bottom:0.5em'>
          <li>Grill</li>
          <li>Stove</li>
          <li>Fryer</li>
          <li>Chiller / Freezer</li>
          <li>Oven</li>
          <li>Microwave</li>
          <li>Warmer</li>
          <li>Dan lain-lain</li>
        </ul>
        <b>5. Civil</b><br>
        <span class='text-xs text-gray-500'>Berkaitan dengan sistem konstruksi sipil, mencakup struktur fisik seperti pondasi, rangka bangunan, jalan, dan infrastruktur lainnya.</span>
        <ul style='margin-left:1em; margin-bottom:0.5em'>
          <li>Furniture</li>
          <li>Infrastruktur Bangunan</li>
          <li>Interior / Exterior</li>
          <li>Dan lain-lain</li>
        </ul>
        <b>6. Others</b><br>
        <span class='text-xs text-gray-500'>Pekerjaan lainnya, diluar 5 kategori diatas</span>
      </div>
    `,width:600,confirmButtonText:"Tutup",customClass:{htmlContainer:"text-left"}})}return(e,l)=>(n(),u("div",ce,[a("div",pe,[a("button",{onClick:l[0]||(l[0]=t=>w("close")),class:"absolute top-3 right-3 text-gray-400 hover:text-red-500 text-xl"},l[8]||(l[8]=[a("i",{class:"fas fa-times"},null,-1)])),a("h2",fe,s(e.$t("create_task.title")),1),a("form",{onSubmit:se(G,["prevent"])},[a("div",me,[a("label",ve,s(e.$t("create_task.finding_problem")),1),_(a("input",{"onUpdate:modelValue":l[1]||(l[1]=t=>o.value.title=t),type:"text",class:"w-full border rounded p-2",placeholder:e.$t("create_task.finding_problem")},null,8,be),[[D,o.value.title]])]),a("div",ge,[a("label",he,s(e.$t("create_task.description")),1),_(a("textarea",{"onUpdate:modelValue":l[2]||(l[2]=t=>o.value.description=t),class:"w-full border rounded p-2",placeholder:e.$t("create_task.description")},null,8,ye),[[D,o.value.description]])]),a("div",ke,[a("div",xe,[a("label",_e,[M(s(e.$t("create_task.categories"))+" ",1),a("button",{type:"button",onClick:le,class:"text-blue-500 hover:text-blue-700"},l[9]||(l[9]=[a("i",{class:"fas fa-info-circle"},null,-1)]))]),_(a("select",{"onUpdate:modelValue":l[3]||(l[3]=t=>o.value.category=t),class:"w-full border rounded p-2"},[a("option",we,s(e.$t("create_task.select_category")),1),(n(!0),u(b,null,g(P.value,t=>(n(),u("option",{key:t.id,value:t.id},s(t.name),9,Ce))),128))],512),[[j,o.value.category]])]),a("div",$e,[a("label",Ee,s(e.$t("create_task.priority")),1),_(a("select",{"onUpdate:modelValue":l[4]||(l[4]=t=>o.value.priority=t),class:"w-full border rounded p-2",onChange:A},[a("option",Ie,s(e.$t("create_task.select_priority")),1),(n(!0),u(b,null,g(E.value,t=>(n(),u("option",{key:t.id,value:t.id},s(t.priority),9,Ue))),128))],544),[[j,o.value.priority]])])]),a("div",De,[a("label",Me,s(e.$t("create_task.due_date")),1),_(a("input",{"onUpdate:modelValue":l[5]||(l[5]=t=>o.value.due_date=t),type:"date",class:"w-full border rounded p-2 bg-gray-100",readonly:""},null,512),[[D,o.value.due_date]])]),a("div",Be,[a("label",Pe,s(e.$t("kanban.capture")),1),a("div",Le,[a("button",{type:"button",class:"px-4 py-2 rounded bg-violet-500 text-white flex items-center gap-2",onClick:z},[l[10]||(l[10]=a("i",{class:"fas fa-camera"},null,-1)),M(" "+s(e.$t("kanban.photo")),1)]),a("button",{type:"button",class:"px-4 py-2 rounded bg-teal-500 text-white flex items-center gap-2",onClick:H},[l[11]||(l[11]=a("i",{class:"fas fa-video"},null,-1)),M(" "+s(e.$t("kanban.video")),1)])]),a("div",Re,[(n(!0),u(b,null,g(m.value,(t,i)=>(n(),u("div",{key:i,class:"relative group"},[a("img",{src:t,class:"w-20 h-20 object-cover rounded shadow border"},null,8,Se),a("button",{onClick:r=>Y(i),class:"absolute inset-0 flex items-center justify-center bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity"},l[12]||(l[12]=[a("i",{class:"fas fa-trash text-white text-xl"},null,-1)]),8,Te)]))),128))]),a("div",je,[(n(!0),u(b,null,g(p.value,(t,i)=>(n(),u("div",{key:i,class:"relative group"},[a("video",{src:t.url,class:"w-24 h-20 rounded shadow border",controls:""},null,8,Fe),a("button",{onClick:r=>Q(i),class:"absolute inset-0 flex items-center justify-center bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity"},l[13]||(l[13]=[a("i",{class:"fas fa-trash text-white text-xl"},null,-1)]),8,Oe)]))),128))]),a("input",{ref_key:"photoInput",ref:I,type:"file",accept:"image/*",capture:"environment",class:"hidden",onChange:J,multiple:""},null,544),a("input",{ref_key:"videoInput",ref:U,type:"file",accept:"video/*",capture:"environment",class:"hidden",onChange:q,multiple:""},null,544)]),a("div",Ve,[a("label",Ae,s(e.$t("kanban.upload_media")),1),a("input",{type:"file",class:"w-full border rounded p-2",multiple:"",accept:"image/*,video/*",onChange:X},null,32),a("div",Ne,[(n(!0),u(b,null,g(h.value,(t,i)=>(n(),u("div",{key:i,class:"relative group"},[t.type.startsWith("image/")?(n(),u("img",{key:0,src:t.url,class:"w-20 h-20 object-cover rounded shadow border"},null,8,Ge)):t.type.startsWith("video/")?(n(),u("video",{key:1,src:t.url,class:"w-24 h-20 rounded shadow border",controls:""},null,8,Ke)):T("",!0),a("button",{onClick:r=>Z(i),class:"absolute inset-0 flex items-center justify-center bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity"},l[14]||(l[14]=[a("i",{class:"fas fa-trash text-white text-xl"},null,-1)]),8,We)]))),128))])]),a("div",ze,[a("label",He,s(e.$t("kanban.upload_doc")),1),a("input",{type:"file",class:"w-full border rounded p-2",multiple:"",accept:".pdf,.doc,.docx,.xls,.xlsx,.csv",onChange:ee},null,32),a("div",Je,[(n(!0),u(b,null,g(y.value,(t,i)=>(n(),u("div",{key:i,class:"flex items-center gap-2 border rounded px-2 py-1 bg-gray-50"},[a("i",{class:re(["fas",L(t).icon,L(t).color,"text-2xl"])},null,2),a("span",qe,s(t.name),1),a("button",{onClick:r=>te(i),class:"text-red-500 hover:text-red-700"},l[15]||(l[15]=[a("i",{class:"fas fa-trash"},null,-1)]),8,Ye)]))),128))])]),a("div",Qe,[a("button",{type:"button",onClick:l[6]||(l[6]=t=>w("close")),class:"px-4 py-2 rounded bg-gray-200 hover:bg-gray-300"},s(e.$t("create_task.cancel")),1),a("button",Xe,s(e.$t("create_task.save")),1)])],32),k.value?(n(),ie(ue,{key:0,mode:x.value,onClose:l[7]||(l[7]=t=>k.value=!1),onCapture:ae},null,8,["mode"])):T("",!0)])]))}},st=de(Ze,[["__scopeId","data-v-b18139d1"]]);export{st as default};
