import{$ as Te,c as P,r as _,w as D,a as Ce,b as qe,A as Ie,B as u,C as F,D as s,G as p,N as d,O as R,L as n,E as m,H as x,I as W,J as N,F as j,M as V,l as ie,x as Ae,Q as Be,W as L}from"./vendor-vue-g7iCcTkf.js";import{A as De}from"./AppLayout-Cg9_BqdS.js";import{a as S}from"./vendor-utils-CpgP2uT4.js";import{S as b}from"./app-CL3toCqm.js";import{s as Ne}from"./vue-multiselect.esm-V-bx43V9.js";/* empty css                            */import{_ as je}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-DcALjTaB.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const Ve={class:"min-h-screen bg-gray-50 py-8 px-4 md:px-8"},Me={class:"w-full max-w-5xl mx-auto bg-white rounded-2xl shadow-2xl p-6 md:p-8"},$e={class:"text-2xl font-bold mb-8 flex items-center gap-2 text-green-700"},Fe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ue=["disabled"],Ee=["value"],Oe=["value"],Ge={class:"space-y-4"},Pe={class:"flex justify-between items-center"},Re=["disabled"],We={key:0,class:"text-sm text-blue-600 bg-blue-50 border border-blue-200 rounded-lg px-3 py-2"},Le={key:1,class:"text-center py-8 text-gray-400 border-2 border-dashed rounded-lg"},Ke={key:0},He={key:1},Qe={class:"flex justify-between items-start mb-2"},ze={class:"font-medium text-gray-800"},Xe=["onClick","disabled"],Je={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ye={class:"md:col-span-2"},Ze={class:"flex items-center justify-between"},et={class:"font-medium text-gray-900"},tt={class:"text-sm text-gray-500"},at={key:0},st={key:1},lt={key:2},ot={key:0,class:"text-xs text-yellow-600 mt-1"},it={key:0,class:"ml-1"},ut=["onUpdate:modelValue","disabled"],nt=["value","disabled"],rt={class:"md:col-span-2"},dt=["onUpdate:modelValue","disabled"],mt={class:"flex justify-center pt-2"},vt=["disabled"],ct={key:0,class:"mb-6"},pt={class:"mb-4"},_t={class:"relative"},ft={key:0,class:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto"},yt=["onMousedown"],bt={class:"font-medium"},gt={class:"text-sm text-gray-600"},ht={key:0,class:"text-xs text-blue-600 font-medium"},kt={key:0,class:"space-y-2"},wt={class:"flex items-center space-x-3"},xt={class:"flex items-center space-x-2"},St=["onClick"],Tt=["onClick"],Ct={class:"flex items-center space-x-2"},qt={class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},It={class:"font-medium"},At={class:"text-sm text-gray-600"},Bt={key:0,class:"text-xs text-blue-600 font-medium"},Dt=["onClick"],Nt={key:1,class:"text-sm text-amber-600 bg-amber-50 border border-amber-200 rounded-md p-3"},jt={class:"flex justify-between items-center mt-8"},Vt={class:"flex items-center gap-2 text-sm text-gray-500"},Mt={key:0},$t={key:1},Ft={class:"flex justify-end gap-2"},Ut=["disabled"],Et={key:0},Ot={key:1},Gt=["disabled"],Pt={key:0},Rt={key:1},Wt={__name:"Create",props:{outlets:Array,items:Array,warehouse_outlets:Array,header:Object,details:Array,approvalFlows:Array,isEdit:Boolean},setup(K){var Z,ee,te,ae,se,le;const r=K,H=Te(),I=P(()=>{var a,t;return((t=(a=H.props.auth)==null?void 0:a.user)==null?void 0:t.id_outlet)||""}),A=_(r.warehouse_outlets||[]),U=P(()=>r.isEdit||!1);function Q(){return{id:Date.now()+Math.random(),item_id:"",item_name:"",selectedItem:null,qty:"",unit_id:"",unit_name:"",note:"",stock:null}}const e=_({header_id:((Z=r.header)==null?void 0:Z.id)||null,type:((ee=r.header)==null?void 0:ee.type)||"internal_use",date:((te=r.header)==null?void 0:te.date)||"",outlet_id:((ae=r.header)==null?void 0:ae.outlet_id)||(I.value==1?"":I.value),notes:((se=r.header)==null?void 0:se.notes)||"",items:r.details&&r.details.length>0?r.details.map(a=>{const t=r.items.find(l=>l.id==a.item_id)||null;return{id:Date.now()+Math.random(),item_id:a.item_id,item_name:a.item_name||"",selectedItem:t,qty:a.qty,unit_id:a.unit_id,unit_name:a.unit_name||"",note:a.note||"",stock:null}}):[Q()],warehouse_outlet_id:((le=r.header)==null?void 0:le.warehouse_outlet_id)||"",approvers:r.approvalFlows&&r.approvalFlows.length>0?r.approvalFlows.map(a=>({id:a.approver_id,name:a.name,email:a.email,jabatan:a.jabatan})):[]}),f=_(null),M=_(null),T=_(!1),C=_(!1),h=_(!1),q=_(""),k=_([]),w=_(!1),ue=P(()=>I.value!=1),v=_(!1),E=_(!1);D(()=>e.value.outlet_id,async a=>{if((!U.value||!e.value.warehouse_outlet_id)&&(e.value.warehouse_outlet_id=""),a&&I.value==1)try{const t=await S.get(`/api/warehouse-outlets/by-outlet/${a}`);A.value=t.data}catch(t){console.error("Error fetching warehouse outlets:",t),A.value=[]}else a&&I.value!=1?A.value=r.warehouse_outlets.filter(t=>t.outlet_id==a):A.value=[]},{immediate:!0}),Ce(async()=>{if(U.value&&e.value.warehouse_outlet_id)for(let a=0;a<e.value.items.length;a++)e.value.items[a].item_id&&await B(a)});async function ne(){var a;if(e.value.type==="stock_cut"&&!(!e.value.outlet_id||!e.value.warehouse_outlet_id)){E.value=!0;try{const t=await S.get(route("outlet-internal-use-waste.stock-cut-items"),{params:{outlet_id:e.value.outlet_id,warehouse_outlet_id:e.value.warehouse_outlet_id}}),i=(Array.isArray((a=t.data)==null?void 0:a.items)?t.data.items:[]).map(o=>{const c=r.items.find($=>$.id==o.item_id)||{id:o.item_id,name:o.item_name};return{id:Date.now()+Math.random(),item_id:o.item_id,item_name:o.item_name,selectedItem:c,qty:"",unit_id:o.unit_id||"",unit_name:o.unit_name||"",note:"",stock:o.stock||null}});e.value.items=i}catch(t){console.error("Error loading stock cut items:",t),e.value.items=[]}finally{E.value=!1}}}D(()=>[e.value.type,e.value.outlet_id,e.value.warehouse_outlet_id],async([a,t,l])=>{a==="stock_cut"&&t&&l&&await ne()},{immediate:!0});function z(){e.value.items.push(Q())}function re(a){e.value.items.length!==1&&e.value.items.splice(a,1)}function de(a,t){!a||!a.id||(e.value.items[t].item_id=a.id,e.value.items[t].item_name=a.name,e.value.items[t].selectedItem=a,ve(t,a.id),e.value.warehouse_outlet_id&&e.value.outlet_id&&B(t))}function me(a){e.value.items[a].item_id="",e.value.items[a].item_name="",e.value.items[a].selectedItem=null,e.value.items[a].unit_id="",e.value.items[a].unit_name="",e.value.items[a].stock=null}async function ve(a,t){if(t){const l=await S.get(`/outlet-internal-use-waste/get-item-units/${t}`);l.data.units&&l.data.units.length>0?(e.value.items[a].unit_id=l.data.units[0].id,e.value.items[a].unit_name=l.data.units[0].name):(e.value.items[a].unit_id="",e.value.items[a].unit_name="")}else e.value.items[a].unit_id="",e.value.items[a].unit_name=""}function ce(a){return a.unit_name||""}async function pe(){if(!e.value.warehouse_outlet_id||!e.value.outlet_id)return{valid:!1,message:"Pilih outlet dan warehouse outlet terlebih dahulu"};for(let a=0;a<e.value.items.length;a++){const t=e.value.items[a];if(!(!t.item_id||!t.qty||t.qty<=0))if(t.stock){if(Number(t.stock.qty_small||0)<=0)return{valid:!1,message:`Stok item "${t.item_name||"Item"}" tidak tersedia (stock: 0). Tidak dapat menyimpan draft.`}}else try{if(await B(a),e.value.items[a].stock&&Number(e.value.items[a].stock.qty_small||0)<=0)return{valid:!1,message:`Stok item "${e.value.items[a].item_name||"Item"}" tidak tersedia (stock: 0). Tidak dapat menyimpan draft.`}}catch(l){console.warn("Could not fetch stock for item:",l)}}return{valid:!0}}async function _e(){if(!e.value.warehouse_outlet_id||!e.value.outlet_id)return{valid:!1,message:"Pilih outlet dan warehouse outlet terlebih dahulu"};if(e.value.items.filter(t=>t.item_id&&t.qty>0).length===0)return{valid:!1,message:"Tidak ada item yang dapat di-submit. Silakan tambahkan item terlebih dahulu."};for(let t=0;t<e.value.items.length;t++){const l=e.value.items[t];if(!(!l.item_id||!l.qty||l.qty<=0)){if(!l.stock)try{await B(t)}catch(i){console.warn("Could not fetch stock for item:",i)}if(l.stock){const i=Number(l.stock.qty_small||0),o=Number(l.qty||0);if(i<=0)return{valid:!1,message:`Stok item "${l.item_name||"Item"}" tidak tersedia (stock: 0). Tidak dapat di-submit.`};if(o>i)return{valid:!1,message:`Qty item "${l.item_name||"Item"}" (${o}) melebihi stok yang tersedia (${i.toFixed(2)}). Tidak dapat di-submit.`}}else return{valid:!1,message:`Stok item "${l.item_name||"Item"}" tidak ditemukan. Tidak dapat di-submit.`}}}return{valid:!0}}async function fe(){var l,i;if(C.value){console.log("Autosave already in progress, skipping...");return}if(!e.value.type||!e.value.date||!e.value.outlet_id||!e.value.warehouse_outlet_id){console.log("Autosave skipped: Missing required fields",{type:e.value.type,date:e.value.date,outlet_id:e.value.outlet_id,warehouse_outlet_id:e.value.warehouse_outlet_id});return}const a=e.value.items.filter(o=>o.item_id&&o.qty>0);console.log("Autosave: Triggered",{type:e.value.type,date:e.value.date,outlet_id:e.value.outlet_id,warehouse_outlet_id:e.value.warehouse_outlet_id,validItemsCount:a.length,totalItemsCount:e.value.items.length}),C.value=!0,T.value=!0;const t={type:e.value.type,date:e.value.date,outlet_id:e.value.outlet_id,warehouse_outlet_id:e.value.warehouse_outlet_id,notes:e.value.notes,items:e.value.items.filter(o=>o.item_id&&o.qty>0).map(o=>({item_id:o.item_id,qty:o.qty,unit_id:o.unit_id,note:o.note||null})),approvers:e.value.approvers.map(o=>o.id),autosave:!0};console.log("Autosave: Saving draft for outlet:",e.value.outlet_id,"warehouse:",e.value.warehouse_outlet_id,"type:",e.value.type);try{const o=await S.post(route("outlet-internal-use-waste.store"),t,{headers:{Accept:"application/json","Content-Type":"application/json"}});o.data.success?(o.data.header_id&&(e.value.header_id=o.data.header_id,console.log("✅ Autosave: Draft saved/updated with header_id:",o.data.header_id)),M.value=new Date):console.error("❌ Autosave failed: Response not successful",o.data)}catch(o){console.error("❌ Autosave failed:",o),console.error("Error details:",{message:o.message,response:(l=o.response)==null?void 0:l.data,status:(i=o.response)==null?void 0:i.status})}finally{T.value=!1,C.value=!1}}D(()=>[e.value.type,e.value.date,e.value.outlet_id,e.value.warehouse_outlet_id,e.value.notes,e.value.items,e.value.approvers],()=>{if(!C.value){if(h.value||v.value){console.log("Autosave skipped: Submit or save in progress");return}f.value&&clearTimeout(f.value),f.value=setTimeout(()=>{!h.value&&!v.value&&!C.value&&(console.log("Autosave: Triggered after 3 seconds"),fe())},3e3)}},{deep:!0});async function ye(){var l,i;if(v.value||h.value){console.log("Save draft: Already in progress, skipping...");return}for(v.value=!0,f.value&&(clearTimeout(f.value),f.value=null);C.value;)await new Promise(o=>setTimeout(o,100));const a=await pe();if(!a.valid){b.fire({icon:"error",title:"Validasi Gagal",text:a.message,confirmButtonText:"OK",confirmButtonColor:"#EF4444"}),v.value=!1;return}const t={type:e.value.type,date:e.value.date,outlet_id:e.value.outlet_id,warehouse_outlet_id:e.value.warehouse_outlet_id,notes:e.value.notes,items:e.value.items.map(o=>({item_id:o.item_id,qty:o.qty,unit_id:o.unit_id,note:o.note||null})),approvers:e.value.approvers.map(o=>o.id),autosave:!1};try{const o=await S.post(route("outlet-internal-use-waste.store"),t,{headers:{Accept:"application/json","Content-Type":"application/json"}});o.data.success&&(o.data.header_id&&(e.value.header_id=o.data.header_id,console.log("Save draft: Draft saved/updated with header_id:",o.data.header_id)),M.value=new Date,b.fire({icon:"success",title:"Berhasil",text:"Draft berhasil disimpan",timer:1500,showConfirmButton:!1}))}catch(o){console.error("Save draft failed:",o);const c=((i=(l=o.response)==null?void 0:l.data)==null?void 0:i.message)||o.message||"Gagal menyimpan draft";b.fire({icon:"error",title:"Gagal",text:c,confirmButtonText:"OK",confirmButtonColor:"#EF4444"})}finally{v.value=!1}}async function X(){var a,t,l;if(h.value){console.log("Submit already in progress, ignoring duplicate call");return}if(v.value){console.log("Already loading, ignoring submit call");return}for(h.value=!0,f.value&&(clearTimeout(f.value),f.value=null);C.value;)await new Promise(i=>setTimeout(i,100));try{if((e.value.type==="r_and_d"||e.value.type==="marketing"||e.value.type==="wrong_maker"||e.value.type==="training")&&(!e.value.approvers||e.value.approvers.length===0)){b.fire({icon:"error",title:"Validasi Gagal",text:"Tipe ini wajib memiliki minimal 1 approver"}),h.value=!1;return}const o=await _e();if(!o.valid){b.fire({icon:"error",title:"Validasi Stock Gagal",text:o.message,confirmButtonText:"OK",confirmButtonColor:"#EF4444"}),h.value=!1;return}v.value=!0;const c={type:e.value.type,date:e.value.date,outlet_id:e.value.outlet_id,warehouse_outlet_id:e.value.warehouse_outlet_id,notes:e.value.notes,items:e.value.items.filter(y=>y.item_id&&y.qty>0).map(y=>({item_id:y.item_id,qty:y.qty,unit_id:y.unit_id,note:y.note||null})),approvers:e.value.approvers.map(y=>y.id)},$=e.value.header_id?route("outlet-internal-use-waste.submit",e.value.header_id):route("outlet-internal-use-waste.store-and-submit"),oe=e.value.header_id?{approvers:e.value.approvers.map(y=>y.id)}:c;console.log("Calling submit endpoint:",$,oe);const g=await S.post($,oe,{headers:{Accept:"application/json","Content-Type":"application/json"}});if(console.log("Submit response:",g.data),g.data.success){if(g.data.current_status&&g.data.current_status!=="DRAFT"&&g.data.current_status!==g.data.status){b.fire({icon:"info",title:"Sudah Di-submit",text:"Data ini sudah di-submit sebelumnya. Status: "+g.data.current_status,timer:2e3,showConfirmButton:!1}).then(()=>{L.visit(route("outlet-internal-use-waste.index"))});return}b.fire({icon:"success",title:"Berhasil",text:g.data.message||"Data berhasil di-submit",timer:1500,showConfirmButton:!1}).then(()=>{L.visit(route("outlet-internal-use-waste.index"))})}else b.fire({icon:"error",title:"Gagal Submit",text:g.data.message||"Gagal submit data",confirmButtonText:"OK",confirmButtonColor:"#EF4444"})}catch(i){console.error("Submit failed:",i),console.error("Error response:",(a=i.response)==null?void 0:a.data);const o=((l=(t=i.response)==null?void 0:t.data)==null?void 0:l.message)||i.message||"Gagal submit data";b.fire({icon:"error",title:"Gagal Submit",text:o,confirmButtonText:"OK",confirmButtonColor:"#EF4444"})}finally{v.value=!1,h.value=!1}}function be(){L.visit(route("outlet-internal-use-waste.index"))}let O=null;const ge=()=>{O&&clearTimeout(O),q.value.length>=2?O=setTimeout(()=>{J(q.value)},300):(k.value=[],w.value=!1)},he=()=>{q.value.length>=2&&J(q.value)},ke=()=>{setTimeout(()=>{w.value=!1},200)},J=async(a="")=>{if(!a||a.length<2){k.value=[],w.value=!1;return}try{const t=await S.get("/outlet-internal-use-waste/approvers",{params:{search:a},headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}});t.data.success?(k.value=t.data.users,w.value=!0):(k.value=[],w.value=!1)}catch(t){console.error("Failed to load approvers:",t),k.value=[],w.value=!1}},we=a=>{e.value.approvers.find(t=>t.id===a.id)||e.value.approvers.push(a),q.value="",w.value=!1,k.value=[]},xe=a=>{e.value.approvers.splice(a,1)},Y=(a,t)=>{const l=e.value.approvers.splice(a,1)[0];e.value.approvers.splice(t,0,l)};D(()=>H.props.flash,a=>{a!=null&&a.error&&b.fire({icon:"error",title:"Gagal Menyimpan Data",html:a.error,confirmButtonText:"OK",confirmButtonColor:"#EF4444",width:"600px"})},{immediate:!0});async function B(a){const t=e.value.items[a];if(!(!t.item_id||!e.value.warehouse_outlet_id||!e.value.outlet_id))try{const l=await S.get("/api/outlet-inventory/stock",{params:{item_id:t.item_id,warehouse_outlet_id:e.value.warehouse_outlet_id,outlet_id:e.value.outlet_id}});t.stock=l.data}catch(l){console.error("Error fetching stock:",l),t.stock={qty_small:0,qty_medium:0,qty_large:0,unit_small:"",unit_medium:"",unit_large:""}}}function G(a){return a==null?0:Number(a)%1===0?Number(a):Number(a).toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:2})}function Se(a){if(!a.stock)return"Stok: 0";const t=Number(a.stock.qty_small||0),l=Number(a.stock.qty_medium||0),i=Number(a.stock.qty_large||0);let o="Stok: ";const c=[];return(t>0||a.stock.unit_small)&&c.push(`${G(t)} ${a.stock.unit_small||""}`),(l>0||a.stock.unit_medium)&&c.push(`${G(l)} ${a.stock.unit_medium||""}`),(i>0||a.stock.unit_large)&&c.push(`${G(i)} ${a.stock.unit_large||""}`),c.length===0?"Stok: 0":o+c.join(" | ")}return D(()=>e.value.warehouse_outlet_id,a=>{e.value.items.forEach((t,l)=>{t.item_id&&a&&B(l)})}),qe(()=>{f.value&&clearTimeout(f.value)}),(a,t)=>(u(),Ie(De,null,{default:F(()=>[s("div",Ve,[s("div",Me,[s("h1",$e,[t[7]||(t[7]=s("i",{class:"fa-solid fa-recycle text-green-500"},null,-1)),p(" "+d(U.value?"Edit":"Input")+" Category Cost Outlet ",1)]),s("form",{onSubmit:[R(X,["prevent"]),t[6]||(t[6]=R(()=>{},["prevent","stop"]))],class:"space-y-5"},[s("div",Fe,[s("div",null,[t[9]||(t[9]=s("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Tipe",-1)),x(s("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>e.value.type=l),class:"input input-bordered w-full",required:""},t[8]||(t[8]=[s("option",{value:""},"Pilih Tipe",-1),s("option",{value:"internal_use"},"Internal Use",-1),s("option",{value:"spoil"},"Spoil",-1),s("option",{value:"waste"},"Waste",-1),s("option",{value:"stock_cut"},"Stock Cut",-1),s("option",{value:"r_and_d"},"R & D",-1),s("option",{value:"marketing"},"Marketing",-1),s("option",{value:"non_commodity"},"Non Commodity",-1),s("option",{value:"guest_supplies"},"Guest Supplies",-1),s("option",{value:"wrong_maker"},"Wrong Maker",-1),s("option",{value:"training"},"Training",-1)]),512),[[W,e.value.type]])]),s("div",null,[t[10]||(t[10]=s("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Tanggal",-1)),x(s("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=l=>e.value.date=l),class:"input input-bordered w-full",required:""},null,512),[[N,e.value.date]])]),s("div",null,[t[12]||(t[12]=s("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Outlet",-1)),x(s("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>e.value.outlet_id=l),disabled:ue.value,class:"input input-bordered w-full",required:""},[t[11]||(t[11]=s("option",{value:""},"Pilih Outlet",-1)),(u(!0),n(j,null,V(r.outlets,l=>(u(),n("option",{key:l.id_outlet,value:l.id_outlet},d(l.nama_outlet),9,Ee))),128))],8,Ue),[[W,e.value.outlet_id]])]),s("div",null,[t[14]||(t[14]=s("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Warehouse Outlet",-1)),x(s("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>e.value.warehouse_outlet_id=l),class:"input input-bordered w-full",required:""},[t[13]||(t[13]=s("option",{value:""},"Pilih Warehouse Outlet",-1)),(u(!0),n(j,null,V(A.value,l=>(u(),n("option",{key:l.id,value:l.id},d(l.name),9,Oe))),128))],512),[[W,e.value.warehouse_outlet_id]])])]),s("div",Ge,[s("div",Pe,[t[16]||(t[16]=s("h3",{class:"font-semibold text-gray-700"},"Items",-1)),s("button",{type:"button",onClick:z,class:"btn btn-sm btn-primary",disabled:!e.value.warehouse_outlet_id||e.value.type==="stock_cut"},t[15]||(t[15]=[s("i",{class:"fa fa-plus mr-1"},null,-1),p(" Tambah Item ")]),8,Re)]),e.value.type==="stock_cut"&&E.value?(u(),n("div",We,t[17]||(t[17]=[s("i",{class:"fa fa-spinner fa-spin mr-2"},null,-1),p("Memuat item stock cut... ")]))):m("",!0),e.value.items.length===0?(u(),n("div",Le,[t[18]||(t[18]=s("i",{class:"fa fa-box-open text-4xl mb-2"},null,-1)),e.value.type==="stock_cut"?(u(),n("p",Ke,"Tidak ada item stock cut dengan stok tersedia pada outlet dan warehouse ini.")):(u(),n("p",He,'Belum ada item. Klik "Tambah Item" untuk menambahkan.'))])):m("",!0),(u(!0),n(j,null,V(e.value.items,(l,i)=>(u(),n("div",{key:l.id||i,class:"bg-white border rounded-lg p-4 space-y-4 relative"},[s("div",Qe,[s("h4",ze,"Item #"+d(i+1),1),e.value.type!=="stock_cut"?(u(),n("button",{key:0,type:"button",onClick:o=>re(i),class:ie(["px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition-colors text-sm font-medium",e.value.items.length===1?"opacity-50 cursor-not-allowed":""]),disabled:e.value.items.length===1,title:"Hapus Item"},t[19]||(t[19]=[s("i",{class:"fa fa-trash mr-1"},null,-1),p(" Hapus ")]),10,Xe)):m("",!0)]),s("div",Je,[s("div",Ye,[t[22]||(t[22]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Item",-1)),Ae(Be(Ne),{modelValue:l.selectedItem,"onUpdate:modelValue":o=>l.selectedItem=o,options:K.items,searchable:!0,"close-on-select":!0,"show-labels":!1,placeholder:"Cari dan pilih item...",label:"name","track-by":"id",disabled:!e.value.warehouse_outlet_id||e.value.type==="stock_cut",onSelect:o=>de(o,i),onRemove:()=>me(i),class:"multiselect-custom"},{option:F(({option:o})=>[s("div",Ze,[s("div",null,[s("div",et,d(o.name),1),s("div",tt,[o.small_unit_name?(u(),n("span",at,"Small: "+d(o.small_unit_name),1)):m("",!0),o.medium_unit_name?(u(),n("span",st," | Medium: "+d(o.medium_unit_name),1)):m("",!0),o.large_unit_name?(u(),n("span",lt," | Large: "+d(o.large_unit_name),1)):m("",!0)])])])]),noResult:F(()=>t[20]||(t[20]=[s("div",{class:"text-center py-2 text-gray-500"},[s("i",{class:"fa-solid fa-search mr-2"}),p(" Tidak ada item yang ditemukan ")],-1)])),noOptions:F(()=>t[21]||(t[21]=[s("div",{class:"text-center py-2 text-gray-500"},[s("i",{class:"fa-solid fa-box mr-2"}),p(" Tidak ada item tersedia ")],-1)])),_:2},1032,["modelValue","onUpdate:modelValue","options","disabled","onSelect","onRemove"]),e.value.warehouse_outlet_id?m("",!0):(u(),n("div",ot," Pilih warehouse outlet terlebih dahulu untuk melihat stok. ")),l.stock?(u(),n("div",{key:1,class:ie(["text-xs mt-1",Number(l.stock.qty_small||0)<=0?"text-red-600 font-bold":"text-gray-500"])},[p(" Stok: "+d(Se(l))+" ",1),Number(l.stock.qty_small||0)<=0?(u(),n("span",it,"⚠️ Stock tidak tersedia")):m("",!0)],2)):m("",!0)]),s("div",null,[t[23]||(t[23]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Qty",-1)),x(s("input",{type:"number",min:"0.01",step:"0.01","onUpdate:modelValue":o=>l.qty=o,class:"input input-bordered w-full",required:"",disabled:!e.value.warehouse_outlet_id||!l.item_id},null,8,ut),[[N,l.qty,void 0,{number:!0}]])]),s("div",null,[t[24]||(t[24]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Unit",-1)),s("input",{type:"text",value:ce(l),class:"input input-bordered w-full bg-gray-50",readonly:"",disabled:!l.item_id},null,8,nt)]),s("div",rt,[t[25]||(t[25]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Note",-1)),x(s("textarea",{"onUpdate:modelValue":o=>l.note=o,class:"input input-bordered w-full",placeholder:"Catatan item (opsional)",rows:"3",disabled:e.value.type==="stock_cut"},null,8,dt),[[N,l.note]])])])]))),128)),s("div",mt,[s("button",{type:"button",onClick:z,class:"btn btn-sm btn-primary",disabled:!e.value.warehouse_outlet_id||e.value.type==="stock_cut"},t[26]||(t[26]=[s("i",{class:"fa fa-plus mr-1"},null,-1),p(" Tambah Item ")]),8,vt)])]),s("div",null,[t[27]||(t[27]=s("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Catatan Umum",-1)),x(s("textarea",{"onUpdate:modelValue":t[4]||(t[4]=l=>e.value.notes=l),class:"input input-bordered w-full",rows:"2",placeholder:"Catatan tambahan"},null,512),[[N,e.value.notes]])]),e.value.type==="r_and_d"||e.value.type==="marketing"||e.value.type==="wrong_maker"||e.value.type==="training"?(u(),n("div",ct,[t[33]||(t[33]=s("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Approval Flow",-1)),t[34]||(t[34]=s("p",{class:"text-sm text-gray-600 mb-4"},"Tambahkan approver dalam urutan dari level terendah ke tertinggi. Approver pertama akan menjadi level terendah, dan approver terakhir akan menjadi level tertinggi.",-1)),s("div",pt,[s("div",_t,[x(s("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>q.value=l),type:"text",placeholder:"Cari user berdasarkan nama, email, atau jabatan...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",onInput:ge,onFocus:he,onBlur:ke},null,544),[[N,q.value]]),w.value&&k.value.length>0?(u(),n("div",ft,[(u(!0),n(j,null,V(k.value,l=>(u(),n("div",{key:l.id,onMousedown:R(i=>we(l),["prevent"]),class:"px-3 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-200 last:border-b-0"},[s("div",bt,d(l.name),1),s("div",gt,d(l.email),1),l.jabatan?(u(),n("div",ht,d(l.jabatan),1)):m("",!0)],40,yt))),128))])):m("",!0)])]),e.value.approvers.length>0?(u(),n("div",kt,[t[31]||(t[31]=s("h4",{class:"font-medium text-gray-700"},"Urutan Approval (Terendah ke Tertinggi):",-1)),(u(!0),n(j,null,V(e.value.approvers,(l,i)=>(u(),n("div",{key:l.id,class:"flex items-center justify-between p-3 bg-gray-50 border border-gray-200 rounded-md"},[s("div",wt,[s("div",xt,[i>0?(u(),n("button",{key:0,onClick:o=>Y(i,i-1),class:"p-1 text-gray-500 hover:text-gray-700",title:"Pindah ke atas"},t[28]||(t[28]=[s("i",{class:"fa fa-arrow-up"},null,-1)]),8,St)):m("",!0),i<e.value.approvers.length-1?(u(),n("button",{key:1,onClick:o=>Y(i,i+1),class:"p-1 text-gray-500 hover:text-gray-700",title:"Pindah ke bawah"},t[29]||(t[29]=[s("i",{class:"fa fa-arrow-down"},null,-1)]),8,Tt)):m("",!0)]),s("div",Ct,[s("span",qt," Level "+d(i+1),1),s("div",null,[s("div",It,d(l.name),1),s("div",At,d(l.email),1),l.jabatan?(u(),n("div",Bt,d(l.jabatan),1)):m("",!0)])])]),s("button",{onClick:o=>xe(i),class:"text-red-600 hover:text-red-800",title:"Hapus"},t[30]||(t[30]=[s("i",{class:"fa fa-trash"},null,-1)]),8,Dt)]))),128))])):(u(),n("div",Nt,t[32]||(t[32]=[s("i",{class:"fa fa-exclamation-triangle mr-2"},null,-1),p(" Wajib menambahkan minimal 1 approver untuk tipe ini. ")])))])):m("",!0),s("div",jt,[s("div",Vt,[T.value?(u(),n("span",Mt,t[35]||(t[35]=[s("i",{class:"fa fa-spinner fa-spin"},null,-1),p(" Menyimpan otomatis... ")]))):M.value?(u(),n("span",$t,[t[36]||(t[36]=s("i",{class:"fa fa-check text-green-500"},null,-1)),p(" Terakhir disimpan: "+d(new Date(M.value).toLocaleTimeString("id-ID")),1)])):m("",!0)]),s("div",Ft,[s("button",{type:"button",class:"btn btn-ghost px-6 py-2 rounded-lg",onClick:be},"Batal"),s("button",{type:"button",onClick:ye,class:"btn bg-gray-500 text-white px-6 py-2 rounded-lg font-bold shadow hover:shadow-xl transition-all",disabled:v.value||T.value},[v.value&&!T.value?(u(),n("span",Et,t[37]||(t[37]=[s("i",{class:"fa fa-spinner fa-spin"},null,-1),p(" Menyimpan... ")]))):(u(),n("span",Ot," Simpan Draft "))],8,Ut),s("button",{type:"button",onClick:X,class:"btn bg-gradient-to-r from-green-500 to-green-700 text-white px-8 py-2 rounded-lg font-bold shadow hover:shadow-xl transition-all",disabled:v.value||T.value},[v.value&&!T.value?(u(),n("span",Pt,t[38]||(t[38]=[s("i",{class:"fa fa-spinner fa-spin"},null,-1),p(" Submit... ")]))):(u(),n("span",Rt," Submit "))],8,Gt)])])],32)])])]),_:1}))}},sa=je(Wt,[["__scopeId","data-v-3c207701"]]);export{sa as default};
