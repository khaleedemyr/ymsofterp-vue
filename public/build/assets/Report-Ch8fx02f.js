import{r as y,c as z,a as J,L as s,B as o,x as E,C as O,D as t,H as b,J as I,I as C,F as k,M as w,N as n,E as p,G as c,l as V,Q as K}from"./vendor-vue-g7iCcTkf.js";import{A as X}from"./AppLayout-BaHOzAR0.js";import{N as Q}from"./vue-easy-lightbox.esm.min-H9agbAmC.js";import{a as M}from"./vendor-utils-CpgP2uT4.js";import"./app-e_83ELsm.js";import"./vendor-charts-CuqD4wLC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-DOFHeIjT.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const q={class:"min-h-screen bg-gray-50 dark:bg-gray-900"},W={class:"h-full"},Y={class:"bg-white dark:bg-gray-800 min-h-screen"},Z={class:"p-4 text-gray-900 dark:text-gray-100"},ee={class:"mb-6"},te={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-7 gap-4"},ae=["disabled"],re=["value"],se=["value"],oe={class:"flex flex-col justify-end"},le={class:"flex gap-2"},de=["disabled"],ne={key:0,class:"fa-solid fa-spinner fa-spin mr-2"},ie=["disabled"],ue={class:"bg-white dark:bg-gray-800 rounded-lg shadow"},ge={class:"px-4 py-3 border-b border-gray-200 dark:border-gray-700"},pe={class:"text-lg font-medium text-gray-900 dark:text-white"},ce={class:"text-sm text-gray-500 dark:text-gray-400 ml-2"},xe={class:"overflow-x-auto max-h-[calc(100vh-300px)]"},ye={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},be={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},ve={key:0},fe={key:1},me={class:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white"},ke={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},_e={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},he={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},we={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},De={class:"space-y-1"},je={class:"font-medium"},Ce={class:"text-xs text-blue-600 dark:text-blue-400"},$e={class:"px-4 py-3 whitespace-nowrap"},Ie={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},Se={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},Le={class:"space-y-1"},Ae={key:0,class:"font-medium text-green-600 dark:text-green-400"},Ee={key:1,class:"text-gray-400"},Oe={key:2,class:"text-xs text-gray-500"},Ve={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},Me={class:"space-y-1"},Te={key:0,class:"font-medium text-blue-600 dark:text-blue-400"},Ne={key:1,class:"text-gray-400"},Ue={key:2,class:"text-xs text-gray-500"},Re={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},Be={key:0,class:"flex gap-2"},He={key:0,class:"flex gap-1"},Ge=["onClick"],Fe={key:0,class:"relative"},Pe=["src"],ze={key:1,class:"w-12 h-12 bg-gray-100 dark:bg-gray-700 rounded border border-gray-300 dark:border-gray-600 flex items-center justify-center"},Je=["href"],Ke=["onClick"],Xe={key:0,class:"relative"},Qe=["src"],qe={key:1,class:"w-12 h-12 bg-gray-100 dark:bg-gray-700 rounded border border-gray-300 dark:border-gray-600 flex items-center justify-center"},We=["href"],Ye={key:2,class:"text-gray-400"},Ze={key:0,class:"px-4 py-3 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"},et={class:"flex items-center justify-between"},tt={class:"flex items-center gap-4"},at={class:"text-sm text-gray-700 dark:text-gray-300"},rt={class:"flex items-center gap-2"},st={class:"flex items-center gap-2"},ot=["disabled"],lt={class:"flex items-center gap-1"},dt={key:1,class:"px-2 text-gray-500"},nt=["onClick"],it={key:2,class:"px-2 text-gray-500"},ut=["disabled"],wt={__name:"Report",props:{outlets:Array,divisions:Array,user:Object,filters:Object},setup(S){const u=S,x=y(!1),v=y([]),d=y({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0,has_more_pages:!1}),D=y(!1),_=y([]),f=y(0),i=y({start_date:u.filters.start_date||"",end_date:u.filters.end_date||"",status:u.filters.status||"",outlet_id:u.filters.outlet_id||"",division_id:u.filters.division_id||"",employee_name:u.filters.employee_name||""}),T=z(()=>{var r;return(r=u.user)!=null&&r.id_outlet&&u.user.id_outlet!==1?u.outlets.filter(e=>e.id_outlet===u.user.id_outlet):u.outlets}),j=async(r=1)=>{x.value=!0;try{const e={...i.value,page:r,per_page:d.value.per_page},l=await M.get("/attendance/report/data",{params:e});l.data.success&&(v.value=l.data.data,d.value=l.data.pagination)}catch(e){console.error("Error loading report data:",e),v.value=[]}finally{x.value=!1}},h=r=>{j(r)},N=r=>{d.value.per_page=r,j(1)},U=async()=>{try{const r=await M.get("/attendance/report/export",{params:i.value,responseType:"blob"}),e=window.URL.createObjectURL(new Blob([r.data])),l=document.createElement("a");l.href=e,l.setAttribute("download",`absent_report_${new Date().toISOString().split("T")[0]}.xlsx`),document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(e)}catch(r){console.error("Error exporting to Excel:",r)}},R=(r,e)=>{if(!r)return"-";const l=new Date(r).toLocaleDateString("id-ID"),a=e?new Date(e).toLocaleDateString("id-ID"):l;return l===a?l:`${l} - ${a}`},B=(r,e)=>{if(!r)return 0;const l=new Date(r),g=(e?new Date(e):l).getTime()-l.getTime();return Math.ceil(g/(1e3*3600*24))+1},$=r=>r?new Date(r).toLocaleString("id-ID"):"-",H=r=>{switch(r){case"pending":return"Menunggu Persetujuan";case"supervisor_approved":return"Disetujui Atasan";case"approved":return"Disetujui";case"rejected":return"Ditolak";default:return r}},G=r=>{switch(r){case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300";case"supervisor_approved":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300";case"approved":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"rejected":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"}},F=r=>{if(!r)return null;try{return`/storage/${r}`}catch(e){return console.error("Error processing image:",e),null}},L=(r,e=[])=>{console.log("=== OPENING LIGHTBOX ==="),console.log("imageUrl:",r),console.log("allImagePaths:",e),!e||e.length===0?(console.log("No image paths provided, using single image"),_.value=[r],f.value=0):(_.value=e.map(l=>F(l)).filter(l=>l),console.log("Converted lightboxImages:",_.value),f.value=e.findIndex(l=>r.includes(l.split("/").pop())),f.value===-1&&(f.value=0)),D.value=!0,console.log("Final state:",{lightboxVisible:D.value,lightboxImages:_.value,lightboxIndex:f.value}),console.log("=== LIGHTBOX OPENED ===")},A=r=>{if(!r)return!1;const e=[".jpg",".jpeg",".png",".gif",".bmp",".webp"],l=r.toLowerCase().substring(r.lastIndexOf("."));return e.includes(l)},P=()=>{const r=d.value.current_page,e=d.value.last_page,l=[],a=Math.max(1,r-2),g=Math.min(e,r+2);for(let m=a;m<=g;m++)l.push(m);return l};return J(()=>{j()}),(r,e)=>(o(),s(k,null,[E(X,{title:"Report Absent"},{header:O(()=>e[13]||(e[13]=[t("h2",{class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"}," Report Absent ",-1)])),default:O(()=>{var l;return[t("div",q,[t("div",W,[t("div",Y,[t("div",Z,[t("div",ee,[t("div",te,[t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Tanggal Mulai ",-1)),b(t("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=a=>i.value.start_date=a),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"},null,512),[[I,i.value.start_date]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Tanggal Selesai ",-1)),b(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=a=>i.value.end_date=a),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"},null,512),[[I,i.value.end_date]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Status ",-1)),b(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>i.value.status=a),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"},e[16]||(e[16]=[t("option",{value:""},"Semua Status",-1),t("option",{value:"pending"},"Menunggu Persetujuan",-1),t("option",{value:"supervisor_approved"},"Disetujui Atasan",-1),t("option",{value:"approved"},"Disetujui",-1),t("option",{value:"rejected"},"Ditolak",-1)]),512),[[C,i.value.status]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Outlet ",-1)),b(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>i.value.outlet_id=a),disabled:((l=u.user)==null?void 0:l.id_outlet)&&u.user.id_outlet!==1,class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white disabled:bg-gray-100 disabled:cursor-not-allowed"},[e[18]||(e[18]=t("option",{value:""},"Semua Outlet",-1)),(o(!0),s(k,null,w(T.value,a=>(o(),s("option",{key:a.id_outlet,value:a.id_outlet},n(a.nama_outlet),9,re))),128))],8,ae),[[C,i.value.outlet_id]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Divisi ",-1)),b(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>i.value.division_id=a),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"},[e[20]||(e[20]=t("option",{value:""},"Semua Divisi",-1)),(o(!0),s(k,null,w(S.divisions,a=>(o(),s("option",{key:a.id,value:a.id},n(a.nama_divisi),9,se))),128))],512),[[C,i.value.division_id]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Cari Nama Karyawan ",-1)),b(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=a=>i.value.employee_name=a),placeholder:"Masukkan nama karyawan...",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"},null,512),[[I,i.value.employee_name]])]),t("div",oe,[t("div",le,[t("button",{onClick:j,disabled:x.value,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},[x.value?(o(),s("i",ne)):p("",!0),c(" "+n(x.value?"Loading...":"Filter"),1)],8,de),t("button",{onClick:U,disabled:x.value||v.value.length===0,class:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"},e[23]||(e[23]=[t("i",{class:"fa-solid fa-file-excel mr-2"},null,-1),c(" Export Excel ")]),8,ie)])])])]),t("div",ue,[t("div",ge,[t("h3",pe,[e[24]||(e[24]=c(" Data Report Absent ")),t("span",ce," ("+n(v.value.length)+" data) ",1)])]),t("div",xe,[t("table",ye,[e[36]||(e[36]=t("thead",{class:"bg-gray-50 dark:bg-gray-700"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Nama Karyawan "),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Outlet "),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Divisi "),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Jenis Izin/Cuti "),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Tanggal & Durasi "),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Status "),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Tanggal Pengajuan "),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Approval Atasan "),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Approval HRD "),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Dokumen ")])],-1)),t("tbody",be,[x.value?(o(),s("tr",ve,e[25]||(e[25]=[t("td",{colspan:"10",class:"px-4 py-3 text-center text-gray-500 dark:text-gray-400"},[t("i",{class:"fa-solid fa-spinner fa-spin mr-2"}),c(" Loading... ")],-1)]))):v.value.length===0?(o(),s("tr",fe,e[26]||(e[26]=[t("td",{colspan:"10",class:"px-4 py-3 text-center text-gray-500 dark:text-gray-400"}," Tidak ada data ",-1)]))):(o(!0),s(k,{key:2},w(v.value,a=>(o(),s("tr",{key:a.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700"},[t("td",me,n(a.employee_name||"-"),1),t("td",ke,n(a.outlet_name||"-"),1),t("td",_e,n(a.nama_divisi||"-"),1),t("td",he,n(a.leave_type_name||"-"),1),t("td",we,[t("div",De,[t("div",je,n(R(a.date_from,a.date_to)),1),t("div",Ce,[e[27]||(e[27]=t("i",{class:"fa-solid fa-calendar-days mr-1"},null,-1)),c(" "+n(B(a.date_from,a.date_to))+" hari ",1)])])]),t("td",$e,[t("span",{class:V([G(a.status),"inline-flex px-2 py-1 text-xs font-semibold rounded-full"])},n(H(a.status)),3)]),t("td",Ie,n($(a.created_at)),1),t("td",Se,[t("div",Le,[a.approver_name?(o(),s("div",Ae,[e[28]||(e[28]=t("i",{class:"fa-solid fa-user-check mr-1"},null,-1)),c(" "+n(a.approver_name),1)])):(o(),s("div",Ee,e[29]||(e[29]=[t("i",{class:"fa-solid fa-clock mr-1"},null,-1),c(" Belum disetujui ")]))),a.approved_at?(o(),s("div",Oe,n($(a.approved_at)),1)):p("",!0)])]),t("td",Ve,[t("div",Me,[a.hrd_approver_name?(o(),s("div",Te,[e[30]||(e[30]=t("i",{class:"fa-solid fa-user-tie mr-1"},null,-1)),c(" "+n(a.hrd_approver_name),1)])):(o(),s("div",Ne,e[31]||(e[31]=[t("i",{class:"fa-solid fa-clock mr-1"},null,-1),c(" Belum disetujui ")]))),a.hrd_approved_at?(o(),s("div",Ue,n($(a.hrd_approved_at)),1)):p("",!0)])]),t("td",Re,[a.document_paths||a.document_path?(o(),s("div",Be,[a.document_paths&&a.document_paths.length>0?(o(),s("div",He,[(o(!0),s(k,null,w(a.document_paths,(g,m)=>(o(),s("div",{key:m,class:"relative group cursor-pointer",onClick:gt=>L(`/storage/${g}`,a.document_paths)},[A(g)?(o(),s("div",Fe,[t("img",{src:`/storage/${g}`,class:"w-12 h-12 object-cover rounded border border-gray-300 dark:border-gray-600 hover:opacity-90 transition-opacity"},null,8,Pe),e[32]||(e[32]=t("div",{class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all rounded flex items-center justify-center pointer-events-none"},[t("i",{class:"fa-solid fa-search-plus text-white opacity-0 group-hover:opacity-100 transition-opacity text-xs"})],-1))])):(o(),s("div",ze,[t("a",{href:`/storage/${g}`,target:"_blank",class:"text-center text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300"},e[33]||(e[33]=[t("i",{class:"fa-solid fa-file-pdf text-lg"},null,-1)]),8,Je)]))],8,Ge))),128))])):a.document_path?(o(),s("div",{key:1,class:"relative group cursor-pointer",onClick:g=>L(`/storage/${a.document_path}`,[a.document_path])},[A(a.document_path)?(o(),s("div",Xe,[t("img",{src:`/storage/${a.document_path}`,class:"w-12 h-12 object-cover rounded border border-gray-300 dark:border-gray-600 hover:opacity-90 transition-opacity"},null,8,Qe),e[34]||(e[34]=t("div",{class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all rounded flex items-center justify-center pointer-events-none"},[t("i",{class:"fa-solid fa-search-plus text-white opacity-0 group-hover:opacity-100 transition-opacity text-xs"})],-1))])):(o(),s("div",qe,[t("a",{href:`/storage/${a.document_path}`,target:"_blank",class:"text-center text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300"},e[35]||(e[35]=[t("i",{class:"fa-solid fa-file-pdf text-lg"},null,-1)]),8,We)]))],8,Ke)):(o(),s("span",Ye,"-"))])):p("",!0)])]))),128))])])]),d.value.total>0?(o(),s("div",Ze,[t("div",et,[t("div",tt,[t("div",at," Menampilkan "+n(d.value.from)+" sampai "+n(d.value.to)+" dari "+n(d.value.total)+" data ",1),t("div",rt,[e[38]||(e[38]=t("label",{class:"text-sm text-gray-700 dark:text-gray-300"},"Per halaman:",-1)),b(t("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>d.value.per_page=a),onChange:e[7]||(e[7]=a=>N(d.value.per_page)),class:"px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"},e[37]||(e[37]=[t("option",{value:"10"},"10",-1),t("option",{value:"15"},"15",-1),t("option",{value:"25"},"25",-1),t("option",{value:"50"},"50",-1),t("option",{value:"100"},"100",-1)]),544),[[C,d.value.per_page]])])]),t("div",st,[t("button",{onClick:e[8]||(e[8]=a=>h(d.value.current_page-1)),disabled:d.value.current_page<=1,class:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed"},e[39]||(e[39]=[t("i",{class:"fa-solid fa-chevron-left"},null,-1)]),8,ot),t("div",lt,[d.value.current_page>3?(o(),s("button",{key:0,onClick:e[9]||(e[9]=a=>h(1)),class:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700"}," 1 ")):p("",!0),d.value.current_page>4?(o(),s("span",dt,"...")):p("",!0),(o(!0),s(k,null,w(P(),a=>(o(),s("button",{key:a,onClick:g=>h(a),class:V(["px-3 py-1 text-sm border rounded",a===d.value.current_page?"bg-blue-600 text-white border-blue-600":"border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700"])},n(a),11,nt))),128)),d.value.current_page<d.value.last_page-3?(o(),s("span",it,"...")):p("",!0),d.value.current_page<d.value.last_page-2?(o(),s("button",{key:3,onClick:e[10]||(e[10]=a=>h(d.value.last_page)),class:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700"},n(d.value.last_page),1)):p("",!0)]),t("button",{onClick:e[11]||(e[11]=a=>h(d.value.current_page+1)),disabled:!d.value.has_more_pages,class:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed"},e[40]||(e[40]=[t("i",{class:"fa-solid fa-chevron-right"},null,-1)]),8,ut)])])])):p("",!0)])])])])])]}),_:1}),E(K(Q),{visible:D.value,imgs:_.value,index:f.value,onHide:e[12]||(e[12]=l=>D.value=!1)},null,8,["visible","imgs","index"])],64))}};export{wt as default};
