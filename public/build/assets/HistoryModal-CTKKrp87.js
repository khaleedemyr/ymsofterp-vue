import{r as u,w as V,L as d,B as r,D as e,A as $,E as g,N as l,H as b,J as v,F as j,M as E,l as I}from"./vendor-vue-g7iCcTkf.js";import{a as L}from"./vendor-utils-CpgP2uT4.js";import{l as A}from"./lodash-DB3HVzpp.js";import F from"./PaymentDetailModal-D3jSla_D.js";const O={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},R={class:"bg-white rounded-lg p-6 max-w-6xl w-full max-h-[90vh] overflow-y-auto"},U={class:"flex justify-between items-center mb-4"},z={key:0,class:"mb-4 p-4 bg-red-100 text-red-700 rounded"},T={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"},J={class:"flex gap-2"},q={key:1,class:"flex justify-center items-center h-48"},G={key:2,class:"overflow-x-auto"},K={class:"min-w-full"},Q={class:"bg-white divide-y divide-gray-200"},W={class:"px-6 py-4 whitespace-nowrap"},X={class:"px-6 py-4 whitespace-nowrap"},Y={class:"px-6 py-4 whitespace-nowrap"},Z={class:"px-6 py-4 whitespace-nowrap"},ee={class:"px-6 py-4 whitespace-nowrap text-green-700 font-semibold"},te={class:"px-6 py-4 whitespace-nowrap text-red-600 font-semibold"},ae={class:"px-6 py-4 whitespace-nowrap"},se={class:"px-6 py-4 whitespace-nowrap"},le={class:"px-6 py-4 whitespace-nowrap"},ne={class:"px-6 py-4 whitespace-nowrap text-center"},oe=["onClick"],re={key:3,class:"mt-4 flex justify-between items-center"},de={class:"text-sm text-gray-500"},ue={class:"flex gap-2"},ie=["disabled"],ce=["disabled"],be={__name:"HistoryModal",emits:["close"],setup(pe,{emit:me}){const w=u([]),i=u(!1),c=u(null),p=u(null),o=u({startDate:"",endDate:"",paymentStatus:"",paymentMethod:"",search:""}),s=u({currentPage:1,lastPage:1,from:0,to:0,total:0}),S=A.debounce(()=>{m()},300);V(o,()=>{s.value.currentPage=1,S()},{deep:!0});async function m(){var n,a;i.value=!0,c.value=null;try{const t=await L.get("/mt-po-payment/history",{params:{page:s.value.currentPage,...o.value}});w.value=t.data.data,s.value={currentPage:t.data.current_page,lastPage:t.data.last_page,from:t.data.from,to:t.data.to,total:t.data.total}}catch(t){c.value=((a=(n=t.response)==null?void 0:n.data)==null?void 0:a.message)||"Error fetching payment history"}finally{i.value=!1}}function C(){s.value.currentPage>1&&(s.value.currentPage--,m())}function N(){s.value.currentPage<s.value.lastPage&&(s.value.currentPage++,m())}function _(n){return new Date(n).toLocaleDateString("id-ID")}function f(n){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(n)}function M(n){return`px-2 py-1 rounded-full text-xs ${{unpaid:"bg-red-100 text-red-800",partial_paid:"bg-yellow-100 text-yellow-800",paid:"bg-green-100 text-green-800"}[n]}`}function B(n){p.value=n}function H(){p.value=null}return m(),(n,a)=>(r(),d("div",O,[e("div",R,[e("div",U,[a[4]||(a[4]=e("h2",{class:"text-xl font-bold"},"Payment History",-1)),e("button",{onClick:a[0]||(a[0]=t=>n.$emit("close")),class:"text-gray-500"},"Ã—")]),c.value?(r(),d("div",z,l(c.value),1)):g("",!0),e("div",T,[e("div",null,[a[5]||(a[5]=e("label",{class:"block text-sm font-medium text-gray-700"},"Date Range",-1)),e("div",J,[b(e("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=t=>o.value.startDate=t),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[v,o.value.startDate]]),b(e("input",{type:"date","onUpdate:modelValue":a[2]||(a[2]=t=>o.value.endDate=t),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[v,o.value.endDate]])])]),e("div",null,[a[6]||(a[6]=e("label",{class:"block text-sm font-medium text-gray-700"},"Search",-1)),b(e("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=t=>o.value.search=t),placeholder:"PO Number/Supplier/Status/Method",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[v,o.value.search]])])]),i.value?(r(),d("div",q,a[7]||(a[7]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},null,-1)]))):(r(),d("div",G,[e("table",K,[a[9]||(a[9]=e("thead",null,[e("tr",{class:"bg-gray-50"},[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"PO Number"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Supplier"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total Amount"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Paid"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Remaining"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Payment Status"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Payment Method"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Payment Date"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",Q,[(r(!0),d(j,null,E(w.value,t=>{var h,k,P,D;return r(),d("tr",{key:t.id},[e("td",W,l(t.po_number),1),e("td",X,l(_(t.created_at)),1),e("td",Y,l(t.supplier.name),1),e("td",Z,l(f(t.total_amount)),1),e("td",ee,l(f(((h=t.payments)==null?void 0:h.reduce((x,y)=>x+Number(y.payment_amount),0))||0)),1),e("td",te,l(f(t.total_amount-(((k=t.payments)==null?void 0:k.reduce((x,y)=>x+Number(y.payment_amount),0))||0))),1),e("td",ae,[e("span",{class:I(M(t.payment_status))},l(t.payment_status),3)]),e("td",se,l((P=t.payments[0])==null?void 0:P.payment_method),1),e("td",le,l(_((D=t.payments[0])==null?void 0:D.payment_date)),1),e("td",ne,[e("button",{onClick:x=>B(t),class:"text-blue-600 hover:text-blue-900",title:"Lihat Detail"},a[8]||(a[8]=[e("i",{class:"fas fa-eye"},null,-1)]),8,oe)])])}),128))])])])),i.value?g("",!0):(r(),d("div",re,[e("div",de," Showing "+l(s.value.from)+" to "+l(s.value.to)+" of "+l(s.value.total)+" entries ",1),e("div",ue,[e("button",{onClick:C,disabled:s.value.currentPage===1,class:"btn-secondary"}," Previous ",8,ie),e("button",{onClick:N,disabled:s.value.currentPage===s.value.lastPage,class:"btn-secondary"}," Next ",8,ce)])]))]),p.value?(r(),$(F,{key:0,po:p.value,onClose:H},null,8,["po"])):g("",!0)]))}};export{be as default};
