import{r as g,c as I,w as V,L as a,B as o,D as e,H as b,G as r,I as N,F as _,M as h,E as v,J as p,x as W,Q as A,N as u,O as Q,l as k}from"./vendor-vue-g7iCcTkf.js";import{a as U}from"./vendor-utils-CpgP2uT4.js";import{S as w}from"./app-CZyV0iGJ.js";import{s as E}from"./vue-multiselect.esm-V-bx43V9.js";/* empty css                            */import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-charts-CuqD4wLC.js";const L={class:"mb-6"},G=["value"],H={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},z=["disabled"],J=["disabled"],R={class:"md:col-span-2"},X={key:0,class:"text-xs text-gray-600 mt-2 bg-blue-50 px-3 py-2 rounded-lg border border-blue-200"},$={key:0,class:"text-orange-600 font-semibold"},Y=["disabled"],Z={class:"md:col-span-2 flex gap-4 items-end"},ee={class:"flex-1"},te=["disabled"],se={class:"w-40"},ie=["disabled"],le=["value"],ae={class:"md:col-span-2"},oe=["disabled"],re={key:0,class:"mt-6 bg-gray-50 rounded-xl p-4 border border-gray-200"},ne={class:"overflow-x-auto"},de={class:"w-full bg-white rounded-lg shadow-sm"},ue={class:"divide-y divide-gray-200"},me={class:"px-4 py-3 text-sm font-medium text-gray-900"},be={class:"px-4 py-3 text-sm text-right text-gray-700"},fe={class:"px-4 py-3 text-sm text-right text-gray-700 font-semibold"},ce={class:"px-4 py-3 text-sm text-right"},pe={class:"inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800"},xe={class:"px-4 py-3 text-sm text-right text-gray-700"},ge={key:0,class:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg"},ve={class:"flex justify-end gap-3 mt-8 pt-6 border-t border-gray-200"},ye=["disabled"],_e={key:0,class:"animate-spin mr-2 inline-block"},he={key:1},ke={__name:"Form",props:{items:Array,warehouses:Array,loading:Boolean,itemsWithBom:Array},emits:["submitted","cancel"],setup(f,{emit:C}){const B=f,M=C,s=g({warehouse_id:"",production_date:new Date().toISOString().slice(0,10),batch_number:"",item_id:null,qty:0,notes:"",unit_id:"",qty_jadi:"",unit_jadi:""}),n=g([]),q=g(""),c=g(!1),O=I(()=>{let l=null;if(s.value.item_id&&(typeof s.value.item_id=="object"&&s.value.item_id.id?l=s.value.item_id.id:(typeof s.value.item_id=="number"||typeof s.value.item_id=="string")&&(l=parseInt(s.value.item_id))),!l)return[];const t=B.items.find(d=>d.id===l);if(!t)return[];const i=[];return t.small_unit_id&&t.small_unit_name&&i.push({id:t.small_unit_id,name:t.small_unit_name}),t.medium_unit_id&&t.medium_unit_name&&t.medium_unit_id!==t.small_unit_id&&i.push({id:t.medium_unit_id,name:t.medium_unit_name}),t.large_unit_id&&t.large_unit_name&&t.large_unit_id!==t.small_unit_id&&t.large_unit_id!==t.medium_unit_id&&i.push({id:t.large_unit_id,name:t.large_unit_name}),i}),P=l=>{if(!l){s.value.item_id=null,s.value.unit_id="",s.value.unit_jadi="",q.value="";return}s.value.item_id=l,s.value.unit_id=l.small_unit_id||"",s.value.unit_jadi=l.small_unit_id||"",q.value=l.small_unit_name||"",y()};function F(){y()}function y(){var i,d;const l=((i=s.value.item_id)==null?void 0:i.id)||s.value.item_id;if(!l||!s.value.qty||!s.value.warehouse_id){n.value=[];return}const t={item_id:l,qty:s.value.qty,warehouse_id:s.value.warehouse_id};c.value=!0,U.post("/mk-production/bom",t,{headers:{"X-CSRF-TOKEN":(d=document.querySelector('meta[name="csrf-token"]'))==null?void 0:d.getAttribute("content")}}).then(m=>{if(m.data.error){w.fire({icon:"warning",title:"Item Tidak Memiliki BOM",text:m.data.error,confirmButtonText:"OK"}),n.value=[];return}n.value=m.data}).catch(m=>{n.value=[]}).finally(()=>c.value=!1)}function T(){var i,d;if(n.value.some(m=>m.sisa<0))return;c.value=!0;const l=((i=s.value.item_id)==null?void 0:i.id)||s.value.item_id,t={...s.value,item_id:l,qty:s.value.qty,unit_id:s.value.unit_jadi||s.value.unit_id};U.post("/mk-production",t,{headers:{"X-CSRF-TOKEN":(d=document.querySelector('meta[name="csrf-token"]'))==null?void 0:d.getAttribute("content")}}).then(()=>{w.fire({icon:"success",title:"Berhasil",text:"Produksi berhasil disimpan!",timer:1500,showConfirmButton:!1}).then(()=>{M("submitted")})}).catch(m=>{var j,S;w.fire({icon:"error",title:"Gagal",text:((S=(j=m.response)==null?void 0:j.data)==null?void 0:S.message)||"Gagal menyimpan produksi"})}).finally(()=>c.value=!1)}function x(l){return Number(l).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function D(l){var i;const t=typeof l=="object"?l:{id:l};return((i=B.itemsWithBom)==null?void 0:i.some(d=>d.id==t.id))||!1}return V(()=>s.value.item_id,()=>{s.value.unit_jadi=""}),V(()=>s.value.warehouse_id,()=>{s.value.item_id&&y()}),(l,t)=>(o(),a("div",null,[t[29]||(t[29]=e("div",{class:"flex items-center gap-2 mb-6"},[e("div",{class:"p-2 bg-blue-100 rounded-lg"},[e("i",{class:"fa-solid fa-industry text-blue-600"})]),e("h2",{class:"text-xl font-bold text-gray-800"},"Form Produksi Baru")],-1)),e("div",L,[t[10]||(t[10]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[e("i",{class:"fa-solid fa-warehouse text-blue-500 mr-2"}),r(" Warehouse ")],-1)),b(e("select",{"onUpdate:modelValue":t[0]||(t[0]=i=>s.value.warehouse_id=i),class:"w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white",required:""},[t[9]||(t[9]=e("option",{value:"",disabled:""},"Pilih Warehouse",-1)),(o(!0),a(_,null,h(f.warehouses,i=>(o(),a("option",{key:i.id,value:i.id},u(i.name),9,G))),128))],512),[[N,s.value.warehouse_id]])]),e("form",{onSubmit:Q(T,["prevent"]),class:"space-y-6"},[e("div",H,[e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[e("i",{class:"fa-solid fa-calendar-day text-blue-500 mr-2"}),r(" Tanggal Produksi ")],-1)),b(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=i=>s.value.production_date=i),class:"w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",required:"",disabled:!s.value.warehouse_id},null,8,z),[[p,s.value.production_date]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[e("i",{class:"fa-solid fa-barcode text-blue-500 mr-2"}),r(" Batch Number ")],-1)),b(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=i=>s.value.batch_number=i),class:"w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",placeholder:"Batch/No Lot",disabled:!s.value.warehouse_id},null,8,J),[[p,s.value.batch_number]])]),e("div",R,[t[15]||(t[15]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[e("i",{class:"fa-solid fa-box text-blue-500 mr-2"}),r(" Item Hasil Produksi ")],-1)),W(A(E),{modelValue:s.value.item_id,"onUpdate:modelValue":t[3]||(t[3]=i=>s.value.item_id=i),options:f.items,searchable:!0,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Pilih atau cari item...","track-by":"id",label:"name","preselect-first":!1,class:"w-full",onSelect:P},null,8,["modelValue","options"]),f.itemsWithBom&&f.itemsWithBom.length?(o(),a("div",X,[t[13]||(t[13]=e("i",{class:"fa-solid fa-lightbulb text-blue-500 mr-1"},null,-1)),e("strong",null,u(f.itemsWithBom.length),1),t[14]||(t[14]=r(" item tersedia dengan BOM. ")),s.value.item_id&&!D(s.value.item_id)?(o(),a("span",$," Item yang dipilih tidak memiliki BOM. ")):v("",!0)])):v("",!0)]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[e("i",{class:"fa-solid fa-calculator text-blue-500 mr-2"}),r(" Qty Produksi ")],-1)),b(e("input",{type:"number",min:"0",step:"0.01","onUpdate:modelValue":t[4]||(t[4]=i=>s.value.qty=i),class:"w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",required:"",onInput:F,disabled:!s.value.warehouse_id||!s.value.item_id,placeholder:"0.00"},null,40,Y),[[p,s.value.qty,void 0,{number:!0}]]),t[17]||(t[17]=e("p",{class:"text-xs text-gray-500 mt-1"},"Bisa menggunakan desimal (contoh: 0.5, 1.25)",-1))]),e("div",Z,[e("div",ee,[t[18]||(t[18]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[e("i",{class:"fa-solid fa-check-circle text-blue-500 mr-2"}),r(" Qty Jadi ")],-1)),b(e("input",{type:"number",min:"0",step:"0.01","onUpdate:modelValue":t[5]||(t[5]=i=>s.value.qty_jadi=i),class:"w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",disabled:!s.value.item_id,placeholder:"0.00"},null,8,te),[[p,s.value.qty_jadi,void 0,{number:!0}]])]),e("div",se,[t[20]||(t[20]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[e("i",{class:"fa-solid fa-ruler text-blue-500 mr-2"}),r(" Unit ")],-1)),b(e("select",{"onUpdate:modelValue":t[6]||(t[6]=i=>s.value.unit_jadi=i),class:"w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white",disabled:!s.value.item_id},[t[19]||(t[19]=e("option",{value:"",disabled:""},"Pilih Unit",-1)),(o(!0),a(_,null,h(O.value,i=>(o(),a("option",{key:i.id,value:i.id},u(i.name),9,le))),128))],8,ie),[[N,s.value.unit_jadi]])])]),e("div",ae,[t[21]||(t[21]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[e("i",{class:"fa-solid fa-note-sticky text-blue-500 mr-2"}),r(" Catatan ")],-1)),b(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=i=>s.value.notes=i),class:"w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all resize-none",rows:"3",placeholder:"Catatan tambahan (opsional)",disabled:!s.value.warehouse_id},null,8,oe),[[p,s.value.notes]])])]),n.value.length?(o(),a("div",re,[t[24]||(t[24]=e("div",{class:"flex items-center gap-2 mb-4"},[e("div",{class:"p-2 bg-amber-100 rounded-lg"},[e("i",{class:"fa-solid fa-list-check text-amber-600"})]),e("h3",{class:"font-bold text-gray-800"},"Bahan Baku (BOM)")],-1)),e("div",ne,[e("table",de,[t[22]||(t[22]=e("thead",{class:"bg-gradient-to-r from-amber-600 to-amber-700"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-bold text-white uppercase tracking-wider"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"fa-solid fa-box text-amber-200"}),e("span",null,"Bahan")])]),e("th",{class:"px-4 py-3 text-right text-xs font-bold text-white uppercase tracking-wider"},[e("div",{class:"flex items-center justify-end gap-2"},[e("i",{class:"fa-solid fa-calculator text-amber-200"}),e("span",null,"Qty/1")])]),e("th",{class:"px-4 py-3 text-right text-xs font-bold text-white uppercase tracking-wider"},[e("div",{class:"flex items-center justify-end gap-2"},[e("i",{class:"fa-solid fa-sigma text-amber-200"}),e("span",null,"Total")])]),e("th",{class:"px-4 py-3 text-right text-xs font-bold text-white uppercase tracking-wider"},[e("div",{class:"flex items-center justify-end gap-2"},[e("i",{class:"fa-solid fa-ruler text-amber-200"}),e("span",null,"Unit")])]),e("th",{class:"px-4 py-3 text-right text-xs font-bold text-white uppercase tracking-wider"},[e("div",{class:"flex items-center justify-end gap-2"},[e("i",{class:"fa-solid fa-warehouse text-amber-200"}),e("span",null,"Stok")])]),e("th",{class:"px-4 py-3 text-right text-xs font-bold text-white uppercase tracking-wider"},[e("div",{class:"flex items-center justify-end gap-2"},[e("i",{class:"fa-solid fa-balance-scale text-amber-200"}),e("span",null,"Sisa")])])])],-1)),e("tbody",ue,[(o(!0),a(_,null,h(n.value,i=>(o(),a("tr",{key:i.material_item_id,class:k([i.sisa<0?"bg-red-50 hover:bg-red-100":"hover:bg-amber-50","transition-colors"])},[e("td",me,u(i.material_name),1),e("td",be,u(x(i.qty_per_1)),1),e("td",fe,u(x(i.qty_total)),1),e("td",ce,[e("span",pe,u(i.unit_name),1)]),e("td",xe,u(x(i.stok)),1),e("td",{class:k(["px-4 py-3 text-sm text-right font-bold",i.sisa<0?"text-red-600":"text-green-700"])},[e("span",{class:k([i.sisa<0?"bg-red-100 text-red-800":"bg-green-100 text-green-800","inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold"])},u(x(i.sisa)),3)],2)],2))),128))])])]),n.value.some(i=>i.sisa<0)?(o(),a("div",ge,t[23]||(t[23]=[e("div",{class:"flex items-center gap-2 text-red-700 font-semibold"},[e("i",{class:"fa-solid fa-exclamation-triangle"}),e("span",null,"Stok bahan tidak cukup untuk produksi!")],-1)]))):v("",!0)])):v("",!0),e("div",ve,[e("button",{type:"button",class:"px-6 py-2.5 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-xl transition-all font-semibold border-2 border-gray-200 hover:border-gray-300",onClick:t[8]||(t[8]=i=>l.$emit("cancel"))},t[25]||(t[25]=[e("i",{class:"fa-solid fa-times mr-2"},null,-1),r(" Batal ")])),e("button",{type:"submit",class:"px-6 py-2.5 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-xl shadow-lg hover:shadow-xl transition-all font-semibold transform hover:-translate-y-0.5",disabled:c.value||n.value.some(i=>i.sisa<0)||!s.value.item_id||!s.value.qty||s.value.qty<=0},[c.value?(o(),a("span",_e,t[26]||(t[26]=[e("i",{class:"fa fa-spinner"},null,-1)]))):(o(),a("span",he,t[27]||(t[27]=[e("i",{class:"fa-solid fa-save mr-2"},null,-1)]))),t[28]||(t[28]=r(" Simpan Produksi "))],8,ye)])],32)]))}},Ue=K(ke,[["__scopeId","data-v-c913d491"]]);export{Ue as default};
