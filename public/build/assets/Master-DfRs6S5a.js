import{r as b,c as Y,w as Q,a as Z,A as ee,B as u,C as te,D as l,L as c,E as O,G as s,H as r,F as E,M as P,N as w,I as K,l as q,V as d,W as le,n as ae}from"./vendor-vue-g7iCcTkf.js";import{A as ne}from"./AppLayout-D8A3r8FT.js";import{S as m}from"./app-3SxMownK.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-utils-CpgP2uT4.js";import"./ProfileUpdateModal-BaUvls0f.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const se={class:"w-full min-h-[60vh] h-[calc(100vh-150px)] flex flex-col justify-start items-stretch py-4"},ie={key:0,class:"fixed inset-0 bg-black bg-opacity-20 flex items-center justify-center z-50"},re={class:"flex gap-4 mb-6 items-center"},ue=["value"],de=["value"],pe=["disabled"],ce=["disabled"],ve=["disabled"],xe={key:0,class:"ml-2 text-sm text-gray-700 font-semibold truncate max-w-[180px]"},fe=["disabled"],be={key:0},me={key:1},ye={class:"flex-1 w-full overflow-auto"},ge={key:0,class:"w-full h-full"},he={class:"overflow-x-auto"},ke={class:"w-full min-w-[1200px] divide-y divide-blue-200 bg-white rounded-2xl shadow-2xl animate-fade-in-up"},we={class:"bg-gradient-to-r from-blue-600 to-green-400 text-white sticky top-0 z-10"},_e={class:"bg-gradient-to-r from-blue-100 to-green-100 text-blue-900 text-xs"},je={class:"px-2 py-1 text-center"},Ve=["value"],Ce={class:"px-2 py-1 text-center"},Ue=["value"],De={class:"px-2 py-1 text-center"},Ne={class:"px-2 py-1 text-center"},Ie={class:"px-2 py-1 text-center"},Be={class:"px-2 py-1 text-center"},Ee={class:"px-2 py-1 text-center"},Se={class:"px-2 py-1 text-center"},Ae={class:"px-2 py-1 text-center"},Te={class:"px-2 py-1 text-center"},Fe={class:"px-2 py-1 text-center flex items-center justify-center gap-2"},Oe={class:"px-4 py-2"},Pe={class:"px-4 py-2 font-semibold"},Me={class:"px-4 py-2"},Re={class:"px-4 py-2 text-center font-bold text-purple-600"},$e={class:"px-2 py-2 text-center"},Le=["value","onInput","onBlur"],Ke={class:"px-2 py-2 text-center"},qe=["value","onInput","onBlur"],Je={class:"px-2 py-2 text-center"},Ge=["onUpdate:modelValue"],Xe={class:"px-2 py-2 text-center"},He=["onUpdate:modelValue"],We={class:"px-2 py-2 text-center"},ze=["onUpdate:modelValue"],Ye={class:"px-2 py-2 text-center"},Qe=["onUpdate:modelValue"],Ze={class:"px-2 py-2 text-center"},et=["onUpdate:modelValue"],tt={class:"px-2 py-2 text-center"},lt=["onUpdate:modelValue"],at={class:"px-2 py-2 text-center"},nt=["onUpdate:modelValue"],ot={class:"px-2 py-2 text-center"},st=["onUpdate:modelValue"],it={class:"px-2 py-2 text-center"},rt=["onUpdate:modelValue"],ut={key:1,colspan:"11",class:"text-center text-gray-400"},dt={key:1,class:"text-center text-gray-400 py-12"},pt={key:1,class:"flex justify-end mt-6"},ct=["disabled"],vt={key:0},xt={key:1},ft={__name:"Master",props:{outlets:Array,divisions:Array,users:Array,filter:Object,payrollMaster:Object},setup(J){var $,L;const g=J,v=b((($=g.filter)==null?void 0:$.outlet_id)||""),p=b(((L=g.filter)==null?void 0:L.division_id)||""),V=b(g.users||[]),S=b(!1),y=b([]),n=b({gaji:"",tunjangan:"",ot:!1,um:!1,ph:!1,sc:!1,bpjs_jkn:!1,bpjs_tk:!1,lb:!1,deviasi:!1,city_ledger:!1}),C=b(!1),_=b(!1),h=b(null),D=b(""),A=b(!1);function j(o){return o?o.toString().replace(/\D/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,","):""}function T(o){return o?o.toString().replace(/\D/g,""):""}function N(o,e,t){const a=o.target,f=a.value,k=T(f);if(t){const U=y.value.find(F=>F.user_id===t);U&&(U[e]=k)}else n.value[e]=k;a.value=j(k)}function I(o){const e=o.target,t=e.value,a=T(t);e.value=a}function B(o,e,t){const a=o.target,f=a.value,k=T(f);if(t){const U=y.value.find(F=>F.user_id===t);U&&(U[e]=k)}else n.value[e]=k;a.value=j(k)}function G(){var o,e,t;D.value=((e=(o=h.value)==null?void 0:o.files[0])==null?void 0:e.name)||"",A.value=!!((t=h.value)!=null&&t.files.length)}function M(o){if(!o||!Array.isArray(o)){y.value=[];return}y.value=o.map(e=>{var a;const t=((a=g.payrollMaster)==null?void 0:a[e.id])||{};return{user_id:e.id,gaji:t.gaji??"",tunjangan:t.tunjangan??"",ot:t.ot==1,um:t.um==1,ph:t.ph==1,sc:t.sc==1,bpjs_jkn:t.bpjs_jkn==1,bpjs_tk:t.bpjs_tk==1,lb:t.lb==1,deviasi:t.deviasi==1,city_ledger:t.city_ledger==1}})}const i=Y(()=>{const o={};return y.value.forEach(e=>{o[e.user_id]=e}),o});Q(()=>g.users,o=>{V.value=o||[],M(o)},{immediate:!0}),Z(()=>{M(g.users)});function R(){!v.value&&!p.value||(S.value=!0,le.get("/payroll/master",{outlet_id:v.value,division_id:p.value},{preserveState:!0,replace:!0,onFinish:()=>ae(()=>{S.value=!1})}))}function X(){if(!v.value||!p.value)return;const o=`/payroll/master/template?outlet_id=${v.value}&division_id=${p.value}`;window.open(o,"_blank")}function x(o,e){n.value[o]=e,y.value.forEach(t=>{t[o]=e})}function H(){Object.keys(n.value).forEach(o=>{n.value[o]=typeof n.value[o]=="boolean"?!1:""})}async function W(){var e;if(!v.value&&!p.value){m.fire("Peringatan","Pilih Outlet atau Divisi terlebih dahulu","warning");return}if(!V.value.length||!y.value.length){m.fire("Peringatan","Tidak ada data untuk disimpan","warning");return}if((await m.fire({title:"Konfirmasi",text:"Apakah Anda yakin ingin menyimpan data payroll ini?",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Simpan",cancelButtonText:"Batal",reverseButtons:!0})).isConfirmed){C.value=!0,m.fire({title:"Menyimpan...",text:"Mohon tunggu, data sedang diproses",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>{m.showLoading()}});try{const t={outlet_id:v.value?parseInt(v.value):0,division_id:p.value&&p.value!==""?parseInt(p.value):0,payrollData:y.value},f=await(await fetch("/payroll/master",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":(e=document.querySelector("meta[name=csrf-token]"))==null?void 0:e.content},body:JSON.stringify(t)})).json();f.success?m.fire("Berhasil",f.message||"Data payroll berhasil disimpan","success"):m.fire("Gagal",f.message||"Gagal menyimpan data payroll","error")}catch(t){console.error("Error saving payroll:",t),m.fire("Error","Terjadi kesalahan saat menyimpan data payroll","error")}finally{C.value=!1}}}async function z(){var t;const o=h.value&&h.value.files&&h.value.files[0];if(!o||!v.value||!p.value)return;_.value=!0;const e=new FormData;e.append("file",o),e.append("outlet_id",v.value),e.append("division_id",p.value);try{const f=await(await fetch("/payroll/master/import",{method:"POST",body:e,headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":(t=document.querySelector("meta[name=csrf-token]"))==null?void 0:t.content}})).json();f.success?(m.fire("Berhasil",f.message||"Import payroll berhasil","success"),R()):m.fire("Gagal",f.message||"Import payroll gagal","error")}catch(a){console.error("Error importing payroll:",a),m.fire("Error","Terjadi kesalahan saat import payroll","error")}finally{_.value=!1,h.value&&(h.value.value=""),D.value="",A.value=!1}}return(o,e)=>(u(),ee(ne,{title:"Master Payroll"},{default:te(()=>[l("div",se,[S.value?(u(),c("div",ie,e[30]||(e[30]=[l("div",{class:"animate-spin rounded-full h-20 w-20 border-t-4 border-b-4 border-blue-500"},null,-1)]))):O("",!0),e[50]||(e[50]=l("h1",{class:"text-2xl font-bold text-blue-800 mb-6 flex items-center gap-2"},[l("i",{class:"fa-solid fa-money-check-dollar text-green-500"}),s(" Master Payroll ")],-1)),l("div",re,[r(l("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>v.value=t),class:"form-input rounded-xl shadow-lg w-80",autofocus:""},[e[31]||(e[31]=l("option",{value:""},"Pilih Outlet",-1)),(u(!0),c(E,null,P(g.outlets,t=>(u(),c("option",{key:t.id,value:t.id},w(t.name),9,ue))),128))],512),[[K,v.value]]),r(l("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>p.value=t),class:"form-input rounded-xl shadow-lg w-80"},[e[32]||(e[32]=l("option",{value:""},"Pilih Divisi",-1)),(u(!0),c(E,null,P(g.divisions,t=>(u(),c("option",{key:t.id,value:t.id},w(t.name),9,de))),128))],512),[[K,p.value]]),l("button",{onClick:R,class:"bg-gradient-to-br from-green-400 to-blue-500 text-white px-6 py-2 rounded-xl shadow-xl hover:scale-105 hover:shadow-2xl transition-all duration-300 font-bold",disabled:!v.value&&!p.value},e[33]||(e[33]=[l("i",{class:"fa-solid fa-magnifying-glass"},null,-1),s(" Lihat Data ")]),8,pe),l("button",{onClick:X,class:"bg-gradient-to-br from-blue-500 to-green-400 text-white px-6 py-2 rounded-xl shadow-xl hover:scale-105 hover:shadow-2xl transition-all duration-300 font-bold",disabled:!v.value&&!p.value},e[34]||(e[34]=[l("i",{class:"fa-solid fa-file-arrow-down"},null,-1),s(" Download Template ")]),8,ce),l("label",{class:q(["bg-gradient-to-br from-yellow-400 to-orange-400 text-white px-6 py-2 rounded-xl shadow-xl hover:scale-105 hover:shadow-2xl transition-all duration-300 font-bold cursor-pointer flex items-center gap-2 mb-0",{"opacity-60 pointer-events-none":!v.value||!p.value||_.value}])},[e[35]||(e[35]=l("i",{class:"fa-solid fa-file-arrow-up"},null,-1)),e[36]||(e[36]=s(" Pilih File ")),l("input",{ref_key:"importFileInput",ref:h,type:"file",accept:".xlsx,.xls",class:"hidden",disabled:!v.value||!p.value||_.value,onChange:G},null,40,ve)],2),D.value?(u(),c("span",xe,w(D.value),1)):O("",!0),l("button",{onClick:z,disabled:_.value||!v.value||!p.value||!A.value,class:"bg-orange-500 text-white px-6 py-2 rounded-xl shadow-xl hover:bg-orange-600 transition-all duration-300 font-bold flex items-center gap-2"},[_.value?(u(),c("span",be,e[37]||(e[37]=[l("i",{class:"fa fa-spinner fa-spin"},null,-1)]))):(u(),c("span",me,e[38]||(e[38]=[l("i",{class:"fa-solid fa-cloud-arrow-up"},null,-1)]))),e[39]||(e[39]=s(" Import "))],8,fe)]),l("div",ye,[V.value.length?(u(),c("div",ge,[l("div",he,[l("table",ke,[l("thead",we,[e[45]||(e[45]=l("tr",null,[l("th",{class:"px-4 py-3 text-left text-xs font-bold uppercase tracking-wider"},"NIK"),l("th",{class:"px-4 py-3 text-left text-xs font-bold uppercase tracking-wider"},"Nama Karyawan"),l("th",{class:"px-4 py-3 text-left text-xs font-bold uppercase tracking-wider"},"Jabatan"),l("th",{class:"px-4 py-3 text-center text-xs font-bold uppercase tracking-wider"},"Point"),l("th",{class:"px-4 py-3 text-center text-xs font-bold uppercase tracking-wider"},[s("GAJI"),l("br"),s("(EARN)")]),l("th",{class:"px-4 py-3 text-center text-xs font-bold uppercase tracking-wider"},[s("TUNJANGAN"),l("br"),s("(EARN)")]),l("th",{class:"px-2 py-3 text-center text-xs font-bold uppercase tracking-wider"},[s("OT"),l("br"),s("(EARN)")]),l("th",{class:"px-2 py-3 text-center text-xs font-bold uppercase tracking-wider"},[s("UM"),l("br"),s("(EARN)")]),l("th",{class:"px-2 py-3 text-center text-xs font-bold uppercase tracking-wider"},[s("PH"),l("br"),s("(EARN)")]),l("th",{class:"px-2 py-3 text-center text-xs font-bold uppercase tracking-wider"},[s("SC"),l("br"),s("(EARN)")]),l("th",{class:"px-2 py-3 text-center text-xs font-bold uppercase tracking-wider"},[s("BPJS JKN"),l("br"),s("(DEDUCTION)")]),l("th",{class:"px-2 py-3 text-center text-xs font-bold uppercase tracking-wider"},[s("BPJS TK"),l("br"),s("(DEDUCTION)")]),l("th",{class:"px-2 py-3 text-center text-xs font-bold uppercase tracking-wider"},[s("L & B"),l("br"),s("(DEDUCTION)")]),l("th",{class:"px-2 py-3 text-center text-xs font-bold uppercase tracking-wider"},[s("Deviasi"),l("br"),s("(DEDUCTION)")]),l("th",{class:"px-2 py-3 text-center text-xs font-bold uppercase tracking-wider"},[s("City Ledger"),l("br"),s("(DEDUCTION)")])],-1)),l("tr",_e,[e[41]||(e[41]=l("td",null,null,-1)),e[42]||(e[42]=l("td",{class:"text-right pr-2 font-bold"},"Isi Semua:",-1)),e[43]||(e[43]=l("td",null,null,-1)),e[44]||(e[44]=l("td",null,null,-1)),l("td",je,[l("input",{type:"text",value:j(n.value.gaji),class:"form-input text-blue-900 font-bold text-center w-24",onInput:e[2]||(e[2]=t=>N(t,"gaji")),onFocus:e[3]||(e[3]=t=>I(t)),onBlur:e[4]||(e[4]=t=>B(t,"gaji")),onChange:e[5]||(e[5]=t=>x("gaji",n.value.gaji)),placeholder:"0"},null,40,Ve)]),l("td",Ce,[l("input",{type:"text",value:j(n.value.tunjangan),class:"form-input text-blue-900 font-bold text-center w-24",onInput:e[6]||(e[6]=t=>N(t,"tunjangan")),onFocus:e[7]||(e[7]=t=>I(t)),onBlur:e[8]||(e[8]=t=>B(t,"tunjangan")),onChange:e[9]||(e[9]=t=>x("tunjangan",n.value.tunjangan)),placeholder:"0"},null,40,Ue)]),l("td",De,[r(l("input",{type:"checkbox","onUpdate:modelValue":e[10]||(e[10]=t=>n.value.ot=t),onChange:e[11]||(e[11]=t=>x("ot",n.value.ot))},null,544),[[d,n.value.ot]])]),l("td",Ne,[r(l("input",{type:"checkbox","onUpdate:modelValue":e[12]||(e[12]=t=>n.value.um=t),onChange:e[13]||(e[13]=t=>x("um",n.value.um))},null,544),[[d,n.value.um]])]),l("td",Ie,[r(l("input",{type:"checkbox","onUpdate:modelValue":e[14]||(e[14]=t=>n.value.ph=t),onChange:e[15]||(e[15]=t=>x("ph",n.value.ph))},null,544),[[d,n.value.ph]])]),l("td",Be,[r(l("input",{type:"checkbox","onUpdate:modelValue":e[16]||(e[16]=t=>n.value.sc=t),onChange:e[17]||(e[17]=t=>x("sc",n.value.sc))},null,544),[[d,n.value.sc]])]),l("td",Ee,[r(l("input",{type:"checkbox","onUpdate:modelValue":e[18]||(e[18]=t=>n.value.bpjs_jkn=t),onChange:e[19]||(e[19]=t=>x("bpjs_jkn",n.value.bpjs_jkn))},null,544),[[d,n.value.bpjs_jkn]])]),l("td",Se,[r(l("input",{type:"checkbox","onUpdate:modelValue":e[20]||(e[20]=t=>n.value.bpjs_tk=t),onChange:e[21]||(e[21]=t=>x("bpjs_tk",n.value.bpjs_tk))},null,544),[[d,n.value.bpjs_tk]])]),l("td",Ae,[r(l("input",{type:"checkbox","onUpdate:modelValue":e[22]||(e[22]=t=>n.value.lb=t),onChange:e[23]||(e[23]=t=>x("lb",n.value.lb))},null,544),[[d,n.value.lb]])]),l("td",Te,[r(l("input",{type:"checkbox","onUpdate:modelValue":e[24]||(e[24]=t=>n.value.deviasi=t),onChange:e[25]||(e[25]=t=>x("deviasi",n.value.deviasi))},null,544),[[d,n.value.deviasi]])]),l("td",Fe,[r(l("input",{type:"checkbox","onUpdate:modelValue":e[26]||(e[26]=t=>n.value.city_ledger=t),onChange:e[27]||(e[27]=t=>x("city_ledger",n.value.city_ledger))},null,544),[[d,n.value.city_ledger]]),l("button",{onClick:H,class:"ml-2 text-red-500 hover:text-red-700",title:"Reset Isi Semua"},e[40]||(e[40]=[l("i",{class:"fa fa-eraser"},null,-1)]))])])]),l("tbody",null,[(u(!0),c(E,null,P(V.value,t=>(u(),c("tr",{key:t.id,class:"hover:scale-[1.01] hover:shadow-xl transition-all duration-200 bg-white/80 hover:bg-blue-50 cursor-pointer border-b border-blue-100"},[l("td",Oe,w(t.nik),1),l("td",Pe,w(t.nama_lengkap),1),l("td",Me,w(t.jabatan),1),l("td",Re,w(t.point||0),1),i.value[t.id]?(u(),c(E,{key:0},[l("td",$e,[l("input",{type:"text",value:j(i.value[t.id].gaji),class:"form-input text-blue-900 font-bold text-center w-32",onInput:a=>N(a,"gaji",t.id),onFocus:e[28]||(e[28]=a=>I(a)),onBlur:a=>B(a,"gaji",t.id),placeholder:"0"},null,40,Le)]),l("td",Ke,[l("input",{type:"text",value:j(i.value[t.id].tunjangan),class:"form-input text-blue-900 font-bold text-center w-32",onInput:a=>N(a,"tunjangan",t.id),onFocus:e[29]||(e[29]=a=>I(a)),onBlur:a=>B(a,"tunjangan",t.id),placeholder:"0"},null,40,qe)]),l("td",Je,[r(l("input",{type:"checkbox","onUpdate:modelValue":a=>i.value[t.id].ot=a},null,8,Ge),[[d,i.value[t.id].ot]])]),l("td",Xe,[r(l("input",{type:"checkbox","onUpdate:modelValue":a=>i.value[t.id].um=a},null,8,He),[[d,i.value[t.id].um]])]),l("td",We,[r(l("input",{type:"checkbox","onUpdate:modelValue":a=>i.value[t.id].ph=a},null,8,ze),[[d,i.value[t.id].ph]])]),l("td",Ye,[r(l("input",{type:"checkbox","onUpdate:modelValue":a=>i.value[t.id].sc=a},null,8,Qe),[[d,i.value[t.id].sc]])]),l("td",Ze,[r(l("input",{type:"checkbox","onUpdate:modelValue":a=>i.value[t.id].bpjs_jkn=a},null,8,et),[[d,i.value[t.id].bpjs_jkn]])]),l("td",tt,[r(l("input",{type:"checkbox","onUpdate:modelValue":a=>i.value[t.id].bpjs_tk=a},null,8,lt),[[d,i.value[t.id].bpjs_tk]])]),l("td",at,[r(l("input",{type:"checkbox","onUpdate:modelValue":a=>i.value[t.id].lb=a},null,8,nt),[[d,i.value[t.id].lb]])]),l("td",ot,[r(l("input",{type:"checkbox","onUpdate:modelValue":a=>i.value[t.id].deviasi=a},null,8,st),[[d,i.value[t.id].deviasi]])]),l("td",it,[r(l("input",{type:"checkbox","onUpdate:modelValue":a=>i.value[t.id].city_ledger=a},null,8,rt),[[d,i.value[t.id].city_ledger]])])],64)):(u(),c("td",ut,"Data tidak tersedia"))]))),128))])])])])):(u(),c("div",dt,e[46]||(e[46]=[s(" Silakan pilih outlet atau divisi, lalu klik "),l("b",null,"Lihat Data",-1),s(". ")])))]),V.value.length&&y.value.length?(u(),c("div",pt,[l("button",{onClick:W,disabled:C.value,class:q(["bg-blue-600 text-white px-8 py-2 rounded-xl shadow hover:bg-blue-700 font-bold text-lg flex items-center gap-2 transition-all duration-300",{"opacity-50 cursor-not-allowed":C.value}])},[C.value?(u(),c("span",vt,e[47]||(e[47]=[l("i",{class:"fa fa-spinner fa-spin"},null,-1)]))):(u(),c("span",xt,e[48]||(e[48]=[l("i",{class:"fa-solid fa-floppy-disk"},null,-1)]))),e[49]||(e[49]=s(" Simpan "))],10,ct)])):O("",!0)])]),_:1}))}},Ct=oe(ft,[["__scopeId","data-v-6aedf0f6"]]);export{Ct as default};
