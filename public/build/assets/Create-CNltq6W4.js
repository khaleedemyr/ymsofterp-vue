import{P as T,r as v,c as C,a as N,A as V,B as l,C as h,D as e,x as M,Q as r,S,G as g,O as E,L as n,E as m,H as p,J as x,F as B,M as U,N as a}from"./vendor-vue-g7iCcTkf.js";import{A as F}from"./AppLayout-CCl6N_RX.js";import{a as A}from"./vendor-utils-CpgP2uT4.js";import"./app-DvUgkxHf.js";import"./vendor-charts-CuqD4wLC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-oDgFzWKX.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const L={class:"w-full py-8 px-0"},R={class:"flex justify-between items-center mb-6"},H={class:"relative"},J={key:0,class:"absolute right-3 top-3"},Y={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto"},q=["onClick"],K={class:"flex items-center justify-between"},z={class:"flex-1"},G={class:"font-semibold text-gray-900"},Q={class:"text-sm text-gray-600"},$={class:"text-xs text-gray-500 mt-1"},W={class:"text-sm text-blue-600 font-semibold ml-4"},X={key:2,class:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg p-4 text-center text-gray-500"},Z={key:0,class:"mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200"},ee={class:"flex items-center justify-between"},te={class:"font-semibold text-gray-900"},se={class:"text-sm text-gray-600"},ae={key:1,class:"mt-1 text-sm text-red-600"},oe={key:0,class:"mt-1 text-sm text-red-600"},re=["max"],le={key:0,class:"mt-1 text-sm text-red-600"},ne=["min"],ie={class:"text-xs text-gray-500 mt-1"},de={key:0,class:"mt-1 text-sm text-red-600"},ue={key:0,class:"bg-gray-50 rounded-lg p-4 border border-gray-200"},me={class:"space-y-1 text-sm"},ce={class:"flex justify-between"},be={class:"font-semibold"},ge={class:"flex justify-between"},pe={class:"font-semibold"},xe={class:"flex justify-between"},fe={class:"font-semibold text-green-600"},ve={class:"flex justify-between"},ye={class:"font-semibold text-blue-600"},_e={key:1,class:"bg-red-50 border-l-4 border-red-500 p-4 rounded"},ke={class:"flex"},he={class:"ml-3"},we={class:"text-sm text-red-700"},Me={class:"flex gap-4"},Se=["disabled"],je={key:0,class:"fa fa-spinner fa-spin"},De={key:1,class:"fa-solid fa-coins"},Ae={__name:"Create",props:{errors:Object},setup(d){const s=T({member_id:null,point_amount:null,transaction_date:new Date().toISOString().split("T")[0],reference_id:"",expires_at:"",description:""}),c=v([]),i=v(null),b=v(""),y=v(!1),f=v(!1),_=new Date().toISOString().split("T")[0];let k=null;const j=async()=>{const u=b.value;if(!u||u.length<2){c.value=[];return}k&&clearTimeout(k),y.value=!0,k=setTimeout(async()=>{try{const t=await A.get("/manual-point/search-members",{params:{search:u}});c.value=t.data||[]}catch(t){console.error("Error searching members:",t),c.value=[]}finally{y.value=!1}},300)},D=u=>{s.member_id=u.id,i.value=u,b.value="",c.value=[]},I=()=>{s.member_id=null,i.value=null,b.value="",c.value=[]},O=u=>u?new Intl.NumberFormat("id-ID").format(u):"0",w=C(()=>s.member_id&&s.point_amount&&s.point_amount>0&&s.transaction_date&&s.description.trim().length>0),P=()=>{w.value&&(f.value=!0,s.post("/manual-point",{preserveScroll:!0,onSuccess:()=>{s.reset(),s.transaction_date=new Date().toISOString().split("T")[0],i.value=null,c.value=[]},onFinish:()=>{f.value=!1}}))};return N(()=>{s.transaction_date||(s.transaction_date=_)}),(u,t)=>(l(),V(F,null,{default:h(()=>[e("div",L,[e("div",R,[e("div",null,[M(r(S),{href:"/manual-point",class:"text-blue-600 hover:text-blue-800 mb-2 inline-flex items-center gap-2"},{default:h(()=>t[6]||(t[6]=[e("i",{class:"fa-solid fa-arrow-left"},null,-1),g(" Kembali ke Daftar ")])),_:1}),t[7]||(t[7]=e("h1",{class:"text-2xl font-bold text-gray-800 flex items-center gap-2"},[e("i",{class:"fa-solid fa-coins"}),g(" Inject Point Manual ")],-1))])]),t[26]||(t[26]=e("div",{class:"bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded"},[e("div",{class:"flex"},[e("div",{class:"flex-shrink-0"},[e("i",{class:"fa-solid fa-info-circle text-blue-500"})]),e("div",{class:"ml-3"},[e("p",{class:"text-sm text-blue-700"}," Fitur ini digunakan untuk inject point manual ke member jika ada kegagalan dari POS. Point yang di-inject akan memiliki expiry 1 tahun dari tanggal transaksi (atau sesuai yang diisi). ")])])],-1)),e("form",{onSubmit:E(P,["prevent"]),class:"bg-white rounded-xl shadow-lg p-6 space-y-6"},[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[g(" Pilih Member "),e("span",{class:"text-red-500"},"*")],-1)),e("div",H,[p(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=o=>b.value=o),onInput:j,placeholder:"Cari member (ID, Nama, Email, atau No. HP) - minimal 2 karakter",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,544),[[x,b.value]]),y.value?(l(),n("div",J,t[8]||(t[8]=[e("i",{class:"fa fa-spinner fa-spin text-gray-400"},null,-1)]))):m("",!0),c.value.length>0&&b.value&&b.value.length>=2?(l(),n("div",Y,[(l(!0),n(B,null,U(c.value,o=>(l(),n("div",{key:o.id,onClick:Ie=>D(o),class:"px-4 py-3 hover:bg-blue-50 cursor-pointer border-b last:border-b-0"},[e("div",K,[e("div",z,[e("div",G,a(o.nama_lengkap),1),e("div",Q,a(o.member_id)+" | "+a(o.email),1),e("div",$," Level: "+a(o.member_level||"Silver"),1)]),e("div",W,a(O(o.just_points||0))+" points ",1)])],8,q))),128))])):m("",!0),b.value&&b.value.length>=2&&c.value.length===0&&!y.value?(l(),n("div",X," Tidak ada member yang ditemukan ")):m("",!0)]),i.value?(l(),n("div",Z,[e("div",ee,[e("div",null,[e("div",te,a(i.value.nama_lengkap),1),e("div",se,a(i.value.member_id)+" | "+a(i.value.email),1)]),e("button",{type:"button",onClick:I,class:"text-red-600 hover:text-red-800"},t[9]||(t[9]=[e("i",{class:"fa-solid fa-times"},null,-1)]))])])):m("",!0),d.errors.member_id?(l(),n("div",ae,a(d.errors.member_id),1)):m("",!0)]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[g(" Jumlah Point "),e("span",{class:"text-red-500"},"*")],-1)),p(e("input",{type:"number","onUpdate:modelValue":t[1]||(t[1]=o=>r(s).point_amount=o),required:"",min:"1",max:"100000",placeholder:"Masukkan jumlah point",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,r(s).point_amount,void 0,{number:!0}]]),t[12]||(t[12]=e("div",{class:"text-xs text-gray-500 mt-1"},"Min: 1, Max: 100,000 points",-1)),d.errors.point_amount?(l(),n("div",oe,a(d.errors.point_amount),1)):m("",!0)]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[g(" Tanggal Transaksi "),e("span",{class:"text-red-500"},"*")],-1)),p(e("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=o=>r(s).transaction_date=o),required:"",max:r(_),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,re),[[x,r(s).transaction_date]]),d.errors.transaction_date?(l(),n("div",le,a(d.errors.transaction_date),1)):m("",!0)]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Reference ID (Opsional) ",-1)),p(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=o=>r(s).reference_id=o),maxlength:"255",placeholder:"Contoh: ORDER-12345 atau kosongkan untuk auto-generate",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,r(s).reference_id]]),t[15]||(t[15]=e("div",{class:"text-xs text-gray-500 mt-1"}," Jika kosong, akan auto-generate: MANUAL-YYYYMMDDHHMMSS-MEMBERID ",-1))]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Tanggal Expiry (Opsional) ",-1)),p(e("input",{type:"date","onUpdate:modelValue":t[4]||(t[4]=o=>r(s).expires_at=o),min:r(s).transaction_date||r(_),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,ne),[[x,r(s).expires_at]]),t[17]||(t[17]=e("div",{class:"text-xs text-gray-500 mt-1"}," Jika kosong, akan otomatis 1 tahun dari tanggal transaksi ",-1))]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[g(" Keterangan "),e("span",{class:"text-red-500"},"*")],-1)),p(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=o=>r(s).description=o),required:"",maxlength:"500",rows:"4",placeholder:"Contoh: Kompensasi point untuk order yang gagal di POS, Order ID: ORD-12345",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,r(s).description]]),e("div",ie,a(r(s).description.length)+"/500 karakter ",1),d.errors.description?(l(),n("div",de,a(d.errors.description),1)):m("",!0)]),i.value?(l(),n("div",ue,[t[23]||(t[23]=e("h3",{class:"text-sm font-semibold text-gray-700 mb-2"},"Preview:",-1)),e("div",me,[e("div",ce,[t[19]||(t[19]=e("span",{class:"text-gray-600"},"Member:",-1)),e("span",be,a(i.value.nama_lengkap)+" ("+a(i.value.member_id)+")",1)]),e("div",ge,[t[20]||(t[20]=e("span",{class:"text-gray-600"},"Point Saat Ini:",-1)),e("span",pe,a(i.value.just_points||0)+" points",1)]),e("div",xe,[t[21]||(t[21]=e("span",{class:"text-gray-600"},"Point yang akan di-inject:",-1)),e("span",fe,"+"+a(r(s).point_amount||0)+" points",1)]),e("div",ve,[t[22]||(t[22]=e("span",{class:"text-gray-600"},"Point Setelah Inject:",-1)),e("span",ye,a((i.value.just_points||0)+(r(s).point_amount||0))+" points ",1)])])])):m("",!0),d.errors.error?(l(),n("div",_e,[e("div",ke,[t[24]||(t[24]=e("div",{class:"flex-shrink-0"},[e("i",{class:"fa-solid fa-exclamation-circle text-red-500"})],-1)),e("div",he,[e("p",we,a(d.errors.error),1)])])])):m("",!0),e("div",Me,[e("button",{type:"submit",disabled:f.value||!w.value,class:"flex-1 px-6 py-3 bg-gradient-to-r from-green-500 to-green-700 text-white rounded-lg font-semibold hover:from-green-600 hover:to-green-800 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[f.value?(l(),n("i",je)):(l(),n("i",De)),g(" "+a(f.value?"Memproses...":"Inject Point"),1)],8,Se),M(r(S),{href:"/manual-point",class:"px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition"},{default:h(()=>t[25]||(t[25]=[g(" Batal ")])),_:1})])],32)])]),_:1}))}};export{Ae as default};
