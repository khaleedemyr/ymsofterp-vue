import{r as v,a as ae,j as oe,A as ie,B as o,C as re,D as e,x as ne,G as g,N as i,L as r,E as m,l as p,H as le,Z as de,O as T,J as ce,F as $,M as B,Q as ue,W}from"./vendor-vue-g7iCcTkf.js";import{S as f}from"./app-DcTypqnW.js";import{A as ge}from"./AppLayout-CSX-_rnh.js";import{N as me}from"./vue-easy-lightbox.esm.min-H9agbAmC.js";import{a as D}from"./vendor-utils-CpgP2uT4.js";import"./vendor-charts-CuqD4wLC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-B1e0pQ9F.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const fe={class:"max-w-6xl w-full mx-auto py-8 px-2"},xe={class:"flex justify-between items-center mb-6"},pe={class:"text-2xl font-bold text-gray-800 flex items-center gap-2"},be={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ye={class:"lg:col-span-2 space-y-6"},he={class:"bg-white rounded-2xl shadow-lg p-6"},ve={class:"text-xl font-bold text-gray-800 mb-4"},_e={class:"prose max-w-none"},ke={class:"text-gray-700 whitespace-pre-wrap"},we={class:"bg-white rounded-2xl shadow-lg p-6"},Ce={class:"flex items-center justify-between mb-4"},Te={key:0,class:"flex items-center gap-1"},$e={class:"text-xs text-gray-500"},Be={key:0,class:"space-y-4"},De={class:"flex gap-3"},je={key:0,class:"w-8 h-8 rounded-full overflow-hidden border border-gray-200 flex-shrink-0"},Ae=["src","alt"],Se={key:1,class:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold border border-gray-200 flex-shrink-0"},Ue={class:"flex-1"},Ie=["onKeydown"],Ke={class:"flex justify-end mt-2"},He=["disabled"],Le={key:0,class:"space-y-3"},Ee={key:0,class:"w-8 h-8 rounded-full overflow-hidden border border-gray-200 flex-shrink-0"},Me=["src","alt"],Ve={key:1,class:"w-8 h-8 rounded-full bg-gradient-to-br from-gray-400 to-gray-600 flex items-center justify-center text-white text-xs font-bold border border-gray-200 flex-shrink-0"},We={class:"flex-1"},Ne={class:"bg-gray-50 rounded-lg p-3"},Re={class:"flex items-center gap-2 mb-1"},Pe={class:"font-medium text-sm text-gray-800"},Ge={class:"text-xs text-gray-500"},ze={class:"text-sm text-gray-700"},Oe={class:"flex items-center gap-4 mt-2 text-xs text-gray-500"},qe=["onClick"],Fe=["onClick"],Je={key:1,class:"text-center py-4 text-gray-500 text-sm"},Qe={class:"space-y-6"},Ye={class:"bg-white rounded-2xl shadow-lg p-6"},Ze={class:"space-y-4"},Xe={class:"mt-1"},et={class:"mt-1"},tt={class:"mt-1 text-sm text-gray-900"},st={class:"mt-1 text-sm text-gray-900"},at={class:"mt-1 text-sm text-gray-900"},ot={key:0},it={class:"mt-1 text-sm text-gray-900"},rt={key:1},nt={class:"mt-2 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},lt=["onClick"],dt={class:"aspect-square bg-gray-100 border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition-all duration-200"},ct=["src","alt","onClick"],ut={class:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent text-white p-2"},gt={class:"text-xs truncate font-medium"},mt={key:1,class:"relative group"},ft={class:"aspect-square bg-gray-100 border border-gray-200 rounded-lg flex flex-col items-center justify-center p-2 cursor-pointer"},xt={key:0,class:"fas fa-file-pdf text-red-500 text-2xl mb-1"},pt={key:1,class:"fas fa-file-alt text-gray-500 text-2xl mb-1"},bt={class:"text-xs text-gray-600 text-center truncate w-full"},yt={class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center"},ht=["href"],vt={class:"mt-1 text-sm text-gray-900"},_t={class:"mt-1 text-sm text-gray-900"},kt={key:2},wt={class:"bg-white rounded-2xl shadow-lg p-6"},Ct={key:0,class:"relative"},Tt={class:"space-y-6"},$t={class:"relative z-10 flex-shrink-0"},Bt={class:"flex-1 min-w-0 pb-2"},Dt={class:"flex items-start justify-between"},jt={class:"flex-1"},At={class:"text-sm font-semibold text-gray-900 mb-1"},St={class:"text-sm text-gray-700 mb-2"},Ut={key:0,class:"mb-3"},It={class:"flex items-center gap-2 text-xs"},Kt={class:"px-2 py-1 bg-red-100 text-red-700 rounded-full"},Ht={class:"px-2 py-1 bg-green-100 text-green-700 rounded-full"},Lt={class:"flex-shrink-0 ml-4"},Et={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Mt={class:"flex items-center gap-2 mt-3 pt-3 border-t border-gray-200"},Vt={class:"text-xs text-gray-600"},Wt={class:"text-xs text-gray-500"},Nt={key:1,class:"text-center py-8 text-gray-500"},Xt={__name:"Show",props:{ticket:Object},setup(n){const u=n,x=v(""),w=v(!1),j=v(0),A=v([]),_=v(!1);function N(){W.visit("/tickets")}function R(s,t=0){A.value=s,j.value=t,w.value=!0}function P(){w.value=!1}function S(s){const t=u.ticket.attachments.filter(d=>d.mime_type&&d.mime_type.startsWith("image/")),c=t.findIndex(d=>d.id===s.id),l=t.map(d=>d.file_path.startsWith("/storage/")?d.file_path:`/storage/${d.file_path}`);R(l,c)}function G(){W.visit(`/tickets/${u.ticket.id}/edit`)}async function U(){var s,t,c;if((s=x.value)!=null&&s.trim())try{const l=await D.post(`/tickets/${u.ticket.id}/comments`,{comment:x.value.trim()});l.data.success&&(u.ticket.comments||(u.ticket.comments=[]),u.ticket.comments.unshift(l.data.data),x.value="",f.fire("Berhasil","Komentar berhasil ditambahkan","success"))}catch(l){f.fire("Error",((c=(t=l.response)==null?void 0:t.data)==null?void 0:c.message)||"Gagal menambahkan komentar","error")}}function z(){_.value=!_.value}function C(){return u.ticket.comments?u.ticket.comments.length:0}function O(){const s=C();return s===0?"Tambah komentar":s===1?"1 komentar":`${s} komentar`}function I(s){if(!s)return"U";const t=s.split(" ");return t.length>=2?(t[0][0]+t[1][0]).toUpperCase():s[0].toUpperCase()}async function q(s){var c,l;const{value:t}=await f.fire({title:"Edit Komentar",input:"textarea",inputValue:s.comment,inputAttributes:{placeholder:"Tulis komentar...",rows:3},showCancelButton:!0,confirmButtonText:"Update",cancelButtonText:"Batal",inputValidator:d=>{if(!d||!d.trim())return"Komentar tidak boleh kosong!"}});if(t&&t.trim()!==s.comment)try{const d=await D.put(`/tickets/comments/${s.id}`,{comment:t.trim()});d.data.success&&(s.comment=t.trim(),s.updated_at=d.data.data.updated_at,f.fire("Berhasil","Komentar berhasil diperbarui","success"))}catch(d){f.fire("Error",((l=(c=d.response)==null?void 0:c.data)==null?void 0:l.message)||"Gagal memperbarui komentar","error")}}async function F(s){var c,l;if((await f.fire({title:"Hapus Komentar?",text:"Komentar akan dihapus secara permanen",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal"})).isConfirmed)try{if((await D.delete(`/tickets/comments/${s.id}`)).data.success){const b=u.ticket.comments.findIndex(k=>k.id===s.id);b>-1&&u.ticket.comments.splice(b,1),f.fire("Berhasil","Komentar berhasil dihapus","success")}}catch(d){f.fire("Error",((l=(c=d.response)==null?void 0:c.data)==null?void 0:l.message)||"Gagal menghapus komentar","error")}}function J(s){return{open:"bg-blue-100 text-blue-800",in_progress:"bg-yellow-100 text-yellow-800",pending:"bg-purple-100 text-purple-800",resolved:"bg-green-100 text-green-800",closed:"bg-gray-100 text-gray-800",cancelled:"bg-red-100 text-red-800"}[s]||"bg-gray-100 text-gray-800"}function Q(s){return{1:"bg-green-100 text-green-800",2:"bg-yellow-100 text-yellow-800",3:"bg-orange-100 text-orange-800",4:"bg-red-100 text-red-800"}[s]||"bg-gray-100 text-gray-800"}function K(s){const t=new Date(s),l=Math.floor((new Date-t)/1e3);return l<60?"baru saja":l<3600?`${Math.floor(l/60)} menit yang lalu`:l<86400?`${Math.floor(l/3600)} jam yang lalu`:l<2592e3?`${Math.floor(l/86400)} hari yang lalu`:t.toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"})}function Y(s){var c;return s.field_name&&s.old_value&&s.new_value?`Changed ${s.field_name} from '${s.old_value}' to '${s.new_value}'`:s.description?s.description:{created:"Ticket created",updated:"Ticket updated",assigned:"Ticket assigned",status_changed:"Status changed",priority_changed:"Priority changed",category_changed:"Category changed",comment_added:"Comment added",attachment_added:"Attachment added",resolved:"Ticket resolved",closed:"Ticket closed",reopened:"Ticket reopened"}[s.action]||((c=s.action)==null?void 0:c.replace(/_/g," ").replace(/\b\w/g,l=>l.toUpperCase()))||"Action performed"}function Z(s){return{created:"Ticket Created",updated:"Ticket Updated",assigned:"Ticket Assigned",status_changed:"Status Changed",priority_changed:"Priority Changed",category_changed:"Category Changed",comment_added:"Comment Added",attachment_added:"Attachment Added",resolved:"Ticket Resolved",closed:"Ticket Closed",reopened:"Ticket Reopened"}[s]||(s==null?void 0:s.replace(/_/g," ").replace(/\b\w/g,c=>c.toUpperCase()))||"Action Performed"}function X(s){return{created:"fas fa-plus-circle",updated:"fas fa-edit",assigned:"fas fa-user-check",status_changed:"fas fa-exchange-alt",priority_changed:"fas fa-flag",category_changed:"fas fa-tags",comment_added:"fas fa-comment",attachment_added:"fas fa-paperclip",resolved:"fas fa-check-circle",closed:"fas fa-times-circle",reopened:"fas fa-redo"}[s]||"fas fa-circle"}function ee(s){return{created:"bg-green-500",updated:"bg-blue-500",assigned:"bg-purple-500",status_changed:"bg-yellow-500",priority_changed:"bg-orange-500",category_changed:"bg-indigo-500",comment_added:"bg-cyan-500",attachment_added:"bg-pink-500",resolved:"bg-green-600",closed:"bg-red-500",reopened:"bg-blue-600"}[s]||"bg-gray-500"}function te(s){return{created:"border-green-400",updated:"border-blue-400",assigned:"border-purple-400",status_changed:"border-yellow-400",priority_changed:"border-orange-400",category_changed:"border-indigo-400",comment_added:"border-cyan-400",attachment_added:"border-pink-400",resolved:"border-green-500",closed:"border-red-400",reopened:"border-blue-500"}[s]||"border-gray-400"}return ae(()=>{}),oe(()=>{}),(s,t)=>(o(),ie(ge,{title:"Detail Ticket"},{default:re(()=>{var c,l,d,b,k,H,L,E,M;return[e("div",fe,[e("div",xe,[e("h1",pe,[t[1]||(t[1]=e("i",{class:"fa-solid fa-ticket-alt text-blue-500"},null,-1)),g(" "+i(n.ticket.ticket_number),1)]),e("div",{class:"flex gap-2"},[e("button",{onClick:G,class:"bg-green-600 text-white px-4 py-2 rounded-xl hover:bg-green-700 transition-colors"},t[2]||(t[2]=[e("i",{class:"fa-solid fa-edit mr-2"},null,-1),g(" Edit ")])),e("button",{onClick:N,class:"bg-gray-500 text-white px-4 py-2 rounded-xl hover:bg-gray-600 transition-colors"},t[3]||(t[3]=[e("i",{class:"fa-solid fa-arrow-left mr-2"},null,-1),g(" Kembali ")]))])]),e("div",be,[e("div",ye,[e("div",he,[e("h2",ve,i(n.ticket.title),1),e("div",_e,[e("p",ke,i(n.ticket.description),1)])]),e("div",we,[e("div",Ce,[e("button",{onClick:z,class:"flex items-center gap-2 text-sm font-medium text-gray-600 hover:text-blue-600 transition-colors"},[e("i",{class:p(["fa-solid transition-transform duration-200",_.value?"fa-chevron-up":"fa-chevron-down"])},null,2),e("span",null,i(O()),1)]),C()>0?(o(),r("div",Te,[t[4]||(t[4]=e("i",{class:"fa-solid fa-comment text-gray-400 text-xs"},null,-1)),e("span",$e,i(C()),1)])):m("",!0)]),_.value?(o(),r("div",Be,[e("div",De,[s.$page.props.auth.user.avatar?(o(),r("div",je,[e("img",{src:`/storage/${s.$page.props.auth.user.avatar}`,alt:s.$page.props.auth.user.nama_lengkap,class:"w-full h-full object-cover"},null,8,Ae)])):(o(),r("div",Se,i(I(s.$page.props.auth.user.nama_lengkap)),1)),e("div",Ue,[le(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=a=>x.value=a),onKeydown:de(T(U,["prevent"]),["enter"]),placeholder:"Tulis komentar...",class:"w-full px-3 py-2 border border-gray-200 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",rows:"2"},null,40,Ie),[[ce,x.value]]),e("div",Ke,[e("button",{onClick:U,disabled:!((c=x.value)!=null&&c.trim()),class:"bg-blue-600 text-white px-4 py-1 rounded-lg text-xs font-medium hover:bg-blue-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"},t[5]||(t[5]=[e("i",{class:"fa-solid fa-paper-plane mr-1"},null,-1),g(" Kirim ")]),8,He)])])]),n.ticket.comments&&n.ticket.comments.length>0?(o(),r("div",Le,[(o(!0),r($,null,B(n.ticket.comments,a=>{var y,h,V;return o(),r("div",{key:a.id,class:"flex gap-3"},[(y=a.user)!=null&&y.avatar?(o(),r("div",Ee,[e("img",{src:`/storage/${a.user.avatar}`,alt:a.user.nama_lengkap,class:"w-full h-full object-cover"},null,8,Me)])):(o(),r("div",Ve,i(I(((h=a.user)==null?void 0:h.nama_lengkap)||"U")),1)),e("div",We,[e("div",Ne,[e("div",Re,[e("span",Pe,i(((V=a.user)==null?void 0:V.nama_lengkap)||"Unknown"),1),e("span",Ge,i(K(a.created_at)),1)]),e("p",ze,i(a.comment),1)]),e("div",Oe,[a.user_id===s.$page.props.auth.user.id?(o(),r("button",{key:0,onClick:se=>q(a),class:"hover:text-green-600 transition-colors"},t[6]||(t[6]=[e("i",{class:"fa-solid fa-edit mr-1"},null,-1),g(" Edit ")]),8,qe)):m("",!0),a.user_id===s.$page.props.auth.user.id?(o(),r("button",{key:1,onClick:se=>F(a),class:"hover:text-red-600 transition-colors"},t[7]||(t[7]=[e("i",{class:"fa-solid fa-trash mr-1"},null,-1),g(" Hapus ")]),8,Fe)):m("",!0)])])])}),128))])):(o(),r("div",Je,t[8]||(t[8]=[e("i",{class:"fa-solid fa-comment-slash mb-2 block text-2xl"},null,-1),g(" Belum ada komentar ")])))])):m("",!0)])]),e("div",Qe,[e("div",Ye,[t[21]||(t[21]=e("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"Ticket Information",-1)),e("div",Ze,[e("div",null,[t[9]||(t[9]=e("label",{class:"text-sm font-medium text-gray-600"},"Status",-1)),e("div",Xe,[e("span",{class:p(["inline-flex px-3 py-1 text-sm font-semibold rounded-full",J((l=n.ticket.status)==null?void 0:l.slug)])},i(((d=n.ticket.status)==null?void 0:d.name)||"-"),3)])]),e("div",null,[t[10]||(t[10]=e("label",{class:"text-sm font-medium text-gray-600"},"Priority",-1)),e("div",et,[e("span",{class:p(["inline-flex px-3 py-1 text-sm font-semibold rounded-full",Q((b=n.ticket.priority)==null?void 0:b.level)])},i(((k=n.ticket.priority)==null?void 0:k.name)||"-"),3)])]),e("div",null,[t[11]||(t[11]=e("label",{class:"text-sm font-medium text-gray-600"},"Category",-1)),e("p",tt,i(((H=n.ticket.category)==null?void 0:H.name)||"-"),1)]),e("div",null,[t[12]||(t[12]=e("label",{class:"text-sm font-medium text-gray-600"},"Divisi",-1)),e("p",st,i(((L=n.ticket.divisi)==null?void 0:L.nama_divisi)||"-"),1)]),e("div",null,[t[13]||(t[13]=e("label",{class:"text-sm font-medium text-gray-600"},"Outlet",-1)),e("p",at,i(((E=n.ticket.outlet)==null?void 0:E.nama_outlet)||"-"),1)]),n.ticket.due_date?(o(),r("div",ot,[t[14]||(t[14]=e("label",{class:"text-sm font-medium text-gray-600"},"Due Date",-1)),e("p",it,i(new Date(n.ticket.due_date).toLocaleString("id-ID")),1)])):m("",!0),n.ticket.attachments&&n.ticket.attachments.length>0?(o(),r("div",rt,[t[17]||(t[17]=e("label",{class:"text-sm font-medium text-gray-600"},"Attachments",-1)),e("div",nt,[(o(!0),r($,null,B(n.ticket.attachments,a=>(o(),r("div",{key:a.id,class:"relative"},[a.mime_type&&a.mime_type.startsWith("image/")?(o(),r("div",{key:0,class:"relative group cursor-pointer",onClick:T(y=>S(a),["stop"])},[e("div",dt,[e("img",{src:a.file_path.startsWith("/storage/")?a.file_path:`/storage/${a.file_path}`,alt:a.file_name,class:"w-full h-full object-cover hover:scale-105 transition-transform duration-200",onClick:T(y=>S(a),["stop"])},null,8,ct)]),t[15]||(t[15]=e("div",{class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center"},[e("div",{class:"opacity-0 group-hover:opacity-100 bg-white bg-opacity-90 text-gray-800 px-3 py-1 rounded-full text-sm transition-all duration-200 flex items-center gap-2"},[e("i",{class:"fas fa-search-plus"}),e("span",null,"View")])],-1)),e("div",ut,[e("p",gt,i(a.file_name),1)])],8,lt)):(o(),r("div",mt,[e("div",ft,[a.mime_type==="application/pdf"?(o(),r("i",xt)):(o(),r("i",pt)),e("p",bt,i(a.file_name),1)]),e("div",yt,[e("a",{href:a.file_path.startsWith("/storage/")?a.file_path:`/storage/${a.file_path}`,target:"_blank",class:"opacity-0 group-hover:opacity-100 bg-white bg-opacity-90 text-gray-800 px-3 py-1 rounded-full text-sm transition-all duration-200"},t[16]||(t[16]=[e("i",{class:"fas fa-download mr-1"},null,-1),g("Download ")]),8,ht)])]))]))),128))])])):m("",!0),e("div",null,[t[18]||(t[18]=e("label",{class:"text-sm font-medium text-gray-600"},"Created By",-1)),e("p",vt,i(((M=n.ticket.creator)==null?void 0:M.nama_lengkap)||"-"),1)]),e("div",null,[t[19]||(t[19]=e("label",{class:"text-sm font-medium text-gray-600"},"Created At",-1)),e("p",_t,i(new Date(n.ticket.created_at).toLocaleString("id-ID")),1)]),n.ticket.source==="daily_report"?(o(),r("div",kt,t[20]||(t[20]=[e("label",{class:"text-sm font-medium text-gray-600"},"Source",-1),e("p",{class:"mt-1 text-sm text-blue-600"},[e("i",{class:"fa-solid fa-clipboard-list mr-1"}),g(" Daily Report ")],-1)]))):m("",!0)])]),e("div",wt,[t[27]||(t[27]=e("h3",{class:"text-lg font-bold text-gray-800 mb-6 flex items-center gap-2"},[e("i",{class:"fas fa-history text-blue-500"}),g(" Timeline History ")],-1)),n.ticket.history&&n.ticket.history.length>0?(o(),r("div",Ct,[t[25]||(t[25]=e("div",{class:"absolute left-6 top-0 bottom-0 w-0.5 bg-gradient-to-b from-blue-200 via-blue-300 to-gray-200"},null,-1)),e("div",Tt,[(o(!0),r($,null,B(n.ticket.history,(a,y)=>{var h;return o(),r("div",{key:a.id,class:"relative flex items-start gap-4"},[e("div",$t,[e("div",{class:p(["w-12 h-12 rounded-full flex items-center justify-center text-white shadow-lg",ee(a.action)])},[e("i",{class:p([X(a.action),"text-sm"])},null,2)],2)]),e("div",Bt,[e("div",{class:p(["bg-gray-50 rounded-xl p-4 border-l-4",te(a.action)])},[e("div",Dt,[e("div",jt,[e("h4",At,i(Z(a.action)),1),e("p",St,i(Y(a)),1),a.field_name&&a.old_value&&a.new_value?(o(),r("div",Ut,[e("div",It,[e("span",Kt,i(a.old_value),1),t[22]||(t[22]=e("i",{class:"fas fa-arrow-right text-gray-400"},null,-1)),e("span",Ht,i(a.new_value),1)])])):m("",!0)]),e("div",Lt,[e("span",Et,i(K(a.created_at)),1)])]),e("div",Mt,[t[23]||(t[23]=e("div",{class:"w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center"},[e("i",{class:"fas fa-user text-xs text-gray-600"})],-1)),e("span",Vt,i(((h=a.user)==null?void 0:h.nama_lengkap)||"Unknown User"),1),t[24]||(t[24]=e("span",{class:"text-xs text-gray-400"},"â€¢",-1)),e("span",Wt,i(new Date(a.created_at).toLocaleString("id-ID")),1)])],2)])])}),128))])])):(o(),r("div",Nt,t[26]||(t[26]=[e("div",{class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4"},[e("i",{class:"fas fa-history text-2xl text-gray-400"})],-1),e("p",{class:"text-sm font-medium"},"Belum ada history",-1),e("p",{class:"text-xs text-gray-400 mt-1"},"History akan muncul saat ada perubahan pada ticket",-1)])))])])])]),ne(ue(me),{visible:w.value,imgs:A.value,index:j.value,onHide:P},null,8,["visible","imgs","index"])]}),_:1}))}};export{Xt as default};
