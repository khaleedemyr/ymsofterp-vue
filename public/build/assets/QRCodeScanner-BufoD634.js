import{r as u,a as S,j as C,L as o,B as r,D as e,E as j,N as n,R,G as p,H as M,J as Q,F as E,M as B,W as D}from"./vendor-vue-g7iCcTkf.js";import{S as f}from"./app-AaUk6aDd.js";import"./vendor-utils-CpgP2uT4.js";import"./vendor-charts-CuqD4wLC.js";const T={class:"fixed inset-0 z-50 flex items-center justify-center"},N={class:"backdrop-blur-xl bg-white/10 border border-white/20 rounded-2xl p-6 max-w-2xl w-full mx-4"},U={class:"flex items-center justify-between mb-6"},V={class:"text-white/70 mt-1"},I={class:"backdrop-blur-sm bg-white/5 border border-white/10 rounded-xl p-6 mb-6"},P={class:"text-center"},L={key:0,class:"mb-4"},q={key:1,class:"mb-4"},z={class:"w-64 h-64 bg-gray-800 rounded-lg flex items-center justify-center mx-auto relative"},F={class:"flex items-center justify-center space-x-4"},O={class:"backdrop-blur-sm bg-white/5 border border-white/10 rounded-xl p-4 mb-6"},W={class:"flex items-center space-x-3"},$=["disabled"],A={key:0,class:"fas fa-spinner fa-spin mr-2"},G={key:1,class:"fas fa-check mr-2"},H={key:0,class:"backdrop-blur-sm bg-white/5 border border-white/10 rounded-xl p-4"},J={class:"space-y-2 max-h-32 overflow-y-auto"},K={class:"text-white font-medium"},X={class:"text-white/70 text-sm"},Y={class:"text-right"},Z={class:"text-green-400 text-sm font-medium"},ee={class:"text-white/50 text-xs"},ae={__name:"QRCodeScanner",props:{mode:{type:String,default:"check-in",validator:b=>["check-in","check-out"].includes(b)}},emits:["close","scanned"],setup(b,{emit:k}){const x=b,w=k,h=u(null),m=u(!1),i=u(""),d=u(!1),l=u([]);let c=null,v=null;const y=async()=>{try{c=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}),h.value&&(h.value.srcObject=c,m.value=!0,v=setInterval(()=>{console.log("Scanning for QR codes...")},1e3))}catch(a){console.error("Error accessing camera:",a),f.fire({icon:"error",title:"Error",text:"Tidak dapat mengakses kamera. Pastikan izin kamera sudah diberikan."})}},g=()=>{c&&(c.getTracks().forEach(a=>a.stop()),c=null),v&&(clearInterval(v),v=null),m.value=!1},_=async()=>{if(i.value){d.value=!0;try{const a=x.mode==="check-in"?"lms.check-in":"lms.check-out";await D.post(a("lms.check-in"),{qr_code:i.value},{onSuccess:t=>{const s=t.props.flash.success||t.props.flash.data;s&&(l.value.unshift({id:Date.now(),participant:s.participant||"Unknown",training:s.training||"Unknown",status:x.mode==="check-in"?"Check-in Berhasil":"Check-out Berhasil",time:new Date().toLocaleTimeString("id-ID")}),l.value.length>5&&(l.value=l.value.slice(0,5)),f.fire({icon:"success",title:"Berhasil",text:s.message||"QR Code berhasil diproses"}),i.value="",w("scanned",s))},onError:t=>{f.fire({icon:"error",title:"Error",text:Object.values(t)[0]||"QR Code tidak valid atau sudah digunakan"})}})}catch{f.fire({icon:"error",title:"Error",text:"Terjadi kesalahan saat memproses QR Code"})}finally{d.value=!1}}};return S(()=>{}),C(()=>{g()}),(a,t)=>(r(),o("div",T,[t[11]||(t[11]=e("div",{class:"absolute inset-0 bg-black/50 backdrop-blur-sm"},null,-1)),e("div",N,[e("div",U,[e("div",null,[t[2]||(t[2]=e("h3",{class:"text-2xl font-bold text-white"},"QR Code Scanner",-1)),e("p",V,n(b.mode==="check-in"?"Check-in Peserta":"Check-out Peserta"),1)]),e("button",{onClick:t[0]||(t[0]=s=>a.$emit("close")),class:"text-white/70 hover:text-white"},t[3]||(t[3]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),e("div",I,[e("div",P,[m.value?(r(),o("div",q,[e("div",z,[e("video",{ref_key:"video",ref:h,class:"w-full h-full object-cover rounded-lg"},null,512),t[5]||(t[5]=R('<div class="absolute inset-0 border-2 border-blue-500 rounded-lg pointer-events-none"><div class="absolute top-0 left-0 w-8 h-8 border-t-2 border-l-2 border-blue-500"></div><div class="absolute top-0 right-0 w-8 h-8 border-t-2 border-r-2 border-blue-500"></div><div class="absolute bottom-0 left-0 w-8 h-8 border-b-2 border-l-2 border-blue-500"></div><div class="absolute bottom-0 right-0 w-8 h-8 border-b-2 border-r-2 border-blue-500"></div></div>',1))]),t[6]||(t[6]=e("p",{class:"text-white/70 mt-4"},"Arahkan kamera ke QR Code peserta",-1))])):(r(),o("div",L,t[4]||(t[4]=[e("div",{class:"w-64 h-64 bg-gray-800 rounded-lg flex items-center justify-center mx-auto"},[e("i",{class:"fas fa-qrcode text-gray-400 text-6xl"})],-1),e("p",{class:"text-white/70 mt-4"},"Klik tombol di bawah untuk memulai scanner",-1)]))),e("div",F,[m.value?(r(),o("button",{key:1,onClick:g,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl font-semibold hover:from-red-600 hover:to-red-700 transition-all"},t[8]||(t[8]=[e("i",{class:"fas fa-stop mr-2"},null,-1),p(" Stop Scanner ")]))):(r(),o("button",{key:0,onClick:y,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-semibold hover:from-blue-600 hover:to-blue-700 transition-all"},t[7]||(t[7]=[e("i",{class:"fas fa-camera mr-2"},null,-1),p(" Mulai Scanner ")])))])])]),e("div",O,[t[9]||(t[9]=e("h4",{class:"text-lg font-semibold text-white mb-3"},"Input Manual",-1)),e("div",W,[M(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>i.value=s),type:"text",placeholder:"Masukkan QR Code secara manual...",class:"flex-1 bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[Q,i.value]]),e("button",{onClick:_,disabled:!i.value||d.value,class:"px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-semibold hover:from-green-600 hover:to-green-700 transition-all disabled:opacity-50"},[d.value?(r(),o("i",A)):(r(),o("i",G)),p(" "+n(d.value?"Memproses...":"Proses"),1)],8,$)])]),l.value.length>0?(r(),o("div",H,[t[10]||(t[10]=e("h4",{class:"text-lg font-semibold text-white mb-3"},"Scan Terbaru",-1)),e("div",J,[(r(!0),o(E,null,B(l.value,s=>(r(),o("div",{key:s.id,class:"flex items-center justify-between p-2 bg-white/5 rounded-lg"},[e("div",null,[e("div",K,n(s.participant),1),e("div",X,n(s.training),1)]),e("div",Y,[e("div",Z,n(s.status),1),e("div",ee,n(s.time),1)])]))),128))])])):j("",!0)])]))}};export{ae as default};
