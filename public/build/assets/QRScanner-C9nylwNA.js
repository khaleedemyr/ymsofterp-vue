import{r as m,a as j,j as B,W as q,L as u,B as d,D as e,E as x,l as v,G as w,H as D,J as M,Z as T,Q as _,N as p,F as I,M as N}from"./vendor-vue-g7iCcTkf.js";import{S as h}from"./app-D7xoXxxM.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-utils-CpgP2uT4.js";import"./vendor-charts-CuqD4wLC.js";const V={class:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"},$={class:"bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-hidden"},A={class:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6"},F={class:"flex items-center justify-between"},H={class:"p-6"},L={class:"flex bg-gray-100 rounded-lg p-1 mb-4"},U={class:"relative"},z={class:"mt-4"},K={class:"flex space-x-2"},W=["disabled"],G={class:"flex items-center"},J={class:"font-medium"},P={key:0,class:"text-sm mt-1 opacity-80"},Z={key:1,class:"mt-6"},X={class:"space-y-2 max-h-32 overflow-y-auto"},Y={class:"font-medium"},ee={class:"text-gray-500 ml-2"},te={class:"text-xs text-gray-400"},se={__name:"QRScanner",props:{training:Object},emits:["close"],setup(re,{emit:le}){const n=m("checkin"),a=m(""),r=m(""),o=m(""),i=m([]);let f=null;const C=computed(()=>r.value.includes("Berhasil")?"bg-green-100 text-green-800 border border-green-200":r.value.includes("Error")?"bg-red-100 text-red-800 border border-red-200":"bg-blue-100 text-blue-800 border border-blue-200"),S=computed(()=>r.value.includes("Berhasil")?"fas fa-check-circle text-green-600":r.value.includes("Error")?"fas fa-exclamation-circle text-red-600":"fas fa-info-circle text-blue-600");j(async()=>{if(typeof Html5QrcodeScanner<"u")b();else{const s=document.createElement("script");s.src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js",s.onload=b,document.head.appendChild(s)}}),B(()=>{f&&f.clear()});const b=()=>{f=new Html5QrcodeScanner("qr-reader",{fps:10,qrbox:{width:250,height:250},aspectRatio:1},!1),f.render(Q,R)},Q=s=>{k(s)},R=s=>{console.log("QR scan failed:",s)},g=()=>{a.value.trim()&&(k(a.value.trim()),a.value="")},k=async s=>{try{r.value="Memproses QR Code...",o.value="";const t=n.value==="checkin"?"lms.schedules.checkin":"lms.schedules.checkout",l=await q.post(route(t),{qr_code:s},{preserveState:!0,preserveScroll:!0,onSuccess:c=>{var y;if((y=c.props.flash)!=null&&y.success){r.value="Berhasil!",o.value=c.props.flash.success;const E={id:Date.now(),participant:c.props.flash.participant||"Unknown",action:n.value==="checkin"?"Check In":"Check Out",time:new Date().toLocaleTimeString("id-ID")};i.value.unshift(E),i.value.length>5&&(i.value=i.value.slice(0,5)),h.fire({icon:"success",title:"Berhasil!",text:c.props.flash.success,timer:2e3,showConfirmButton:!1})}},onError:c=>{r.value="Error!",o.value=Object.values(c)[0]||"Terjadi kesalahan",h.fire({icon:"error",title:"Error!",text:o.value})}})}catch{r.value="Error!",o.value="Terjadi kesalahan saat memproses QR Code",h.fire({icon:"error",title:"Error!",text:o.value})}};return(s,t)=>(d(),u("div",V,[e("div",$,[e("div",A,[e("div",F,[t[5]||(t[5]=e("h2",{class:"text-xl font-bold"},"QR Code Scanner",-1)),e("button",{onClick:t[0]||(t[0]=l=>s.$emit("close")),class:"text-white/80 hover:text-white"},t[4]||(t[4]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),t[6]||(t[6]=e("p",{class:"text-white/80 mt-2"},"Scan QR Code untuk absensi",-1))]),e("div",H,[e("div",L,[e("button",{onClick:t[1]||(t[1]=l=>n.value="checkin"),class:v([n.value==="checkin"?"bg-blue-500 text-white":"text-gray-600","flex-1 py-2 px-4 rounded-md text-sm font-medium transition-all"])},t[7]||(t[7]=[e("i",{class:"fas fa-sign-in-alt mr-2"},null,-1),w(" Check In ")]),2),e("button",{onClick:t[2]||(t[2]=l=>n.value="checkout"),class:v([n.value==="checkout"?"bg-green-500 text-white":"text-gray-600","flex-1 py-2 px-4 rounded-md text-sm font-medium transition-all"])},t[8]||(t[8]=[e("i",{class:"fas fa-sign-out-alt mr-2"},null,-1),w(" Check Out ")]),2)]),e("div",U,[t[11]||(t[11]=e("div",{id:"qr-reader",class:"w-full h-64 bg-gray-100 rounded-lg overflow-hidden"},null,-1)),e("div",z,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Atau masukkan QR Code manual: ",-1)),e("div",K,[D(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>a.value=l),type:"text",placeholder:"Paste QR Code di sini...",class:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyup:T(g,["enter"])},null,544),[[M,a.value]]),e("button",{onClick:g,disabled:!a.value.trim(),class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed"},t[9]||(t[9]=[e("i",{class:"fas fa-check"},null,-1)]),8,W)])])]),r.value?(d(),u("div",{key:0,class:v(["mt-4 p-3 rounded-lg",_(C)])},[e("div",G,[e("i",{class:v([_(S),"mr-2"])},null,2),e("span",J,p(r.value),1)]),o.value?(d(),u("p",P,p(o.value),1)):x("",!0)],2)):x("",!0),i.value.length>0?(d(),u("div",Z,[t[12]||(t[12]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Aktivitas Terbaru",-1)),e("div",X,[(d(!0),u(I,null,N(i.value,l=>(d(),u("div",{key:l.id,class:"flex items-center justify-between p-2 bg-gray-50 rounded-lg text-sm"},[e("div",null,[e("span",Y,p(l.participant),1),e("span",ee,p(l.action),1)]),e("span",te,p(l.time),1)]))),128))])])):x("",!0)])])]))}},ue=O(se,[["__scopeId","data-v-06ea5670"]]);export{ue as default};
