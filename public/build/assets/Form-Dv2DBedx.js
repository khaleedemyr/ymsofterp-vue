import{r as n,w as E,b as F,L as l,B as o,D as t,E as m,x as J,G as _,H as S,J as $,I as A,F as D,M as G,N as i,O as P,C as W,l as K}from"./vendor-vue-g7iCcTkf.js";import{a as M}from"./vendor-utils-CpgP2uT4.js";import{S as V}from"./app-dzBjFUgD.js";import{_ as X}from"./Modal-BBL5yay4.js";import"./vendor-charts-CuqD4wLC.js";const Y={class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40"},Z={class:"bg-white rounded-xl shadow-2xl w-full max-w-lg p-6 relative max-h-[90vh] overflow-y-auto"},ee={key:0},te={class:"mb-4"},se={class:"flex gap-2 mb-2"},ae={key:0,class:"mb-2"},le={key:0,class:"mb-2"},oe=["value"],re={key:1},ie={class:"mb-4"},ne={class:"font-bold text-blue-700 mb-2"},de={class:"text-sm text-gray-600 mb-2"},ue={class:"min-w-full divide-y divide-gray-200 mb-4"},ce={class:"px-2 py-1"},pe={class:"text-xs text-gray-400"},ve=["onClick","disabled"],me={class:"px-2 py-1 text-right"},ye={class:"px-2 py-1 text-right"},fe=["onUpdate:modelValue","max","onInput"],xe={key:0,class:"text-red-500 text-xs mt-1"},be={class:"flex justify-end gap-2 mt-4"},ge=["disabled"],he={key:0,class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},_e={key:2,class:"text-red-500 mt-2"},we={class:"p-4 min-w-[320px] max-w-[90vw]"},ke={key:0,class:"text-center py-8"},qe={key:1},Ce={class:"mb-2"},Se={class:"mb-2"},De={key:0},Ge={key:1,class:"italic text-gray-400"},Me={class:"mb-2"},Ve={key:0},Be={key:1,class:"italic text-gray-400"},Oe={key:0,class:"mb-2"},Ne={class:"flex flex-wrap gap-2 mt-1"},Qe=["src"],Ie={key:2,class:"text-red-500 text-center py-4"},Ue={__name:"Form",emits:["close"],setup(He,{emit:j}){const L=j,x=n(""),b=n(null),g=n([]),B=n(!1),p=n(""),v=n(!1),h=n(!1),w=n([]),f=n("");let d=null;const k=n(!1),r=n({}),q=n(!1),O=async()=>{var a,e;p.value="";try{const s=await M.post(route("outlet-good-receive.fetch-do"),{do_number:x.value});b.value=s.data.do,g.value=s.data.items.map(c=>({...c,qty_received:c.quantity})),B.value=!0}catch(s){p.value=((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.message)||"DO tidak ditemukan"}},N=a=>{var e;return a.qty_error="",a.qty_received===null||a.qty_received===void 0?(a.qty_error="Jumlah harus diisi",!1):a.qty_received<0?(a.qty_error="Jumlah tidak boleh negatif",!1):a.qty_received>a.quantity?(a.qty_error=`Jumlah tidak boleh melebihi ${a.quantity}`,!1):((e=a.qty_received.toString().split(".")[1])==null?void 0:e.length)>2?(a.qty_error="Maksimal 2 angka di belakang koma",!1):!0},R=async()=>{var e,s,c,y;if(p.value="",v.value=!0,!g.value.every(u=>N(u))){v.value=!1,await V.fire({icon:"error",title:"Validasi Gagal",text:"Mohon periksa kembali jumlah yang diterima"});return}try{await M.post(route("outlet-good-receive.store"),{do_id:b.value.id,receive_date:new Date().toISOString().slice(0,10),items:g.value.map(u=>({do_item_id:u.id,item_id:u.item_id,qty_ordered:u.quantity,qty_received:u.qty_received,unit_id:u.unit_id||1})),notes:""}),v.value=!1,await V.fire({icon:"success",title:"Berhasil",text:"Good Receive berhasil disimpan",timer:1500,showConfirmButton:!1}),C(),window.location.reload()}catch(u){v.value=!1,await V.fire({icon:"error",title:"Gagal",text:((s=(e=u.response)==null?void 0:e.data)==null?void 0:s.message)||"Gagal simpan Good Receive"}),p.value=((y=(c=u.response)==null?void 0:c.data)==null?void 0:y.message)||"Gagal simpan Good Receive"}};function C(){L("close")}E(h,async a=>{if(a)if(window.Html5Qrcode)Q();else{const e=document.createElement("script");e.src="https://unpkg.com/html5-qrcode",e.onload=Q,document.body.appendChild(e)}});async function Q(){var a;if(window.Html5Qrcode)try{const e=await window.Html5Qrcode.getCameras();w.value=e;const s=e.find(c=>c.label.toLowerCase().includes("back")||c.label.toLowerCase().includes("belakang"));f.value=(s==null?void 0:s.id)||((a=e[0])==null?void 0:a.id)||"",I()}catch(e){console.error("Error getting cameras:",e),p.value="Gagal mengakses kamera"}}function I(){!window.Html5Qrcode||!f.value||(d&&d.stop().then(()=>d.clear()),d=new window.Html5Qrcode("qr-reader"),d.start(f.value,{fps:10,qrbox:200,aspectRatio:1},a=>{x.value=a,H(),O()},a=>{}))}function U(){I()}function H(){h.value=!1,d&&d.stop().then(()=>d.clear()).catch(()=>{})}F(()=>{if(d)try{d.stop().then(()=>d.clear()).catch(()=>{})}catch{}});async function z(a){if(a.item_id){q.value=!0,k.value=!0;try{const e=await M.get(`/api/items/${a.item_id}/detail`);r.value=e.data.item}catch{r.value={error:"Gagal mengambil data item"}}finally{q.value=!1}}}function T(){k.value=!1,r.value={}}return(a,e)=>(o(),l("div",Y,[t("div",Z,[e[17]||(e[17]=t("h2",{class:"text-xl font-bold mb-4 flex items-center gap-2"},[t("i",{class:"fa-solid fa-truck"}),_(" Buat Good Receive Outlet ")],-1)),t("button",{onClick:C,class:"absolute top-4 right-4 text-gray-400 hover:text-red-500"},e[3]||(e[3]=[t("i",{class:"fa-solid fa-xmark text-2xl"},null,-1)])),B.value?(o(),l("div",re,[t("div",ie,[t("div",ne,"DO: "+i(b.value.number),1),t("div",de,"Tanggal: "+i(b.value.date),1)]),t("form",{onSubmit:P(R,["prevent"])},[t("table",ue,[e[8]||(e[8]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 py-1 text-left text-xs font-medium text-gray-500 uppercase"},"Barang"),t("th",{class:"px-2 py-1 text-right text-xs font-medium text-gray-500 uppercase"},"Qty DO"),t("th",{class:"px-2 py-1 text-right text-xs font-medium text-gray-500 uppercase"},"Qty Diterima")])],-1)),t("tbody",null,[(o(!0),l(D,null,G(g.value,(s,c)=>(o(),l("tr",{key:s.id},[t("td",ce,[_(i(s.item_name)+" ",1),t("span",pe,"("+i(s.unit_name)+")",1),t("button",{type:"button",class:"ml-1 px-2 py-1 rounded bg-yellow-100 text-yellow-800 text-xs font-semibold hover:bg-yellow-200 border border-yellow-300 flex items-center gap-1",onClick:y=>z(s),disabled:!s.item_id},e[7]||(e[7]=[t("i",{class:"fa fa-info-circle"},null,-1),_(" SPS ")]),8,ve)]),t("td",me,i(s.quantity),1),t("td",ye,[S(t("input",{"onUpdate:modelValue":y=>s.qty_received=y,type:"number",min:"0",max:s.quantity,step:"0.01",class:K(["w-20 px-2 py-1 border rounded",{"border-red-500":s.qty_error}]),required:"",onInput:y=>N(s)},null,42,fe),[[$,s.qty_received,void 0,{number:!0}]]),s.qty_error?(o(),l("div",xe,i(s.qty_error),1)):m("",!0)])]))),128))])]),t("div",be,[t("button",{type:"button",onClick:C,class:"bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg"},"Batal"),t("button",{type:"submit",disabled:v.value,class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-2"},[v.value?(o(),l("svg",he,e[9]||(e[9]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):m("",!0),t("span",null,i(v.value?"Menyimpan...":"Simpan"),1)],8,ge)])],32)])):(o(),l("div",ee,[t("div",te,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Input Nomor DO",-1)),t("div",se,[S(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>x.value=s),type:"text",placeholder:"Nomor DO",class:"flex-1 px-4 py-2 border border-gray-300 rounded-lg"},null,512),[[$,x.value]]),t("button",{onClick:O,class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg"},"Cari"),t("button",{onClick:e[1]||(e[1]=s=>h.value=!0),class:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg"},e[4]||(e[4]=[t("i",{class:"fa-solid fa-camera"},null,-1)]))]),h.value?(o(),l("div",ae,[w.value.length>1?(o(),l("div",le,[S(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>f.value=s),onChange:U,class:"border rounded px-2 py-1"},[(o(!0),l(D,null,G(w.value,s=>(o(),l("option",{key:s.id,value:s.id},i(s.label),9,oe))),128))],544),[[A,f.value]])])):m("",!0),e[5]||(e[5]=t("div",{id:"qr-reader",style:{width:"100%"}},null,-1)),t("button",{onClick:H,class:"mt-2 bg-gray-300 hover:bg-gray-400 text-gray-700 px-3 py-1 rounded"},"Tutup Scanner")])):m("",!0)])])),p.value?(o(),l("div",_e,i(p.value),1)):m("",!0),J(X,{show:k.value,onClose:T},{default:W(()=>[t("div",we,[t("div",{class:"flex justify-between items-center mb-2"},[e[11]||(e[11]=t("h2",{class:"text-lg font-bold text-gray-700"},"Detail Item",-1)),t("button",{onClick:T,class:"text-gray-400 hover:text-gray-700"},e[10]||(e[10]=[t("i",{class:"fa fa-times"},null,-1)]))]),q.value?(o(),l("div",ke,e[12]||(e[12]=[t("i",{class:"fa fa-spinner fa-spin text-blue-400 text-2xl"},null,-1)]))):r.value&&!r.value.error?(o(),l("div",qe,[t("div",Ce,[e[13]||(e[13]=t("span",{class:"font-semibold"},"Nama:",-1)),_(" "+i(r.value.name),1)]),t("div",Se,[e[14]||(e[14]=t("span",{class:"font-semibold"},"Deskripsi:",-1)),r.value.description?(o(),l("span",De,i(r.value.description),1)):(o(),l("span",Ge,"(Tidak ada deskripsi)"))]),t("div",Me,[e[15]||(e[15]=t("span",{class:"font-semibold"},"Spesifikasi:",-1)),r.value.specification?(o(),l("span",Ve,i(r.value.specification),1)):(o(),l("span",Be,"(Tidak ada spesifikasi)"))]),r.value.images&&r.value.images.length?(o(),l("div",Oe,[e[16]||(e[16]=t("span",{class:"font-semibold"},"Gambar:",-1)),t("div",Ne,[(o(!0),l(D,null,G(r.value.images,s=>(o(),l("img",{key:s.id,src:s.path.startsWith("http")?s.path:"/storage/"+s.path,class:"w-24 h-24 object-contain border rounded bg-white"},null,8,Qe))),128))])])):m("",!0)])):r.value&&r.value.error?(o(),l("div",Ie,i(r.value.error),1)):m("",!0)])]),_:1},8,["show"])])]))}};export{Ue as default};
