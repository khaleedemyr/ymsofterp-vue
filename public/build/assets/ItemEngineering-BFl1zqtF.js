import{k as $,r as i,$ as z,c as A,a as G,L as l,B as a,D as t,G as g,E as O,Q as E,H as y,I as q,F as m,M as b,J as N,N as r,l as H}from"./vendor-vue-g7iCcTkf.js";import{A as J}from"./AppLayout-BDukGJW2.js";import{a as v}from"./vendor-utils-CpgP2uT4.js";import"./app-DGqVli5-.js";import"./vendor-charts-CuqD4wLC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-CnwZ944E.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const P={class:"min-h-screen w-full bg-gray-50 p-0"},K={class:"w-full bg-white shadow-2xl rounded-2xl p-8"},W={class:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-8 items-end"},X={key:0},Y=["value"],Z={key:1},tt=["value"],et={key:2},st=["value"],ot={key:0,class:"text-center py-10"},lt={key:1},at={class:"mb-8"},nt={class:"space-y-4"},rt=["onClick"],it={class:"flex items-center justify-between"},dt={class:"flex items-center gap-4"},ut={class:"font-bold text-blue-800 text-lg"},gt={class:"flex gap-6 text-sm text-blue-700"},ct={class:"font-semibold"},pt={class:"font-semibold"},mt={class:"font-semibold"},bt={key:0,class:"bg-white"},xt={class:"overflow-x-auto"},ft={class:"min-w-full"},yt={class:"bg-white divide-y divide-gray-200"},vt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},_t={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},ht={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right"},wt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right"},kt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-semibold"},Ct={class:"bg-blue-50 border-t-2 border-blue-200"},Tt={class:"px-6 py-3 text-right font-bold text-blue-800"},It={class:"bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-6 mb-8 border border-green-200"},jt={class:"flex items-center justify-between"},Ot={class:"text-right"},Et={class:"text-2xl font-bold text-green-800"},qt={class:"overflow-x-auto mb-8"},Nt={class:"min-w-full rounded-2xl overflow-hidden shadow-lg"},Rt={class:"px-6 py-3"},Mt={class:"px-6 py-3 font-semibold text-gray-800"},St={class:"px-6 py-3 text-right font-semibold"},Ht=Object.assign({layout:J},{__name:"ItemEngineering",setup(Vt){var j;const n=$({region:"",outlet:"",date_from:"",date_to:""}),k=i([]),x=i([]),f=i([]),R=i([]),_=i({}),C=i([]),h=i(!1),w=((j=z().props.auth)==null?void 0:j.user)||{},T=i(""),I=i(0),M=A(()=>I.value),c=i({});function p(s){if(typeof s=="number")return s.toLocaleString("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0});if(!s)return"-";const e=Number(s);return isNaN(e)?s:e.toLocaleString("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0})}function S(s){c.value[s]=!c.value[s]}const V=async()=>{const s=await v.get("/api/regions");k.value=s.data.regions||[]},L=async()=>{const s=await v.get("/api/outlets/report");x.value=s.data.outlets||[],f.value=x.value},U=()=>{n.region?f.value=x.value.filter(s=>s.region_id==n.region):f.value=x.value,n.outlet=""},B=async()=>{const s=await v.get("/api/my-outlet-qr");s.data.qr_code&&(n.outlet=s.data.qr_code),s.data.outlet_name&&(T.value=s.data.outlet_name)},D=async()=>{h.value=!0;try{const s=await v.get("/api/report/item-engineering",{params:n});R.value=s.data.items||[],_.value=s.data.items_by_category||{},C.value=s.data.modifiers||[],I.value=s.data.grand_total||0;const e=Object.keys(_.value);e.length>0&&(c.value[e[0]]=!0)}finally{h.value=!1}},F=()=>{const s={outlet:n.outlet,date_from:n.date_from,date_to:n.date_to},e=Object.entries(s).map(([o,d])=>`${o}=${encodeURIComponent(d||"")}`).join("&");window.open(`/report/item-engineering/export?${e}`,"_blank")};return G(async()=>{w.id_outlet==1?(await V(),await L()):await B()}),(s,e)=>(a(),l("div",P,[t("div",K,[e[22]||(e[22]=t("h1",{class:"text-2xl font-bold mb-6 text-blue-800 flex items-center gap-2"},[t("i",{class:"fa-solid fa-cogs"}),g(" Item Engineering ")],-1)),t("div",W,[E(w).id_outlet==1?(a(),l("div",X,[e[5]||(e[5]=t("label",{class:"block text-sm font-medium mb-1"},"Region",-1)),y(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>n.region=o),onChange:U,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 px-3 py-2"},[e[4]||(e[4]=t("option",{value:""},"Pilih Region",-1)),(a(!0),l(m,null,b(k.value,o=>(a(),l("option",{key:o.id,value:o.id},r(o.name),9,Y))),128))],544),[[q,n.region]])])):O("",!0),E(w).id_outlet==1?(a(),l("div",Z,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium mb-1"},"Outlet",-1)),y(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>n.outlet=o),class:"block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 px-3 py-2"},[e[6]||(e[6]=t("option",{value:""},"Pilih Outlet",-1)),(a(!0),l(m,null,b(f.value,o=>(a(),l("option",{key:o.id,value:o.qr_code},r(o.name),9,tt))),128))],512),[[q,n.outlet]])])):(a(),l("div",et,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium mb-1"},"Outlet",-1)),t("input",{type:"text",value:T.value,class:"block w-full rounded-lg border-gray-300 shadow-sm bg-gray-100 cursor-not-allowed px-3 py-2",readonly:""},null,8,st)])),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium mb-1"},"Tanggal From",-1)),y(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=o=>n.date_from=o),class:"block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 px-3 py-2"},null,512),[[N,n.date_from]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium mb-1"},"Tanggal To",-1)),y(t("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=o=>n.date_to=o),class:"block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 px-3 py-2"},null,512),[[N,n.date_to]])]),t("div",{class:"flex items-end h-full gap-2"},[t("button",{onClick:D,class:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 transition"},"Tampilkan"),t("button",{onClick:F,class:"w-full bg-green-600 text-white px-4 py-2 rounded-lg shadow hover:bg-green-700 transition"},"Export to Excel")])]),h.value?(a(),l("div",ot,e[11]||(e[11]=[t("span",{class:"text-gray-500"},"Loading...",-1)]))):(a(),l("div",lt,[t("div",at,[e[17]||(e[17]=t("h2",{class:"text-lg font-bold text-blue-800 mb-4 flex items-center gap-2"},[t("i",{class:"fa-solid fa-list"}),g(" Item Engineering by Category ")],-1)),t("div",nt,[(a(!0),l(m,null,b(_.value,(o,d)=>(a(),l("div",{key:d,class:"border border-gray-200 rounded-lg overflow-hidden shadow-sm"},[t("div",{class:"bg-gradient-to-r from-blue-50 to-blue-100 px-6 py-4 cursor-pointer hover:bg-blue-200 transition",onClick:u=>S(d)},[t("div",it,[t("div",dt,[t("i",{class:H([c.value[d]?"fa-solid fa-chevron-down":"fa-solid fa-chevron-right","text-blue-600"])},null,2),t("div",null,[t("h3",ut,r(d||"Uncategorized"),1),t("div",gt,[t("span",null,[e[12]||(e[12]=g("Total Qty: ")),t("span",ct,r(o.total_qty),1)]),t("span",null,[e[13]||(e[13]=g("Total Sales: ")),t("span",pt,r(p(o.total_subtotal)),1)]),t("span",null,[e[14]||(e[14]=g("Items: ")),t("span",mt,r(o.items.length),1)])])])])])],8,rt),c.value[d]?(a(),l("div",bt,[t("div",xt,[t("table",ft,[e[16]||(e[16]=t("thead",null,[t("tr",{class:"bg-gray-50 border-b"},[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"No"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nama Item"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Qty Terjual"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Harga Jual"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Subtotal")])],-1)),t("tbody",yt,[(a(!0),l(m,null,b(o.items,(u,Q)=>(a(),l("tr",{key:u.item_name,class:"hover:bg-gray-50 transition"},[t("td",vt,r(Q+1),1),t("td",_t,r(u.item_name),1),t("td",ht,r(u.qty_terjual),1),t("td",wt,r(p(u.harga_jual)),1),t("td",kt,r(p(u.subtotal)),1)]))),128)),t("tr",Ct,[e[15]||(e[15]=t("td",{colspan:"4",class:"px-6 py-3 text-right font-bold text-blue-800"},"Category Total",-1)),t("td",Tt,r(p(o.total_subtotal)),1)])])])])])):O("",!0)]))),128))])]),t("div",It,[t("div",jt,[e[19]||(e[19]=t("h3",{class:"text-lg font-bold text-green-800"},"Grand Total Summary",-1)),t("div",Ot,[t("div",Et,r(p(M.value)),1),e[18]||(e[18]=t("div",{class:"text-sm text-green-600"},"Total dari semua categories",-1))])])]),t("div",qt,[e[21]||(e[21]=t("h2",{class:"text-lg font-bold text-blue-800 mb-2 flex items-center gap-2"},[t("i",{class:"fa-solid fa-gears"}),g(" Modifier Engineering")],-1)),t("table",Nt,[e[20]||(e[20]=t("thead",null,[t("tr",{class:"bg-[#2563eb] text-white font-bold text-base"},[t("th",{class:"px-6 py-3 text-left"},"No"),t("th",{class:"px-6 py-3 text-left"},"Nama Modifier"),t("th",{class:"px-6 py-3 text-right"},"Qty Terjual")])],-1)),t("tbody",null,[(a(!0),l(m,null,b(C.value,(o,d)=>(a(),l("tr",{key:o.name,class:"bg-white border-b last:border-b-0 hover:bg-blue-50 transition"},[t("td",Rt,r(d+1),1),t("td",Mt,r(o.name),1),t("td",St,r(o.qty),1)]))),128))])])])]))])]))}});export{Ht as default};
