import{r as b,c as h,w as Y,A as Z,B as i,C as ee,D as l,L as d,E as K,H as N,J as P,F as D,M as Q,N as o,I as H,x as te,Q as ae,G as U,l as W,W as le}from"./vendor-vue-g7iCcTkf.js";import{A as se}from"./AppLayout-nEB-Gr2i.js";import{s as re}from"./vue-multiselect.esm-V-bx43V9.js";/* empty css                            */import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-utils-CpgP2uT4.js";import"./app-YbzOJwkz.js";import"./vendor-charts-CuqD4wLC.js";import"./ProfileUpdateModal-DIps1Q-A.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const ie={class:"max-w-7xl mx-auto py-8 px-4"},oe={class:"flex flex-wrap gap-3 mb-4 items-center"},ue={class:"flex items-center gap-2"},de=["value"],me={class:"flex items-center gap-2"},ce={class:"flex items-center gap-2"},pe=["value"],_e={class:"flex items-center gap-2"},ge=["disabled"],fe={key:0,class:"animate-spin mr-2"},ye={key:1,class:"mr-2"},ve={key:0,class:"bg-red-50 border-l-4 border-red-400 text-red-800 p-4 rounded my-8 text-center font-semibold"},xe={key:1,class:"bg-blue-50 border-l-4 border-blue-400 text-blue-800 p-4 rounded my-8 text-center font-semibold"},be={class:"bg-white rounded-xl shadow-lg overflow-hidden"},he={class:"overflow-x-auto"},ke={class:"min-w-full divide-y divide-gray-200"},qe={class:"bg-white divide-y divide-gray-200"},$e={key:0},we={class:"px-6 py-4 whitespace-nowrap text-sm"},Se={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-700"},De={class:"px-6 py-4 whitespace-nowrap text-sm text-right"},Ae={class:"px-6 py-4 whitespace-nowrap text-sm text-right"},Ce={class:"px-6 py-4 whitespace-nowrap text-sm text-right"},Le={class:"px-6 py-4 whitespace-nowrap text-sm"},Me={class:"px-6 py-4 whitespace-nowrap text-sm"},Ve={key:0,class:"flex justify-between items-center mt-4"},Ne={class:"text-sm text-gray-600"},Ue={class:"flex gap-1"},Ie=["disabled"],Te={class:"px-2"},Be=["disabled"],Ee={key:3,class:"bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 p-4 rounded my-8 text-center font-semibold"},Ke={__name:"StockCard",props:{cards:Array,warehouses:Array,items:Array,saldo_awal:Object,error:String},setup(A){const x=A,C=b(""),S=b(25),p=b(1),k=b(""),m=b(""),L=b(!1),q=b(""),M=b(""),$=h(()=>{let a=x.cards;if(k.value&&(a=a.filter(t=>{var u;return String(t.warehouse_name)===String((u=x.warehouses.find(v=>v.id==k.value))==null?void 0:u.name)})),m.value&&(a=a.filter(t=>t.item_name===m.value.name)),q.value&&(a=a.filter(t=>new Date(t.date)>=new Date(q.value))),M.value&&(a=a.filter(t=>new Date(t.date)<=new Date(M.value))),!C.value)return a;const e=C.value.toLowerCase();return a.filter(t=>t.item_name&&t.item_name.toLowerCase().includes(e)||t.warehouse_name&&t.warehouse_name.toLowerCase().includes(e)||t.reference_type&&t.reference_type.toLowerCase().includes(e)||t.description&&t.description.toLowerCase().includes(e))}),I=h(()=>Math.ceil($.value.length/S.value)||1),T=h(()=>(p.value-1)*S.value),j=h(()=>Math.min(T.value+S.value,$.value.length)),B=h(()=>$.value.slice(T.value,j.value));function R(){p.value>1&&p.value--}function G(){p.value<I.value&&p.value++}Y([S,C],()=>{p.value=1});function F(a,e,t,u,v,_){let c=0,s=0,r=0;if(e&&t){c=Math.floor(a/(e*t));let g=a%(e*t);s=Math.floor(g/e),r=g%e}else e?(s=Math.floor(a/e),r=a%e):r=a;let n=[];return c>0&&n.push(`${c} ${u||""}`.trim()),s>0&&n.push(`${s} ${v||""}`.trim()),r>0&&n.push(`${r} ${_||""}`.trim()),n.length?n.join(" / "):`0 ${_||""}`}function y(a){return a==null?0:Number(a)%1===0?Number(a):Number(a).toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:2})}function O(a,e=null){return e==="in"?`${y(a.in_qty_small)} ${a.small_unit_name||""} | ${y(a.in_qty_medium)} ${a.medium_unit_name||""} | ${y(a.in_qty_large)} ${a.large_unit_name||""}`:e==="out"?`${y(a.out_qty_small)} ${a.small_unit_name||""} | ${y(a.out_qty_medium)} ${a.medium_unit_name||""} | ${y(a.out_qty_large)} ${a.large_unit_name||""}`:"-"}function J(a){return`${y(a.saldo_qty_small)} ${a.small_unit_name||""} | ${y(a.saldo_qty_medium)} ${a.medium_unit_name||""} | ${y(a.saldo_qty_large)} ${a.large_unit_name||""}`}h(()=>{let a=0;return B.value.map((e,t)=>{let u=e.in_qty_small||0,v=e.in_qty_medium||0,_=e.in_qty_large||0,c=e.small_conversion_qty||1,s=e.medium_conversion_qty||1,r=u+v*c+_*c*s,n=e.out_qty_small||0,g=e.out_qty_medium||0,f=e.out_qty_large||0,w=n+g*c+f*c*s;return a+=r-w,console.log("runningBalance",{idx:t,saldo:a,row:e}),a})});const E=h(()=>{var _,c;if(x.saldo_awal)return x.saldo_awal;if(!m.value)return"-";let a=x.cards.filter(s=>s.item_name===m.value.name);k.value&&(a=a.filter(s=>{var r;return String(s.warehouse_name)===String((r=x.warehouses.find(n=>n.id==k.value))==null?void 0:r.name)})),q.value&&(a=a.filter(s=>new Date(s.date)<new Date(q.value))),a=[...a].sort((s,r)=>new Date(s.date)-new Date(r.date)||s.id-r.id);let e=0,t=((_=a[0])==null?void 0:_.small_conversion_qty)||1,u=((c=a[0])==null?void 0:c.medium_conversion_qty)||1;return a.forEach(s=>{let r=(s.in_qty_small||0)+(s.in_qty_medium||0)*t+(s.in_qty_large||0)*t*u,n=(s.out_qty_small||0)+(s.out_qty_medium||0)*t+(s.out_qty_large||0)*t*u;e+=r-n}),(s=>{var r,n,g;return F(s,t,u,(r=a[0])==null?void 0:r.large_unit_name,(n=a[0])==null?void 0:n.medium_unit_name,(g=a[0])==null?void 0:g.small_unit_name)})(e)});h(()=>{var n,g;if(!m.value)return{saldoAwal:"-",totalMasuk:"-",totalKeluar:"-",saldoAkhir:"-"};let a=$.value,e=((n=a[0])==null?void 0:n.small_conversion_qty)||1,t=((g=a[0])==null?void 0:g.medium_conversion_qty)||1,u=0,v=0,_=0;a.forEach(f=>{let w=(f.in_qty_small||0)+(f.in_qty_medium||0)*e+(f.in_qty_large||0)*e*t,V=(f.out_qty_small||0)+(f.out_qty_medium||0)*e+(f.out_qty_large||0)*e*t;u+=w,v+=V,_+=w-V});let s=E.value==="-"?0:E.value;typeof _=="number"&&(s+=_);const r=f=>{var w,V,z;return F(f,e,t,(w=a[0])==null?void 0:w.large_unit_name,(V=a[0])==null?void 0:V.medium_unit_name,(z=a[0])==null?void 0:z.small_unit_name)};return{saldoAwal:E.value,totalMasuk:r(u),totalKeluar:r(v),saldoAkhir:r(s)}});function X(){var e;if(!m.value){alert("Silakan pilih barang terlebih dahulu!");return}L.value=!0;const a={item_id:((e=m.value)==null?void 0:e.id)||"",warehouse_id:k.value||"",from:q.value||"",to:M.value||""};Object.keys(a).forEach(t=>{a[t]||delete a[t]}),le.get("/inventory/stock-card",a,{preserveState:!0,preserveScroll:!0,onSuccess:()=>{L.value=!1},onError:t=>{L.value=!1,console.error("Error loading data:",t)}})}return(a,e)=>(i(),Z(se,null,{default:ee(()=>[l("div",ie,[e[20]||(e[20]=l("h1",{class:"text-2xl font-bold mb-6"},"Kartu Stok (Stock Card)",-1)),l("div",oe,[N(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>C.value=t),type:"text",placeholder:"Cari barang, warehouse, referensi, keterangan...",class:"px-4 py-2 border border-gray-300 rounded-lg w-full md:w-64 focus:ring-blue-500 focus:border-blue-500"},null,512),[[P,C.value]]),l("div",ue,[e[7]||(e[7]=l("label",{class:"text-sm"},"Warehouse",-1)),N(l("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>k.value=t),class:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500"},[e[6]||(e[6]=l("option",{value:""},"Semua Warehouse",-1)),(i(!0),d(D,null,Q(A.warehouses,t=>(i(),d("option",{key:t.id,value:t.id},o(t.name),9,de))),128))],512),[[H,k.value]])]),l("div",me,[e[8]||(e[8]=l("label",{class:"text-sm"},"Barang",-1)),te(ae(re),{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=t=>m.value=t),options:A.items,searchable:!0,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Pilih atau cari barang...","track-by":"name",label:"name","preselect-first":!1,class:"w-64"},null,8,["modelValue","options"])]),l("div",ce,[e[9]||(e[9]=l("label",{class:"text-sm"},"Tampilkan",-1)),N(l("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>S.value=t),class:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500"},[(i(),d(D,null,Q([10,25,50,100],t=>l("option",{key:t,value:t},o(t),9,pe)),64))],512),[[H,S.value]]),e[10]||(e[10]=l("span",{class:"text-sm"},"data",-1))]),l("div",_e,[e[11]||(e[11]=l("label",{class:"text-sm"},"Periode",-1)),N(l("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=t=>q.value=t),class:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[P,q.value]]),e[12]||(e[12]=l("span",null,"-",-1)),N(l("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=t=>M.value=t),class:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[P,M.value]])]),l("button",{onClick:X,disabled:L.value,class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md font-semibold hover:bg-blue-700"},[L.value?(i(),d("span",fe,e[13]||(e[13]=[l("i",{class:"fas fa-spinner"},null,-1)]))):(i(),d("span",ye,e[14]||(e[14]=[l("i",{class:"fas fa-sync-alt"},null,-1)]))),e[15]||(e[15]=U(" Load Data "))],8,ge)]),x.error?(i(),d("div",ve,o(x.error),1)):m.value?m.value&&A.cards.length>0?(i(),d(D,{key:2},[l("div",be,[l("div",he,[l("table",ke,[e[18]||(e[18]=l("thead",{class:"bg-gray-50 sticky top-0 z-10"},[l("tr",null,[l("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Tanggal"),l("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Warehouse"),l("th",{class:"px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider"},"Masuk (Qty)"),l("th",{class:"px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider"},"Keluar (Qty)"),l("th",{class:"px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider"},"Saldo (Qty)"),l("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Referensi"),l("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Keterangan")])],-1)),l("tbody",qe,[$.value.length?K("",!0):(i(),d("tr",$e,e[17]||(e[17]=[l("td",{colspan:"7",class:"text-center py-10 text-gray-400"},"Tidak ada data kartu stok.",-1)]))),(i(!0),d(D,null,Q(B.value,(t,u)=>(i(),d("tr",{key:t.id,class:W(["hover:bg-gray-50 transition",u===B.value.length-1?"bg-yellow-200 font-bold":""])},[l("td",we,o(t.date?new Date(t.date).toLocaleDateString("id-ID"):"-"),1),l("td",Se,o(t.warehouse_name),1),l("td",De,o(O(t,"in")),1),l("td",Ae,o(O(t,"out")),1),l("td",Ce,o(J(t)),1),l("td",Le,[t.reference_number?(i(),d(D,{key:0},[U(o(t.reference_number),1)],64)):(i(),d(D,{key:1},[U(o(t.reference_type?t.reference_type+(t.reference_id?" #"+t.reference_id:""):"-"),1)],64))]),l("td",Me,o(t.description||"-"),1)],2))),128))])])])]),$.value.length?(i(),d("div",Ve,[l("div",Ne," Menampilkan "+o(T.value+1)+" - "+o(j.value)+" dari "+o($.value.length)+" data ",1),l("div",Ue,[l("button",{onClick:R,disabled:p.value===1,class:W(["px-3 py-1 rounded border text-sm",p.value===1?"bg-gray-200 text-gray-400":"bg-white text-blue-700 hover:bg-blue-50"])},"<",10,Ie),l("span",Te,"Halaman "+o(p.value)+" / "+o(I.value),1),l("button",{onClick:G,disabled:p.value===I.value,class:W(["px-3 py-1 rounded border text-sm",p.value===I.value?"bg-gray-200 text-gray-400":"bg-white text-blue-700 hover:bg-blue-50"])},">",10,Be)])])):K("",!0)],64)):m.value&&A.cards.length===0?(i(),d("div",Ee,e[19]||(e[19]=[l("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1),U(" Tidak ada data kartu stok untuk item yang dipilih. Coba ubah filter warehouse atau periode tanggal. ")]))):K("",!0):(i(),d("div",xe,e[16]||(e[16]=[l("i",{class:"fas fa-info-circle mr-2"},null,-1),U(' Silakan pilih warehouse, barang, dan periode tanggal, kemudian klik tombol "Load Data" untuk melihat kartu stok. ')])))])]),_:1}))}},Ye=ne(Ke,[["__scopeId","data-v-72c2aaa4"]]);export{Ye as default};
