import{c as h,r as H,P as L,w as W,A as Y,B as o,C as z,D as t,G as b,N as n,Q as s,W as j,O as Q,L as i,E as p,H as v,l as T,J as K,F as w,M as C,I as S}from"./vendor-vue-g7iCcTkf.js";import{A as R}from"./AppLayout-D6FAfGlz.js";import{S as g}from"./app-dzBjFUgD.js";import"./vendor-utils-CpgP2uT4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-CUUHZNnG.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const X={class:"w-full py-8 px-4"},Z={class:"max-w-4xl mx-auto"},ee={class:"bg-white rounded-2xl shadow-lg p-6"},te={class:"flex justify-between items-center mb-6"},re={class:"text-2xl font-bold text-gray-800 flex items-center gap-2"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},le={key:0,class:"mt-1 text-sm text-red-600"},oe=["value"],se={key:0,class:"mt-1 text-sm text-red-600"},ie={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ne=["value"],de={key:0,class:"mt-1 text-sm text-red-600"},ue={class:"space-y-4"},ce={class:"flex justify-between items-center"},be={class:"space-y-4"},me={class:"flex justify-between items-center mb-4"},ge={class:"font-semibold text-gray-700"},pe=["onClick"],fe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},_e=["onUpdate:modelValue"],xe=["value"],ve={key:0,class:"mt-1 text-xs text-gray-600"},ye=["onUpdate:modelValue"],ke=["value"],he={key:0,class:"mt-1 text-xs text-gray-600"},je=["value","onInput"],we={class:"bg-blue-50 border-2 border-blue-200 rounded-lg p-4"},Ce={class:"grid grid-cols-2 gap-4"},Ee={class:"text-lg font-bold text-green-700"},Be={class:"text-lg font-bold text-red-700"},Te={key:0,class:"mt-2 text-sm text-red-600 font-semibold"},Se={key:1,class:"mt-2 text-sm text-green-600 font-semibold"},Ve={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-4"},Ae={class:"text-sm text-red-600"},Je={class:"flex justify-end gap-4 pt-4 border-t"},De=["disabled"],$e={key:0},Ue={key:1},Le={__name:"Form",props:{jurnal:Object,coas:Array,outlets:Array},setup(E){var J,D,$;const m=E,f=h(()=>!!m.jurnal),M=f.value?[{coa_debit_id:m.jurnal.coa_debit_id||"",coa_kredit_id:m.jurnal.coa_kredit_id||"",jumlah:m.jurnal.jumlah_debit||0}]:[{coa_debit_id:"",coa_kredit_id:"",jumlah:0}],d=H(M.map(r=>({...r}))),l=L({tanggal:((J=m.jurnal)==null?void 0:J.tanggal)||new Date().toISOString().split("T")[0],keterangan:((D=m.jurnal)==null?void 0:D.keterangan)||"",outlet_id:(($=m.jurnal)==null?void 0:$.outlet_id)||"",entries:d.value}),V=h(()=>m.coas.map(r=>({value:r.id,label:`${r.code} - ${r.name} (${r.type})`,code:r.code,name:r.name,type:r.type})));function _(r){return r?m.coas.find(e=>e.id==r):null}function A(r,e){const a=r[e];if(!a)return;const c=_(a);!c||!c.default_counter_account_id||(e==="coa_debit_id"?r.coa_kredit_id||(r.coa_kredit_id=c.default_counter_account_id):e==="coa_kredit_id"&&(r.coa_debit_id||(r.coa_debit_id=c.default_counter_account_id)))}W(()=>d.value,r=>{r.forEach(e=>{e.coa_debit_id&&A(e,"coa_debit_id"),e.coa_kredit_id&&A(e,"coa_kredit_id")})},{deep:!0});const y=h(()=>d.value.reduce((r,e)=>r+(parseFloat(e.jumlah)||0),0)),k=h(()=>d.value.reduce((r,e)=>r+(parseFloat(e.jumlah)||0),0));function O(){d.value.push({coa_debit_id:"",coa_kredit_id:"",jumlah:0})}async function N(r){d.value.length>1?(await g.fire({title:"Hapus Entry?",text:`Yakin ingin menghapus entry #${r+1}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal"})).isConfirmed&&d.value.splice(r,1):g.fire("Peringatan","Minimal harus ada 1 entry jurnal!","warning")}function P(r,e){return r.coa_debit_id&&r.coa_kredit_id&&r.coa_debit_id==r.coa_kredit_id?`Entry #${e+1}: CoA debit dan kredit tidak boleh sama!`:r.jumlah<=0?`Entry #${e+1}: Jumlah harus lebih dari 0!`:null}function q(){l.entries=d.value;const r=[];if(d.value.forEach((a,c)=>{const x=P(a,c);x&&r.push(x)}),r.length>0){g.fire({title:"Validasi Gagal",html:r.join("<br>"),icon:"error",confirmButtonText:"OK"});return}if(y.value!==k.value){g.fire("Validasi Gagal","Total debit dan kredit harus sama!","error");return}if(d.value.filter(a=>!a.coa_debit_id||!a.coa_kredit_id||!a.jumlah).length>0){g.fire("Validasi Gagal","Semua entry harus lengkap (CoA debit, CoA kredit, dan jumlah)!","error");return}if(f.value){if(d.value.length>1){g.fire("Peringatan","Mode edit hanya support 1 entry. Silakan hapus entry tambahan atau buat jurnal baru.","warning");return}const a=d.value[0];l.coa_debit_id=a.coa_debit_id,l.coa_kredit_id=a.coa_kredit_id,l.jumlah_debit=a.jumlah,l.jumlah_kredit=a.jumlah,l.put(route("jurnal.update",m.jurnal.id),{onSuccess:()=>{g.fire("Berhasil","Jurnal berhasil diupdate!","success").then(()=>{j.visit("/jurnal")})},onError:c=>{c.error&&g.fire("Error",c.error,"error")}})}else l.post(route("jurnal.store"),{onSuccess:()=>{g.fire("Berhasil","Jurnal berhasil dibuat!","success").then(()=>{j.visit("/jurnal")})},onError:a=>{a.error&&g.fire("Error",a.error,"error")}})}function B(r){return r?new Intl.NumberFormat("id-ID").format(r):"0"}function G(r){return parseFloat(r.toString().replace(/[^\d]/g,""))||0}return(r,e)=>(o(),Y(R,{title:f.value?"Edit Jurnal":"Tambah Jurnal Baru"},{default:z(()=>[t("div",X,[t("div",Z,[t("div",ee,[t("div",te,[t("h1",re,[e[5]||(e[5]=t("i",{class:"fa-solid fa-book text-blue-500"},null,-1)),b(" "+n(f.value?"Edit Jurnal":"Tambah Jurnal Baru"),1)]),t("button",{onClick:e[0]||(e[0]=a=>s(j).visit("/jurnal")),class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition"},e[6]||(e[6]=[t("i",{class:"fa-solid fa-arrow-left mr-2"},null,-1),b("Kembali ")]))]),t("form",{onSubmit:Q(q,["prevent"]),class:"space-y-6"},[t("div",ae,[t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[b(" Tanggal "),t("span",{class:"text-red-500"},"*")],-1)),v(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>s(l).tanggal=a),type:"date",required:"",class:T(["w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",{"border-red-500":s(l).errors.tanggal}])},null,2),[[K,s(l).tanggal]]),s(l).errors.tanggal?(o(),i("p",le,n(s(l).errors.tanggal),1)):p("",!0)]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[b(" Outlet "),t("span",{class:"text-red-500"},"*")],-1)),v(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>s(l).outlet_id=a),required:"",class:T(["w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",{"border-red-500":s(l).errors.outlet_id}])},[e[8]||(e[8]=t("option",{value:""},"-- Pilih Outlet --",-1)),(o(!0),i(w,null,C(E.outlets,a=>(o(),i("option",{key:a.id_outlet,value:a.id_outlet},n(a.nama_outlet),9,oe))),128))],2),[[S,s(l).outlet_id]]),s(l).errors.outlet_id?(o(),i("p",se,n(s(l).errors.outlet_id),1)):p("",!0)])]),f.value?(o(),i("div",ie,[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," No Jurnal ",-1)),t("input",{value:E.jurnal.no_jurnal,type:"text",readonly:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100"},null,8,ne)])])):p("",!0),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Keterangan ",-1)),v(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=a=>s(l).keterangan=a),rows:"3",class:T(["w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",{"border-red-500":s(l).errors.keterangan}])},null,2),[[K,s(l).keterangan]]),s(l).errors.keterangan?(o(),i("p",de,n(s(l).errors.keterangan),1)):p("",!0)]),t("div",ue,[t("div",ce,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700"},[b(" Entri Jurnal "),t("span",{class:"text-red-500"},"*")],-1)),f.value?p("",!0):(o(),i("button",{key:0,type:"button",onClick:O,class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition text-sm font-semibold"},e[12]||(e[12]=[t("i",{class:"fa-solid fa-plus mr-1"},null,-1),b("Tambah Entry ")])))]),t("div",be,[(o(!0),i(w,null,C(d.value,(a,c)=>{var x,U,F,I;return o(),i("div",{key:c,class:"bg-gray-50 border-2 border-gray-200 rounded-lg p-4"},[t("div",me,[t("h3",ge,"Entry #"+n(c+1),1),!f.value&&d.value.length>1?(o(),i("button",{key:0,type:"button",onClick:u=>N(c),class:"px-3 py-1 bg-red-500 text-white rounded-lg hover:bg-red-600 transition text-sm",title:"Hapus Entry"},e[14]||(e[14]=[t("i",{class:"fa-solid fa-trash"},null,-1)]),8,pe)):p("",!0)]),t("div",fe,[t("div",null,[e[16]||(e[16]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},[t("i",{class:"fa-solid fa-arrow-down text-green-600 mr-1"}),b(" CoA Debit "),t("span",{class:"text-red-500"},"*")],-1)),v(t("select",{"onUpdate:modelValue":u=>a.coa_debit_id=u,required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm"},[e[15]||(e[15]=t("option",{value:""},"-- Pilih CoA Debit --",-1)),(o(!0),i(w,null,C(V.value,u=>(o(),i("option",{key:u.value,value:u.value},n(u.label),9,xe))),128))],8,_e),[[S,a.coa_debit_id]]),_(a.coa_debit_id)?(o(),i("div",ve,n((x=_(a.coa_debit_id))==null?void 0:x.code)+" - "+n((U=_(a.coa_debit_id))==null?void 0:U.name),1)):p("",!0)]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},[t("i",{class:"fa-solid fa-arrow-up text-red-600 mr-1"}),b(" CoA Kredit "),t("span",{class:"text-red-500"},"*")],-1)),v(t("select",{"onUpdate:modelValue":u=>a.coa_kredit_id=u,required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 text-sm"},[e[17]||(e[17]=t("option",{value:""},"-- Pilih CoA Kredit --",-1)),(o(!0),i(w,null,C(V.value,u=>(o(),i("option",{key:u.value,value:u.value},n(u.label),9,ke))),128))],8,ye),[[S,a.coa_kredit_id]]),_(a.coa_kredit_id)?(o(),i("div",he,n((F=_(a.coa_kredit_id))==null?void 0:F.code)+" - "+n((I=_(a.coa_kredit_id))==null?void 0:I.name),1)):p("",!0)]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},[b(" Jumlah "),t("span",{class:"text-red-500"},"*")],-1)),t("input",{value:B(a.jumlah),onInput:u=>a.jumlah=G(u.target.value),type:"text",required:"",placeholder:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-right text-sm"},null,40,je)])])])}),128))]),t("div",we,[t("div",Ce,[t("div",null,[e[20]||(e[20]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Total Debit",-1)),t("div",Ee,n(B(y.value)),1)]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Total Kredit",-1)),t("div",Be,n(B(k.value)),1)])]),y.value!==k.value?(o(),i("div",Te,e[22]||(e[22]=[t("i",{class:"fa-solid fa-exclamation-triangle mr-1"},null,-1),b(" Total debit dan kredit harus sama! ")]))):(o(),i("div",Se,e[23]||(e[23]=[t("i",{class:"fa-solid fa-check-circle mr-1"},null,-1),b(" Balance: Total debit = Total kredit ")])))])]),s(l).errors.error?(o(),i("div",Ve,[t("p",Ae,n(s(l).errors.error),1)])):p("",!0),t("div",Je,[t("button",{type:"button",onClick:e[4]||(e[4]=a=>s(j).visit("/jurnal")),class:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition"}," Batal "),t("button",{type:"submit",disabled:s(l).processing||y.value!==k.value||d.value.length===0,class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed"},[s(l).processing?(o(),i("span",$e,"Menyimpan...")):(o(),i("span",Ue,n(f.value?"Update":"Simpan"),1))],8,De)])],32)])])])]),_:1},8,["title"]))}};export{Le as default};
