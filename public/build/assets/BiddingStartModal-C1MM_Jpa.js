import{r as i,a as T,L as n,B as l,x as d,A,E as P,C as p,Q as g,D as e,G as F,F as w,M as D,O as G,l as O,N as u,H as q,V as z}from"./vendor-vue-g7iCcTkf.js";import{a as Q}from"./vendor-utils-CpgP2uT4.js";import"./app-BgZdqVzD.js";import U from"./BiddingPrintPreviewModal-BsohxcIw.js";import Y from"./BiddingList-GMV_-AV4.js";import H from"./BiddingSupplierInputModal-DMUGQKUT.js";import{Y as J,h as S,G as K,S as W}from"./vendor-ui-CrPgGUUb.js";import"./vendor-charts-CuqD4wLC.js";const X={class:"fixed inset-0 overflow-y-auto"},Z={class:"flex min-h-full items-center justify-center p-4 text-center"},ee={key:0,class:"flex items-center justify-center py-8"},te={key:1},se={key:0,class:"text-center text-gray-500 py-8"},ae={key:1,class:"space-y-4 max-h-[60vh] overflow-y-auto"},le=["onClick"],ne={class:"flex items-center gap-2"},oe=["onClick"],ie={class:"font-semibold"},de={class:"text-xs text-gray-500"},ue={class:"text-xs text-gray-500"},re={key:0},ce={class:"w-full text-sm mb-2"},fe=["value"],ve={class:"flex justify-end gap-2 mt-6"},me=["disabled"],we={__name:"BiddingStartModal",props:{show:Boolean,taskId:[String,Number]},emits:["close","bidding-started"],setup(B,{emit:E}){const y=B,x=E,b=i(!1),r=i([]),c=i([]),_=i(!1),f=i([]),v=i(!1),h=i(!1),m=i([]);T(R);async function R(){b.value=!0;try{console.log("Fetching PRs for taskId:",y.taskId);const a=await Q.get(`/api/maintenance-tasks/${y.taskId}/purchase-requisitions`);console.log("API Response PRs:",a.data),r.value=a.data.filter(t=>t.status==="APPROVED")}catch(a){console.error("Error fetching PRs:",a),r.value=[]}finally{b.value=!1}}function k(){x("close")}async function $(){const a=[];r.value.forEach(t=>{(t.items||[]).forEach(s=>{c.value.includes(s.id)&&a.push({...s,pr_number:t.pr_number})})}),f.value=a,_.value=!0}function L(a){return new Date(a).toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric"})}function M(){x("close"),setTimeout(()=>{v.value=!0},300)}function V(){if(console.log("previewItems saat input bidding:",f.value),!f.value.length){const a=[];r.value.forEach(t=>{(t.items||[]).forEach(s=>{c.value.includes(s.id)&&a.push({...s,pr_number:t.pr_number})})}),f.value=a}v.value=!1,setTimeout(()=>{h.value=!0},300)}function j(a){h.value=!1,setTimeout(()=>{v.value=!0},300)}function C(a){const t=m.value.indexOf(a);t===-1?m.value.push(a):m.value.splice(t,1)}return(a,t)=>(l(),n(w,null,[d(g(W),{appear:"",show:B.show,as:"template"},{default:p(()=>[d(g(J),{as:"div",onClose:k,class:"relative z-[99999]"},{default:p(()=>[d(g(S),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>t[5]||(t[5]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",X,[e("div",Z,[d(g(S),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:p(()=>[d(g(K),{class:"w-full max-w-4xl transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all"},{default:p(()=>[e("div",{class:"flex justify-between items-center mb-4"},[t[8]||(t[8]=e("h3",{class:"text-lg font-medium"},"Pilih Item PR untuk Bidding",-1)),e("div",{class:"flex items-center gap-2"},[e("button",{onClick:M,class:"px-3 py-1 text-sm bg-green-100 text-green-700 rounded hover:bg-green-200"},t[6]||(t[6]=[e("i",{class:"fas fa-list"},null,-1),F(" Lihat Daftar Bidding ")])),e("button",{onClick:k,class:"text-gray-400 hover:text-gray-600"},t[7]||(t[7]=[e("i",{class:"fas fa-times"},null,-1)]))])]),b.value?(l(),n("div",ee,t[9]||(t[9]=[e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e("span",null,"Loading PR...")],-1)]))):(l(),n("div",te,[r.value.length===0?(l(),n("div",se," Tidak ada PR yang tersedia untuk bidding. ")):(l(),n("div",ae,[(l(!0),n(w,null,D(r.value,s=>{var I;return l(),n("div",{key:s.id,class:"border rounded-lg p-4"},[e("div",{class:"flex justify-between items-center mb-2 cursor-pointer",onClick:o=>C(s.id)},[e("div",ne,[e("button",{onClick:G(o=>C(s.id),["stop"]),class:"text-gray-500 hover:text-blue-600 focus:outline-none"},[e("i",{class:O(m.value.includes(s.id)?"fas fa-chevron-down":"fas fa-chevron-right")},null,2)],8,oe),e("div",null,[e("div",ie,u(s.pr_number),1),e("div",de,u(L(s.created_at)),1)])]),e("div",ue,"Status: "+u(s.status),1)],8,le),m.value.includes(s.id)&&((I=s.items)!=null&&I.length)?(l(),n("div",re,[e("table",ce,[t[10]||(t[10]=e("thead",null,[e("tr",null,[e("th"),e("th",null,"Item"),e("th",null,"Spesifikasi"),e("th",null,"Qty"),e("th",null,"Unit")])],-1)),e("tbody",null,[(l(!0),n(w,null,D(s.items,o=>(l(),n("tr",{key:o.id},[e("td",null,[q(e("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=N=>c.value=N),value:o.id},null,8,fe),[[z,c.value]])]),e("td",null,u(o.item_name),1),e("td",null,u(o.specifications||"-"),1),e("td",null,u(o.quantity),1),e("td",null,u(o.unit_name||"-"),1)]))),128))])])])):P("",!0)])}),128))]))])),e("div",ve,[e("button",{onClick:k,class:"px-4 py-2 text-gray-700 bg-gray-100 rounded hover:bg-gray-200"},"Batal"),e("button",{onClick:$,disabled:c.value.length===0,class:"px-4 py-2 text-white bg-blue-500 rounded hover:bg-blue-600"}," Lanjut Bidding ",8,me)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]),d(U,{show:_.value,items:f.value,onClose:t[1]||(t[1]=s=>_.value=!1),onPrinted:t[2]||(t[2]=()=>x("bidding-started",c.value.value))},null,8,["show","items"]),v.value?(l(),A(Y,{key:0,"task-id":y.taskId,onClose:t[3]||(t[3]=s=>v.value=!1),onInputBidding:V},null,8,["task-id"])):P("",!0),d(H,{show:h.value,items:f.value,onClose:t[4]||(t[4]=s=>h.value=!1),onSupplierInputDone:j},null,8,["show","items"])],64))}};export{we as default};
