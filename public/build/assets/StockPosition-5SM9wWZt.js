import{c as f,r as _,a as tt,w as B,A as et,B as i,C as st,D as s,L as n,E as b,H as I,J as lt,F as h,M as w,N as o,I as T,G as v,l as F,W as at}from"./vendor-vue-g7iCcTkf.js";import{A as it}from"./AppLayout-C3aoO-bU.js";import{a as nt}from"./vendor-utils-CpgP2uT4.js";import"./app-a4QKyjuP.js";import"./vendor-charts-CuqD4wLC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-CoSAPJ9h.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const ot={class:"max-w-7xl mx-auto py-8 px-4"},ut={class:"flex flex-col md:flex-row md:items-center gap-4 mb-4"},rt={class:"flex items-center gap-2"},dt=["disabled"],pt=["value"],mt={class:"flex items-center gap-2"},ct=["value"],_t={class:"flex items-center gap-2"},yt=["value"],gt=["disabled"],xt={key:0,class:"animate-spin mr-2"},ft={key:1,class:"mr-2"},ht=["disabled"],vt={key:0,class:"animate-spin mr-2"},bt={key:1,class:"mr-2"},kt={key:0,class:"bg-red-50 border-l-4 border-red-400 text-red-800 p-4 rounded my-8 text-center font-semibold"},St={key:1,class:"bg-blue-50 border-l-4 border-blue-400 text-blue-800 p-4 rounded my-8 text-center font-semibold"},wt={key:2,class:"bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 p-4 rounded my-8 text-center font-semibold"},Dt={key:3,class:"bg-white rounded-xl shadow-lg overflow-hidden"},$t={class:"min-w-full divide-y divide-gray-200"},qt={class:"bg-white divide-y divide-gray-200"},Ct={key:0},At=["onClick"],Ot={class:"px-6 py-3 font-semibold text-blue-700",colspan:"8"},Lt={class:"flex items-center gap-2"},Et={class:"text-xs font-normal text-gray-600"},It=["onClick"],Ft={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Tt={class:"flex items-center gap-2"},jt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-700"},Mt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-700"},Nt={class:"px-6 py-4 whitespace-nowrap text-sm text-right"},Wt={key:0},Qt={key:0},Bt={key:1},Kt={class:"px-6 py-4 whitespace-nowrap text-sm text-right"},Vt={key:0},Rt={key:0},Ut={key:1},Pt={class:"px-6 py-4 whitespace-nowrap text-sm text-right"},Ht={key:0},Jt={key:0},Xt={key:1},zt={class:"px-6 py-4 whitespace-nowrap text-sm"},Yt={key:0,class:"bg-gray-50"},Gt={colspan:"8",class:"px-6 py-4"},Zt={key:0,class:"text-center py-4"},te={key:1,class:"overflow-x-auto"},ee={class:"min-w-full divide-y divide-gray-200 text-sm"},se={class:"bg-white divide-y divide-gray-200"},le={key:0,class:"bg-yellow-50 font-semibold"},ae={class:"px-4 py-2 text-gray-700"},ie={class:"px-4 py-2 text-right text-gray-700"},ne={class:"px-4 py-2 text-gray-700"},oe={class:"px-4 py-2 text-right text-gray-700"},ue={class:"px-4 py-2 text-right text-gray-700"},re={class:"px-4 py-2 text-right text-gray-700"},de={class:"px-4 py-2 text-gray-700"},pe={class:"px-4 py-2 text-gray-700"},me={key:2,class:"text-center py-4 text-gray-500 text-sm"},ce={key:0},_e={key:1},ye={key:2},ge={class:"text-xs mt-1"},xe={key:4,class:"flex justify-between items-center mt-4"},fe={class:"text-sm text-gray-600"},Ae={__name:"StockPosition",props:{stocks:Array,outlets:Array,user_outlet_id:[String,Number],warehouse_outlets:Array,error:String},setup(K){const p=K,D=f(()=>Array.isArray(p.stocks)?p.stocks:[]),V=f(()=>Array.isArray(p.outlets)?p.outlets:[]),R=f(()=>Array.isArray(p.warehouse_outlets)?p.warehouse_outlets:[]),C=_(""),j=_(25);_(1);const m=_(""),y=_(""),$=_(!1),q=_(!1),A=f(()=>m.value||y.value);tt(()=>{p.user_outlet_id&&String(p.user_outlet_id)!=="1"&&(m.value=String(p.user_outlet_id))});const M=f(()=>String(p.user_outlet_id)==="1"),U=f(()=>{let t=R.value;return!M.value&&p.user_outlet_id&&(t=t.filter(e=>String(e.outlet_id)===String(p.user_outlet_id))),m.value&&(t=t.filter(e=>String(e.outlet_id)===String(m.value))),t}),N=f(()=>{let t=D.value;if(m.value&&(t=t.filter(l=>String(l.outlet_id)===String(m.value))),y.value&&(t=t.filter(l=>String(l.warehouse_outlet_id)===String(y.value))),!C.value)return t;const e=C.value.toLowerCase();return t.filter(l=>l.item_name&&l.item_name.toLowerCase().includes(e)||l.outlet_name&&l.outlet_name.toLowerCase().includes(e)||l.category_name&&l.category_name.toLowerCase().includes(e))}),k=f(()=>{const t={};return N.value.forEach(e=>{const l=e.category_name||null;t[l]||(t[l]=[]),t[l].push(e)}),t}),x=_([]),S=_([]),d=_({}),O=_({}),L=_({});function r(t){return`${t.item_id}-${t.outlet_id}-${t.warehouse_outlet_id||"null"}`}function P(t){const e=x.value.indexOf(t);e>-1?x.value.splice(e,1):x.value.push(t)}async function H(t){const e=r(t),l=S.value.indexOf(e);l>-1?S.value.splice(l,1):(S.value.push(e),!d.value[e]&&!L.value[e]&&await J(t))}async function J(t){var l,g;const e=r(t);L.value[e]=!0;try{const a={item_id:t.item_id,outlet_id:t.outlet_id};t.warehouse_outlet_id&&(a.warehouse_outlet_id=t.warehouse_outlet_id),console.log("Fetching item detail with params:",a);const u=await nt.get("/outlet-inventory/stock-card/detail",{params:a,withCredentials:!0,headers:{"X-Requested-With":"XMLHttpRequest"}});if(console.log("Response received:",u.data),u.data&&u.data.cards){const E=Array.isArray(u.data.cards)?u.data.cards:[];d.value={...d.value,[e]:E},u.data.saldo_awal&&(O.value={...O.value,[e]:u.data.saldo_awal}),console.log("Item details set for key:",e,"Count:",E.length),console.log("All itemDetails:",d.value)}else console.warn("No cards data in response:",u.data),d.value={...d.value,[e]:[]}}catch(a){console.error("Error fetching item detail:",a),console.error("Error response:",(l=a.response)==null?void 0:l.data),console.error("Error status:",(g=a.response)==null?void 0:g.status),d.value[e]=[]}finally{L.value[e]=!1}}function W(t,e=null){if(e==="in"){const l=[];return t.in_qty_small>0&&l.push(`${c(t.in_qty_small)} ${t.small_unit_name||""}`),t.in_qty_medium>0&&l.push(`${c(t.in_qty_medium)} ${t.medium_unit_name||""}`),t.in_qty_large>0&&l.push(`${c(t.in_qty_large)} ${t.large_unit_name||""}`),l.length>0?l.join(" | "):"-"}else if(e==="out"){const l=[];return t.out_qty_small>0&&l.push(`${c(t.out_qty_small)} ${t.small_unit_name||""}`),t.out_qty_medium>0&&l.push(`${c(t.out_qty_medium)} ${t.medium_unit_name||""}`),t.out_qty_large>0&&l.push(`${c(t.out_qty_large)} ${t.large_unit_name||""}`),l.length>0?l.join(" | "):"-"}else return"-"}function Q(t){if(!t)return"-";if(t.small!==void 0||t.medium!==void 0||t.large!==void 0){const l=[];return t.small!==void 0&&t.small!==null&&l.push(`${c(t.small)} ${t.small_unit_name||""}`),t.medium!==void 0&&t.medium!==null&&l.push(`${c(t.medium)} ${t.medium_unit_name||""}`),t.large!==void 0&&t.large!==null&&l.push(`${c(t.large)} ${t.large_unit_name||""}`),l.length>0?l.join(" | "):"-"}const e=[];return t.saldo_qty_small!==void 0&&t.saldo_qty_small!==null&&e.push(`${c(t.saldo_qty_small)} ${t.small_unit_name||""}`),t.saldo_qty_medium!==void 0&&t.saldo_qty_medium!==null&&e.push(`${c(t.saldo_qty_medium)} ${t.medium_unit_name||""}`),t.saldo_qty_large!==void 0&&t.saldo_qty_large!==null&&e.push(`${c(t.saldo_qty_large)} ${t.large_unit_name||""}`),e.length>0?e.join(" | "):"-"}function c(t){return t==null?"0":Number(t)%1===0?Number(t).toLocaleString("id-ID"):Number(t).toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:2})}function X(){const t=new Date,e=t.getFullYear(),l=t.getMonth();return new Date(e,l,1).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"})}B(()=>p.stocks,()=>{if(D.value.length>0){const t=Object.keys(k.value);x.value=t}},{immediate:!0});function z(){const t=Object.keys(k.value);x.value=t}function Y(){x.value=[]}B(m,()=>{y.value=""});function G(){if(!A.value){alert("Silakan pilih minimal satu filter terlebih dahulu!");return}$.value=!0;const t={outlet_id:m.value||"",warehouse_outlet_id:y.value||""};Object.keys(t).forEach(e=>{t[e]||delete t[e]}),at.get("/outlet-inventory/stock-position",t,{preserveState:!0,preserveScroll:!0,onSuccess:()=>{$.value=!1},onError:e=>{$.value=!1,console.error("Error loading data:",e)}})}function Z(){if(!A.value){alert("Silakan pilih minimal satu filter terlebih dahulu!");return}if(D.value.length===0){alert("Tidak ada data untuk di-export. Silakan load data terlebih dahulu!");return}q.value=!0;const t=new URLSearchParams({outlet_id:m.value||"",warehouse_outlet_id:y.value||""});m.value||t.delete("outlet_id"),y.value||t.delete("warehouse_outlet_id");const e=`/outlet-inventory/stock-position/export?${t.toString()}`,l=document.createElement("a");l.href=e,l.download="",document.body.appendChild(l),l.click(),document.body.removeChild(l),setTimeout(()=>{q.value=!1},2e3)}return(t,e)=>(i(),et(it,null,{default:st(()=>[s("div",ot,[e[28]||(e[28]=s("h1",{class:"text-2xl font-bold mb-6"},"Laporan Stok Akhir Outlet",-1)),s("div",ut,[I(s("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>C.value=l),type:"text",placeholder:"Cari nama barang atau outlet...",class:"px-4 py-2 border border-gray-300 rounded-lg w-full md:w-64 focus:ring-blue-500 focus:border-blue-500"},null,512),[[lt,C.value]]),s("div",rt,[e[5]||(e[5]=s("label",{class:"text-sm"},"Outlet",-1)),I(s("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>m.value=l),class:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500",disabled:!M.value},[e[4]||(e[4]=s("option",{value:""},"Semua Outlet",-1)),(i(!0),n(h,null,w(V.value,l=>(i(),n("option",{key:l.id,value:l.id},o(l.name),9,pt))),128))],8,dt),[[T,m.value]])]),s("div",mt,[e[7]||(e[7]=s("label",{class:"text-sm"},"Warehouse Outlet",-1)),I(s("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>y.value=l),class:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500"},[e[6]||(e[6]=s("option",{value:""},"Semua Warehouse Outlet",-1)),(i(!0),n(h,null,w(U.value,l=>(i(),n("option",{key:l.id,value:l.id},o(l.name),9,ct))),128))],512),[[T,y.value]])]),s("div",_t,[e[8]||(e[8]=s("label",{class:"text-sm"},"Tampilkan",-1)),I(s("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>j.value=l),class:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500"},[(i(),n(h,null,w([10,25,50,100],l=>s("option",{key:l,value:l},o(l),9,yt)),64))],512),[[T,j.value]]),e[9]||(e[9]=s("span",{class:"text-sm"},"data",-1))]),s("button",{onClick:G,disabled:$.value,class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md font-semibold hover:bg-blue-700"},[$.value?(i(),n("span",xt,e[10]||(e[10]=[s("i",{class:"fas fa-spinner"},null,-1)]))):(i(),n("span",ft,e[11]||(e[11]=[s("i",{class:"fas fa-sync-alt"},null,-1)]))),e[12]||(e[12]=v(" Load Data "))],8,gt),s("button",{onClick:Z,disabled:q.value||!A.value||D.value.length===0,class:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-md font-semibold hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed"},[q.value?(i(),n("span",vt,e[13]||(e[13]=[s("i",{class:"fas fa-spinner"},null,-1)]))):(i(),n("span",bt,e[14]||(e[14]=[s("i",{class:"fas fa-file-excel"},null,-1)]))),v(" "+o(q.value?"Exporting...":"Export Excel"),1)],8,ht)]),p.error?(i(),n("div",kt,o(p.error),1)):A.value?D.value.length===0?(i(),n("div",wt,e[16]||(e[16]=[s("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1),v(" Tidak ada data stok untuk filter yang dipilih. Coba ubah filter atau pilih kombinasi filter yang berbeda. ")]))):(i(),n("div",Dt,[s("table",$t,[e[27]||(e[27]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Kategori"),s("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Nama Barang"),s("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Outlet"),s("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Warehouse Outlet"),s("th",{class:"px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider"},"Qty Small"),s("th",{class:"px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider"},"Qty Medium"),s("th",{class:"px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider"},"Qty Large"),s("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Tanggal Update")])],-1)),s("tbody",qt,[Object.keys(k.value).length===0?(i(),n("tr",Ct,e[17]||(e[17]=[s("td",{colspan:"8",class:"text-center py-10 text-gray-400"},"Tidak ada data stok.",-1)]))):(i(!0),n(h,{key:1},w(k.value,(l,g)=>(i(),n(h,{key:g||"no-category"},[s("tr",{class:"bg-blue-50 hover:bg-blue-100 cursor-pointer",onClick:a=>P(g||"no-category")},[s("td",Ot,[s("div",Lt,[s("i",{class:F(x.value.includes(g||"no-category")?"fa-solid fa-chevron-down":"fa-solid fa-chevron-right")},null,2),s("span",null,o(g||"Tanpa Kategori"),1),s("span",Et,"("+o(l.length)+" item)",1)])])],8,At),x.value.includes(g||"no-category")?(i(!0),n(h,{key:0},w(l,a=>(i(),n(h,{key:a.item_id+"-"+a.outlet_id+"-"+a.warehouse_outlet_id},[s("tr",{class:F(["hover:bg-gray-50 transition cursor-pointer",{"bg-blue-50":S.value.includes(r(a))}]),onClick:u=>H(a)},[e[18]||(e[18]=s("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},null,-1)),s("td",Ft,[s("div",Tt,[s("i",{class:F(S.value.includes(r(a))?"fa-solid fa-chevron-down text-blue-600":"fa-solid fa-chevron-right text-gray-400")},null,2),s("span",null,o(a.item_name),1)])]),s("td",jt,o(a.outlet_name),1),s("td",Mt,o(a.warehouse_outlet_name||"-"),1),s("td",Nt,[a.qty_small>0?(i(),n("span",Wt,[v(o(Number(a.qty_small).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2}))+" ",1),a.small_unit_name?(i(),n("span",Qt,o(a.small_unit_name),1)):b("",!0)])):(i(),n("span",Bt,"-"))]),s("td",Kt,[a.qty_medium>0?(i(),n("span",Vt,[v(o(Number(a.qty_medium).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2}))+" ",1),a.medium_unit_name?(i(),n("span",Rt,o(a.medium_unit_name),1)):b("",!0)])):(i(),n("span",Ut,"-"))]),s("td",Pt,[a.qty_large>0?(i(),n("span",Ht,[v(o(Number(a.qty_large).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2}))+" ",1),a.large_unit_name?(i(),n("span",Jt,o(a.large_unit_name),1)):b("",!0)])):(i(),n("span",Xt,"-"))]),s("td",zt,o(a.updated_at?new Date(a.updated_at).toLocaleString():"-"),1)],10,It),S.value.includes(r(a))?(i(),n("tr",Yt,[s("td",Gt,[L.value[r(a)]?(i(),n("div",Zt,e[19]||(e[19]=[s("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},null,-1),s("p",{class:"mt-2 text-gray-600 text-sm"},"Memuat detail transaksi...",-1)]))):d.value[r(a)]&&Array.isArray(d.value[r(a)])&&d.value[r(a)].length>0?(i(),n("div",te,[s("table",ee,[e[24]||(e[24]=s("thead",{class:"bg-gray-100"},[s("tr",null,[s("th",{class:"px-4 py-2 text-left text-xs font-bold text-gray-700 uppercase"},"Tanggal"),s("th",{class:"px-4 py-2 text-right text-xs font-bold text-gray-700 uppercase"},"Masuk (Qty)"),s("th",{class:"px-4 py-2 text-right text-xs font-bold text-gray-700 uppercase"},"Keluar (Qty)"),s("th",{class:"px-4 py-2 text-right text-xs font-bold text-gray-700 uppercase"},"Saldo (Qty)"),s("th",{class:"px-4 py-2 text-left text-xs font-bold text-gray-700 uppercase"},"Referensi"),s("th",{class:"px-4 py-2 text-left text-xs font-bold text-gray-700 uppercase"},"Keterangan")])],-1)),s("tbody",se,[O.value[r(a)]?(i(),n("tr",le,[s("td",ae,o(X()),1),e[20]||(e[20]=s("td",{class:"px-4 py-2 text-right text-gray-700"},"-",-1)),e[21]||(e[21]=s("td",{class:"px-4 py-2 text-right text-gray-700"},"-",-1)),s("td",ie,o(Q(O.value[r(a)])),1),e[22]||(e[22]=s("td",{class:"px-4 py-2 text-gray-700"},"Saldo Awal Bulan",-1)),e[23]||(e[23]=s("td",{class:"px-4 py-2 text-gray-700"},"Saldo akhir bulan sebelumnya",-1))])):b("",!0),(i(!0),n(h,null,w(d.value[r(a)],(u,E)=>(i(),n("tr",{key:u.id,class:F(E===d.value[r(a)].length-1?"bg-yellow-200 font-bold":"hover:bg-gray-50")},[s("td",ne,o(u.date?new Date(u.date).toLocaleDateString("id-ID"):"-"),1),s("td",oe,o(W(u,"in")),1),s("td",ue,o(W(u,"out")),1),s("td",re,o(Q(u)),1),s("td",de,o(u.reference_type?u.reference_type+(u.reference_id?" #"+u.reference_id:""):"-"),1),s("td",pe,o(u.description||"-"),1)],2))),128))])])])):(i(),n("div",me,[d.value[r(a)]===void 0?(i(),n("div",ce,e[25]||(e[25]=[s("p",null,"Memuat data...",-1)]))):d.value[r(a)]&&d.value[r(a)].length===0?(i(),n("div",_e," Tidak ada data transaksi untuk item ini. ")):(i(),n("div",ye,[e[26]||(e[26]=s("p",null,"Data tidak tersedia.",-1)),s("p",ge,"Debug: "+o(JSON.stringify(d.value[r(a)])),1)]))]))])])):b("",!0)],64))),128)):b("",!0)],64))),128))])])])):(i(),n("div",St,e[15]||(e[15]=[s("i",{class:"fas fa-info-circle mr-2"},null,-1),v(' Silakan pilih minimal satu filter (Outlet atau Warehouse Outlet), kemudian klik tombol "Load Data" untuk melihat laporan stok akhir. ')]))),Object.keys(k.value).length>0?(i(),n("div",xe,[s("div",fe,[v(" Total "+o(Object.keys(k.value).length)+" kategori, "+o(N.value.length)+" item ",1),s("button",{onClick:z,class:"ml-4 text-blue-600 hover:text-blue-800 text-sm"},"Expand All"),s("button",{onClick:Y,class:"ml-2 text-blue-600 hover:text-blue-800 text-sm"},"Collapse All")])])):b("",!0)])]),_:1}))}};export{Ae as default};
