import{c as _,r as b,w as T,L as i,B as u,D as e,E as c,N as a,G as r,F as v,M as k,O as U,H as f,I as D,J as h}from"./vendor-vue-g7iCcTkf.js";import{a as O}from"./vendor-utils-CpgP2uT4.js";const $={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},A={class:"bg-white rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl border border-blue-100 relative"},E={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80"},R=["src"],q={class:"flex justify-between items-center mb-4"},z={key:1,class:"mb-4 p-4 bg-red-100 text-red-700 rounded"},G={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},H={class:"bg-blue-50 rounded-lg p-4 border border-blue-100 shadow-sm"},J={class:"bg-blue-50 rounded-lg p-4 border border-blue-100 shadow-sm"},W={class:"mb-6 bg-blue-50 rounded-lg p-4 border border-blue-100 shadow-sm"},K={key:2,class:"mb-6"},Q={class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},X={class:"text-sm"},Y={class:"font-semibold"},Z={class:"mt-2 text-blue-900 font-semibold"},ee={class:"text-red-600"},te={key:3,class:"mb-6"},le={class:"grid grid-cols-2 md:grid-cols-3 gap-4"},oe=["src","onClick"],se={class:"text-xs mt-2 text-blue-700 font-semibold"},ne=["href"],ae={class:"text-xs font-semibold"},ie={class:"text-xs text-gray-400 mt-1"},ue={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},re=["value"],de={class:"mb-4"},me=["max"],pe={class:"mb-4"},be={class:"mb-4"},fe={class:"mb-4"},ye={class:"flex justify-end gap-2 mt-2"},ce=["disabled"],ve=["disabled"],ge={key:0},xe={key:1},he={__name:"PaymentModal",props:{po:Object},emits:["close","payment-success"],setup(n,{emit:I}){const d=n,C=I,N=_(()=>{var o;return((o=d.po.payments)==null?void 0:o.reduce((t,l)=>t+Number(l.payment_amount),0))||0}),y=_(()=>d.po.total_amount-N.value),s=b({payment_date:new Date().toISOString().split("T")[0],payment_amount:d.po.payment_status==="partial_paid"?y.value:d.po.total_amount,payment_type:"full",payment_method:"transfer",payment_reference:"",payment_proof:null,notes:""});T(()=>d.po.payment_status,o=>{o==="partial_paid"?s.value.payment_amount=y.value:s.value.payment_amount=d.po.total_amount});const m=b(!1),p=b(null),g=b(!1),x=b(""),S=[{value:"transfer",label:"Bank Transfer"},{value:"cash",label:"Cash"},{value:"cheque",label:"Cheque"}],j=_(()=>d.po.payment_status==="partial_paid"?y.value:d.po.total_amount);function B(o){x.value=o,g.value=!0}function L(){g.value=!1,x.value=""}async function M(){var o,t;if(!s.value.payment_proof){p.value="Please upload payment proof";return}m.value=!0,p.value=null;try{const l=new FormData;l.append("po_id",d.po.id),l.append("payment_date",s.value.payment_date),l.append("payment_amount",s.value.payment_amount),l.append("payment_type",s.value.payment_type),l.append("payment_method",s.value.payment_method),l.append("payment_reference",s.value.payment_reference),l.append("payment_proof",s.value.payment_proof),l.append("notes",s.value.notes),await O.post("/mt-po-payment/store",l,{headers:{"Content-Type":"multipart/form-data"}}),window.Swal&&await window.Swal.fire({icon:"success",title:"Pembayaran berhasil!",text:"Data pembayaran PO berhasil disimpan.",timer:1800,showConfirmButton:!1}),C("payment-success")}catch(l){p.value=((t=(o=l.response)==null?void 0:o.data)==null?void 0:t.message)||"Error processing payment"}finally{m.value=!1}}function V(o){s.value.payment_proof=o.target.files[0]}function F(o){return/\.(jpg|jpeg|png|gif|webp)$/i.test(o)}function w(o){return o?o.startsWith("storage/")?"/"+o:"/storage/"+o.replace(/^\/?/,""):""}function P(o){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(o)}return(o,t)=>(u(),i("div",$,[e("div",A,[g.value?(u(),i("div",E,[e("div",{class:"absolute top-4 right-8"},[e("button",{onClick:L,class:"text-white text-3xl font-bold"},"×")]),e("img",{src:x.value,class:"max-h-[80vh] max-w-[90vw] rounded shadow-lg border-4 border-white"},null,8,R)])):c("",!0),e("div",q,[t[7]||(t[7]=e("h2",{class:"text-xl font-bold text-blue-800"},"Make Payment",-1)),e("button",{onClick:t[0]||(t[0]=l=>o.$emit("close")),class:"text-gray-400 hover:text-blue-600 text-2xl"},"×")]),p.value?(u(),i("div",z,a(p.value),1)):c("",!0),e("div",G,[e("div",H,[t[11]||(t[11]=e("h3",{class:"font-semibold mb-2 text-blue-700"},"PO Information",-1)),e("p",null,[t[8]||(t[8]=e("span",{class:"font-bold"},"PO Number:",-1)),r(" "+a(n.po.po_number),1)]),e("p",null,[t[9]||(t[9]=e("span",{class:"font-bold"},"Date:",-1)),r(" "+a(new Date(n.po.created_at).toLocaleDateString("id-ID")),1)]),e("p",null,[t[10]||(t[10]=e("span",{class:"font-bold"},"Total Amount:",-1)),r(" "+a(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(n.po.total_amount)),1)])]),e("div",J,[t[16]||(t[16]=e("h3",{class:"font-semibold mb-2 text-blue-700"},"Supplier Information",-1)),e("p",null,[t[12]||(t[12]=e("span",{class:"font-bold"},"Name:",-1)),r(" "+a(n.po.supplier.name),1)]),e("p",null,[t[13]||(t[13]=e("span",{class:"font-bold"},"Contact:",-1)),r(" "+a(n.po.supplier.contact_person),1)]),e("p",null,[t[14]||(t[14]=e("span",{class:"font-bold"},"Phone:",-1)),r(" "+a(n.po.supplier.phone),1)]),e("p",null,[t[15]||(t[15]=e("span",{class:"font-bold"},"Email:",-1)),r(" "+a(n.po.supplier.email),1)])])]),e("div",W,[t[20]||(t[20]=e("h3",{class:"font-semibold mb-2 text-blue-700"},"Bank Details",-1)),e("p",null,[t[17]||(t[17]=e("span",{class:"font-bold"},"Bank:",-1)),r(" "+a(n.po.supplier.bank_name),1)]),e("p",null,[t[18]||(t[18]=e("span",{class:"font-bold"},"Account Number:",-1)),r(" "+a(n.po.supplier.bank_account_number),1)]),e("p",null,[t[19]||(t[19]=e("span",{class:"font-bold"},"Account Name:",-1)),r(" "+a(n.po.supplier.bank_account_name),1)])]),n.po.payment_status==="partial_paid"&&n.po.payments&&n.po.payments.length?(u(),i("div",K,[e("div",Q,[t[23]||(t[23]=e("h3",{class:"font-semibold mb-2 text-yellow-700"},"Previous Payments",-1)),e("ul",X,[(u(!0),i(v,null,k(n.po.payments,l=>(u(),i("li",{key:l.id,class:"mb-1"},[e("span",Y,a(P(l.payment_amount)),1),t[21]||(t[21]=r("  on  ")),e("span",null,a(new Date(l.payment_date).toLocaleDateString("id-ID")),1)]))),128))]),e("div",Z,[t[22]||(t[22]=r(" Remaining to pay: ")),e("span",ee,a(P(y.value)),1)])])])):c("",!0),n.po.invoices&&n.po.invoices.length>0?(u(),i("div",te,[t[25]||(t[25]=e("h3",{class:"font-semibold mb-2 text-blue-700"},"Invoice",-1)),e("div",le,[(u(!0),i(v,null,k(n.po.invoices,l=>(u(),i("div",{key:l.id,class:"rounded-lg border border-blue-100 bg-white shadow-sm p-2 flex flex-col items-center"},[F(l.invoice_file_path)?(u(),i(v,{key:0},[e("img",{src:w(l.invoice_file_path),class:"w-full h-32 object-cover rounded cursor-pointer hover:scale-105 transition",onClick:we=>B(w(l.invoice_file_path)),alt:"Invoice"},null,8,oe),e("div",se,a(l.invoice_number),1)],64)):(u(),i("a",{key:1,href:w(l.invoice_file_path),target:"_blank",class:"flex flex-col items-center text-blue-700 hover:underline"},[t[24]||(t[24]=e("i",{class:"fas fa-file-alt text-3xl mb-2"},null,-1)),e("span",ae,a(l.invoice_number),1)],8,ne)),e("div",ie,a(l.invoice_date?new Date(l.invoice_date).toLocaleDateString("id-ID"):""),1)]))),128))])])):c("",!0),e("form",{onSubmit:U(M,["prevent"]),class:"mt-4"},[e("div",ue,[e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700"},"Payment Type",-1)),f(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>s.value.payment_type=l),class:"mt-1 block w-full rounded-md border-blue-200 shadow-sm focus:border-blue-500 focus:ring-blue-500"},t[26]||(t[26]=[e("option",{value:"full"},"Full Payment",-1),e("option",{value:"partial"},"Partial Payment",-1)]),512),[[D,s.value.payment_type]])]),e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-gray-700"},"Payment Method",-1)),f(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>s.value.payment_method=l),class:"mt-1 block w-full rounded-md border-blue-200 shadow-sm focus:border-blue-500 focus:ring-blue-500"},[(u(),i(v,null,k(S,l=>e("option",{key:l.value,value:l.value},a(l.label),9,re)),64))],512),[[D,s.value.payment_method]])])]),e("div",de,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700"},"Payment Amount",-1)),f(e("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=l=>s.value.payment_amount=l),max:j.value,class:"mt-1 block w-full rounded-md border-blue-200 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,8,me),[[h,s.value.payment_amount]])]),e("div",pe,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium text-gray-700"},"Payment Reference",-1)),f(e("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=l=>s.value.payment_reference=l),class:"mt-1 block w-full rounded-md border-blue-200 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[h,s.value.payment_reference]])]),e("div",be,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium text-gray-700"},"Payment Proof",-1)),e("input",{type:"file",onChange:V,class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32)]),e("div",fe,[t[32]||(t[32]=e("label",{class:"block text-sm font-medium text-gray-700"},"Notes",-1)),f(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=l=>s.value.notes=l),class:"mt-1 block w-full rounded-md border-blue-200 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[h,s.value.notes]])]),e("div",ye,[e("button",{type:"button",onClick:t[6]||(t[6]=l=>o.$emit("close")),disabled:m.value,class:"px-4 py-2 rounded font-semibold bg-gray-200 hover:bg-gray-300 text-gray-700 transition disabled:opacity-60"}," Cancel ",8,ce),e("button",{type:"submit",disabled:m.value,class:"px-4 py-2 rounded font-semibold bg-blue-600 hover:bg-blue-700 text-white transition disabled:opacity-60"},[m.value?(u(),i("span",ge,"Processing...")):(u(),i("span",xe,"Submit Payment"))],8,ve)])],32)])]))}};export{he as default};
