import{$ as H,r as _,c as Q,w as Y,A as q,B as l,C as P,D as e,G as d,O as j,H as m,J as v,L as u,F as f,M as c,N as r,I as k,x as Z,Q as X,E as b,Z as I,T as ee,Y as te,l as se,W as F}from"./vendor-vue-g7iCcTkf.js";import{A as ne}from"./AppLayout-Dr73aeKz.js";import{a as C}from"./vendor-utils-CpgP2uT4.js";import{S}from"./app-CZyV0iGJ.js";import{s as ae}from"./vue-multiselect.esm-V-bx43V9.js";/* empty css                            */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-DbuU0LgT.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const oe={class:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-white py-12 px-4 md:px-8"},ie={class:"w-full max-w-4xl bg-white rounded-3xl shadow-3xl p-10 border border-blue-100 transition-all duration-300 hover:shadow-4xl"},le={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ue=["value"],re=["value"],de={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},pe={class:"flex justify-between items-center"},me={class:"text-xs text-gray-500"},fe={class:"overflow-x-auto"},ce={class:"min-w-full divide-y divide-gray-200"},ge={class:"bg-white divide-y divide-gray-200"},he={class:"px-3 py-2 min-w-[200px]"},ve={class:"relative"},be=["id","onUpdate:modelValue","onInput","onFocus","onBlur","onKeydown"],xe=["id"],ye=["id","onMousedown"],we={class:"font-medium"},_e={class:"text-xs text-gray-500"},ke={class:"text-sm text-gray-600"},Ie={key:0,class:"absolute right-2 top-2"},Ce={class:"px-3 py-2 min-w-[100px]"},De=["onUpdate:modelValue","onInput"],Be={class:"px-3 py-2 min-w-[100px]"},Ue={class:"relative"},Se=["onUpdate:modelValue"],$e=["value"],Ve={key:0,class:"absolute -top-1 -right-1 bg-blue-500 text-white text-xs px-1 rounded-full"},Ae={class:"px-3 py-2 min-w-[150px]"},Te={class:"relative"},qe=["onUpdate:modelValue","onInput"],Pe={key:0,class:"absolute -top-1 -right-1 bg-green-500 text-white text-xs px-1 rounded-full"},je={class:"px-3 py-2 min-w-[150px] text-right"},Fe={class:"px-3 py-2"},Me=["onClick","disabled"],Ee={class:"px-3 py-2 text-right font-bold"},Oe={key:0,class:"flex flex-wrap gap-2 mt-2"},Re=["src"],Le={class:"flex justify-end gap-2"},We=["disabled"],Ne={key:0},Ke={key:1},at={__name:"Form",props:{warehouses:Array,warehouseDivisions:Array,suppliers:Array},setup(M){const x=M;H();function $(){return{item_id:"",item_name:"",qty:"",unit_id:"",price:0,subtotal:0,unitOptions:[],suggestions:[],showDropdown:!1,highlightedIndex:-1,loading:!1}}const n=_({transaction_date:new Date().toISOString().split("T")[0],warehouse_id:"",warehouse_division_id:"",notes:"",payment_method:"",supplier:null,items:[$()]}),g=_(!1);function E(){n.value.items.push($())}function O(a){n.value.items.length!==1&&n.value.items.splice(a,1)}function y(a){const t=n.value.items[a];t.subtotal=(t.qty||0)*(t.price||0)}const R=Q(()=>n.value.items.reduce((a,t)=>a+(t.subtotal||0),0));async function L(a,t){if(!t||t.length<2){n.value.items[a].suggestions=[],n.value.items[a].highlightedIndex=-1;return}n.value.items[a].loading=!0;try{const s=await C.get("/items/search-for-outlet-transfer",{params:{q:t,warehouse_id:n.value.warehouse_id}});n.value.items[a].suggestions=s.data,n.value.items[a].showDropdown=!0,n.value.items[a].highlightedIndex=0}finally{n.value.items[a].loading=!1}}function V(a,t){const s=t.target.value;n.value.items[a].item_id="",n.value.items[a].item_name=s,n.value.items[a].showDropdown=!0,L(a,s)}async function A(a,t){n.value.items[a].item_id=t.id,n.value.items[a].item_name=t.name,n.value.items[a].suggestions=[],n.value.items[a].showDropdown=!1,n.value.items[a].highlightedIndex=-1;const s=await C.get(`/retail-warehouse-food/get-item-units/${t.id}`,{params:{payment_method:n.value.payment_method}});n.value.items[a].unitOptions=s.data.units,n.value.payment_method==="contra_bon"&&s.data.default_unit?(n.value.items[a].unit_id=s.data.default_unit.id,s.data.default_price>0&&(n.value.items[a].price=s.data.default_price),y(a)):n.value.items[a].unit_id=""}function W(a){setTimeout(()=>{n.value.items[a].showDropdown=!1},200)}function w(a,t){const s=n.value.items[a];!s.showDropdown||!s.suggestions.length||(t.key==="ArrowDown"?(t.preventDefault(),s.highlightedIndex=(s.highlightedIndex+1)%s.suggestions.length):t.key==="ArrowUp"?(t.preventDefault(),s.highlightedIndex=(s.highlightedIndex-1+s.suggestions.length)%s.suggestions.length):t.key==="Enter"?(t.preventDefault(),s.highlightedIndex>=0&&s.suggestions[s.highlightedIndex]&&A(a,s.suggestions[s.highlightedIndex])):t.key==="Escape"&&(s.showDropdown=!1))}function N(a){const t=document.getElementById(`item-input-${a}`);if(!t)return{};const s=t.getBoundingClientRect();return{position:"fixed",left:`${s.left}px`,top:`${s.bottom}px`,width:`${s.width}px`,zIndex:99999}}Y(()=>n.value.payment_method,a=>{if(a==="cash"){const t=x.suppliers.find(s=>s.name.toLowerCase().includes("cash supplier"));t&&(n.value.supplier=t)}else if(a==="contra_bon")for(let t=0;t<n.value.items.length;t++){const s=n.value.items[t];s.item_id&&s.item_id!==""&&C.get(`/retail-warehouse-food/get-item-units/${s.item_id}`,{params:{payment_method:"contra_bon"}}).then(i=>{i.data.default_unit&&(n.value.items[t].unit_id=i.data.default_unit.id,i.data.default_price>0&&(n.value.items[t].price=i.data.default_price),y(t))}).catch(i=>{console.error("Error updating item for contra bon:",i)})}});const D=_([]),B=_([]);function K(a){D.value=Array.from(a.target.files),B.value=D.value.map(t=>URL.createObjectURL(t))}async function G(){var t,s;if(!(g.value||!(await S.fire({title:"Simpan Data?",text:"Apakah Anda yakin ingin menyimpan transaksi ini?",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Simpan",cancelButtonText:"Batal",confirmButtonColor:"#2563eb",cancelButtonColor:"#6b7280",reverseButtons:!0})).isConfirmed)){g.value=!0;try{const i=new FormData;i.append("warehouse_id",n.value.warehouse_id),i.append("warehouse_division_id",n.value.warehouse_division_id||""),i.append("transaction_date",n.value.transaction_date),i.append("notes",n.value.notes),i.append("payment_method",n.value.payment_method),i.append("supplier_id",n.value.supplier?n.value.supplier.id:""),n.value.items.forEach((o,p)=>{var U;i.append(`items[${p}][item_name]`,o.item_name),i.append(`items[${p}][qty]`,o.qty),i.append(`items[${p}][unit_id]`,o.unit_id),i.append(`items[${p}][unit]`,((U=o.unitOptions.find(J=>J.id===o.unit_id))==null?void 0:U.name)||""),i.append(`items[${p}][price]`,o.price)}),D.value.forEach((o,p)=>{i.append("invoices[]",o)});const h=await C.post("/retail-warehouse-food",i,{headers:{"Content-Type":"multipart/form-data"}});h.data.message&&(await S.fire({icon:"success",title:"Berhasil",text:h.data.message,timer:1500,showConfirmButton:!1}),F.visit("/retail-warehouse-food"))}catch(i){S.fire({icon:"error",title:"Gagal",text:((s=(t=i.response)==null?void 0:t.data)==null?void 0:s.message)||"Gagal menyimpan transaksi"})}finally{g.value=!1}}}function z(){F.visit("/retail-warehouse-food")}function T(a){return a?"Rp "+Number(a).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2}):"Rp 0"}return(a,t)=>(l(),q(ne,null,{default:P(()=>[e("div",oe,[e("div",ie,[t[26]||(t[26]=e("h1",{class:"text-3xl font-extrabold mb-6 flex items-center gap-3 text-blue-800 drop-shadow-lg"},[e("i",{class:"fa-solid fa-warehouse text-blue-500 text-3xl"}),d(" Input Warehouse Retail Food ")],-1)),t[27]||(t[27]=e("div",{class:"mb-8 p-4 bg-blue-50 border border-blue-200 rounded-xl"},[e("h3",{class:"text-lg font-semibold text-blue-800 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-info-circle text-blue-600"}),d(" Cara Penggunaan Warehouse Retail Food ")]),e("div",{class:"text-sm text-blue-700 space-y-2"},[e("div",{class:"flex items-start gap-2"},[e("span",{class:"bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5"},"1"),e("span",null,[e("strong",null,"Isi Data Transaksi:"),d(" Pilih tanggal, warehouse, warehouse division (opsional), metode pembayaran (Cash/Contra Bon), dan supplier. "),e("strong",null,'Jika metode pembayaran Cash, pilih supplier "CASH SUPPLIER".')])]),e("div",{class:"flex items-start gap-2"},[e("span",{class:"bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5"},"2"),e("span",null,[e("strong",null,"Tambah Items:"),d(" Cari item dengan mengetik nama item, pilih unit dan isi quantity serta harga. "),e("strong",null,"Jika metode pembayaran Contra Bon, unit medium dan harga akan otomatis terisi."),d(' Klik "+ Tambah Item" untuk menambah item baru.')])]),e("div",{class:"flex items-start gap-2"},[e("span",{class:"bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5"},"3"),e("span",null,[e("strong",null,"Upload Bukti:"),d(" Upload foto bon/invoice dalam format JPG/PNG (bisa lebih dari 1 file).")])]),e("div",{class:"flex items-start gap-2"},[e("span",{class:"bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5"},"4"),e("span",null,[e("strong",null,"Simpan:"),d(' Klik tombol "Simpan" untuk menyimpan transaksi. Data akan otomatis masuk ke inventory warehouse.')])])])],-1)),e("form",{onSubmit:j(G,["prevent"]),class:"space-y-7"},[e("div",le,[e("div",null,[t[6]||(t[6]=e("label",{class:"block text-xs font-bold text-gray-600 mb-2"},"Tanggal",-1)),m(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=s=>n.value.transaction_date=s),class:"input input-bordered w-full shadow-inner rounded-xl focus:ring-2 focus:ring-blue-300 transition-all duration-200",required:""},null,512),[[v,n.value.transaction_date]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-xs font-bold text-gray-600 mb-2"},"Warehouse",-1)),m(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>n.value.warehouse_id=s),class:"input input-bordered w-full shadow-inner rounded-xl focus:ring-2 focus:ring-blue-300 transition-all duration-200",required:""},[t[7]||(t[7]=e("option",{value:""},"Pilih Warehouse",-1)),(l(!0),u(f,null,c(x.warehouses,s=>(l(),u("option",{key:s.id,value:s.id},r(s.name),9,ue))),128))],512),[[k,n.value.warehouse_id]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-xs font-bold text-gray-600 mb-2"},"Warehouse Division (Opsional)",-1)),m(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>n.value.warehouse_division_id=s),class:"input input-bordered w-full shadow-inner rounded-xl focus:ring-2 focus:ring-blue-300 transition-all duration-200"},[t[9]||(t[9]=e("option",{value:""},"Pilih Warehouse Division",-1)),(l(!0),u(f,null,c(x.warehouseDivisions,s=>(l(),u("option",{key:s.id,value:s.id},r(s.name),9,re))),128))],512),[[k,n.value.warehouse_division_id]])])]),e("div",de,[e("div",null,[t[12]||(t[12]=e("label",{class:"block text-xs font-bold text-gray-600 mb-2"},"Metode Pembayaran",-1)),m(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>n.value.payment_method=s),class:"input input-bordered w-full shadow-inner rounded-xl focus:ring-2 focus:ring-blue-300 transition-all duration-200",required:""},t[11]||(t[11]=[e("option",{value:""},"Pilih Metode Pembayaran",-1),e("option",{value:"cash"},"Cash",-1),e("option",{value:"contra_bon"},"Contra Bon",-1)]),512),[[k,n.value.payment_method]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-xs font-bold text-gray-600 mb-2"},"Supplier",-1)),Z(X(ae),{modelValue:n.value.supplier,"onUpdate:modelValue":t[4]||(t[4]=s=>n.value.supplier=s),options:x.suppliers,searchable:!0,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Pilih atau cari supplier...","track-by":"id",label:"name","preselect-first":!1,class:"w-full"},{option:P(({option:s})=>[e("div",pe,[e("span",null,r(s.name),1),e("span",me,r(s.code),1)])]),_:1},8,["modelValue","options"])])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Items",-1)),e("div",fe,[e("table",ce,[t[19]||(t[19]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Item"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Qty"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Unit"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Harga"),e("th",{class:"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase"},"Subtotal"),e("th",{class:"px-3 py-2"})])],-1)),e("tbody",ge,[(l(!0),u(f,null,c(n.value.items,(s,i)=>{var h;return l(),u("tr",{key:i},[e("td",he,[e("div",ve,[m(e("input",{id:`item-input-${i}`,type:"text","onUpdate:modelValue":o=>s.item_name=o,onInput:o=>V(i,o),onFocus:o=>V(i,o),onBlur:o=>W(i),onKeydown:[I(o=>w(i,o),["down"]),I(o=>w(i,o),["up"]),I(o=>w(i,o),["enter"]),I(o=>w(i,o),["esc"])],class:"input input-bordered w-full",required:"",autocomplete:"off",placeholder:"Cari nama item..."},null,40,be),[[v,s.item_name]]),(l(),q(ee,{to:"body"},[s.showDropdown&&s.suggestions&&s.suggestions.length>0?(l(),u("div",{key:0,style:te(N(i)),id:`autocomplete-dropdown-${i}`,class:"fixed z-[99999] bg-white border border-blue-200 rounded shadow max-w-xs w-[260px] max-h-96 overflow-auto mt-1"},[(l(!0),u(f,null,c(s.suggestions,(o,p)=>(l(),u("div",{key:o.id,id:`autocomplete-item-${i}-${p}`,onMousedown:j(U=>A(i,o),["prevent"]),class:se(["px-3 py-2 flex justify-between items-center cursor-pointer",s.highlightedIndex===p?"bg-blue-100":"hover:bg-blue-50"])},[e("div",null,[e("div",we,r(o.name),1),e("div",_e,r(o.sku),1)]),e("div",ke,r(o.unit_small||o.unit||""),1)],42,ye))),128))],12,xe)):b("",!0)])),s.loading?(l(),u("div",Ie,t[14]||(t[14]=[e("i",{class:"fa fa-spinner fa-spin text-blue-400"},null,-1)]))):b("",!0)])]),e("td",Ce,[m(e("input",{type:"number",min:"0.01",step:"0.01","onUpdate:modelValue":o=>s.qty=o,onInput:o=>y(i),class:"input input-bordered w-full",required:""},null,40,De),[[v,s.qty,void 0,{number:!0}]])]),e("td",Be,[e("div",Ue,[m(e("select",{"onUpdate:modelValue":o=>s.unit_id=o,class:"input input-bordered w-full",required:""},[t[15]||(t[15]=e("option",{value:""},"Pilih Unit",-1)),(l(!0),u(f,null,c(s.unitOptions,o=>(l(),u("option",{key:o.id,value:o.id},r(o.name)+r(o.is_medium?" (Medium)":""),9,$e))),128))],8,Se),[[k,s.unit_id]]),n.value.payment_method==="contra_bon"&&((h=s.unitOptions.find(o=>o.id===s.unit_id))!=null&&h.is_medium)?(l(),u("div",Ve," Auto ")):b("",!0)])]),e("td",Ae,[e("div",Te,[m(e("input",{type:"number",min:"0",step:"0.01","onUpdate:modelValue":o=>s.price=o,onInput:o=>y(i),class:"input input-bordered w-full",required:""},null,40,qe),[[v,s.price,void 0,{number:!0}]]),n.value.payment_method==="contra_bon"&&s.price>0?(l(),u("div",Pe," Auto ")):b("",!0)])]),e("td",je,r(T(s.subtotal)),1),e("td",Fe,[e("button",{type:"button",onClick:o=>O(i),class:"text-red-500 hover:text-red-700",disabled:n.value.items.length===1},t[16]||(t[16]=[e("i",{class:"fa-solid fa-trash"},null,-1)]),8,Me)])])}),128))]),e("tfoot",null,[e("tr",null,[t[17]||(t[17]=e("td",{colspan:"4",class:"px-3 py-2 text-right font-bold"},"Total:",-1)),e("td",Ee,r(T(R.value)),1),t[18]||(t[18]=e("td",null,null,-1))])])])]),e("div",{class:"mt-2"},[e("button",{type:"button",onClick:E,class:"text-blue-500 hover:text-blue-700"},t[20]||(t[20]=[e("i",{class:"fa fa-plus mr-1"},null,-1),d(" Tambah Item ")]))])]),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Catatan",-1)),m(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=s=>n.value.notes=s),class:"input input-bordered w-full",rows:"3"},null,512),[[v,n.value.notes]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Upload Bon/Invoice (jpg/png, bisa lebih dari 1)",-1)),e("input",{type:"file",multiple:"",accept:"image/jpeg,image/png",onChange:K},null,32),B.value.length?(l(),u("div",Oe,[(l(!0),u(f,null,c(B.value,(s,i)=>(l(),u("div",{key:i,class:"w-24 h-24 border rounded overflow-hidden flex items-center justify-center bg-gray-50"},[e("img",{src:s,class:"object-contain w-full h-full"},null,8,Re)]))),128))])):b("",!0)]),e("div",Le,[e("button",{type:"button",onClick:z,class:"btn px-6 py-2 rounded-lg font-bold bg-gradient-to-r from-gray-200 to-gray-400 text-gray-700 shadow-md hover:from-gray-300 hover:to-gray-500 active:scale-95 transition-all"}," Batal "),e("button",{type:"submit",class:"btn px-6 py-2 rounded-lg font-bold bg-gradient-to-r from-blue-500 to-blue-700 text-white shadow-lg hover:from-blue-600 hover:to-blue-800 active:scale-95 transition-all flex items-center gap-2",disabled:g.value},[g.value?(l(),u("span",Ne,t[24]||(t[24]=[e("i",{class:"fa fa-spinner fa-spin"},null,-1),d(" Menyimpan...")]))):(l(),u("span",Ke,t[25]||(t[25]=[e("i",{class:"fa fa-save"},null,-1),d(" Simpan")])))],8,We)])],32)])])]),_:1}))}};export{at as default};
