import{r as k,a as F,w as R,L as u,B as c,D as t,E as b,H as C,J as w,G as x,N as r,F as P,M as B,W as S,Y as j}from"./vendor-vue-g7iCcTkf.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-utils-CpgP2uT4.js";const A={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},L={class:"mb-4"},E={class:"mt-4 p-4 bg-gray-50 rounded-lg"},I={class:"flex flex-col sm:flex-row gap-4 items-end"},M={class:"flex-1"},N={class:"flex-1"},V={key:0,class:"mt-2 text-sm text-gray-600"},W={class:"mb-6"},G={key:1,class:"flex items-center justify-center h-96 text-gray-500"},U={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},O={class:"flex items-center justify-between mb-2"},H={class:"flex items-center gap-2"},J={class:"text-sm font-semibold text-gray-900"},K={class:"space-y-1 text-xs"},Y={class:"flex justify-between"},q={class:"font-medium"},Q={class:"flex justify-between"},X={class:"font-medium"},Z={class:"flex justify-between"},$={class:"font-medium"},tt={class:"flex justify-between"},et={class:"font-medium"},at={key:1,class:"mt-6 pt-4 border-t border-gray-200"},st={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center"},ot={class:"bg-blue-50 rounded-lg p-3"},lt={class:"text-lg font-bold text-blue-800"},nt={class:"bg-green-50 rounded-lg p-3"},rt={class:"text-lg font-bold text-green-800"},dt={class:"bg-orange-50 rounded-lg p-3"},it={class:"text-lg font-bold text-orange-800"},ut={class:"bg-purple-50 rounded-lg p-3"},ct={class:"text-lg font-bold text-purple-800"},gt={__name:"CrmPurchasingPowerChart",props:{data:Array,filters:Object},setup(s){var _,h;const o=s,f=k(null);let g=null;const i=k({start_date:((_=o.filters)==null?void 0:_.start_date)||"",end_date:((h=o.filters)==null?void 0:h.end_date)||""}),y={"Anak-anak":"#8B5CF6",Remaja:"#EF4444","Dewasa Muda":"#F97316","Dewasa Produktif":"#EAB308","Dewasa Matang":"#22C55E","Usia Tua":"#3B82F6","Tidak Diketahui":"#6B7280"};F(()=>{if(typeof ApexCharts<"u")v();else{const l=document.createElement("script");l.src="https://cdn.jsdelivr.net/npm/apexcharts",l.onload=v,document.head.appendChild(l)}}),R(()=>o.data,()=>{if(g&&o.data&&o.data.length>0){const l=o.data.map(d=>d.age_group),e=o.data.map(d=>d.total_spending),m=o.data.map(d=>d.avg_spending_per_customer);g.updateSeries([{name:"Total Pengeluaran",type:"column",data:e},{name:"Rata-rata per Customer",type:"line",data:m}]),g.updateOptions({xaxis:{categories:l}})}else g&&(!o.data||o.data.length===0)&&g.updateSeries([])},{deep:!0});function v(){if(!o.data||!f.value||o.data.length===0)return;const l=o.data.map(a=>a.age_group),e=o.data.map(a=>a.total_spending),m=o.data.map(a=>a.avg_spending_per_customer);l.map(a=>y[a]);const d={series:[{name:"Total Pengeluaran",type:"column",data:e},{name:"Rata-rata per Customer",type:"line",data:m}],chart:{type:"line",height:400,stacked:!1,toolbar:{show:!1},animations:{enabled:!0,easing:"easeinout",speed:800,animateGradually:{enabled:!0,delay:150},dynamicAnimation:{enabled:!0,speed:350}}},colors:["#3B82F6","#EF4444"],stroke:{curve:"smooth",width:[0,3]},plotOptions:{bar:{borderRadius:4,columnWidth:"60%",dataLabels:{position:"top"}}},fill:{type:["solid","gradient"],gradient:{shade:"light",type:"vertical",shadeIntensity:.25,gradientToColors:["#3B82F6"],inverseColors:!1,opacityFrom:.8,opacityTo:.1,stops:[0,100]}},grid:{borderColor:"#e2e8f0",strokeDashArray:4},xaxis:{categories:l,labels:{style:{colors:"#6b7280",fontSize:"12px"}}},yaxis:[{title:{text:"Total Pengeluaran (Rp)",style:{color:"#3B82F6",fontSize:"14px",fontWeight:600}},labels:{style:{colors:"#6b7280",fontSize:"12px"},formatter:function(a){return"Rp "+a.toLocaleString("id-ID")}}},{opposite:!0,title:{text:"Rata-rata per Customer (Rp)",style:{color:"#EF4444",fontSize:"14px",fontWeight:600}},labels:{style:{colors:"#6b7280",fontSize:"12px"},formatter:function(a){return"Rp "+a.toLocaleString("id-ID")}}}],tooltip:{shared:!0,intersect:!1,y:{formatter:function(a,{seriesIndex:n}){return"Rp "+a.toLocaleString("id-ID")}}},legend:{position:"top",horizontalAlign:"right",fontSize:"14px",markers:{radius:12}},dataLabels:{enabled:!1},markers:{size:5,hover:{size:7}},states:{hover:{filter:{type:"lighten",value:.15}},active:{allowMultipleDataPointsSelection:!1,filter:{type:"darken",value:.35}}}};g=new ApexCharts(f.value,d),g.render()}function p(l){return l.toLocaleString("id-ID")}function T(){S.visit("/crm/dashboard",{data:{start_date:i.value.start_date,end_date:i.value.end_date},preserveState:!0})}function D(){i.value.start_date="",i.value.end_date="",S.visit("/crm/dashboard",{data:{start_date:"",end_date:""},preserveState:!0})}return(l,e)=>{var m,d;return c(),u("div",A,[t("div",L,[e[7]||(e[7]=t("div",{class:"flex justify-between items-start mb-2"},[t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-900"},"Daya Beli per Kelompok Usia"),t("p",{class:"text-sm text-gray-600"},"Analisis pengeluaran dan daya beli berdasarkan kelompok usia")])],-1)),t("div",E,[t("div",I,[t("div",M,[e[2]||(e[2]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Dari Tanggal",-1)),C(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>i.value.start_date=a),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[w,i.value.start_date]])]),t("div",N,[e[3]||(e[3]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Sampai Tanggal",-1)),C(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>i.value.end_date=a),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[w,i.value.end_date]])]),t("div",{class:"flex gap-2"},[t("button",{onClick:T,class:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition flex items-center gap-2"},e[4]||(e[4]=[t("i",{class:"fa-solid fa-filter"},null,-1),x(" Filter ")])),t("button",{onClick:D,class:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition flex items-center gap-2"},e[5]||(e[5]=[t("i",{class:"fa-solid fa-times"},null,-1),x(" Reset ")]))])]),(m=s.filters)!=null&&m.start_date||(d=s.filters)!=null&&d.end_date?(c(),u("div",V,[e[6]||(e[6]=t("i",{class:"fa-solid fa-info-circle"},null,-1)),x(" Filter aktif: "+r(s.filters.start_date||"Semua")+" - "+r(s.filters.end_date||"Semua"),1)])):b("",!0)])]),t("div",W,[s.data&&s.data.length>0?(c(),u("div",{key:0,ref_key:"chartContainer",ref:f,class:"w-full h-96"},null,512)):(c(),u("div",G,e[8]||(e[8]=[t("div",{class:"text-center"},[t("i",{class:"fas fa-chart-bar text-4xl mb-2"}),t("p",null,"Tidak ada data untuk ditampilkan")],-1)])))]),s.data&&s.data.length>0?(c(),u("div",U,[(c(!0),u(P,null,B(s.data,a=>(c(),u("div",{key:a.age_group,class:"bg-gray-50 rounded-lg p-4"},[t("div",O,[t("div",H,[t("div",{class:"w-3 h-3 rounded-full",style:j({backgroundColor:y[a.age_group]})},null,4),t("span",J,r(a.age_group),1)])]),t("div",K,[t("div",Y,[e[9]||(e[9]=t("span",{class:"text-gray-600"},"Total Customer:",-1)),t("span",q,r(p(a.total_customers)),1)]),t("div",Q,[e[10]||(e[10]=t("span",{class:"text-gray-600"},"Total Pengeluaran:",-1)),t("span",X,r(a.total_spending_formatted),1)]),t("div",Z,[e[11]||(e[11]=t("span",{class:"text-gray-600"},"Rata-rata per Customer:",-1)),t("span",$,r(a.avg_spending_per_customer_formatted),1)]),t("div",tt,[e[12]||(e[12]=t("span",{class:"text-gray-600"},"Total Transaksi:",-1)),t("span",et,r(p(a.total_transactions)),1)])])]))),128))])):b("",!0),s.data&&s.data.length>0?(c(),u("div",at,[t("div",st,[t("div",ot,[e[13]||(e[13]=t("p",{class:"text-sm text-blue-600 font-medium"},"Total Customer",-1)),t("p",lt,r(p(s.data.reduce((a,n)=>a+n.total_customers,0))),1)]),t("div",nt,[e[14]||(e[14]=t("p",{class:"text-sm text-green-600 font-medium"},"Total Pengeluaran",-1)),t("p",rt," Rp "+r(p(s.data.reduce((a,n)=>a+n.total_spending,0))),1)]),t("div",dt,[e[15]||(e[15]=t("p",{class:"text-sm text-orange-600 font-medium"},"Total Transaksi",-1)),t("p",it,r(p(s.data.reduce((a,n)=>a+n.total_transactions,0))),1)]),t("div",ut,[e[16]||(e[16]=t("p",{class:"text-sm text-purple-600 font-medium"},"Rata-rata Global",-1)),t("p",ct," Rp "+r(p(s.data.reduce((a,n)=>a+n.total_spending,0)/s.data.reduce((a,n)=>a+n.total_customers,0))),1)])])])):b("",!0)])}}},bt=z(gt,[["__scopeId","data-v-aaa799f8"]]);export{bt as default};
