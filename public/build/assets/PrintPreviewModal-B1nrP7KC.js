import{r as q,c as I,w as S,a as R,A as L,B as p,L as u,E as T,D as t,G as a,N as s,F as C,M as N,H as A,I as M,T as H}from"./vendor-vue-g7iCcTkf.js";import{a as O}from"./vendor-utils-CpgP2uT4.js";const Q={key:0,class:"fixed inset-0 z-[100000] flex items-center justify-center bg-black/40 p-4"},G={class:"bg-white rounded-xl shadow-lg w-full max-w-2xl max-h-[90vh] flex flex-col relative"},V={class:"p-6 pb-4 border-b border-gray-200"},$={class:"flex-1 overflow-y-auto p-6 pt-4"},U={id:"print-area"},z={class:"mb-4 text-sm"},F={class:"grid grid-cols-2 gap-4"},J={class:"w-full text-xs border mb-4",style:{"border-collapse":"collapse"}},K={class:"border px-2 py-1"},W={class:"border px-2 py-1"},X={class:"border px-2 py-1"},Y={class:"border px-2 py-1"},Z={class:"border px-2 py-1 text-right"},_={class:"border px-2 py-1 text-right"},tt={class:"border px-2 py-1 text-right"},et={key:0},ot={class:"border px-2 py-1 text-right"},st={class:"border px-2 py-1 text-right"},lt={style:{width:"100%","margin-top":"40px"}},nt={style:{"vertical-align":"top",width:"60%"}},rt={style:{"margin-top":"48px"}},it={class:"text-sm font-bold"},at={class:"text-xs"},dt={class:"p-6 pt-4 border-t border-gray-200 bg-gray-50"},pt={class:"flex flex-col gap-4"},ut={class:"flex items-center gap-2"},ct=["value"],gt={class:"flex justify-end gap-2"},xt={__name:"PrintPreviewModal",props:{show:Boolean,po:Object},setup(l){const r=l,g=q([]),m=q(""),x=I(()=>g.value.find(o=>o.id_outlet==m.value)),y=async()=>{try{const o=await O.get(route("outlets.list"));g.value=o.data.filter(e=>e.status==="A")}catch(o){console.error("Error fetching outlets:",o)}},c=o=>(typeof o!="number"&&(o=Number(o)||0),"Rp "+o.toLocaleString("id-ID")),B=()=>{const o=r.po.subtotal||r.po.items.reduce((e,i)=>e+(Number(i.total)||0),0);if(r.po.ppn_enabled){const e=r.po.ppn_amount||o*.11;return o+e}return o};function h(){var i;if(!((i=r.po)!=null&&i.number))return;const o=document.getElementById("qrcode");o&&(o.innerHTML="");const e="qrcodejs-cdn";if(document.getElementById(e))new window.QRCode(o,{text:r.po.number,width:80,height:80});else{const d=document.createElement("script");d.id=e,d.src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js",d.onload=()=>{new window.QRCode(o,{text:r.po.number,width:80,height:80})},document.body.appendChild(d)}}S(()=>r.show,o=>{o&&(setTimeout(h,200),y())}),R(()=>{r.show&&(setTimeout(h,200),y())});function E(){const o=document.getElementById("print-area").innerHTML,e=window.open("","","height=600,width=800");e.document.write("<html><head><title>Print PO</title>"),e.document.write("<style>body{font-family:Arial,sans-serif;}table{border-collapse:collapse;width:100%;}th,td{border:1px solid #ddd;padding:8px;}.print-header { text-align:center; }.logo-print { max-width:180px; margin:0 auto 12px; display:block; }@media print {.print-header { display:block !important; }.logo-print { display:block !important; }}</style><script src='https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js'><\/script>"),e.document.write("</head><body>"),e.document.write(o),e.document.write("<script>var qrDiv = document.getElementById('qrcode');if(qrDiv && !qrDiv.hasChildNodes()) {new QRCode(qrDiv, { text: '"+r.po.number+"', width: 80, height: 80 });}<\/script>"),e.document.write("</body></html>"),e.document.close(),e.focus(),setTimeout(()=>{e.print(),e.close(),O.post(route("po-foods.mark-printed",r.po.id)).then(i=>{i.data.printed_at&&(r.po.printed_at=i.data.printed_at)})},500)}return(o,e)=>{var i,d,f,v,w,k,D;return p(),L(H,{to:"body"},[l.show?(p(),u("div",Q,[t("div",G,[t("div",V,[t("button",{onClick:e[0]||(e[0]=n=>o.$emit("close")),class:"absolute top-3 right-3 text-gray-400 hover:text-gray-600"},e[3]||(e[3]=[t("i",{class:"fas fa-times text-lg"},null,-1)])),e[4]||(e[4]=t("h3",{class:"text-lg font-semibold text-gray-800"},"Preview Purchase Order",-1))]),t("div",$,[t("div",U,[e[20]||(e[20]=t("div",{class:"text-center mb-4 print-header"},[t("img",{src:"/images/logojustusgroup.png",alt:"Justus Group",class:"logo-print",style:{"max-width":"180px",margin:"0 auto 12px",display:"block"}}),t("h2",{style:{"font-size":"20px","font-weight":"bold","margin-bottom":"8px"}},"PURCHASE ORDER")],-1)),t("div",z,[t("div",F,[t("div",null,[t("p",null,[e[5]||(e[5]=t("strong",null,"No. PO:",-1)),a(" "+s(l.po.number),1)]),t("p",null,[e[6]||(e[6]=t("strong",null,"Tanggal:",-1)),a(" "+s(new Date(l.po.date).toLocaleDateString("id-ID")),1)]),t("p",null,[e[7]||(e[7]=t("strong",null,"Supplier:",-1)),a(" "+s((i=l.po.supplier)==null?void 0:i.name),1)]),t("p",null,[e[8]||(e[8]=t("strong",null,"Tanggal Kedatangan:",-1)),a(" "+s(l.po.arrival_date?new Date(l.po.arrival_date).toLocaleDateString("id-ID"):"-"),1)]),t("p",null,[e[9]||(e[9]=t("strong",null,"Outlet Pengiriman:",-1)),a(" "+s(((d=x.value)==null?void 0:d.nama_outlet)||"-"),1)]),t("p",null,[e[10]||(e[10]=t("strong",null,"Alamat Pengiriman:",-1)),a(" "+s(((f=x.value)==null?void 0:f.lokasi)||"-"),1)])]),t("div",null,[t("p",null,[e[11]||(e[11]=t("strong",null,"Status:",-1)),a(" "+s(l.po.status),1)]),t("p",null,[e[12]||(e[12]=t("strong",null,"Dibuat oleh:",-1)),a(" "+s((v=l.po.creator)==null?void 0:v.nama_lengkap),1)]),t("p",null,[e[13]||(e[13]=t("strong",null,"Catatan:",-1)),a(" "+s(l.po.notes||"-"),1)])])])]),t("table",J,[e[17]||(e[17]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"border px-2 py-1"},"No"),t("th",{class:"border px-2 py-1"},"Nama Barang"),t("th",{class:"border px-2 py-1"},"Qty"),t("th",{class:"border px-2 py-1"},"Unit"),t("th",{class:"border px-2 py-1"},"Harga"),t("th",{class:"border px-2 py-1"},"Total")])],-1)),t("tbody",null,[(p(!0),u(C,null,N(l.po.items,(n,b)=>{var P,j;return p(),u("tr",{key:n.id},[t("td",K,s(b+1),1),t("td",W,s((P=n.item)==null?void 0:P.name),1),t("td",X,s(n.quantity),1),t("td",Y,s((j=n.unit)==null?void 0:j.name),1),t("td",Z,s(c(n.price)),1),t("td",_,s(c(n.total)),1)])}),128))]),t("tfoot",null,[t("tr",null,[e[14]||(e[14]=t("td",{colspan:"5",class:"border px-2 py-1 text-right"},[t("strong",null,"Subtotal:")],-1)),t("td",tt,[t("strong",null,s(c(l.po.subtotal||l.po.items.reduce((n,b)=>n+(Number(b.total)||0),0))),1)])]),l.po.ppn_enabled?(p(),u("tr",et,[e[15]||(e[15]=t("td",{colspan:"5",class:"border px-2 py-1 text-right"},[t("strong",null,"PPN (11%):")],-1)),t("td",ot,[t("strong",null,s(c(l.po.ppn_amount||0)),1)])])):T("",!0),t("tr",null,[e[16]||(e[16]=t("td",{colspan:"5",class:"border px-2 py-1 text-right"},[t("strong",null,"Grand Total:")],-1)),t("td",st,[t("strong",null,s(c(l.po.grand_total||B())),1)])])])]),t("table",lt,[t("tr",null,[t("td",nt,[e[18]||(e[18]=t("p",{class:"text-sm font-bold mb-2"},"Dibuat oleh,",-1)),t("div",rt,[t("p",it,s((w=l.po.creator)==null?void 0:w.nama_lengkap),1),t("p",at,s((D=(k=l.po.creator)==null?void 0:k.jabatan)==null?void 0:D.nama_jabatan),1)])]),e[19]||(e[19]=t("td",{style:{"vertical-align":"top","text-align":"right",width:"40%"}},[t("div",{id:"qrcode"})],-1))])])])]),t("div",dt,[t("div",pt,[t("div",ut,[e[22]||(e[22]=t("label",{class:"text-sm font-medium text-gray-700"},"Pilih Outlet Pengiriman:",-1)),A(t("select",{"onUpdate:modelValue":e[1]||(e[1]=n=>m.value=n),class:"flex-1 rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"},[e[21]||(e[21]=t("option",{value:""},"Pilih Outlet",-1)),(p(!0),u(C,null,N(g.value,n=>(p(),u("option",{key:n.id_outlet,value:n.id_outlet},s(n.nama_outlet),9,ct))),128))],512),[[M,m.value]])]),t("div",gt,[t("button",{onClick:e[2]||(e[2]=n=>o.$emit("close")),class:"px-4 py-2 text-gray-700 bg-gray-100 rounded hover:bg-gray-200"},"Tutup"),t("button",{onClick:E,class:"px-4 py-2 text-white bg-blue-500 rounded hover:bg-blue-600"},"Print")])])])])])):T("",!0)])}}};export{xt as default};
