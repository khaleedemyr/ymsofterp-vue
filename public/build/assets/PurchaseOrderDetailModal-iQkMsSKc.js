import{r as m,$ as X,c as L,w as J,L as l,B as n,x as _,A as Z,C as y,Q as x,D as t,E as h,N as r,l as I,F as b,M as O,H as tt,J as et,T as at}from"./vendor-vue-g7iCcTkf.js";import{a as N}from"./vendor-utils-CpgP2uT4.js";import{S as C}from"./app-DGqVli5-.js";import{Y as st,h as z,G as ot,S as nt}from"./vendor-ui-CrPgGUUb.js";import"./vendor-charts-CuqD4wLC.js";const lt={class:"fixed inset-0 overflow-y-auto"},it={class:"flex min-h-full items-center justify-center p-4 text-center"},rt={class:"flex justify-between items-center mb-6"},dt={key:0,class:"flex items-center justify-center py-8"},ut={key:1,class:"space-y-6"},ct={class:"grid grid-cols-2 gap-4"},pt={class:"font-medium"},mt={class:"font-medium"},vt={class:"font-medium"},ft={class:"border rounded-lg overflow-hidden"},gt={class:"min-w-full divide-y divide-gray-200"},_t={class:"bg-white divide-y divide-gray-200"},yt={class:"px-4 py-2"},xt={class:"px-4 py-2 text-sm text-gray-500"},ht={class:"px-4 py-2 text-center"},bt={class:"px-4 py-2 text-right"},kt={class:"px-4 py-2 text-right"},wt={class:"bg-gray-50"},Dt={class:"px-4 py-2 text-right font-medium"},Et={key:0},Pt={class:"bg-gray-50 p-4 rounded-lg text-sm"},It={class:"space-y-3"},Ot={class:"flex-1"},Nt={class:"font-medium"},Ct={class:"text-sm text-gray-500"},At={key:0},Rt={key:1},St={key:2},Tt={key:3},jt={key:0,class:"text-xs text-gray-400 mt-1"},Vt={key:0,class:"flex gap-2"},$t=["onClick","disabled"],Gt=["onClick","disabled"],Ft={key:1},Mt={class:"mt-6"},Bt={key:0,class:"text-gray-400 text-sm"},Lt={key:1},Jt={class:"min-w-full divide-y divide-gray-200 text-sm"},zt={class:"px-4 py-2"},qt={class:"px-4 py-2"},Qt={class:"px-4 py-2"},Ut=["href"],Yt={key:1},Ht={key:0,class:"fixed inset-0 z-[100001] flex items-center justify-center bg-black bg-opacity-40"},Kt={class:"bg-white rounded-2xl p-6 w-full max-w-md shadow-xl"},Wt={class:"flex justify-end gap-2"},Xt=["disabled"],oe={__name:"PurchaseOrderDetailModal",props:{show:Boolean,poId:[String,Number],taskId:[String,Number]},emits:["close","po-updated"],setup(A,{emit:q}){const d=A,R=q,k=m(!1),c=m(!1),s=m(null),w=m(!1),v=m(""),f=m(null),D=m([]),u=X().props.auth.user;function Q(o){return!u||u.status!=="A"?!1:u.id_role==="5af56935b011a"||u.id_jabatan===217||o==="purchasing_manager"&&u.id_jabatan===168||o==="gm_finance"&&u.id_jabatan===152||o==="coo"&&u.id_jabatan===151||o==="ceo"&&u.id_jabatan===149}function U(o){if(!s.value||!Q(o))return!1;const e=i=>{const a=s.value[i];return a??"PENDING"};return o==="purchasing_manager"?e("purchasing_manager_approval")==="PENDING":o==="gm_finance"?e("purchasing_manager_approval")==="APPROVED"&&e("gm_finance_approval")==="PENDING":o==="coo"?e("gm_finance_approval")==="APPROVED"&&e("coo_approval")==="PENDING":o==="ceo"?e("coo_approval")==="APPROVED"&&e("ceo_approval")==="PENDING"&&s.value.total_amount>=5e6:!1}const Y=L(()=>s.value&&s.value.total_amount>=5e6),H=L(()=>{var o,e,i,a,p,g,V,$,G,F,M,B;return[{key:"purchasing_manager",label:"Purchasing Manager",status:(o=s.value)==null?void 0:o.purchasing_manager_approval,date:(e=s.value)==null?void 0:e.purchasing_manager_approval_date,notes:(i=s.value)==null?void 0:i.purchasing_manager_approval_notes},{key:"gm_finance",label:"GM Finance",status:(a=s.value)==null?void 0:a.gm_finance_approval,date:(p=s.value)==null?void 0:p.gm_finance_approval_date,notes:(g=s.value)==null?void 0:g.gm_finance_approval_notes},{key:"coo",label:"COO",status:(V=s.value)==null?void 0:V.coo_approval,date:($=s.value)==null?void 0:$.coo_approval_date,notes:(G=s.value)==null?void 0:G.coo_approval_notes},...Y.value?[{key:"ceo",label:"CEO",status:(F=s.value)==null?void 0:F.ceo_approval,date:(M=s.value)==null?void 0:M.ceo_approval_date,notes:(B=s.value)==null?void 0:B.ceo_approval_notes}]:[]]});J([()=>d.show,()=>d.poId],async([o,e])=>{console.log("Modal show:",o,"PO ID:",e,"Task ID:",d.taskId),o&&e?await S():s.value=null},{immediate:!0});async function S(){var o,e;k.value=!0;try{console.log("Fetching PO details for:",d.poId,"Task ID:",d.taskId);const i=await N.get(`/api/maintenance-tasks/${d.taskId}/purchase-orders/${d.poId}`);console.log("PO details response:",i.data),s.value=i.data;const a=await N.get(`/api/purchase-orders/${d.poId}/invoices`);D.value=a.data}catch(i){console.error("Error fetching PO details:",i),C.fire({title:"Error",text:"Gagal mengambil detail PO: "+(((e=(o=i.response)==null?void 0:o.data)==null?void 0:e.message)||i.message),icon:"error"}),R("close")}finally{k.value=!1}}function T(o,e){f.value={level:o,status:e},v.value="",w.value=!0}function j(){w.value=!1,f.value=null,v.value=""}async function K(){if(f.value){c.value=!0;try{await W(f.value.level,f.value.status,v.value),j()}finally{c.value=!1}}}async function W(o,e,i=""){var a,p;c.value=!0;try{await N.post(`/api/maintenance-tasks/${d.taskId}/purchase-orders/${d.poId}/approve`,{level:o,status:e,notes:i}),await S(),R("po-updated"),C.fire("Sukses","Status PO berhasil diupdate","success")}catch(g){console.error("Error approving PO:",g),C.fire("Error",((p=(a=g.response)==null?void 0:a.data)==null?void 0:p.message)||"Gagal mengupdate status PO","error")}finally{c.value=!1}}function E(o){return new Date(o).toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric"})}function P(o){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(o)}return console.log("User:",u),J(s,o=>{console.log("PO:",o)}),(o,e)=>(n(),l(b,null,[_(x(nt),{appear:"",show:A.show,as:"template"},{default:y(()=>[_(x(st),{as:"div",onClose:e[1]||(e[1]=i=>o.$emit("close")),class:"relative z-[99999]"},{default:y(()=>[_(x(z),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:y(()=>e[3]||(e[3]=[t("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),t("div",lt,[t("div",it,[_(x(z),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:y(()=>[_(x(ot),{class:"w-full max-w-4xl transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all"},{default:y(()=>{var i;return[t("div",rt,[e[5]||(e[5]=t("h3",{class:"text-lg font-medium"},"Detail Purchase Order",-1)),t("button",{onClick:e[0]||(e[0]=a=>o.$emit("close")),class:"text-gray-400 hover:text-gray-600"},e[4]||(e[4]=[t("i",{class:"fas fa-times"},null,-1)]))]),k.value?(n(),l("div",dt,e[6]||(e[6]=[t("div",{class:"flex items-center gap-2"},[t("div",{class:"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),t("span",null,"Loading...")],-1)]))):s.value?(n(),l("div",ut,[t("div",ct,[t("div",null,[e[7]||(e[7]=t("div",{class:"text-sm text-gray-600"},"PO Number",-1)),t("div",pt,r(s.value.po_number),1)]),t("div",null,[e[8]||(e[8]=t("div",{class:"text-sm text-gray-600"},"Created Date",-1)),t("div",mt,r(E(s.value.created_at)),1)]),t("div",null,[e[9]||(e[9]=t("div",{class:"text-sm text-gray-600"},"Supplier",-1)),t("div",vt,r((i=s.value.supplier)==null?void 0:i.name),1)]),t("div",null,[e[10]||(e[10]=t("div",{class:"text-sm text-gray-600"},"Status",-1)),t("div",{class:I(["font-medium",{"text-yellow-600":s.value.status==="DRAFT","text-green-600":s.value.status==="APPROVED","text-red-600":s.value.status==="REJECTED"}])},r(s.value.status),3)])]),t("div",null,[e[13]||(e[13]=t("h4",{class:"font-medium mb-3"},"Items",-1)),t("div",ft,[t("table",gt,[e[12]||(e[12]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Item"),t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Specifications"),t("th",{class:"px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase"},"Quantity"),t("th",{class:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase"},"Price"),t("th",{class:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase"},"Subtotal")])],-1)),t("tbody",_t,[(n(!0),l(b,null,O(s.value.items,a=>(n(),l("tr",{key:a.id},[t("td",yt,r(a.item_name),1),t("td",xt,r(a.specifications||"-"),1),t("td",ht,r(a.quantity),1),t("td",bt,r(P(a.supplier_price)),1),t("td",kt,r(P(a.quantity*a.supplier_price)),1)]))),128))]),t("tfoot",wt,[t("tr",null,[e[11]||(e[11]=t("td",{colspan:"4",class:"px-4 py-2 text-right font-medium"},"Total:",-1)),t("td",Dt,r(P(s.value.total_amount)),1)])])])])]),s.value.notes?(n(),l("div",Et,[e[14]||(e[14]=t("h4",{class:"font-medium mb-2"},"Notes",-1)),t("div",Pt,r(s.value.notes),1)])):h("",!0),t("div",null,[e[15]||(e[15]=t("h4",{class:"font-medium mb-3"},"Approval Status",-1)),t("div",It,[(n(!0),l(b,null,O(H.value,a=>(n(),l("div",{key:a.key,class:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg"},[t("div",Ot,[t("div",Nt,r(a.label),1),t("div",Ct,[a.status==="APPROVED"?(n(),l("span",At,"Approved")):a.status==="REJECTED"?(n(),l("span",Rt,"Rejected")):(n(),l("span",St,"Pending")),a.date?(n(),l("span",Tt," ("+r(E(a.date))+")",1)):h("",!0)]),a.notes?(n(),l("div",jt,"Catatan: "+r(a.notes),1)):h("",!0)]),U(a.key)?(n(),l("div",Vt,[t("button",{onClick:p=>T(a.key,"APPROVED"),class:"px-3 py-1 bg-green-100 text-green-600 rounded hover:bg-green-200",disabled:c.value}," Approve ",8,$t),t("button",{onClick:p=>T(a.key,"REJECTED"),class:"px-3 py-1 bg-red-100 text-red-600 rounded hover:bg-red-200",disabled:c.value}," Reject ",8,Gt)])):(n(),l("div",Ft,[t("span",{class:I({"text-green-600":a.status==="APPROVED","text-red-600":a.status==="REJECTED","text-gray-400":!a.status||a.status==="PENDING"})},[t("i",{class:I(["fas",a.status==="APPROVED"?"fa-check-circle":a.status==="REJECTED"?"fa-times-circle":"fa-clock"])},null,2)],2)]))]))),128))])]),t("div",Mt,[e[17]||(e[17]=t("h4",{class:"font-medium mb-2"},"Invoice",-1)),D.value.length===0?(n(),l("div",Bt,"Belum ada invoice.")):(n(),l("div",Lt,[t("table",Jt,[e[16]||(e[16]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left"},"No. Invoice"),t("th",{class:"px-4 py-2 text-left"},"Tanggal"),t("th",{class:"px-4 py-2 text-left"},"File")])],-1)),t("tbody",null,[(n(!0),l(b,null,O(D.value,a=>(n(),l("tr",{key:a.id},[t("td",zt,r(a.invoice_number),1),t("td",qt,r(E(a.invoice_date)),1),t("td",Qt,[a.invoice_file_path?(n(),l("a",{key:0,href:a.invoice_file_path,target:"_blank",class:"text-blue-600 underline"},"Lihat File",8,Ut)):(n(),l("span",Yt,"-"))])]))),128))])])]))])])):h("",!0)]}),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]),(n(),Z(at,{to:"body"},[w.value?(n(),l("div",Ht,[t("div",Kt,[e[18]||(e[18]=t("h3",{class:"text-lg font-medium mb-4"},"Tambahkan Catatan (Opsional)",-1)),tt(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=i=>v.value=i),rows:"3",class:"w-full border rounded p-2 mb-4",placeholder:"Tulis catatan di sini...",autofocus:""},null,512),[[et,v.value]]),t("div",Wt,[t("button",{onClick:j,class:"px-4 py-2 bg-gray-100 rounded hover:bg-gray-200"},"Batal"),t("button",{onClick:K,disabled:c.value,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"},r(c.value?"Menyimpan...":"Konfirmasi"),9,Xt)])])])):h("",!0)]))],64))}};export{oe as default};
