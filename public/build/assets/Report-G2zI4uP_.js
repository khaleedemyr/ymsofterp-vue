import{r as h,c as N,w as B,a as W,A as X,B as d,C as E,D as e,L as r,E as m,H as f,J as F,F as k,M as I,N as i,I as w,G as D,l as C}from"./vendor-vue-g7iCcTkf.js";import{A as Z}from"./AppLayout-1Wm1ZPw9.js";import{a as ee}from"./vendor-utils-CpgP2uT4.js";import"./app-BPKNzj_F.js";import"./vendor-charts-CuqD4wLC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-CVHTvH7j.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const te={class:"flex justify-between items-center"},se={class:"flex gap-2"},ae=["disabled"],le={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg mb-6"},oe={class:"p-4"},ie={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4"},de=["disabled"],ne=["value"],re=["value"],ue={class:"flex gap-2 mt-4"},pe=["disabled"],ge={key:0,class:"mt-2 text-sm text-red-600"},ce={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6"},ve={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},xe={class:"p-6"},me={class:"flex items-center"},fe={class:"ml-4"},ye={class:"text-2xl font-semibold text-gray-900"},_e={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},be={class:"p-6"},he={class:"flex items-center"},we={class:"ml-4"},De={class:"text-2xl font-semibold text-gray-900"},ke={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Ie={class:"p-6"},Se={class:"flex items-center"},Ce={class:"ml-4"},Te={class:"text-2xl font-semibold text-gray-900"},Me={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Le={class:"p-6"},Oe={class:"flex items-center"},Ve={class:"ml-4"},je={class:"text-2xl font-semibold text-gray-900"},Ae={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Pe={class:"p-6"},Re={class:"overflow-x-auto"},$e={class:"min-w-full divide-y divide-gray-200"},Ue={class:"bg-white divide-y divide-gray-200"},Ne={key:0},Be={key:1},Ee={class:"px-4 py-3 whitespace-nowrap"},Fe={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-900"},Ye={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-900"},Je={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-900"},Ke={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-900"},qe={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-900"},ze={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-900"},Ge={class:"px-4 py-3 whitespace-nowrap"},He={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-900"},Qe={class:"space-y-1"},We={class:"font-medium"},Xe={class:"text-xs text-gray-500"},Ze={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-900"},et={class:"space-y-1"},tt={class:"font-medium"},st={key:0,class:"text-xs text-green-600"},at={key:1,class:"text-xs text-gray-400"},lt={key:0,class:"px-4 py-3 border-t border-gray-200 bg-white"},ot={class:"flex items-center justify-between"},it={class:"flex items-center gap-4"},dt={class:"text-sm text-gray-700"},nt={class:"flex items-center gap-2"},rt={class:"flex items-center gap-2"},ut=["disabled"],pt={class:"flex items-center gap-1"},gt={key:1,class:"px-2 text-gray-500"},ct=["onClick"],vt={key:2,class:"px-2 text-gray-500"},xt=["disabled"],Ct={__name:"Report",props:{outlets:Array,divisions:Array,user:Object},setup(Y){const n=Y,y=h(!1),_=h([]),v=h(null),o=h({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0,has_more_pages:!1}),s=h({startDate:"",endDate:"",outletId:"",divisionId:"",status:"",type:""}),J=N(()=>{var a;return!n.outlets||!Array.isArray(n.outlets)?[]:(a=n.user)!=null&&a.id_outlet&&n.user.id_outlet!==1?n.outlets.filter(t=>t.id_outlet===n.user.id_outlet):n.outlets}),T=N(()=>s.value.startDate&&s.value.endDate);B(s,(a,t)=>{console.log("Filter changed:",{old:t,new:a}),t&&a.divisionId!==t.divisionId&&console.log("Division ID changed from",t.divisionId,"to",a.divisionId)},{deep:!0}),B(()=>s.value.divisionId,(a,t)=>{console.log("Division ID specifically changed:",{from:t,to:a,timestamp:new Date().toISOString()})});function S(a=1){var u,p;y.value=!0,o.value.current_page=a;const t=new URLSearchParams;s.value.startDate&&t.append("start_date",s.value.startDate),s.value.endDate&&t.append("end_date",s.value.endDate),s.value.outletId&&t.append("outlet_id",s.value.outletId),s.value.divisionId&&t.append("division_id",s.value.divisionId),s.value.status&&t.append("status",s.value.status),s.value.type&&t.append("type",s.value.type),t.append("page",a),t.append("per_page",((u=o.value)==null?void 0:u.per_page)||15),console.log("Loading report data with filters:",{startDate:s.value.startDate,endDate:s.value.endDate,outletId:s.value.outletId,divisionId:s.value.divisionId,status:s.value.status,type:s.value.type,page:a,per_page:(p=o.value)==null?void 0:p.per_page}),console.log("Current filter state:",JSON.stringify(s.value,null,2)),ee.get(`/api/schedule-attendance-correction/report-data?${t.toString()}`).then(g=>{g.data&&g.data.success&&(_.value=g.data.data||[],v.value=g.data.summary||null,o.value=g.data.pagination||{current_page:1,last_page:1,per_page:15,total:0,from:0,to:0,has_more_pages:!1})}).catch(g=>{console.error("Error loading report data:",g),_.value=[],v.value=null,o.value={current_page:1,last_page:1,per_page:15,total:0,from:0,to:0,has_more_pages:!1}}).finally(()=>{y.value=!1})}function K(){var p;const a=new Date,t=new Date(a.getFullYear(),a.getMonth(),1),u=new Date(a.getFullYear(),a.getMonth()+1,0);s.value={startDate:t.toISOString().split("T")[0],endDate:u.toISOString().split("T")[0],outletId:(p=n.user)!=null&&p.id_outlet&&n.user.id_outlet!==1?n.user.id_outlet:"",divisionId:"",status:"",type:""},_.value=[],v.value=null,o.value={current_page:1,last_page:1,per_page:15,total:0,from:0,to:0,has_more_pages:!1}}function b(a){var t;a>=1&&a<=(((t=o.value)==null?void 0:t.last_page)||1)&&S(a)}function q(a){o.value.per_page=parseInt(a),S(1)}function z(){const a=new URLSearchParams;s.value.startDate&&a.append("start_date",s.value.startDate),s.value.endDate&&a.append("end_date",s.value.endDate),s.value.outletId&&a.append("outlet_id",s.value.outletId),s.value.divisionId&&a.append("division_id",s.value.divisionId),s.value.status&&a.append("status",s.value.status),s.value.type&&a.append("type",s.value.type),window.open(`/schedule-attendance-correction/export-report?${a.toString()}`,"_blank")}function G(a){switch(a){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}function H(a){switch(a){case"pending":return"Pending";case"approved":return"Disetujui";case"rejected":return"Ditolak";default:return a}}function M(a,t){const u=t==="old"?a.old_value:a.new_value;if(a.type==="schedule")return u;if(a.type==="attendance")try{const p=JSON.parse(u),g=new Date(p.scan_date).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit",second:"2-digit"});return`${p.inoutmode===1?"Masuk":"Keluar"} ${g}`}catch{return u}return u}const Q=()=>{if(!o.value||!o.value.current_page||!o.value.last_page)return[];const a=o.value.current_page,t=o.value.last_page,u=[],p=Math.max(1,a-2),g=Math.min(t,a+2);for(let x=p;x<=g;x++)u.push(x);return u};return W(()=>{var p;console.log("Report component mounted with props:",{divisions:n.divisions,outlets:n.outlets,user:n.user});const a=new Date,t=new Date(a.getFullYear(),a.getMonth(),1),u=new Date(a.getFullYear(),a.getMonth()+1,0);s.value.startDate=t.toISOString().split("T")[0],s.value.endDate=u.toISOString().split("T")[0],(p=n.user)!=null&&p.id_outlet&&n.user.id_outlet!==1&&(s.value.outletId=n.user.id_outlet)}),(a,t)=>(d(),X(Z,{title:"Report Schedule/Attendance Correction"},{header:E(()=>[e("div",te,[t[13]||(t[13]=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Report Schedule/Attendance Correction ",-1)),e("div",se,[e("button",{onClick:z,disabled:y.value,class:"bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg flex items-center gap-2"},t[12]||(t[12]=[e("i",{class:"fa-solid fa-file-excel"},null,-1),D(" Export Excel ")]),8,ae)])])]),default:E(()=>{var u,p,g,x,L,O,V,j,A,P,R,$,U;return[e("div",null,[e("div",null,[e("div",le,[e("div",oe,[t[27]||(t[27]=e("h3",{class:"text-lg font-semibold mb-4"},"Filter Report",-1)),e("div",ie,[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tanggal Mulai",-1)),f(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=l=>s.value.startDate=l),class:"w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[F,s.value.startDate]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tanggal Selesai",-1)),f(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=l=>s.value.endDate=l),class:"w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[F,s.value.endDate]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Outlet",-1)),f(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>s.value.outletId=l),disabled:((u=n.user)==null?void 0:u.id_outlet)&&n.user.id_outlet!==1,class:"w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 disabled:bg-gray-100 disabled:cursor-not-allowed"},[t[16]||(t[16]=e("option",{value:""},"Semua Outlet",-1)),(d(!0),r(k,null,I(J.value,l=>(d(),r("option",{key:l.id_outlet,value:l.id_outlet},i(l.nama_outlet),9,ne))),128))],8,de),[[w,s.value.outletId]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Divisi",-1)),f(e("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>s.value.divisionId=l),class:"w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[t[18]||(t[18]=e("option",{value:""},"Semua Divisi",-1)),(d(!0),r(k,null,I(n.divisions,l=>(d(),r("option",{key:l.id_divisi,value:l.id_divisi},i(l.nama_divisi),9,re))),128))],512),[[w,s.value.divisionId]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Status",-1)),f(e("select",{"onUpdate:modelValue":t[4]||(t[4]=l=>s.value.status=l),class:"w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},t[20]||(t[20]=[e("option",{value:""},"Semua Status",-1),e("option",{value:"pending"},"Pending",-1),e("option",{value:"approved"},"Disetujui",-1),e("option",{value:"rejected"},"Ditolak",-1)]),512),[[w,s.value.status]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipe",-1)),f(e("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>s.value.type=l),class:"w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},t[22]||(t[22]=[e("option",{value:""},"Semua Tipe",-1),e("option",{value:"schedule"},"Schedule",-1),e("option",{value:"attendance"},"Attendance",-1)]),512),[[w,s.value.type]])])]),e("div",ue,[e("button",{onClick:S,disabled:y.value||!T.value,class:"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg flex items-center gap-2"},[t[24]||(t[24]=e("i",{class:"fa-solid fa-search"},null,-1)),D(" "+i(y.value?"Loading...":"Cari"),1)],8,pe),e("button",{onClick:K,class:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg flex items-center gap-2"},t[25]||(t[25]=[e("i",{class:"fa-solid fa-refresh"},null,-1),D(" Reset ")]))]),T.value?m("",!0):(d(),r("div",ge,t[26]||(t[26]=[e("i",{class:"fa-solid fa-exclamation-triangle mr-1"},null,-1),D(" Silakan pilih minimal tanggal mulai dan tanggal selesai untuk melakukan pencarian. ")])))])]),v.value?(d(),r("div",ce,[e("div",ve,[e("div",xe,[e("div",me,[t[29]||(t[29]=e("div",{class:"flex-shrink-0"},[e("i",{class:"fa-solid fa-list text-2xl text-blue-500"})],-1)),e("div",fe,[t[28]||(t[28]=e("p",{class:"text-sm font-medium text-gray-500"},"Total",-1)),e("p",ye,i(v.value.total),1)])])])]),e("div",_e,[e("div",be,[e("div",he,[t[31]||(t[31]=e("div",{class:"flex-shrink-0"},[e("i",{class:"fa-solid fa-clock text-2xl text-yellow-500"})],-1)),e("div",we,[t[30]||(t[30]=e("p",{class:"text-sm font-medium text-gray-500"},"Pending",-1)),e("p",De,i(v.value.pending),1)])])])]),e("div",ke,[e("div",Ie,[e("div",Se,[t[33]||(t[33]=e("div",{class:"flex-shrink-0"},[e("i",{class:"fa-solid fa-check text-2xl text-green-500"})],-1)),e("div",Ce,[t[32]||(t[32]=e("p",{class:"text-sm font-medium text-gray-500"},"Disetujui",-1)),e("p",Te,i(v.value.approved),1)])])])]),e("div",Me,[e("div",Le,[e("div",Oe,[t[35]||(t[35]=e("div",{class:"flex-shrink-0"},[e("i",{class:"fa-solid fa-times text-2xl text-red-500"})],-1)),e("div",Ve,[t[34]||(t[34]=e("p",{class:"text-sm font-medium text-gray-500"},"Ditolak",-1)),e("p",je,i(v.value.rejected),1)])])])])])):m("",!0),e("div",Ae,[e("div",Pe,[e("div",Re,[e("table",$e,[t[39]||(t[39]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tipe"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tanggal"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Karyawan"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Outlet"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Divisi"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nilai Lama"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nilai Baru"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Diminta Oleh"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Disetujui Oleh")])],-1)),e("tbody",Ue,[y.value?(d(),r("tr",Ne,t[36]||(t[36]=[e("td",{colspan:"10",class:"px-4 py-3 text-center"},[e("div",{class:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"}),e("p",{class:"text-sm mt-2 text-gray-600"},"Memuat data...")],-1)]))):_.value.length===0?(d(),r("tr",Be,t[37]||(t[37]=[e("td",{colspan:"12",class:"px-4 py-3 text-center text-gray-500"}," Tidak ada data ditemukan ",-1)]))):(d(!0),r(k,{key:2},I(_.value,l=>(d(),r("tr",{key:l.id,class:"hover:bg-gray-50"},[e("td",Ee,[e("span",{class:C(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",l.type==="schedule"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"])},i(l.type==="schedule"?"Schedule":"Attendance"),3)]),e("td",Fe,i(new Date(l.tanggal).toLocaleDateString("id-ID")),1),e("td",Ye,i(l.employee_name),1),e("td",Je,i(l.nama_outlet),1),e("td",Ke,i(l.nama_divisi),1),e("td",qe,i(M(l,"old")),1),e("td",ze,i(M(l,"new")),1),e("td",Ge,[e("span",{class:C(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",G(l.status)])},i(H(l.status)),3)]),e("td",He,[e("div",Qe,[e("div",We,i(l.requested_by_name),1),e("div",Xe,i(new Date(l.created_at).toLocaleDateString("id-ID"))+" "+i(new Date(l.created_at).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})),1)])]),e("td",Ze,[e("div",et,[e("div",tt,i(l.approved_by_name||"-"),1),l.approved_at?(d(),r("div",st,i(new Date(l.approved_at).toLocaleDateString("id-ID"))+" "+i(new Date(l.approved_at).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})),1)):(d(),r("div",at,t[38]||(t[38]=[e("i",{class:"fa-solid fa-clock mr-1"},null,-1),D(" Belum disetujui ")])))])])]))),128))])])]),o.value&&o.value.total>0?(d(),r("div",lt,[e("div",ot,[e("div",it,[e("div",dt," Menampilkan "+i(((p=o.value)==null?void 0:p.from)||0)+" sampai "+i(((g=o.value)==null?void 0:g.to)||0)+" dari "+i(((x=o.value)==null?void 0:x.total)||0)+" data ",1),e("div",nt,[t[41]||(t[41]=e("label",{class:"text-sm text-gray-700"},"Per halaman:",-1)),f(e("select",{"onUpdate:modelValue":t[6]||(t[6]=l=>o.value.per_page=l),onChange:t[7]||(t[7]=l=>q(o.value.per_page)),class:"px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},t[40]||(t[40]=[e("option",{value:"10"},"10",-1),e("option",{value:"15"},"15",-1),e("option",{value:"25"},"25",-1),e("option",{value:"50"},"50",-1),e("option",{value:"100"},"100",-1)]),544),[[w,o.value.per_page]])])]),e("div",rt,[e("button",{onClick:t[8]||(t[8]=l=>{var c;return b((((c=o.value)==null?void 0:c.current_page)||1)-1)}),disabled:(((L=o.value)==null?void 0:L.current_page)||1)<=1,class:"px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},t[42]||(t[42]=[e("i",{class:"fa-solid fa-chevron-left"},null,-1)]),8,ut),e("div",pt,[(((O=o.value)==null?void 0:O.current_page)||1)>3?(d(),r("button",{key:0,onClick:t[9]||(t[9]=l=>b(1)),class:"px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50"}," 1 ")):m("",!0),(((V=o.value)==null?void 0:V.current_page)||1)>4?(d(),r("span",gt,"...")):m("",!0),(d(!0),r(k,null,I(Q(),l=>{var c;return d(),r("button",{key:l,onClick:mt=>b(l),class:C(["px-3 py-1 text-sm border rounded",l===(((c=o.value)==null?void 0:c.current_page)||1)?"bg-blue-600 text-white border-blue-600":"border-gray-300 hover:bg-gray-50"])},i(l),11,ct)}),128)),(((j=o.value)==null?void 0:j.current_page)||1)<(((A=o.value)==null?void 0:A.last_page)||1)-3?(d(),r("span",vt,"...")):m("",!0),(((P=o.value)==null?void 0:P.current_page)||1)<(((R=o.value)==null?void 0:R.last_page)||1)-2?(d(),r("button",{key:3,onClick:t[10]||(t[10]=l=>{var c;return b(((c=o.value)==null?void 0:c.last_page)||1)}),class:"px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50"},i((($=o.value)==null?void 0:$.last_page)||1),1)):m("",!0)]),e("button",{onClick:t[11]||(t[11]=l=>{var c;return b((((c=o.value)==null?void 0:c.current_page)||1)+1)}),disabled:!((U=o.value)!=null&&U.has_more_pages),class:"px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},t[43]||(t[43]=[e("i",{class:"fa-solid fa-chevron-right"},null,-1)]),8,xt)])])])):m("",!0)])])])])]}),_:1}))}};export{Ct as default};
