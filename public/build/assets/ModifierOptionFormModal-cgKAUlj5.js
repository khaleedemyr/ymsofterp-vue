import{P,r as _,k as T,w as S,L as l,E as b,B as n,D as e,N as m,O as z,H as h,I as M,Q as c,F as w,M as k,J as B,G as I}from"./vendor-vue-g7iCcTkf.js";import{S as U}from"./app-CXnLHfhT.js";import{a as V}from"./vendor-utils-CpgP2uT4.js";import{_ as D}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-charts-CuqD4wLC.js";const H={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 transition-all"},J={class:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-auto p-0 animate-fade-in"},R={class:"px-8 pt-8 pb-2"},Q={class:"flex items-center gap-2 mb-6"},$={class:"text-2xl font-bold text-gray-900"},G=["value"],K={key:0,class:"text-xs text-red-500 mt-1"},W={key:0,class:"text-xs text-red-500 mt-1"},X={class:"mt-6"},Y={key:0,class:"text-gray-400 italic mb-2"},Z={key:1,class:"max-h-64 overflow-y-auto border border-gray-200 rounded-lg shadow-sm"},ee={class:"min-w-full text-sm"},te={class:"px-2 py-1"},oe=["onUpdate:modelValue"],se=["onUpdate:modelValue","onChange"],ie=["value"],ae={class:"px-2 py-1"},le=["onUpdate:modelValue"],ne={class:"px-2 py-1"},re=["onUpdate:modelValue"],de=["value"],ue={class:"px-2 py-1 text-center"},me=["onClick"],ce={class:"bg-gray-50 px-6 py-4 flex justify-end rounded-b-2xl"},fe=["disabled"],pe={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},be={__name:"ModifierOptionFormModal",props:{show:Boolean,mode:String,option:Object,modifiers:Array},emits:["close","success"],setup(p,{emit:O}){const d=p,y=O,a=P({modifier_id:"",name:"",modifier_bom_json:""}),r=_([]),g=_([]),v=T({}),f=_([]);async function j(){try{const s=await V.get("/api/items/for-modifier-bom");let t=[];Array.isArray(s.data)?t=s.data:Array.isArray(s.data.items)?t=s.data.items:Array.isArray(s.data.data)&&(t=s.data.data),g.value=t.map(o=>({id:o.id,name:o.name}))}catch{g.value=[]}}async function A(s){if(!s)return[];if(v[s])return v[s];const t=await V.get(`/api/items/${s}/detail`);return v[s]=t.data.item.units||[],v[s]}function N(){r.value.push({item_id:"",qty:"",unit_id:""})}function q(s){r.value.splice(s,1)}function F(){for(;f.value.length<r.value.length;)f.value.push("");for(;f.value.length>r.value.length;)f.value.pop()}S(r,F,{deep:!0});function E(s){const t=(f.value[s]||"").toLowerCase();return t?g.value.filter(o=>o.name.toLowerCase().includes(t)):g.value}S(()=>d.show,async s=>{if(s)if(await j(),d.mode==="edit"&&d.option)if(a.modifier_id=d.option.modifier_id,a.name=d.option.name,d.option.modifier_bom_json)try{r.value=JSON.parse(d.option.modifier_bom_json)}catch{r.value=[]}else r.value=[];else d.mode==="create"&&(a.modifier_id="",a.name="",r.value=[])});const u=_(!1);async function C(){u.value=!0,a.modifier_bom_json=JSON.stringify(r.value),d.mode==="create"?a.post(route("modifier-options.store"),{onSuccess:()=>{U.fire("Berhasil","Option berhasil ditambahkan!","success"),y("success"),y("close")},onError:()=>u.value=!1,onFinish:()=>u.value=!1}):d.mode==="edit"&&d.option&&a.put(route("modifier-options.update",d.option.id),{onSuccess:()=>{U.fire("Berhasil","Option berhasil diupdate!","success"),y("success"),y("close")},onError:()=>u.value=!1,onFinish:()=>u.value=!1})}function L(){y("close")}return(s,t)=>p.show?(n(),l("div",H,[e("div",J,[e("div",R,[e("div",Q,[t[2]||(t[2]=e("svg",{class:"w-7 h-7 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M16 7a4 4 0 01-8 0","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M12 3v4m0 0a4 4 0 01-4 4H4m8-4a4 4 0 014 4h4","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),e("h3",$,m(p.mode==="edit"?"Edit":"Tambah")+" Modifier Option",1)]),e("form",{onSubmit:z(C,["prevent"]),class:"space-y-5"},[e("div",null,[t[4]||(t[4]=e("label",{class:"block text-sm font-medium text-gray-700"},"Modifier",-1)),h(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>c(a).modifier_id=o),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500",required:""},[t[3]||(t[3]=e("option",{value:""},"Pilih Modifier",-1)),(n(!0),l(w,null,k(p.modifiers,o=>(n(),l("option",{key:o.id,value:o.id},m(o.name),9,G))),128))],512),[[M,c(a).modifier_id]]),c(a).errors.modifier_id?(n(),l("div",K,m(c(a).errors.modifier_id),1)):b("",!0)]),e("div",null,[t[5]||(t[5]=e("label",{class:"block text-sm font-medium text-gray-700"},"Nama Option",-1)),h(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>c(a).name=o),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500",required:"",maxlength:"100"},null,512),[[B,c(a).name]]),c(a).errors.name?(n(),l("div",W,m(c(a).errors.name),1)):b("",!0)]),e("div",X,[e("div",{class:"flex items-center gap-2 mb-2"},[t[6]||(t[6]=e("span",{class:"font-semibold text-gray-700"},"BOM Modifier (Potong Stok)",-1)),e("button",{type:"button",onClick:N,class:"ml-auto bg-blue-500 text-white px-3 py-1 rounded shadow hover:bg-blue-700 text-xs"},"+ Tambah Baris")]),r.value.length===0?(n(),l("div",Y,"Belum ada BOM")):b("",!0),r.value.length?(n(),l("div",Z,[e("table",ee,[t[10]||(t[10]=e("thead",{class:"sticky top-0 bg-blue-100 text-blue-900 z-10"},[e("tr",null,[e("th",{class:"px-2 py-1"},"Item"),e("th",{class:"px-2 py-1"},"Qty"),e("th",{class:"px-2 py-1"},"Unit"),e("th",{class:"px-2 py-1"})])],-1)),e("tbody",null,[(n(!0),l(w,null,k(r.value,(o,x)=>(n(),l("tr",{key:x,class:"bg-white border-b last:border-b-0"},[e("td",te,[h(e("input",{"onUpdate:modelValue":i=>f.value[x]=i,placeholder:"Cari item...",class:"w-full mb-1 rounded border-gray-200 px-2 py-1 text-xs"},null,8,oe),[[B,f.value[x]]]),h(e("select",{"onUpdate:modelValue":i=>o.item_id=i,class:"w-full rounded border-gray-300",onChange:async i=>{o.unit_id="",o.qty="",await A(o.item_id)}},[t[7]||(t[7]=e("option",{value:""},"Pilih Item",-1)),(n(!0),l(w,null,k(E(x),i=>(n(),l("option",{key:i.id,value:i.id},m(i.name),9,ie))),128))],40,se),[[M,o.item_id]])]),e("td",ae,[h(e("input",{"onUpdate:modelValue":i=>o.qty=i,type:"number",min:"0",step:"any",class:"w-20 rounded border-gray-300"},null,8,le),[[B,o.qty]])]),e("td",ne,[h(e("select",{"onUpdate:modelValue":i=>o.unit_id=i,class:"w-full rounded border-gray-300"},[t[8]||(t[8]=e("option",{value:""},"Pilih Unit",-1)),(n(!0),l(w,null,k(v[o.item_id]||[],i=>(n(),l("option",{key:i.id,value:i.id},m(i.name)+" ("+m(i.type)+")",9,de))),128))],8,re),[[M,o.unit_id]])]),e("td",ue,[e("button",{type:"button",onClick:i=>q(x),class:"text-red-500 hover:text-red-700"},t[9]||(t[9]=[e("i",{class:"fa fa-trash"},null,-1)]),8,me)])]))),128))])])])):b("",!0)])],32)]),e("div",ce,[e("button",{type:"button",onClick:L,class:"inline-flex items-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition sm:w-auto sm:text-sm mr-2"}," Batal "),e("button",{type:"button",onClick:C,disabled:u.value,class:"inline-flex items-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed"},[u.value?(n(),l("svg",pe,t[11]||(t[11]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):b("",!0),I(" "+m(u.value?p.mode==="edit"?"Menyimpan...":"Menambah...":p.mode==="edit"?"Simpan":"Tambah"),1)],8,fe)])])])):b("",!0)}},_e=D(be,[["__scopeId","data-v-e8ae594e"]]);export{_e as default};
