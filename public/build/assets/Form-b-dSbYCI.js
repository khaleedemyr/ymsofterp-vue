import{$ as le,c as T,r as v,w as C,A as oe,B as r,C as $,D as e,G as x,O as se,L as u,E as S,H as m,J as h,F as I,M as U,N as i,I as M,x as ne,Q as ie,l as G,Y as re,W as K}from"./vendor-vue-g7iCcTkf.js";import{A as ue}from"./AppLayout-BpSu8nlk.js";import{a as D}from"./vendor-utils-CpgP2uT4.js";import{S as w}from"./app-C7BJ3pFi.js";import{s as de}from"./vue-multiselect.esm-V-bx43V9.js";/* empty css                            */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-DDWCBsJM.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const pe={class:"min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 to-white py-12 px-4 md:px-8"},ce={class:"w-full max-w-4xl bg-white rounded-3xl shadow-3xl p-10 border border-green-100 transition-all duration-300 hover:shadow-4xl"},me={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ge=["disabled"],fe={key:0,value:""},ve=["value"],be=["disabled"],ye={value:""},xe=["value"],_e={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},he={class:"flex justify-between items-center"},we={class:"text-xs text-gray-500"},ke={key:0,class:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-xl"},Be={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Ce={class:"bg-white p-3 rounded-lg border border-yellow-200 shadow-sm"},Se={class:"font-semibold text-gray-800"},qe={class:"text-xs text-gray-500 mt-1"},Fe={class:"bg-white p-3 rounded-lg border border-yellow-200 shadow-sm"},Ve={class:"font-semibold text-green-600"},Te={class:"bg-white p-3 rounded-lg border border-yellow-200 shadow-sm"},Ie={class:"font-semibold text-blue-600"},Ue={class:"text-xs text-gray-500 mt-1"},De={class:"bg-white p-3 rounded-lg border border-yellow-200 shadow-sm"},Ee={class:"mt-2"},Ae={class:"flex justify-between text-xs mb-1"},Le={class:"w-full bg-gray-200 rounded-full h-2"},Me={key:0,class:"mt-3 p-3 bg-red-50 border border-red-200 rounded-lg"},Pe={class:"text-sm text-red-700 mt-1"},Oe={class:"overflow-x-auto"},je={class:"min-w-full divide-y divide-gray-200"},Re={class:"bg-white divide-y divide-gray-200"},Ne={class:"px-3 py-2 min-w-[200px]"},$e=["onUpdate:modelValue"],Ge={class:"px-3 py-2 min-w-[100px]"},Ke=["onUpdate:modelValue","onInput"],ze={class:"px-3 py-2 min-w-[100px]"},He=["onUpdate:modelValue"],Qe={class:"px-3 py-2 min-w-[150px]"},We=["onUpdate:modelValue","onInput"],Ye={class:"px-3 py-2 min-w-[150px] text-right"},Je={class:"px-3 py-2"},Xe=["onClick","disabled"],Ze={class:"px-3 py-2 text-right font-bold"},et={key:0,class:"flex flex-wrap gap-2 mt-2"},tt=["src"],at={key:1,class:"mb-4 p-4 rounded-xl bg-yellow-100 border border-yellow-300 text-yellow-800 shadow flex items-center gap-2 animate-pulse"},lt={class:"flex justify-end gap-2"},ot=["disabled"],st={key:0},nt={key:1},it={key:2},_t={__name:"Form",props:{outlets:Array,warehouse_outlets:Array,categoryBudgets:Array,suppliers:Array},setup(z){const b=z,H=le(),q=T(()=>{var o,t;return((t=(o=H.props.auth)==null?void 0:o.user)==null?void 0:t.id_outlet)||""});function P(){return{item_name:"",qty:"",unit:"",price:0,subtotal:0}}const Q=T(()=>q.value!=1),g=v(!1),F=v(0),W=T(()=>F.value+_.value>=5e5),s=v(null),k=v(b.categoryBudgets||[]),V=v(!1),a=v({transaction_date:new Date().toISOString().split("T")[0],outlet_id:q.value==1?"":q.value,category_budget_id:"",payment_method:"",supplier:null,notes:"",items:[P()]}),E=v([]),A=v([]);function Y(){a.value.items.push(P())}function J(o){a.value.items.length!==1&&a.value.items.splice(o,1)}function L(o){const t=a.value.items[o],l=parseFloat(t.qty)||0,p=parseFloat(t.price)||0;t.subtotal=l*p}const _=T(()=>a.value.items.reduce((o,t)=>{const l=parseFloat(t.qty)||0,p=parseFloat(t.price)||0,d=l*p;return o+d},0));function c(o){return o?"Rp "+Number(o).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2}):"Rp 0"}async function X(){if(!a.value.outlet_id||!a.value.transaction_date){F.value=0;return}try{const o=await D.get("/retail-non-food/daily-total",{params:{outlet_id:a.value.outlet_id,transaction_date:a.value.transaction_date}});F.value=o.data.total||0}catch{F.value=0}}async function Z(){if(!a.value.outlet_id){k.value=b.categoryBudgets.filter(o=>o.budget_type==="GLOBAL");return}V.value=!0;try{const o=await D.get("/retail-non-food/category-budgets",{params:{outlet_id:a.value.outlet_id}});o.data.success&&o.data.data&&(k.value=o.data.data,a.value.category_budget_id&&(k.value.find(l=>l.id==a.value.category_budget_id)||(a.value.category_budget_id="",s.value=null)))}catch(o){console.error("Error fetching category budgets:",o),k.value=b.categoryBudgets.filter(t=>t.budget_type==="GLOBAL")}finally{V.value=!1}}async function O(){if(!a.value.category_budget_id){s.value=null;return}try{const o=await D.post("/retail-non-food/get-budget-info",{category_budget_id:a.value.category_budget_id});s.value=o.data.budget_info}catch(o){console.error("Error fetching budget info:",o),s.value=null}}C([()=>a.value.outlet_id,()=>a.value.transaction_date,()=>a.value.items.map(o=>[o.qty,o.price])],X,{immediate:!0,deep:!0}),C(()=>a.value.outlet_id,(o,t)=>{t!==void 0&&o!==t&&(a.value.category_budget_id="",s.value=null),Z()},{immediate:!0}),C([()=>a.value.category_budget_id,()=>_.value],()=>{a.value.category_budget_id?O():s.value=null},{immediate:!0}),C(()=>a.value.items,()=>{a.value.items.forEach((o,t)=>{L(t)})},{deep:!0}),C(()=>a.value.payment_method,async o=>{if(o==="cash"&&b.suppliers){const t=b.suppliers.find(l=>l.name.toLowerCase().includes("cash supplier"));t&&(a.value.supplier=t)}});function ee(o){E.value=Array.from(o.target.files),A.value=E.value.map(t=>URL.createObjectURL(t))}async function te(){var t,l,p,d,j,R,N;if(!(g.value||!(await w.fire({title:"Simpan Data?",text:"Apakah Anda yakin ingin menyimpan transaksi ini?",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Simpan",cancelButtonText:"Batal",confirmButtonColor:"#2563eb",cancelButtonColor:"#6b7280",reverseButtons:!0})).isConfirmed)){if(!a.value.category_budget_id){g.value=!1,await w.fire({icon:"warning",title:"Category Diperlukan",text:"Silakan pilih Category Budget sebelum menyimpan data.",confirmButtonText:"OK",confirmButtonColor:"#F59E0B"});return}if(!a.value.payment_method){g.value=!1,await w.fire({icon:"warning",title:"Metode Pembayaran Diperlukan",text:"Silakan pilih Metode Pembayaran sebelum menyimpan data.",confirmButtonText:"OK",confirmButtonColor:"#F59E0B"});return}if(!a.value.supplier||!a.value.supplier.id){g.value=!1,await w.fire({icon:"warning",title:"Supplier Diperlukan",text:"Silakan pilih Supplier sebelum menyimpan data.",confirmButtonText:"OK",confirmButtonColor:"#F59E0B"});return}g.value=!0;try{const n=new FormData;n.append("outlet_id",a.value.outlet_id),n.append("transaction_date",a.value.transaction_date),n.append("category_budget_id",a.value.category_budget_id),n.append("payment_method",a.value.payment_method),n.append("supplier_id",a.value.supplier?a.value.supplier.id:""),n.append("notes",a.value.notes),a.value.items.forEach((y,B)=>{n.append(`items[${B}][item_name]`,y.item_name),n.append(`items[${B}][qty]`,parseFloat(y.qty)||0),n.append(`items[${B}][unit]`,y.unit),n.append(`items[${B}][price]`,parseFloat(y.price)||0)}),E.value.forEach((y,B)=>{n.append("invoices[]",y)});const f=await D.post("/retail-non-food",n,{headers:{"Content-Type":"multipart/form-data"}});f.data.message&&(await w.fire({icon:"success",title:"Berhasil",text:f.data.message,timer:1500,showConfirmButton:!1}),K.visit("/retail-non-food"))}catch(n){console.error("Error saving retail non food:",n),console.error("Error response:",n.response),console.error("Error data:",(t=n.response)==null?void 0:t.data);let f="Gagal menyimpan transaksi";(p=(l=n.response)==null?void 0:l.data)!=null&&p.message?f=n.response.data.message:(j=(d=n.response)==null?void 0:d.data)!=null&&j.error?f=n.response.data.error:n.message&&(f=n.message),(N=(R=n.response)==null?void 0:R.data)!=null&&N.errors&&(f=`Validasi gagal:
`+Object.values(n.response.data.errors).flat().join(`
`)),await w.fire({icon:"error",title:"Gagal",text:f,confirmButtonText:"OK",confirmButtonColor:"#EF4444"})}finally{g.value=!1}}}function ae(){K.visit("/retail-non-food")}return(o,t)=>(r(),oe(ue,null,{default:$(()=>[e("div",pe,[e("div",ce,[t[31]||(t[31]=e("h1",{class:"text-3xl font-extrabold mb-10 flex items-center gap-3 text-green-800 drop-shadow-lg"},[e("i",{class:"fa-solid fa-shopping-bag text-green-500 text-3xl"}),x(" Input Retail Non Food ")],-1)),e("form",{onSubmit:se(te,["prevent"]),class:"space-y-7"},[e("div",me,[e("div",null,[t[6]||(t[6]=e("label",{class:"block text-xs font-bold text-gray-600 mb-2"},"Tanggal",-1)),m(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=l=>a.value.transaction_date=l),class:"input input-bordered w-full shadow-inner rounded-xl focus:ring-2 focus:ring-green-300 transition-all duration-200",required:""},null,512),[[h,a.value.transaction_date]])]),e("div",null,[t[7]||(t[7]=e("label",{class:"block text-xs font-bold text-gray-600 mb-2"},"Outlet",-1)),m(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>a.value.outlet_id=l),disabled:Q.value,class:"input input-bordered w-full shadow-inner rounded-xl focus:ring-2 focus:ring-green-300 transition-all duration-200",required:""},[q.value==1?(r(),u("option",fe,"Pilih Outlet")):S("",!0),(r(!0),u(I,null,U(b.outlets,l=>(r(),u("option",{key:l.id_outlet,value:l.id_outlet},i(l.nama_outlet),9,ve))),128))],8,ge),[[M,a.value.outlet_id]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-xs font-bold text-gray-600 mb-2"},[x("Category Budget "),e("span",{class:"text-red-500 text-xs"},"*")],-1)),m(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>a.value.category_budget_id=l),onChange:O,disabled:V.value,class:"input input-bordered w-full shadow-inner rounded-xl focus:ring-2 focus:ring-green-300 transition-all duration-200",required:""},[e("option",ye,i(V.value?"Memuat...":"Pilih Category Budget"),1),(r(!0),u(I,null,U(k.value,l=>(r(),u("option",{key:l.id,value:l.id}," ["+i(l.division)+"] "+i(l.name),9,xe))),128))],40,be),[[M,a.value.category_budget_id]])])]),e("div",_e,[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-xs font-bold text-gray-600 mb-2"},"Metode Pembayaran",-1)),m(e("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>a.value.payment_method=l),class:"input input-bordered w-full shadow-inner rounded-xl focus:ring-2 focus:ring-green-300 transition-all duration-200",required:""},t[9]||(t[9]=[e("option",{value:""},"Pilih Metode Pembayaran",-1),e("option",{value:"cash"},"Cash",-1),e("option",{value:"contra_bon"},"Contra Bon",-1)]),512),[[M,a.value.payment_method]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-xs font-bold text-gray-600 mb-2"},"Supplier",-1)),ne(ie(de),{modelValue:a.value.supplier,"onUpdate:modelValue":t[4]||(t[4]=l=>a.value.supplier=l),options:b.suppliers,searchable:!0,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Pilih atau cari supplier...","track-by":"id",label:"name","preselect-first":!1,class:"w-full"},{option:$(({option:l})=>[e("div",he,[e("span",null,i(l.name),1),e("span",we,i(l.code),1)])]),_:1},8,["modelValue","options"])])]),s.value?(r(),u("div",ke,[t[18]||(t[18]=e("h3",{class:"text-lg font-semibold text-yellow-800 mb-3 flex items-center gap-2"},[e("i",{class:"fa-solid fa-chart-pie text-yellow-600"}),x(" Informasi Budget Category ")],-1)),e("div",Be,[e("div",Ce,[t[12]||(t[12]=e("div",{class:"text-sm text-gray-600 mb-1"},"Category",-1)),e("div",Se,i(s.value.category_name),1),e("div",qe,i(s.value.division)+" - "+i(s.value.subcategory),1)]),e("div",Fe,[t[13]||(t[13]=e("div",{class:"text-sm text-gray-600 mb-1"},"Budget Limit",-1)),e("div",Ve,i(c(s.value.budget_limit)),1)]),e("div",Te,[t[14]||(t[14]=e("div",{class:"text-sm text-gray-600 mb-1"},"Total Digunakan",-1)),e("div",Ie,i(c(s.value.total_used)),1),e("div",Ue," RNF: "+i(c(s.value.retail_non_food_used))+" | PR: "+i(c(s.value.purchase_requisition_used)),1)]),e("div",De,[t[16]||(t[16]=e("div",{class:"text-sm text-gray-600 mb-1"},"Sisa Budget",-1)),e("div",{class:G([s.value.remaining_budget>0?"text-green-600":"text-red-600","font-semibold"])},i(c(s.value.remaining_budget)),3),e("div",Ee,[e("div",Ae,[t[15]||(t[15]=e("span",null,"Penggunaan",-1)),e("span",null,i(s.value.budget_percentage)+"%",1)]),e("div",Le,[e("div",{class:G([s.value.budget_percentage>=90?"bg-red-500":s.value.budget_percentage>=70?"bg-yellow-500":"bg-green-500","h-2 rounded-full transition-all duration-300"]),style:re({width:Math.min(s.value.budget_percentage,100)+"%"})},null,6)])])])]),s.value.total_used+_.value>s.value.budget_limit?(r(),u("div",Me,[t[17]||(t[17]=e("div",{class:"flex items-center gap-2 text-red-800"},[e("i",{class:"fa fa-exclamation-triangle"}),e("span",{class:"font-semibold"},"Peringatan: Total transaksi ini akan melebihi budget limit!")],-1)),e("div",Pe," Total setelah transaksi: "+i(c(s.value.total_used+_.value))+" (Kelebihan: "+i(c(s.value.total_used+_.value-s.value.budget_limit))+") ",1)])):S("",!0)])):S("",!0),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Items",-1)),e("div",Oe,[e("table",je,[t[22]||(t[22]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Item"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Qty"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Unit"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Harga"),e("th",{class:"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase"},"Subtotal"),e("th",{class:"px-3 py-2"})])],-1)),e("tbody",Re,[(r(!0),u(I,null,U(a.value.items,(l,p)=>(r(),u("tr",{key:p},[e("td",Ne,[m(e("input",{type:"text","onUpdate:modelValue":d=>l.item_name=d,class:"input input-bordered w-full",required:"",placeholder:"Masukkan nama item..."},null,8,$e),[[h,l.item_name]])]),e("td",Ge,[m(e("input",{type:"number",min:"0.01",step:"0.01","onUpdate:modelValue":d=>l.qty=d,onInput:d=>L(p),class:"input input-bordered w-full",required:""},null,40,Ke),[[h,l.qty,void 0,{number:!0}]])]),e("td",ze,[m(e("input",{type:"text","onUpdate:modelValue":d=>l.unit=d,class:"input input-bordered w-full",required:"",placeholder:"pcs, kg, dll"},null,8,He),[[h,l.unit]])]),e("td",Qe,[m(e("input",{type:"number",min:"0",step:"0.01","onUpdate:modelValue":d=>l.price=d,onInput:d=>L(p),class:"input input-bordered w-full",required:""},null,40,We),[[h,l.price,void 0,{number:!0}]])]),e("td",Ye,i(c((parseFloat(l.qty)||0)*(parseFloat(l.price)||0))),1),e("td",Je,[e("button",{type:"button",onClick:d=>J(p),class:"text-red-500 hover:text-red-700",disabled:a.value.items.length===1},t[19]||(t[19]=[e("i",{class:"fa-solid fa-trash"},null,-1)]),8,Xe)])]))),128))]),e("tfoot",null,[e("tr",null,[t[20]||(t[20]=e("td",{colspan:"4",class:"px-3 py-2 text-right font-bold"},"Total:",-1)),e("td",Ze,i(c(_.value)),1),t[21]||(t[21]=e("td",null,null,-1))])])])]),e("div",{class:"mt-2"},[e("button",{type:"button",onClick:Y,class:"text-green-500 hover:text-green-700"},t[23]||(t[23]=[e("i",{class:"fa fa-plus mr-1"},null,-1),x(" Tambah Item ")]))])]),e("div",null,[t[25]||(t[25]=e("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Catatan",-1)),m(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=l=>a.value.notes=l),class:"input input-bordered w-full",rows:"3"},null,512),[[h,a.value.notes]])]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Upload Bon/Invoice (jpg/png, bisa lebih dari 1)",-1)),e("input",{type:"file",multiple:"",accept:"image/jpeg,image/png",onChange:ee},null,32),A.value.length?(r(),u("div",et,[(r(!0),u(I,null,U(A.value,(l,p)=>(r(),u("div",{key:p,class:"w-24 h-24 border rounded overflow-hidden flex items-center justify-center bg-gray-50"},[e("img",{src:l,class:"object-contain w-full h-full"},null,8,tt)]))),128))])):S("",!0)]),W.value?(r(),u("div",at,t[27]||(t[27]=[e("i",{class:"fa fa-triangle-exclamation text-xl"},null,-1),e("span",null,"Total transaksi retail non food outlet hari ini sudah melebihi Rp 500.000!",-1)]))):S("",!0),e("div",lt,[e("button",{type:"button",onClick:ae,class:"btn px-6 py-2 rounded-lg font-bold bg-gradient-to-r from-gray-200 to-gray-400 text-gray-700 shadow-md hover:from-gray-300 hover:to-gray-500 active:scale-95 transition-all"}," Batal "),e("button",{type:"submit",class:"btn px-6 py-2 rounded-lg font-bold bg-gradient-to-r from-green-500 to-green-700 text-white shadow-lg hover:from-green-600 hover:to-green-800 active:scale-95 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:g.value||!a.value.category_budget_id},[g.value?(r(),u("span",st,t[28]||(t[28]=[e("i",{class:"fa fa-spinner fa-spin"},null,-1),x(" Menyimpan...")]))):a.value.category_budget_id?(r(),u("span",it,t[30]||(t[30]=[e("i",{class:"fa fa-save"},null,-1),x(" Simpan")]))):(r(),u("span",nt,t[29]||(t[29]=[e("i",{class:"fa fa-exclamation-triangle"},null,-1),x(" Pilih Category Dulu")])))],8,ot)])],32)])])]),_:1}))}};export{_t as default};
