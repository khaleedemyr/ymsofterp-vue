import{c,r as _,w as J,A as Y,B as l,C as Z,D as a,L as n,E as g,G as C,N as i,H as E,J as ee,F as w,M as A,I as F,l as $}from"./vendor-vue-g7iCcTkf.js";import{A as te}from"./AppLayout-DQ4wNTsP.js";import{a as Q}from"./vendor-utils-CpgP2uT4.js";import"./app-DAB8i6cE.js";import"./vendor-charts-CuqD4wLC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-CinBCb2E.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const se={class:"w-full py-8 px-4"},ae={class:"flex justify-between items-center mb-6"},le=["disabled"],ne={key:0,class:"fas fa-spinner fa-spin"},ie={key:1,class:"fas fa-file-excel"},oe={class:"flex flex-col md:flex-row md:items-center gap-4 mb-4"},re={class:"flex items-center gap-2"},ue=["value"],de={class:"flex items-center gap-2"},pe=["value"],me={class:"bg-white rounded-xl shadow-lg overflow-hidden"},_e={class:"min-w-full divide-y divide-gray-200"},ye={class:"bg-white divide-y divide-gray-200"},ce={key:0},ge=["onClick"],xe={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},fe={class:"flex items-center gap-2"},he={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-700"},ve={class:"px-6 py-4 whitespace-nowrap text-sm text-right"},be={key:0},ke={key:0},we={key:1},$e={class:"px-6 py-4 whitespace-nowrap text-sm text-right"},De={key:0},Se={key:0},qe={key:1},Le={class:"px-6 py-4 whitespace-nowrap text-sm text-right"},Ce={key:0},Ae={key:0},Ie={key:1},Me={class:"px-6 py-4 whitespace-nowrap text-sm"},Ee={key:0,class:"bg-gray-50"},Ne={colspan:"6",class:"px-6 py-4"},Te={key:0,class:"text-center py-4"},Re={key:1,class:"overflow-x-auto"},je={class:"min-w-full divide-y divide-gray-200 text-sm"},Fe={class:"bg-white divide-y divide-gray-200"},Qe={key:0,class:"bg-yellow-50 font-semibold"},Ue={class:"px-4 py-2 text-gray-700"},Be={class:"px-4 py-2 text-right text-gray-700"},Pe={class:"px-4 py-2 text-gray-700"},Ve={class:"px-4 py-2 text-right text-gray-700"},Ke={class:"px-4 py-2 text-right text-gray-700"},We={class:"px-4 py-2 text-right text-gray-700"},Oe={class:"px-4 py-2 text-gray-700"},He={class:"px-4 py-2 text-gray-700"},Xe={key:2,class:"text-center py-4 text-gray-500 text-sm"},ze={key:0},Ge={key:1},Je={key:2},Ye={key:0,class:"flex justify-between items-center mt-4"},Ze={class:"text-sm text-gray-600"},et={class:"flex gap-1"},tt=["disabled"],st={class:"px-2"},at=["disabled"],yt={__name:"StockPosition",props:{stocks:Array,warehouses:Array,warehouse_outlets:Array},setup(U){const D=U,B=c(()=>Array.isArray(D.stocks)?D.stocks:[]),P=c(()=>Array.isArray(D.warehouses)?D.warehouses:[]),k=_(""),x=_(25),m=_(1),f=_(""),h=_(!1),v=_([]),u=_({}),S=_({}),q=_({}),b=c(()=>{let e=B.value;if(f.value&&(e=e.filter(t=>String(t.warehouse_id)===String(f.value))),!k.value)return e;const s=k.value.toLowerCase();return e.filter(t=>t.item_name&&t.item_name.toLowerCase().includes(s)||t.warehouse_name&&t.warehouse_name.toLowerCase().includes(s))}),L=c(()=>Math.ceil(b.value.length/x.value)||1),I=c(()=>(m.value-1)*x.value),N=c(()=>Math.min(I.value+x.value,b.value.length)),V=c(()=>b.value.slice(I.value,N.value));function K(){m.value>1&&m.value--}function W(){m.value<L.value&&m.value++}J([x,k],()=>{m.value=1});function M(e,s=0){return!e||Number(e)===0?"-":Number(e).toLocaleString("id-ID",{minimumFractionDigits:s,maximumFractionDigits:s})}async function O(){if(!h.value)try{h.value=!0;const e=new URLSearchParams;f.value&&e.append("warehouse_id",f.value);const s=await Q.get(route("inventory.stock-position.export"),{params:e,responseType:"blob"}),t=new Blob([s.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),r=window.URL.createObjectURL(t),d=document.createElement("a");d.href=r,d.download=`laporan_stok_akhir_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(r)}catch(e){console.error("Export error:",e),alert("Terjadi kesalahan saat export. Silakan coba lagi.")}finally{h.value=!1}}function o(e){return`${e.item_id}-${e.warehouse_id}`}async function H(e){const s=o(e),t=v.value.indexOf(s);t>-1?v.value.splice(t,1):(v.value.push(s),!u.value[s]&&!q.value[s]&&await X(e))}async function X(e){var t,r;const s=o(e);q.value[s]=!0;try{const d={item_id:e.item_id,warehouse_id:e.warehouse_id};console.log("Fetching item detail with params:",d);const y=await Q.get("/inventory/stock-card/detail",{params:d,withCredentials:!0,headers:{"X-Requested-With":"XMLHttpRequest"}});if(console.log("Response received:",y.data),y.data&&y.data.cards){const j=Array.isArray(y.data.cards)?y.data.cards:[];u.value={...u.value,[s]:j},y.data.saldo_awal&&(S.value={...S.value,[s]:y.data.saldo_awal}),console.log("Item details set for key:",s,"Count:",j.length)}else console.warn("No cards data in response:",y.data),u.value={...u.value,[s]:[]}}catch(d){console.error("Error fetching item detail:",d),console.error("Error response:",(t=d.response)==null?void 0:t.data),console.error("Error status:",(r=d.response)==null?void 0:r.status),u.value={...u.value,[s]:[]}}finally{q.value[s]=!1}}function T(e,s=null){if(s==="in"){const t=[];return e.in_qty_small>0&&t.push(`${p(e.in_qty_small)} ${e.small_unit_name||""}`),e.in_qty_medium>0&&t.push(`${p(e.in_qty_medium)} ${e.medium_unit_name||""}`),e.in_qty_large>0&&t.push(`${p(e.in_qty_large)} ${e.large_unit_name||""}`),t.length>0?t.join(" | "):"-"}else if(s==="out"){const t=[];return e.out_qty_small>0&&t.push(`${p(e.out_qty_small)} ${e.small_unit_name||""}`),e.out_qty_medium>0&&t.push(`${p(e.out_qty_medium)} ${e.medium_unit_name||""}`),e.out_qty_large>0&&t.push(`${p(e.out_qty_large)} ${e.large_unit_name||""}`),t.length>0?t.join(" | "):"-"}else return"-"}function R(e){if(!e)return"-";if(e.small!==void 0||e.medium!==void 0||e.large!==void 0){const t=[];return e.small!==void 0&&e.small!==null&&t.push(`${p(e.small)} ${e.small_unit_name||""}`),e.medium!==void 0&&e.medium!==null&&t.push(`${p(e.medium)} ${e.medium_unit_name||""}`),e.large!==void 0&&e.large!==null&&t.push(`${p(e.large)} ${e.large_unit_name||""}`),t.length>0?t.join(" | "):"-"}const s=[];return e.saldo_qty_small!==void 0&&e.saldo_qty_small!==null&&s.push(`${p(e.saldo_qty_small)} ${e.small_unit_name||""}`),e.saldo_qty_medium!==void 0&&e.saldo_qty_medium!==null&&s.push(`${p(e.saldo_qty_medium)} ${e.medium_unit_name||""}`),e.saldo_qty_large!==void 0&&e.saldo_qty_large!==null&&s.push(`${p(e.saldo_qty_large)} ${e.large_unit_name||""}`),s.length>0?s.join(" | "):"-"}function z(e){if(!e.reference_type)return"-";let s=e.reference_type;return e.reference_type==="good_receive"&&e.reference_number?s+=" #"+e.reference_number:e.reference_type==="warehouse_transfer"&&e.transfer_number?s+=" #"+e.transfer_number:e.reference_type==="delivery_order"&&e.do_number?s+=" #"+e.do_number:e.reference_id&&(s+=" #"+e.reference_id),s}function p(e){return e==null?"0":Number(e)%1===0?Number(e).toLocaleString("id-ID"):Number(e).toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:2})}function G(){const e=new Date,s=e.getFullYear(),t=e.getMonth();return new Date(s,t,1).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"})}return(e,s)=>(l(),Y(te,null,{default:Z(()=>[a("div",se,[a("div",ae,[s[3]||(s[3]=a("h1",{class:"text-2xl font-bold"},"Laporan Stok Akhir",-1)),a("button",{onClick:O,disabled:h.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors"},[h.value?(l(),n("i",ne)):(l(),n("i",ie)),C(" "+i(h.value?"Exporting...":"Export Excel"),1)],8,le)]),a("div",oe,[E(a("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>k.value=t),type:"text",placeholder:"Cari nama barang atau warehouse...",class:"px-4 py-2 border border-gray-300 rounded-lg w-full md:w-64 focus:ring-blue-500 focus:border-blue-500"},null,512),[[ee,k.value]]),a("div",re,[s[5]||(s[5]=a("label",{class:"text-sm"},"Warehouse",-1)),E(a("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>f.value=t),class:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500"},[s[4]||(s[4]=a("option",{value:""},"Semua Warehouse",-1)),(l(!0),n(w,null,A(P.value,t=>(l(),n("option",{key:t.id,value:t.id},i(t.name),9,ue))),128))],512),[[F,f.value]])]),a("div",de,[s[6]||(s[6]=a("label",{class:"text-sm"},"Tampilkan",-1)),E(a("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>x.value=t),class:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500"},[(l(),n(w,null,A([10,25,50,100],t=>a("option",{key:t,value:t},i(t),9,pe)),64))],512),[[F,x.value]]),s[7]||(s[7]=a("span",{class:"text-sm"},"data",-1))])]),a("div",me,[a("table",_e,[s[17]||(s[17]=a("thead",{class:"bg-gray-50"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Nama Barang"),a("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Warehouse"),a("th",{class:"px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider"},"Qty Small"),a("th",{class:"px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider"},"Qty Medium"),a("th",{class:"px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider"},"Qty Large"),a("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Tanggal Update")])],-1)),a("tbody",ye,[b.value.length?g("",!0):(l(),n("tr",ce,s[8]||(s[8]=[a("td",{colspan:"6",class:"text-center py-10 text-gray-400"},"Tidak ada data stok.",-1)]))),(l(!0),n(w,null,A(V.value,t=>(l(),n(w,{key:t.item_id+"-"+t.warehouse_id},[a("tr",{class:$(["hover:bg-gray-50 transition cursor-pointer",{"bg-blue-50":v.value.includes(o(t))}]),onClick:r=>H(t)},[a("td",xe,[a("div",fe,[a("i",{class:$(v.value.includes(o(t))?"fa-solid fa-chevron-down text-blue-600":"fa-solid fa-chevron-right text-gray-400")},null,2),a("span",null,i(t.item_name),1)])]),a("td",he,i(t.warehouse_name),1),a("td",ve,[t.display_small>0?(l(),n("span",be,[C(i(M(t.display_small))+" ",1),t.small_unit_name?(l(),n("span",ke,i(t.small_unit_name),1)):g("",!0)])):(l(),n("span",we,"-"))]),a("td",$e,[t.display_medium>0?(l(),n("span",De,[C(i(M(t.display_medium,2))+" ",1),t.medium_unit_name?(l(),n("span",Se,i(t.medium_unit_name),1)):g("",!0)])):(l(),n("span",qe,"-"))]),a("td",Le,[t.display_large>0?(l(),n("span",Ce,[C(i(M(t.display_large,2))+" ",1),t.large_unit_name?(l(),n("span",Ae,i(t.large_unit_name),1)):g("",!0)])):(l(),n("span",Ie,"-"))]),a("td",Me,i(t.updated_at?new Date(t.updated_at).toLocaleString():"-"),1)],10,ge),v.value.includes(o(t))?(l(),n("tr",Ee,[a("td",Ne,[q.value[o(t)]?(l(),n("div",Te,s[9]||(s[9]=[a("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},null,-1),a("p",{class:"mt-2 text-gray-600 text-sm"},"Memuat detail transaksi...",-1)]))):u.value[o(t)]&&Array.isArray(u.value[o(t)])&&u.value[o(t)].length>0?(l(),n("div",Re,[a("table",je,[s[14]||(s[14]=a("thead",{class:"bg-gray-100"},[a("tr",null,[a("th",{class:"px-4 py-2 text-left text-xs font-bold text-gray-700 uppercase"},"Tanggal"),a("th",{class:"px-4 py-2 text-right text-xs font-bold text-gray-700 uppercase"},"Masuk (Qty)"),a("th",{class:"px-4 py-2 text-right text-xs font-bold text-gray-700 uppercase"},"Keluar (Qty)"),a("th",{class:"px-4 py-2 text-right text-xs font-bold text-gray-700 uppercase"},"Saldo (Qty)"),a("th",{class:"px-4 py-2 text-left text-xs font-bold text-gray-700 uppercase"},"Referensi"),a("th",{class:"px-4 py-2 text-left text-xs font-bold text-gray-700 uppercase"},"Keterangan")])],-1)),a("tbody",Fe,[S.value[o(t)]?(l(),n("tr",Qe,[a("td",Ue,i(G()),1),s[10]||(s[10]=a("td",{class:"px-4 py-2 text-right text-gray-700"},"-",-1)),s[11]||(s[11]=a("td",{class:"px-4 py-2 text-right text-gray-700"},"-",-1)),a("td",Be,i(R(S.value[o(t)])),1),s[12]||(s[12]=a("td",{class:"px-4 py-2 text-gray-700"},"Saldo Awal Bulan",-1)),s[13]||(s[13]=a("td",{class:"px-4 py-2 text-gray-700"},"Saldo akhir bulan sebelumnya",-1))])):g("",!0),(l(!0),n(w,null,A(u.value[o(t)],(r,d)=>(l(),n("tr",{key:r.id,class:$(d===u.value[o(t)].length-1?"bg-yellow-200 font-bold":"hover:bg-gray-50")},[a("td",Pe,i(r.date?new Date(r.date).toLocaleDateString("id-ID"):"-"),1),a("td",Ve,i(T(r,"in")),1),a("td",Ke,i(T(r,"out")),1),a("td",We,i(R(r)),1),a("td",Oe,i(z(r)),1),a("td",He,i(r.description||"-"),1)],2))),128))])])])):(l(),n("div",Xe,[u.value[o(t)]===void 0?(l(),n("div",ze,s[15]||(s[15]=[a("p",null,"Memuat data...",-1)]))):u.value[o(t)]&&u.value[o(t)].length===0?(l(),n("div",Ge," Tidak ada data transaksi untuk item ini. ")):(l(),n("div",Je,s[16]||(s[16]=[a("p",null,"Data tidak tersedia.",-1)])))]))])])):g("",!0)],64))),128))])])]),b.value.length?(l(),n("div",Ye,[a("div",Ze," Menampilkan "+i(I.value+1)+" - "+i(N.value)+" dari "+i(b.value.length)+" data ",1),a("div",et,[a("button",{onClick:K,disabled:m.value===1,class:$(["px-3 py-1 rounded border text-sm",m.value===1?"bg-gray-200 text-gray-400":"bg-white text-blue-700 hover:bg-blue-50"])},"<",10,tt),a("span",st,"Halaman "+i(m.value)+" / "+i(L.value),1),a("button",{onClick:W,disabled:m.value===L.value,class:$(["px-3 py-1 rounded border text-sm",m.value===L.value?"bg-gray-200 text-gray-400":"bg-white text-blue-700 hover:bg-blue-50"])},">",10,at)])])):g("",!0)])]),_:1}))}};export{yt as default};
