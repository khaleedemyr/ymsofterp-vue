import{r as p,w as z,b as A,L as m,E as k,B as f,D as o,O as B,H as P,J as U,F as V,M as $,G as w,N as h}from"./vendor-vue-g7iCcTkf.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-utils-CpgP2uT4.js";const T={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40"},D={class:"bg-white rounded-lg shadow-lg w-full max-w-xl relative"},E={class:"p-4 pb-0"},R={class:"mb-3"},G={key:0,class:"bg-white border rounded shadow mt-1 max-h-40 overflow-y-auto z-20 absolute w-[90%]"},J=["onClick"],O={class:"font-semibold"},q={class:"text-sm mt-2"},H={class:"mt-1"},K={class:"font-mono"},Q={class:"font-mono"},W={key:0,class:"mt-1"},X={class:"font-mono"},Y="pick-map",Z={__name:"PickLocationMapModal",props:{show:Boolean,lat:[String,Number],long:[String,Number]},emits:["close","picked"],setup(x,{emit:M}){const n=x,y=M,r=p(n.lat||-6.2),d=p(n.long||106.8),l=p("");let a=null,v=null;const g=p(""),i=p([]);async function C(){if(g.value){i.value=[];try{const s=`https://nominatim.openstreetmap.org/search?format=jsonv2&q=${encodeURIComponent(g.value)}`,t=await(await fetch(s,{headers:{"Accept-Language":"id"}})).json();i.value=t}catch{i.value=[]}}}function F(s){const e=parseFloat(s.lat),t=parseFloat(s.lon);r.value=e.toFixed(8),d.value=t.toFixed(8),l.value=s.display_name,b(e,t),a&&a.setView([e,t],16),i.value=[]}function S(){return window.L.icon({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]})}async function L(s,e){l.value="";try{const t=`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${s}&lon=${e}`,u=await(await fetch(t,{headers:{"Accept-Language":"id"}})).json();l.value=u.display_name||""}catch{l.value=""}}function b(s,e){v?v.setLatLng([s,e]):v=window.L.marker([s,e],{icon:S(),draggable:!1}).addTo(a)}function _(){if(a)return;const s=n.lat&&!isNaN(Number(n.lat))?Number(n.lat):-6.2,e=n.long&&!isNaN(Number(n.long))?Number(n.long):106.8;r.value=s,d.value=e,a=window.L.map(Y).setView([s,e],13),window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(a),b(s,e),L(s,e),a.on("click",function(t){const{lat:c,lng:u}=t.latlng;r.value=c.toFixed(8),d.value=u.toFixed(8),b(c,u),L(c,u)})}function N(){a&&(a.remove(),a=null,v=null)}function j(){y("picked",{lat:r.value,long:d.value,alamat:l.value}),y("close")}return z(()=>n.show,s=>{s?setTimeout(()=>{if(window.L)_();else{const e=document.createElement("link");e.rel="stylesheet",e.href="https://unpkg.com/leaflet/dist/leaflet.css",document.head.appendChild(e);const t=document.createElement("script");t.src="https://unpkg.com/leaflet/dist/leaflet.js",t.onload=_,document.body.appendChild(t)}},100):N()}),A(()=>{N()}),(s,e)=>x.show?(f(),m("div",T,[o("div",D,[o("button",{onClick:e[0]||(e[0]=t=>s.$emit("close")),class:"absolute top-2 right-2 text-gray-500 hover:text-red-500 text-xl z-10"},e[2]||(e[2]=[o("i",{class:"fas fa-times"},null,-1)])),o("div",E,[e[8]||(e[8]=o("h2",{class:"text-lg font-bold mb-2"},"Pilih Lokasi di Peta",-1)),o("div",R,[o("form",{onSubmit:B(C,["prevent"]),class:"flex gap-2"},[P(o("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>g.value=t),type:"text",class:"form-input w-full",placeholder:"Cari alamat atau tempat..."},null,512),[[U,g.value]]),e[3]||(e[3]=o("button",{type:"submit",class:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700"},[o("i",{class:"fas fa-search"})],-1))],32),i.value.length?(f(),m("div",G,[(f(!0),m(V,null,$(i.value,t=>(f(),m("div",{key:t.place_id,onClick:c=>F(t),class:"px-3 py-2 cursor-pointer hover:bg-blue-50 text-sm border-b last:border-b-0"},[o("div",O,h(t.display_name),1)],8,J))),128))])):k("",!0)]),e[9]||(e[9]=o("div",{id:"pick-map",class:"w-full h-64 rounded mb-4"},null,-1)),o("div",q,[e[7]||(e[7]=o("div",{class:"font-semibold"},"Klik pada peta untuk memilih lokasi.",-1)),o("div",H,[e[4]||(e[4]=w("Latitude: ")),o("span",K,h(r.value),1)]),o("div",null,[e[5]||(e[5]=w("Longitude: ")),o("span",Q,h(d.value),1)]),l.value?(f(),m("div",W,[e[6]||(e[6]=w("Alamat: ")),o("span",X,h(l.value),1)])):k("",!0)]),o("div",{class:"flex justify-end mt-4"},[o("button",{onClick:j,class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"},"Pilih Lokasi Ini")])])])])):k("",!0)}},se=I(Z,[["__scopeId","data-v-c7be64ea"]]);export{se as default};
