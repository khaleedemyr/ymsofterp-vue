import{c as me,P as pe,r as h,w as J,a as ge,j as fe,A as Z,B as a,C as X,D as n,x as _e,G as k,N as u,O as ee,H as p,L as r,E as m,Q as d,J as f,F as y,M as v,I as C,Z as S,T as he,Y as ye,l as ve,W as B,n as F}from"./vendor-vue-g7iCcTkf.js";import{A as be}from"./AppLayout-DP-q1yH_.js";import{S as b}from"./app-BoyRvw0M.js";import{a as U}from"./vendor-utils-CpgP2uT4.js";import{_ as we}from"./Modal-BBL5yay4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-Cs9EnNrk.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const xe={class:"max-w-5xl w-full mx-auto py-8 px-2"},ke={class:"flex items-center gap-2 mb-6"},Ie={class:"text-2xl font-bold text-gray-800 flex items-center gap-2 ml-4"},De={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},qe={key:0,class:"text-xs text-red-500 mt-1"},Se=["value"],$e={key:0,class:"text-xs text-red-500 mt-1"},Ce=["disabled"],Be=["value"],Fe={key:0,class:"text-xs text-blue-500 mt-1"},Ue={key:1,class:"text-xs text-red-500 mt-1"},Te={key:0,class:"text-xs text-red-500 mt-1"},Ee={class:"overflow-x-auto"},Ve={class:"w-full min-w-full divide-y divide-gray-200"},Me={class:"px-3 py-2 min-w-[260px]"},Ne={class:"relative"},Ke=["id","onUpdate:modelValue","onInput","onFocus","onBlur","onKeydown"],Ae=["id"],Le=["id","onMousedown"],je={class:"font-medium"},Re={class:"text-xs text-gray-500"},We={class:"text-sm text-gray-600"},Pe={key:0,class:"absolute right-2 top-2"},ze={key:0,class:"text-xs text-red-500 mt-1"},Ge={key:1,class:"text-xs text-gray-500 mt-1"},Oe={class:"px-3 py-2 min-w-[100px]"},He=["onUpdate:modelValue"],Qe={key:0,class:"text-xs text-red-500 mt-1"},Ye={class:"px-3 py-2 min-w-[100px]"},Je=["onUpdate:modelValue","onChange"],Ze=["value"],Xe=["onUpdate:modelValue"],et={key:2,class:"text-xs text-red-500 mt-1"},tt={class:"px-3 py-2 min-w-[120px]"},st=["onUpdate:modelValue"],ot={class:"px-3 py-2 min-w-[120px]"},nt=["onUpdate:modelValue"],it={key:0,class:"text-xs text-red-500 mt-1"},lt={class:"px-3 py-2"},at=["onClick","disabled"],rt={class:"flex justify-end gap-2"},dt=["disabled"],ut={class:"p-4 min-w-[320px] max-w-[90vw]"},ct={key:0,class:"text-center py-8"},mt={key:1},pt={class:"mb-2"},gt={class:"mb-2"},ft={key:0},_t={key:1,class:"italic text-gray-400"},ht={class:"mb-2"},yt={key:0},vt={key:1,class:"italic text-gray-400"},bt={key:0,class:"mb-2"},wt={class:"flex flex-wrap gap-2 mt-1"},xt=["src"],kt={key:2,class:"text-red-500 text-center py-4"},Vt={__name:"Form",props:{prFood:Object,warehouses:Array,items:Array},setup(T){var W,P,z,G,O,H;const g=T,w=me(()=>!!g.prFood),o=pe({tanggal:(W=g.prFood)!=null&&W.tanggal?g.prFood.tanggal.substring(0,10):"",warehouse_id:((P=g.prFood)==null?void 0:P.warehouse_id)||"",warehouse_division_id:((z=g.prFood)==null?void 0:z.warehouse_division_id)||"",description:((G=g.prFood)==null?void 0:G.description)||"",items:((H=(O=g.prFood)==null?void 0:O.items)==null?void 0:H.map(t=>{var e;return{item_id:t.item_id,item_name:t.item_name||((e=t.item)==null?void 0:e.name)||"",qty:t.qty,unit:t.unit,note:t.note||"",arrival_date:t.arrival_date||"",suggestions:[],showDropdown:!1,loading:!1,highlightedIndex:-1,available_units:t.available_units||[],selected_unit:t.unit||"",_rowKey:Date.now()+"-"+Math.random()}}))||[{item_id:"",item_name:"",qty:"",unit:"",note:"",arrival_date:"",suggestions:[],showDropdown:!1,loading:!1,highlightedIndex:-1,available_units:[],selected_unit:"",_rowKey:Date.now()+"-"+Math.random()}]}),I=h([]),D=h(!1),x=h([]);J(()=>o.items.length,t=>{Array.isArray(x.value)||(x.value=[]),x.value.length=t}),J(()=>o.warehouse_id,t=>{o.items.forEach((e,s)=>{e.item_id&&t&&A(s)}),o.warehouse_division_id="",I.value=[],t&&E(t)});async function E(t){if(t){D.value=!0;try{const e=await U.get("/api/warehouse-divisions/by-warehouse",{params:{warehouse_id:t}});I.value=e.data}catch(e){console.error("Error fetching warehouse divisions:",e),I.value=[]}finally{D.value=!1}}}function te(){o.items.push({item_id:"",item_name:"",qty:"",unit:"",note:"",arrival_date:"",suggestions:[],showDropdown:!1,loading:!1,highlightedIndex:-1,available_units:[],selected_unit:"",_rowKey:Date.now()+"-"+Math.random()}),F(()=>{setTimeout(()=>{const t=o.items.length-1;x.value[t]&&x.value[t].focus()},0)})}function se(t){o.items.length!==1&&o.items.splice(t,1)}function oe(){b.fire({title:"Menyimpan Data...",text:"Mohon tunggu sebentar",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1,didOpen:()=>{b.showLoading()}}),w.value?o.put(route("pr-foods.update",g.prFood.id),{onSuccess:()=>{b.fire({icon:"success",title:"Berhasil!",text:"Data berhasil disimpan",timer:1500,showConfirmButton:!1}).then(()=>{B.visit("/pr-foods")})},onError:t=>{b.fire({icon:"error",title:"Gagal!",text:"Terjadi kesalahan saat menyimpan data"})}}):o.post(route("pr-foods.store"),{onSuccess:()=>{b.fire({icon:"success",title:"Berhasil!",text:"Data berhasil disimpan",timer:1500,showConfirmButton:!1}).then(()=>{B.visit("/pr-foods")})},onError:t=>{b.fire({icon:"error",title:"Gagal!",text:"Terjadi kesalahan saat menyimpan data"})}})}function V(){B.visit("/pr-foods")}async function ne(t,e){if(!e||e.length<2){o.items[t].suggestions=[],o.items[t].highlightedIndex=-1;return}o.items[t].loading=!0;try{const s=await U.get("/api/items/search-for-pr?q="+encodeURIComponent(e));o.items[t].suggestions=s.data.map(i=>({...i,available_units:[i.unit_small,i.unit_medium,i.unit_large].filter(Boolean),unit_small:i.unit_small,unit_medium:i.unit_medium,unit_large:i.unit_large,small_unit_id:i.small_unit_id,medium_unit_id:i.medium_unit_id,large_unit_id:i.large_unit_id})),o.items[t].showDropdown=!0,o.items[t].highlightedIndex=0}catch(s){console.error("Error fetching suggestions:",s),o.items[t].suggestions=[],o.items[t].highlightedIndex=-1}finally{o.items[t].loading=!1}}function M(t,e){o.items[t].item_id=e.id,o.items[t].item_name=e.name,o.items[t].unit=e.unit_small||e.unit||"",o.items[t].selected_unit=e.unit_small||e.unit||"",o.items[t].available_units=[e.unit_small,e.unit_medium,e.unit_large].filter(Boolean),o.items[t].suggestions=[],o.items[t].showDropdown=!1,o.items[t].highlightedIndex=-1,o.items[t].medium_conversion_qty=e.medium_conversion_qty,o.items[t].small_conversion_qty=e.small_conversion_qty,o.warehouse_id&&F(()=>{A(t)})}function N(t,e){const s=e.target.value;o.items[t].item_id="",o.items[t].item_name=s,o.items[t].showDropdown=!0,ne(t,s)}function ie(t){setTimeout(()=>{o.items[t].showDropdown=!1},200)}function q(t,e){const s=o.items[t];!s.showDropdown||!s.suggestions.length||(e.key==="ArrowDown"?(e.preventDefault(),s.highlightedIndex=(s.highlightedIndex+1)%s.suggestions.length,K(t)):e.key==="ArrowUp"?(e.preventDefault(),s.highlightedIndex=(s.highlightedIndex-1+s.suggestions.length)%s.suggestions.length,K(t)):e.key==="Enter"?(e.preventDefault(),s.highlightedIndex>=0&&s.suggestions[s.highlightedIndex]&&M(t,s.suggestions[s.highlightedIndex])):e.key==="Escape"&&(s.showDropdown=!1))}function K(t){F(()=>{const e=document.getElementById(`autocomplete-dropdown-${t}`),s=document.getElementById(`autocomplete-item-${t}-${o.items[t].highlightedIndex}`);if(e&&s){const i=e.getBoundingClientRect(),l=s.getBoundingClientRect();l.top<i.top?e.scrollTop-=i.top-l.top:l.bottom>i.bottom&&(e.scrollTop+=l.bottom-i.bottom)}})}function le(t,e){o.items[t].selected_unit=e.target.value,o.items[t].unit=e.target.value}function ae(t){const s=document.querySelectorAll('input[placeholder="Cari nama item..."]')[t];if(!s)return{};const i=s.getBoundingClientRect();return{left:i.left+"px",top:i.bottom+"px",width:i.width+"px",position:"fixed",zIndex:9999}}async function A(t){const e=o.items[t];if(!(!e.item_id||!o.warehouse_id))try{const s=await U.get("/api/inventory/stock",{params:{item_id:e.item_id,warehouse_id:o.warehouse_id}});if(console.log("Stock response:",s.data),e.stock=s.data,e.stock&&e.medium_conversion_qty&&e.small_conversion_qty){const i=Number(e.stock.qty_small||0),l=Number(e.small_conversion_qty||1),_=Number(e.medium_conversion_qty||1);console.log("Conversion values:",{small:i,mediumConv:l,largeConv:_});const Q=Math.floor(i/(l*_)),Y=i%(l*_),ue=Math.floor(Y/l),ce=Y%l;e.stock_display={qty_large:Q,qty_medium:ue,qty_small:ce},console.log("Converted stock:",e.stock_display)}else e.stock_display=null}catch(s){console.error("Error fetching stock:",s),e.stock={qty_small:0,qty_medium:0,qty_large:0},e.stock_display=null}}function $(t){return t==null?0:Number(t)%1===0?Number(t):Number(t).toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:2})}function re(t){return t.stock?`Stok: ${$(t.stock.qty_small)} ${t.stock.unit_small||""} | ${$(t.stock.qty_medium)} ${t.stock.unit_medium||""} | ${$(t.stock.qty_large)} ${t.stock.unit_large||""}`:"Stok: 0"}const L=h(!1),c=h({}),de=h(!1);function j(){L.value=!1,c.value={}}ge(()=>{if(window.addEventListener("keydown",R),!w.value&&!o.tanggal){const t=new Date,e=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");o.tanggal=`${e}-${s}-${i}`}w.value&&o.warehouse_id&&E(o.warehouse_id)}),fe(()=>{window.removeEventListener("keydown",R)});function R(t){if(t.key==="F1"){t.preventDefault(),console.log("F1 pressed!");const s=`item-input-${o.items.length-1}`,i=document.getElementById(s);i&&(i.focus(),i.select(),i.style.outline="2px solid #2563eb",i.style.boxShadow="0 0 0 2px rgba(37, 99, 235, 0.2)",setTimeout(()=>{i.style.outline="",i.style.boxShadow=""},1e3))}}return(t,e)=>(a(),Z(be,null,{default:X(()=>[n("div",xe,[n("div",ke,[n("button",{onClick:V,class:"text-blue-500 hover:underline"},e[4]||(e[4]=[n("i",{class:"fa fa-arrow-left"},null,-1),k(" Kembali")])),n("h1",Ie,[e[5]||(e[5]=n("i",{class:"fa-solid fa-file-invoice text-blue-500"},null,-1)),k(" "+u(w.value?"Edit":"Tambah")+" PR Foods ",1)])]),n("form",{onSubmit:ee(oe,["prevent"]),class:"space-y-6"},[n("div",De,[n("div",null,[e[6]||(e[6]=n("label",{class:"block text-sm font-medium text-gray-700"},"Tanggal",-1)),p(n("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=s=>d(o).tanggal=s),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500",required:""},null,512),[[f,d(o).tanggal]]),d(o).errors.tanggal?(a(),r("div",qe,u(d(o).errors.tanggal),1)):m("",!0)]),n("div",null,[e[8]||(e[8]=n("label",{class:"block text-sm font-medium text-gray-700"},"Warehouse",-1)),p(n("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>d(o).warehouse_id=s),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500",required:""},[e[7]||(e[7]=n("option",{value:""},"Pilih Warehouse",-1)),(a(!0),r(y,null,v(T.warehouses,s=>(a(),r("option",{key:s.id,value:s.id},u(s.name),9,Se))),128))],512),[[C,d(o).warehouse_id]]),d(o).errors.warehouse_id?(a(),r("div",$e,u(d(o).errors.warehouse_id),1)):m("",!0)]),n("div",null,[e[11]||(e[11]=n("label",{class:"block text-sm font-medium text-gray-700"},"Warehouse Division",-1)),p(n("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>d(o).warehouse_division_id=s),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500",disabled:!d(o).warehouse_id||D.value},[e[9]||(e[9]=n("option",{value:""},"Pilih Warehouse Division",-1)),(a(!0),r(y,null,v(I.value,s=>(a(),r("option",{key:s.id,value:s.id},u(s.name),9,Be))),128))],8,Ce),[[C,d(o).warehouse_division_id]]),D.value?(a(),r("div",Fe,e[10]||(e[10]=[n("i",{class:"fa fa-spinner fa-spin"},null,-1),k(" Loading divisions... ")]))):m("",!0),d(o).errors.warehouse_division_id?(a(),r("div",Ue,u(d(o).errors.warehouse_division_id),1)):m("",!0)])]),n("div",null,[e[12]||(e[12]=n("label",{class:"block text-sm font-medium text-gray-700"},"Keterangan",-1)),p(n("textarea",{"onUpdate:modelValue":e[3]||(e[3]=s=>d(o).description=s),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[f,d(o).description]]),d(o).errors.description?(a(),r("div",Te,u(d(o).errors.description),1)):m("",!0)]),n("div",null,[e[17]||(e[17]=n("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Detail Item",-1)),n("div",Ee,[n("table",Ve,[e[15]||(e[15]=n("thead",{class:"bg-gradient-to-r from-blue-50 to-blue-100"},[n("tr",null,[n("th",{class:"px-3 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Item"),n("th",{class:"px-3 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Qty"),n("th",{class:"px-3 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Unit"),n("th",{class:"px-3 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Note"),n("th",{class:"px-3 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Tgl Kedatangan"),n("th",{class:"px-3 py-2"})])],-1)),n("tbody",null,[(a(!0),r(y,null,v(d(o).items,(s,i)=>(a(),r("tr",{key:s._rowKey||i},[n("td",Me,[n("div",Ne,[p(n("input",{id:`item-input-${i}`,type:"text","onUpdate:modelValue":l=>s.item_name=l,onInput:l=>N(i,l),onFocus:l=>N(i,l),onBlur:l=>ie(i),onKeydown:[S(l=>q(i,l),["down"]),S(l=>q(i,l),["up"]),S(l=>q(i,l),["enter"]),S(l=>q(i,l),["esc"])],class:"w-full rounded border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:"",autocomplete:"off",placeholder:"Cari nama item..."},null,40,Ke),[[f,s.item_name]]),(a(),Z(he,{to:"body"},[s.showDropdown&&s.suggestions&&s.suggestions.length>0?(a(),r("div",{key:0,style:ye(ae(i)),id:`autocomplete-dropdown-${i}`,class:"fixed z-[9999] bg-white border border-blue-200 rounded shadow max-w-xs w-[260px] max-h-96 overflow-auto mt-1"},[(a(!0),r(y,null,v(s.suggestions,(l,_)=>(a(),r("div",{key:l.id,id:`autocomplete-item-${i}-${_}`,onMousedown:ee(Q=>M(i,l),["prevent"]),class:ve(["px-3 py-2 flex justify-between items-center cursor-pointer",s.highlightedIndex===_?"bg-blue-100":"hover:bg-blue-50"])},[n("div",null,[n("div",je,u(l.name),1),n("div",Re,u(l.sku),1)]),n("div",We,u(l.unit),1)],42,Le))),128))],12,Ae)):m("",!0)])),s.loading?(a(),r("div",Pe,e[13]||(e[13]=[n("i",{class:"fa fa-spinner fa-spin text-blue-400"},null,-1)]))):m("",!0)]),d(o).errors[`items.${i}.item_id`]?(a(),r("div",ze,u(d(o).errors[`items.${i}.item_id`]),1)):m("",!0),s.stock?(a(),r("div",Ge," Stok: "+u(re(s)),1)):m("",!0)]),n("td",Oe,[p(n("input",{type:"number",min:"0.01",step:"0.01","onUpdate:modelValue":l=>s.qty=l,class:"w-full rounded border-gray-300",required:""},null,8,He),[[f,s.qty]]),d(o).errors[`items.${i}.qty`]?(a(),r("div",Qe,u(d(o).errors[`items.${i}.qty`]),1)):m("",!0)]),n("td",Ye,[s.available_units&&s.available_units.length?p((a(),r("select",{key:0,"onUpdate:modelValue":l=>s.selected_unit=l,onChange:l=>le(i,l),class:"w-full rounded border-gray-300"},[(a(!0),r(y,null,v(s.available_units,l=>(a(),r("option",{key:l,value:l},u(l),9,Ze))),128))],40,Je)),[[C,s.selected_unit]]):p((a(),r("input",{key:1,type:"text","onUpdate:modelValue":l=>s.unit=l,class:"w-full rounded border-gray-300",required:""},null,8,Xe)),[[f,s.unit]]),d(o).errors[`items.${i}.unit`]?(a(),r("div",et,u(d(o).errors[`items.${i}.unit`]),1)):m("",!0)]),n("td",tt,[p(n("input",{type:"text","onUpdate:modelValue":l=>s.note=l,class:"w-full rounded border-gray-300"},null,8,st),[[f,s.note]])]),n("td",ot,[p(n("input",{type:"date","onUpdate:modelValue":l=>s.arrival_date=l,class:"w-full rounded border-gray-300"},null,8,nt),[[f,s.arrival_date]]),d(o).errors[`items.${i}.arrival_date`]?(a(),r("div",it,u(d(o).errors[`items.${i}.arrival_date`]),1)):m("",!0)]),n("td",lt,[n("button",{type:"button",onClick:l=>se(i),class:"text-red-500 hover:text-red-700",disabled:d(o).items.length===1},e[14]||(e[14]=[n("i",{class:"fa fa-trash"},null,-1)]),8,at)])]))),128))])])]),n("button",{type:"button",onClick:te,class:"mt-2 px-3 py-1 rounded bg-blue-100 text-blue-700 font-semibold hover:bg-blue-200"},e[16]||(e[16]=[n("i",{class:"fa fa-plus"},null,-1),k(" Tambah Item")]))]),n("div",rt,[n("button",{type:"button",onClick:V,class:"px-4 py-2 rounded bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300"},"Batal"),n("button",{type:"submit",disabled:d(o).processing,class:"px-4 py-2 rounded bg-blue-600 text-white font-semibold hover:bg-blue-700 disabled:opacity-50"},u(w.value?"Simpan Perubahan":"Simpan"),9,dt)])],32)]),_e(we,{show:L.value,onClose:j},{default:X(()=>[n("div",ut,[n("div",{class:"flex justify-between items-center mb-2"},[e[19]||(e[19]=n("h2",{class:"text-lg font-bold text-gray-700"},"Detail Item",-1)),n("button",{onClick:j,class:"text-gray-400 hover:text-gray-700"},e[18]||(e[18]=[n("i",{class:"fa fa-times"},null,-1)]))]),de.value?(a(),r("div",ct,e[20]||(e[20]=[n("i",{class:"fa fa-spinner fa-spin text-blue-400 text-2xl"},null,-1)]))):c.value&&!c.value.error?(a(),r("div",mt,[n("div",pt,[e[21]||(e[21]=n("span",{class:"font-semibold"},"Nama:",-1)),k(" "+u(c.value.name),1)]),n("div",gt,[e[22]||(e[22]=n("span",{class:"font-semibold"},"Deskripsi:",-1)),c.value.description?(a(),r("span",ft,u(c.value.description),1)):(a(),r("span",_t,"(Tidak ada deskripsi)"))]),n("div",ht,[e[23]||(e[23]=n("span",{class:"font-semibold"},"Spesifikasi:",-1)),c.value.specification?(a(),r("span",yt,u(c.value.specification),1)):(a(),r("span",vt,"(Tidak ada spesifikasi)"))]),c.value.images&&c.value.images.length?(a(),r("div",bt,[e[24]||(e[24]=n("span",{class:"font-semibold"},"Gambar:",-1)),n("div",wt,[(a(!0),r(y,null,v(c.value.images,s=>(a(),r("img",{key:s.id,src:s.path.startsWith("http")?s.path:"/storage/"+s.path,class:"w-24 h-24 object-contain border rounded bg-white"},null,8,xt))),128))])])):m("",!0)])):c.value&&c.value.error?(a(),r("div",kt,u(c.value.error),1)):m("",!0)])]),_:1},8,["show"])]),_:1}))}};export{Vt as default};
