import{c as x,r as D,A as P,B as s,C as L,D as e,L as a,E as l,G as d,N as i,l as y,F as v,M as B,x as I,Q as V,W as N}from"./vendor-vue-g7iCcTkf.js";import{A as E}from"./AppLayout-zB0hvXOw.js";import{S as b}from"./app-BgZdqVzD.js";import{a as $}from"./vendor-utils-CpgP2uT4.js";import{N as U}from"./vue-easy-lightbox.esm.min-H9agbAmC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-C4ea0y0B.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const q={class:"py-12"},T={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},H={class:"mb-4 flex justify-between items-center"},Q={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},z={class:"p-6 bg-white border-b border-gray-200"},K={class:"grid grid-cols-2 gap-4 mb-6"},J={class:"space-y-2"},X={key:0,class:"flex flex-wrap gap-1 mt-1"},Y={key:2,class:"mt-2"},Z={class:"flex flex-wrap gap-1 mt-1"},tt={key:3},et={class:"flex flex-wrap gap-1 mt-1"},nt={key:4,class:"mt-3 pt-3 border-t border-gray-200"},ot={key:0,class:"text-xs"},st={class:"font-semibold text-red-600"},at={key:1,class:"text-xs"},rt={class:"font-semibold text-red-600"},it={class:"text-xs mt-1"},lt={class:"font-semibold"},dt={class:"text-xs"},ut={class:"font-semibold text-green-600"},ct={class:"text-gray-600"},pt={key:0,class:"mb-4"},gt=["src"],mt={key:1,class:"mt-6"},ft={class:"bg-gray-50 p-4 rounded-lg"},bt={key:0},xt=["disabled"],yt={key:0,class:"animate-spin mr-2"},vt=["disabled"],Bt={key:0,class:"animate-spin mr-2"},kt={key:1},wt=["disabled"],_t={key:0,class:"animate-spin mr-2"},ht=["disabled"],Ft={key:0,class:"animate-spin mr-2"},Rt={class:"mt-6"},Ct={class:"space-y-4"},St={class:"bg-gray-50 p-4 rounded-lg"},At={key:0},jt={key:0},Dt={key:1},Nt={class:"bg-gray-50 p-4 rounded-lg"},$t={key:0},Gt={key:0},Mt={key:1},Wt={class:"mt-6"},Ot={class:"overflow-x-auto"},Pt={class:"min-w-full divide-y divide-gray-200"},Lt={class:"bg-gray-50"},It={key:0,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Vt={class:"bg-white divide-y divide-gray-200"},Et={class:"px-6 py-4 whitespace-nowrap"},Ut={class:"px-6 py-4 whitespace-nowrap"},qt={class:"px-6 py-4 whitespace-nowrap"},Tt={class:"px-6 py-4 whitespace-nowrap"},Ht={key:0,class:"px-6 py-4 whitespace-nowrap text-xs"},Qt={key:0,class:"text-red-600"},zt={key:0},Kt={key:1},Jt={key:1,class:"text-gray-400"},Xt={class:"px-6 py-4 whitespace-nowrap"},Yt={key:0},Zt={key:1},te={class:"px-6 py-4 whitespace-nowrap"},ee={class:"bg-gray-50"},ne=["colspan"],oe={class:"px-6 py-4 font-medium"},se={key:0},be={__name:"Show",props:{contraBon:{type:Object,required:!0},user:{type:Object,required:!0}},setup(n){const c=n,w=x(()=>{var r,t;return((r=c.user)==null?void 0:r.id_role)==="5af56935b011a"&&((t=c.user)==null?void 0:t.status)==="A"}),G=x(()=>{var t,u;return((t=c.user)==null?void 0:t.id_jabatan)==160&&((u=c.user)==null?void 0:u.status)=="A"||w.value}),_=x(()=>{var r,t;return(((r=c.user)==null?void 0:r.id_jabatan)===160&&((t=c.user)==null?void 0:t.status)==="A"||w.value)&&c.contraBon.status==="draft"&&!c.contraBon.finance_manager_approved_at}),h=x(()=>{var r,t,u,m;return(((r=c.user)==null?void 0:r.id_jabatan)===152&&((t=c.user)==null?void 0:t.status)==="A"||((u=c.user)==null?void 0:u.id_role)==="5af56935b011a"&&((m=c.user)==null?void 0:m.status)==="A")&&c.contraBon.status==="draft"&&c.contraBon.finance_manager_approved_at&&!c.contraBon.gm_finance_approved_at}),p=D(!1),k=D(!1),M=r=>r?new Date(r).toLocaleDateString("id-ID"):"-",F=r=>r?new Date(r).toLocaleString("id-ID"):"-",W=r=>{const t={draft:"bg-gray-100 text-gray-800",pending_gm_finance:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"};return`px-2 py-1 rounded-full text-xs font-medium ${t[r]||t.draft}`},f=r=>(typeof r!="number"&&(r=Number(r)||0),"Rp "+r.toLocaleString("id-ID")),O=(r,t)=>{if(!r)return"bg-gray-100 text-gray-800 border-gray-300";const u=String(r).toUpperCase();if(u.startsWith("PRF-"))return"bg-blue-100 text-blue-800 border-blue-300";if(u.startsWith("RWF"))return"bg-orange-100 text-orange-800 border-orange-300";if(u.startsWith("RF"))return"bg-purple-100 text-purple-800 border-purple-300";if(t&&t.length>0){if(t.includes("PR Foods"))return"bg-blue-100 text-blue-800 border-blue-300";if(t.includes("Warehouse Retail Food"))return"bg-orange-100 text-orange-800 border-orange-300";if(t.includes("Retail Food"))return"bg-purple-100 text-purple-800 border-purple-300";if(t.includes("RO Supplier"))return"bg-green-100 text-green-800 border-green-300"}return"bg-gray-100 text-gray-800 border-gray-300"};async function R(r){var u,m;const{value:t}=await b.fire({title:r?"Approve Contra Bon?":"Reject Contra Bon?",input:"textarea",inputLabel:"Catatan (opsional)",inputValue:"",showCancelButton:!0,confirmButtonText:r?"Approve":"Reject",cancelButtonText:"Batal"});if(t!==void 0){p.value=!0;try{const g=await $.post(route("contra-bons.approve",c.contraBon.id),{approved:r,note:t});p.value=!1,g.data.success?(await b.fire({icon:"success",title:"Berhasil",text:g.data.message}),N.reload()):b.fire("Gagal",g.data.message||"Terjadi kesalahan saat approve","error")}catch(g){p.value=!1,b.fire("Gagal",((m=(u=g.response)==null?void 0:u.data)==null?void 0:m.message)||"Terjadi kesalahan saat approve","error")}}}async function C(r){var u,m;const{value:t}=await b.fire({title:r?"Approve Contra Bon?":"Reject Contra Bon?",input:"textarea",inputLabel:"Catatan (opsional)",inputValue:"",showCancelButton:!0,confirmButtonText:r?"Approve":"Reject",cancelButtonText:"Batal"});if(t!==void 0){p.value=!0;try{const g=await $.post(route("contra-bons.approve",c.contraBon.id),{approved:r,note:t});p.value=!1,g.data.success?(await b.fire({icon:"success",title:"Berhasil",text:g.data.message}),N.reload()):b.fire("Gagal",g.data.message||"Terjadi kesalahan saat approve","error")}catch(g){p.value=!1,b.fire("Gagal",((m=(u=g.response)==null?void 0:u.data)==null?void 0:m.message)||"Terjadi kesalahan saat approve","error")}}}return(r,t)=>(s(),P(E,null,{default:L(()=>{var u,m,g,S;return[e("div",q,[e("div",T,[e("div",H,[e("button",{onClick:t[0]||(t[0]=o=>r.$inertia.visit("/contra-bons")),class:"text-blue-500 hover:underline"},t[8]||(t[8]=[e("i",{class:"fa fa-arrow-left"},null,-1),d(" Kembali")])),G.value?(s(),a("button",{key:0,onClick:t[1]||(t[1]=o=>r.$inertia.visit(`/contra-bons/${n.contraBon.id}/edit`)),class:"px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 font-semibold flex items-center gap-2"},t[9]||(t[9]=[e("i",{class:"fa fa-pencil-alt"},null,-1),d(" Edit ")]))):l("",!0)]),e("div",Q,[e("div",z,[t[53]||(t[53]=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight mb-6"}," Detail Contra Bon ",-1)),e("div",K,[e("div",null,[t[24]||(t[24]=e("h3",{class:"text-lg font-semibold mb-2"},"Informasi Contra Bon",-1)),e("div",J,[e("p",null,[t[10]||(t[10]=e("span",{class:"font-medium"},"Nomor:",-1)),d(" "+i(n.contraBon.number),1)]),e("p",null,[t[11]||(t[11]=e("span",{class:"font-medium"},"Tanggal:",-1)),d(" "+i(M(n.contraBon.date)),1)]),e("p",null,[t[12]||(t[12]=e("span",{class:"font-medium"},"No Invoice Supplier:",-1)),d(" "+i(n.contraBon.supplier_invoice_number||"-"),1)]),e("p",null,[t[13]||(t[13]=e("span",{class:"font-medium"},"Status:",-1)),e("span",{class:y(W(n.contraBon.status))},i(n.contraBon.status),3)]),e("p",null,[t[14]||(t[14]=e("span",{class:"font-medium"},"Supplier:",-1)),d(" "+i((u=n.contraBon.supplier)==null?void 0:u.name),1)]),e("p",null,[t[15]||(t[15]=e("span",{class:"font-medium"},"Dibuat oleh:",-1)),d(" "+i((m=n.contraBon.creator)==null?void 0:m.nama_lengkap),1)]),t[23]||(t[23]=e("p",null,[e("span",{class:"font-medium"},"Source Type:")],-1)),n.contraBon.source_types&&n.contraBon.source_types.length>0?(s(),a("div",X,[(s(!0),a(v,null,B(n.contraBon.source_types,o=>(s(),a("span",{key:o,class:y([{"bg-blue-100 text-blue-700 border border-blue-300":o==="PR Foods","bg-green-100 text-green-700 border border-green-300":o==="RO Supplier","bg-purple-100 text-purple-700 border border-purple-300":o==="Retail Food","bg-orange-100 text-orange-700 border border-orange-300":o==="Warehouse Retail Food","bg-gray-100 text-gray-700 border border-gray-300":o==="Unknown"},"px-2 py-1 rounded-full text-xs font-semibold"])},i(o==="PR Foods"?"PRF":o==="Retail Food"?"RF":o==="Warehouse Retail Food"?"RWF":o),3))),128))])):(s(),a("span",{key:1,class:y([{"bg-blue-100 text-blue-700":n.contraBon.source_type_display==="PR Foods","bg-green-100 text-green-700":n.contraBon.source_type_display==="RO Supplier","bg-purple-100 text-purple-700":n.contraBon.source_type_display==="Retail Food","bg-orange-100 text-orange-700":n.contraBon.source_type_display==="Warehouse Retail Food","bg-gray-100 text-gray-700":n.contraBon.source_type_display==="Unknown"},"px-2 py-1 rounded-full text-xs font-semibold inline-block mt-1"])},i(n.contraBon.source_type_display||(n.contraBon.source_type==="purchase_order"?"PO/GR":"Retail Food")),3)),n.contraBon.source_numbers&&n.contraBon.source_numbers.length>0?(s(),a("div",Y,[t[16]||(t[16]=e("p",null,[e("span",{class:"font-medium"},"Source Numbers:")],-1)),e("div",Z,[(s(!0),a(v,null,B(n.contraBon.source_numbers,o=>(s(),a("span",{key:o,class:y([O(o,n.contraBon.source_types),"text-xs px-2 py-1 rounded-full font-semibold border"])},i(o),3))),128))])])):l("",!0),n.contraBon.source_outlets&&n.contraBon.source_outlets.length>0?(s(),a("div",tt,[t[17]||(t[17]=e("p",null,[e("span",{class:"font-medium"},"Outlet:")],-1)),e("div",et,[(s(!0),a(v,null,B(n.contraBon.source_outlets,o=>(s(),a("span",{key:o,class:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full"},i(o),1))),128))])])):l("",!0),n.contraBon.po_discount_info&&(n.contraBon.po_discount_info.discount_total_percent>0||n.contraBon.po_discount_info.discount_total_amount>0)?(s(),a("div",nt,[t[22]||(t[22]=e("p",{class:"text-sm font-semibold text-blue-800 mb-1"},"Informasi Diskon PO:",-1)),n.contraBon.po_discount_info.discount_total_percent>0?(s(),a("div",ot,[t[18]||(t[18]=d(" Diskon Total: ")),e("span",st,i(n.contraBon.po_discount_info.discount_total_percent)+"%",1)])):l("",!0),n.contraBon.po_discount_info.discount_total_amount>0?(s(),a("div",at,[t[19]||(t[19]=d(" Diskon Total: ")),e("span",rt,i(f(n.contraBon.po_discount_info.discount_total_amount)),1)])):l("",!0),e("div",it,[t[20]||(t[20]=d(" Subtotal PO: ")),e("span",lt,i(f(n.contraBon.po_discount_info.subtotal)),1)]),e("div",dt,[t[21]||(t[21]=d(" Grand Total PO: ")),e("span",ut,i(f(n.contraBon.po_discount_info.grand_total)),1)])])):l("",!0)])]),e("div",null,[t[25]||(t[25]=e("h3",{class:"text-lg font-semibold mb-2"},"Catatan",-1)),e("p",ct,i(n.contraBon.notes||"-"),1)])]),n.contraBon.image_path?(s(),a("div",pt,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Scan/Foto Contra Bon Fisik",-1)),e("img",{src:`/storage/${n.contraBon.image_path}`,alt:"Scan Contra Bon",class:"max-w-xs rounded shadow cursor-pointer",onClick:t[2]||(t[2]=o=>k.value=!0)},null,8,gt),I(V(U),{visible:k.value,imgs:[`/storage/${n.contraBon.image_path}`],onHide:t[3]||(t[3]=o=>k.value=!1)},null,8,["visible","imgs"])])):l("",!0),_.value||h.value?(s(),a("div",mt,[t[35]||(t[35]=e("h3",{class:"text-lg font-semibold mb-4"},"Approval",-1)),e("div",ft,[_.value?(s(),a("div",bt,[e("button",{onClick:t[4]||(t[4]=o=>R(!0)),disabled:p.value,class:"px-4 py-2 rounded bg-green-600 text-white font-semibold hover:bg-green-700 mr-2 flex items-center"},[p.value?(s(),a("span",yt,t[27]||(t[27]=[e("i",{class:"fa fa-spinner"},null,-1)]))):l("",!0),t[28]||(t[28]=d(" Approve (Finance Manager) "))],8,xt),e("button",{onClick:t[5]||(t[5]=o=>R(!1)),disabled:p.value,class:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700 flex items-center"},[p.value?(s(),a("span",Bt,t[29]||(t[29]=[e("i",{class:"fa fa-spinner"},null,-1)]))):l("",!0),t[30]||(t[30]=d(" Reject "))],8,vt)])):l("",!0),h.value?(s(),a("div",kt,[e("button",{onClick:t[6]||(t[6]=o=>C(!0)),disabled:p.value,class:"px-4 py-2 rounded bg-green-600 text-white font-semibold hover:bg-green-700 mr-2 flex items-center"},[p.value?(s(),a("span",_t,t[31]||(t[31]=[e("i",{class:"fa fa-spinner"},null,-1)]))):l("",!0),t[32]||(t[32]=d(" Approve (GM Finance) "))],8,wt),e("button",{onClick:t[7]||(t[7]=o=>C(!1)),disabled:p.value,class:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700 flex items-center"},[p.value?(s(),a("span",Ft,t[33]||(t[33]=[e("i",{class:"fa fa-spinner"},null,-1)]))):l("",!0),t[34]||(t[34]=d(" Reject "))],8,ht)])):l("",!0)])])):l("",!0),e("div",Rt,[t[44]||(t[44]=e("h3",{class:"text-lg font-semibold mb-4"},"Riwayat Approval",-1)),e("div",Ct,[e("div",St,[t[39]||(t[39]=e("h4",{class:"font-medium mb-2"},"Finance Manager",-1)),n.contraBon.finance_manager_approved_at?(s(),a("div",At,[t[36]||(t[36]=e("span",{class:"text-green-600 font-semibold"},"Approved",-1)),t[37]||(t[37]=d(" oleh ")),e("b",null,i(((g=n.contraBon.finance_manager)==null?void 0:g.nama_lengkap)||n.contraBon.finance_manager_approved_by),1),d(" pada "+i(F(n.contraBon.finance_manager_approved_at))+" ",1),n.contraBon.finance_manager_note?(s(),a("span",jt,"- Note: "+i(n.contraBon.finance_manager_note),1)):l("",!0)])):(s(),a("div",Dt,t[38]||(t[38]=[e("span",{class:"text-gray-500"},"Belum di-approve",-1)])))]),e("div",Nt,[t[43]||(t[43]=e("h4",{class:"font-medium mb-2"},"GM Finance",-1)),n.contraBon.gm_finance_approved_at?(s(),a("div",$t,[t[40]||(t[40]=e("span",{class:"text-green-600 font-semibold"},"Approved",-1)),t[41]||(t[41]=d(" oleh ")),e("b",null,i(((S=n.contraBon.gm_finance)==null?void 0:S.nama_lengkap)||n.contraBon.gm_finance_approved_by),1),d(" pada "+i(F(n.contraBon.gm_finance_approved_at))+" ",1),n.contraBon.gm_finance_note?(s(),a("span",Gt,"- Note: "+i(n.contraBon.gm_finance_note),1)):l("",!0)])):(s(),a("div",Mt,t[42]||(t[42]=[e("span",{class:"text-gray-500"},"Belum di-approve",-1)])))])])]),e("div",Wt,[t[52]||(t[52]=e("h3",{class:"text-lg font-semibold mb-4"},"Daftar Item",-1)),e("div",Ot,[e("table",Pt,[e("thead",Lt,[e("tr",null,[t[45]||(t[45]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Item",-1)),t[46]||(t[46]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Qty",-1)),t[47]||(t[47]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Unit",-1)),t[48]||(t[48]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Harga",-1)),n.contraBon.source_type==="purchase_order"?(s(),a("th",It,"Diskon")):l("",!0),t[49]||(t[49]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total",-1)),t[50]||(t[50]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Notes",-1))])]),e("tbody",Vt,[(s(!0),a(v,null,B(n.contraBon.items,o=>{var A,j;return s(),a("tr",{key:o.id},[e("td",Et,i((A=o.item)==null?void 0:A.name),1),e("td",Ut,i(o.quantity),1),e("td",qt,i((j=o.unit)==null?void 0:j.name),1),e("td",Tt,i(f(o.price)),1),n.contraBon.source_type==="purchase_order"?(s(),a("td",Ht,[o.discount_percent>0||o.discount_amount>0?(s(),a("div",Qt,[o.discount_percent>0?(s(),a("div",zt,i(o.discount_percent)+"%",1)):l("",!0),o.discount_amount>0?(s(),a("div",Kt,i(f(o.discount_amount)),1)):l("",!0)])):(s(),a("span",Jt,"-"))])):l("",!0),e("td",Xt,[n.contraBon.source_type==="purchase_order"&&o.po_item_total?(s(),a("span",Yt,i(f(o.po_item_total)),1)):(s(),a("span",Zt,i(f(o.total)),1))]),e("td",te,i(o.notes||"-"),1)])}),128))]),e("tfoot",null,[e("tr",ee,[e("td",{colspan:n.contraBon.source_type==="purchase_order"?4:3,class:"px-6 py-4 text-right font-medium"},"Total:",8,ne),e("td",oe,i(f(n.contraBon.total_amount)),1),n.contraBon.source_type==="purchase_order"?(s(),a("td",se)):l("",!0),t[51]||(t[51]=e("td",null,null,-1))])])])])])])])])])]}),_:1}))}};export{be as default};
