import{r as v,c as F,w as L,a as G,j as Y,A as K,B as l,C as H,D as e,L as i,E as f,N as u,Y as X,l as k,F as z,M as O,H as Q,J as Z,a6 as A,G as ee,O as M,W as te}from"./vendor-vue-g7iCcTkf.js";import{A as ae}from"./AppLayout-zB0hvXOw.js";import{S as se}from"./app-BgZdqVzD.js";import"./vendor-utils-CpgP2uT4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-C4ea0y0B.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const ne={class:"max-w-4xl mx-auto"},le={class:"bg-white shadow-sm rounded-lg mb-6"},oe={class:"p-6"},ie={class:"flex justify-between items-start mb-4"},re={class:"text-2xl font-bold text-gray-900"},ue={class:"text-gray-600 mt-1"},de={class:"text-right"},ce={class:"text-lg font-semibold"},ge={class:"mb-4"},me={class:"flex justify-between text-sm text-gray-600 mb-2"},ve={class:"w-full bg-gray-200 rounded-full h-2"},fe={class:"bg-white shadow-sm rounded-lg mb-6"},be={class:"p-6"},xe={class:"flex justify-between items-center mb-6"},he={class:"flex items-center space-x-2"},pe={class:"text-sm text-gray-500"},ye={class:"mb-6"},we={class:"text-xl font-semibold text-gray-900 mb-4"},_e={class:"bg-gray-50 p-4 rounded-lg"},ke={class:"text-gray-800 leading-relaxed mb-4"},Qe={key:0,class:"mt-3"},Ie={class:"grid grid-cols-2 md:grid-cols-4 gap-2"},Te=["src","alt","onClick"],Ce={class:"mb-6"},$e={key:1,class:"space-y-3"},je=["onClick"],Se=["id","value"],Ae=["for"],Me={class:"flex items-start space-x-2"},Be={class:"font-medium text-gray-700"},De={class:"flex-1"},Ee={class:"text-gray-800"},Le={key:0,class:"ml-2"},ze=["src","alt","onClick"],Oe={key:2,class:"space-y-3"},Pe={class:"flex space-x-4"},Ue={class:"flex justify-between items-center"},Ve={class:"text-sm text-gray-500"},Ne={key:0},We={key:1},Re={class:"flex space-x-3"},Je=["disabled"],qe={key:0,class:"fa-solid fa-spinner fa-spin"},Fe={key:1,class:"fa-solid fa-arrow-right"},Ge={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ye={class:"bg-white rounded-lg p-6 max-w-md mx-4"},Ke={class:"flex justify-end"},He={class:"relative max-w-4xl max-h-full p-4"},Xe=["src","alt"],Ze={key:3,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-white bg-opacity-80 text-gray-800 px-3 py-1 rounded-full text-sm"},dt={__name:"TakeTest",props:{enrollTest:Object,testResult:Object,currentQuestion:Object,currentIndex:Number,totalQuestions:Number},setup(n){const s=n,h=v(!1),r=v(""),b=v(0),p=v(!1),c=v(null),y=v(null),I=v(!1),m=v([]),g=v(0);F(()=>s.currentIndex+1===s.totalQuestions);function P(a){const t=Math.floor(a/60),d=a%60;return`${t}:${d.toString().padStart(2,"0")}`}function U(a){return{essay:"Essay",pilihan_ganda:"Pilihan Ganda",yes_no:"Ya/Tidak"}[a]||"Unknown"}function V(){if(s.currentQuestion.tipe_soal==="pilihan_ganda"){const a={};return s.currentQuestion.pilihan_a&&(a.A=s.currentQuestion.pilihan_a),s.currentQuestion.pilihan_b&&(a.B=s.currentQuestion.pilihan_b),s.currentQuestion.pilihan_c&&(a.C=s.currentQuestion.pilihan_c),s.currentQuestion.pilihan_d&&(a.D=s.currentQuestion.pilihan_d),a}return{}}function T(a){return{A:s.currentQuestion.pilihan_a_gambar,B:s.currentQuestion.pilihan_b_gambar,C:s.currentQuestion.pilihan_c_gambar,D:s.currentQuestion.pilihan_d_gambar}[a]}function w(a){return a?`/storage/${a.replace(/\\/g,"/")}`:""}function C(a){if(!a.pertanyaan_gambar)return[];try{return Array.isArray(a.pertanyaan_gambar)?a.pertanyaan_gambar:typeof a.pertanyaan_gambar=="string"?JSON.parse(a.pertanyaan_gambar):[]}catch(t){return console.error("Error parsing pertanyaan_gambar:",t),[]}}function B(a,t){m.value=a,g.value=t,I.value=!0}function D(){I.value=!1,m.value=[],g.value=0}function N(){g.value>0&&g.value--}function W(){g.value<m.value.length-1&&g.value++}function $(a){r.value=a,x()}function j(){c.value&&(clearInterval(c.value),c.value=null),b.value=s.currentQuestion.waktu_detik||180,y.value=Date.now(),p.value=!1,console.log(`Starting timer for question ${s.currentIndex+1}: ${b.value} seconds`),c.value=setInterval(()=>{b.value--,b.value===30&&!p.value&&(p.value=!0,console.log("Timer warning: 30 seconds left")),b.value<=0&&(clearInterval(c.value),c.value=null,console.log("Timer expired, auto moving to next question"),x(),E(!0))},1e3)}function x(){localStorage.setItem(`answer_${s.testResult.id}_${s.currentQuestion.id}`,r.value)}function E(a=!1){if(h.value)return;h.value=!0;const t=y.value?Math.floor((Date.now()-y.value)/1e3):0;c.value&&(clearInterval(c.value),c.value=null),b.value=0,p.value=!1,y.value=null;const d={answer:r.value,time_taken:t};a&&(d.auto_next=!0),a&&console.log("Waktu habis, otomatis pindah ke soal berikutnya..."),r.value="",localStorage.removeItem(`answer_${s.testResult.id}_${s.currentQuestion.id}`),te.post(route("enroll-test.next",s.enrollTest.id),d,{onSuccess:o=>{},onError:o=>{console.error("Error:",o),se.fire({icon:"error",title:"Error",text:"Terjadi kesalahan: "+(o.message||"Unknown error"),confirmButtonText:"OK"}),h.value=!1},onFinish:()=>{h.value=!1}})}function S(){const a=localStorage.getItem(`answer_${s.testResult.id}_${s.currentQuestion.id}`);a?r.value=a:r.value="",x()}function R(){window.addEventListener("beforeunload",a=>{a.preventDefault(),a.returnValue=""}),window.addEventListener("popstate",a=>{a.preventDefault(),window.history.pushState(null,"",window.location.href)})}function J(){Object.keys(localStorage).forEach(t=>{t.startsWith(`answer_${s.testResult.id}_`)&&localStorage.removeItem(t)})}return L(()=>s.currentQuestion,(a,t)=>{a&&a.id!==(t==null?void 0:t.id)&&(console.log("Question changed, restarting timer"),j(),S())},{immediate:!1}),L(()=>s.currentIndex,(a,t)=>{a!==t&&(console.log("Question index changed, restarting timer"),j(),S())},{immediate:!1}),G(()=>{console.log("TakeTest component mounted for question:",s.currentIndex+1),S(),j(),R(),window.history.pushState(null,"",window.location.href)}),Y(()=>{console.log("TakeTest component unmounting, clearing timer"),c.value&&(clearInterval(c.value),c.value=null),J()}),(a,t)=>(l(),K(ae,{title:"Take Test"},{default:H(()=>[e("div",ne,[e("div",le,[e("div",oe,[e("div",ie,[e("div",null,[e("h1",re,u(n.enrollTest.master_soal.judul),1),e("p",ue,u(n.enrollTest.master_soal.deskripsi),1)]),e("div",de,[t[8]||(t[8]=e("div",{class:"text-sm text-gray-500"},"Percobaan",-1)),e("div",ce,u(n.enrollTest.current_attempt)+"/"+u(n.enrollTest.max_attempts),1)])]),e("div",ge,[e("div",me,[e("span",null,"Soal "+u(n.currentIndex+1)+" dari "+u(n.totalQuestions),1),e("span",null,u(Math.round((n.currentIndex+1)/n.totalQuestions*100))+"%",1)]),e("div",ve,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:X({width:(n.currentIndex+1)/n.totalQuestions*100+"%"})},null,4)])])])]),e("div",fe,[e("div",be,[e("div",xe,[e("div",he,[t[9]||(t[9]=e("i",{class:"fa-solid fa-clock text-gray-500"},null,-1)),t[10]||(t[10]=e("span",{class:"text-sm text-gray-600"},"Waktu tersisa:",-1)),e("div",{class:k(["text-lg font-mono font-bold",b.value<=30?"text-red-600":"text-gray-900"])},u(P(b.value)),3)]),e("div",pe," Soal "+u(n.currentIndex+1)+" dari "+u(n.totalQuestions),1)]),e("div",ye,[e("h2",we," Soal "+u(n.currentIndex+1)+" - "+u(U(n.currentQuestion.tipe_soal)),1),e("div",_e,[e("p",ke,u(n.currentQuestion.pertanyaan),1),C(n.currentQuestion).length>0?(l(),i("div",Qe,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Gambar Pertanyaan ",-1)),e("div",Ie,[(l(!0),i(z,null,O(C(n.currentQuestion),(d,o)=>(l(),i("div",{key:o,class:"bg-white rounded border p-2"},[e("img",{src:w(d),alt:`Pertanyaan ${n.currentIndex+1} - Image ${o+1}`,class:"w-full h-20 object-cover rounded cursor-pointer hover:opacity-80 transition",onClick:_=>B(C(n.currentQuestion).map(q=>w(q)),o)},null,8,Te)]))),128))])])):f("",!0)])]),e("div",Ce,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Jawaban Anda: ",-1)),n.currentQuestion.tipe_soal==="essay"?Q((l(),i("textarea",{key:0,"onUpdate:modelValue":t[0]||(t[0]=d=>r.value=d),rows:"6",class:"w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Tulis jawaban Anda di sini...",onInput:x},null,544)),[[Z,r.value]]):n.currentQuestion.tipe_soal==="pilihan_ganda"?(l(),i("div",$e,[(l(!0),i(z,null,O(V(),(d,o)=>(l(),i("div",{key:o,class:k(["flex items-start space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",{"bg-blue-50 border-blue-300":r.value===o}]),onClick:_=>$(o)},[Q(e("input",{type:"radio",id:`option-${o}`,value:o,"onUpdate:modelValue":t[1]||(t[1]=_=>r.value=_),class:"mt-1 text-blue-600 focus:ring-blue-500",onChange:x},null,40,Se),[[A,r.value]]),e("label",{for:`option-${o}`,class:"flex-1 cursor-pointer"},[e("div",Me,[e("span",Be,u(o)+".",1),e("div",De,[e("span",Ee,u(d),1),T(o)?(l(),i("div",Le,[e("img",{src:w(T(o)),alt:`Pilihan ${o}`,class:"w-12 h-12 object-cover rounded border cursor-pointer hover:opacity-80 transition",onClick:_=>B([w(T(o))],0)},null,8,ze)])):f("",!0)])])],8,Ae)],10,je))),128))])):n.currentQuestion.tipe_soal==="yes_no"?(l(),i("div",Oe,[e("div",Pe,[e("label",{class:k(["flex items-center space-x-2 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",{"bg-green-50 border-green-300":r.value==="yes"}]),onClick:t[3]||(t[3]=d=>$("yes"))},[Q(e("input",{type:"radio",value:"yes","onUpdate:modelValue":t[2]||(t[2]=d=>r.value=d),class:"text-green-600 focus:ring-green-500",onChange:x},null,544),[[A,r.value]]),t[12]||(t[12]=e("span",{class:"text-gray-800 font-medium"},"Ya",-1))],2),e("label",{class:k(["flex items-center space-x-2 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",{"bg-red-50 border-red-300":r.value==="no"}]),onClick:t[5]||(t[5]=d=>$("no"))},[Q(e("input",{type:"radio",value:"no","onUpdate:modelValue":t[4]||(t[4]=d=>r.value=d),class:"text-red-600 focus:ring-red-500",onChange:x},null,544),[[A,r.value]]),t[13]||(t[13]=e("span",{class:"text-gray-800 font-medium"},"Tidak",-1))],2)])])):f("",!0)]),e("div",Ue,[e("div",Ve,[r.value.trim()?(l(),i("span",Ne,"Jawaban tersimpan")):(l(),i("span",We,"Belum dijawab"))]),e("div",Re,[e("button",{onClick:E,disabled:h.value,class:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-6 py-2 rounded-lg flex items-center gap-2"},[h.value?(l(),i("i",qe)):(l(),i("i",Fe)),ee(" "+u(n.currentIndex+1===n.totalQuestions?"Selesai":"Lanjut"),1)],8,Je)])])])]),p.value?(l(),i("div",Ge,[e("div",Ye,[t[15]||(t[15]=e("div",{class:"flex items-center mb-4"},[e("i",{class:"fa-solid fa-exclamation-triangle text-yellow-500 text-xl mr-3"}),e("h3",{class:"text-lg font-semibold"},"Peringatan")],-1)),t[16]||(t[16]=e("p",{class:"text-gray-600 mb-4"}," Waktu untuk soal ini akan segera habis. Jawaban akan otomatis disimpan dan pindah ke soal berikutnya. ",-1)),e("div",Ke,[e("button",{onClick:t[6]||(t[6]=d=>p.value=!1),class:"bg-blue-600 text-white px-4 py-2 rounded-lg"}," OK ")])])])):f("",!0)]),I.value?(l(),i("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:D},[e("div",He,[e("button",{onClick:D,class:"absolute top-4 right-4 z-10 bg-white bg-opacity-80 hover:bg-opacity-100 text-gray-800 rounded-full w-10 h-10 flex items-center justify-center transition"},t[17]||(t[17]=[e("i",{class:"fa-solid fa-times"},null,-1)])),m.value.length>1&&g.value>0?(l(),i("button",{key:0,onClick:M(N,["stop"]),class:"absolute left-4 top-1/2 transform -translate-y-1/2 z-10 bg-white bg-opacity-80 hover:bg-opacity-100 text-gray-800 rounded-full w-10 h-10 flex items-center justify-center transition"},t[18]||(t[18]=[e("i",{class:"fa-solid fa-chevron-left"},null,-1)]))):f("",!0),m.value.length>1&&g.value<m.value.length-1?(l(),i("button",{key:1,onClick:M(W,["stop"]),class:"absolute right-4 top-1/2 transform -translate-y-1/2 z-10 bg-white bg-opacity-80 hover:bg-opacity-100 text-gray-800 rounded-full w-10 h-10 flex items-center justify-center transition"},t[19]||(t[19]=[e("i",{class:"fa-solid fa-chevron-right"},null,-1)]))):f("",!0),m.value[g.value]?(l(),i("img",{key:2,src:m.value[g.value],alt:`Image ${g.value+1}`,class:"max-w-full max-h-full object-contain rounded-lg",onClick:t[7]||(t[7]=M(()=>{},["stop"]))},null,8,Xe)):f("",!0),m.value.length>1?(l(),i("div",Ze,u(g.value+1)+" / "+u(m.value.length),1)):f("",!0)])])):f("",!0)]),_:1}))}};export{dt as default};
