import{P as q,r as f,a as K,A as H,B as n,C as S,D as t,x as j,G as h,Q as i,S as F,O as z,H as w,L as r,E as v,F as V,M as A,N as u,I as P,J as O}from"./vendor-vue-g7iCcTkf.js";import{A as G}from"./AppLayout-BqYoiRQJ.js";import{s as J}from"./vue-multiselect.esm-V-bx43V9.js";/* empty css                            */import{a as R}from"./vendor-utils-CpgP2uT4.js";import{S as x}from"./app-D7xoXxxM.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-Sbw2UVT4.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const Q={class:"w-full py-8 px-4"},W={class:"flex justify-between items-center mb-6"},X={class:"bg-white rounded-xl shadow-lg p-6"},Y={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},Z=["disabled"],ee=["value"],te={key:0,class:"mt-1 text-xs text-gray-500"},oe={slot:"option","slot-scope":"props"},le={class:"flex flex-col"},se={class:"font-medium"},ae={class:"text-xs text-gray-500"},ne={key:0,class:"mt-1 text-xs text-gray-500"},ie={key:1,class:"mt-1 text-xs text-yellow-600"},re={class:"mb-6"},de={class:"mb-6"},ue={class:"mb-4"},pe={class:"relative"},me={key:0,class:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto"},ce=["onClick"],ve={class:"font-medium"},ge={class:"text-sm text-gray-600"},ye={key:0,class:"text-xs text-blue-600 font-medium"},fe={key:0,class:"space-y-2"},be={class:"flex items-center space-x-3"},xe={class:"flex items-center space-x-2"},_e=["onClick"],ke=["onClick"],he={class:"flex items-center space-x-2"},we={class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Se={class:"font-medium"},Ee={class:"text-sm text-gray-600"},je={key:0,class:"text-xs text-blue-600 font-medium"},Ve=["onClick"],Ae={class:"flex justify-end space-x-4"},Oe=["disabled"],Ce={key:0},$e={key:1},Ke={__name:"Edit",props:{resignation:Object,outlets:Array,employees:Array,userOutletId:{type:Number,default:null},canSelectOutlet:{type:Boolean,default:!0}},setup(E){const a=E,l=q({outlet_id:a.resignation.outlet_id||"",employee_id:a.resignation.employee_id||null,resignation_date:a.resignation.resignation_date?a.resignation.resignation_date.split(" ")[0]:"",resignation_type:a.resignation.resignation_type||"",notes:a.resignation.notes||"",approvers:a.resignation.approval_flows?a.resignation.approval_flows.map(s=>{var e,o,d,c;return{id:(e=s.approver)==null?void 0:e.id,nama_lengkap:(o=s.approver)==null?void 0:o.nama_lengkap,email:(d=s.approver)==null?void 0:d.email,jabatan:(c=s.approver)==null?void 0:c.jabatan}}).sort((s,e)=>{const o=a.resignation.approval_flows.find(c=>{var k;return((k=c.approver)==null?void 0:k.id)===s.id}),d=a.resignation.approval_flows.find(c=>{var k;return((k=c.approver)==null?void 0:k.id)===e.id});return((o==null?void 0:o.approval_level)||0)-((d==null?void 0:d.approval_level)||0)}):[]}),_=f(a.employees||[]),p=f([]),m=f(null),y=f(""),g=f([]),b=f(!1),C=f(!1);K(()=>{if(p.value=_.value.map(s=>({id:s.id,name:`${s.nama_lengkap} (${s.nik})`,nik:s.nik,nama_lengkap:s.nama_lengkap})),l.employee_id){const s=p.value.find(e=>e.id===l.employee_id);s&&(m.value=s)}!a.canSelectOutlet&&a.userOutletId&&a.outlets.length>0&&(l.outlet_id=a.outlets[0].id_outlet)});const U=async()=>{if(!l.outlet_id){_.value=[],p.value=[],m.value=null,l.employee_id=null;return}try{const s=await R.get("/employee-resignations/get-employees",{params:{outlet_id:l.outlet_id}});if(_.value=s.data.employees||[],p.value=_.value.map(e=>({id:e.id,name:`${e.nama_lengkap} (${e.nik})`,nik:e.nik,nama_lengkap:e.nama_lengkap})),l.employee_id){const e=p.value.find(o=>o.id===l.employee_id);e?m.value=e:(m.value=null,l.employee_id=null)}}catch(s){console.error("Failed to load employees:",s),_.value=[],p.value=[],m.value=null,l.employee_id=null}},T=s=>{l.employee_id=s.id},B=()=>{l.employee_id=null,m.value=null},M=()=>{y.value.length>=2?$(y.value):(b.value=!1,g.value=[])},$=async(s="")=>{if(s.length<2){g.value=[],b.value=!1;return}try{const e=await R.get("/employee-resignations/approvers",{params:{search:s}});g.value=e.data.approvers||[],b.value=g.value.length>0}catch(e){console.error("Failed to load approvers:",e),g.value=[],b.value=!1}},D=s=>{l.approvers.find(e=>e.id===s.id)||l.approvers.push(s),y.value="",b.value=!1,g.value=[]},I=s=>{l.approvers.splice(s,1)},N=(s,e)=>{const o=l.approvers.splice(s,1)[0];l.approvers.splice(e,0,o)},L=()=>{if(!l.outlet_id){x.fire({icon:"error",title:"Validation Error",text:"Please select an outlet"});return}if(!m.value||!l.employee_id){x.fire({icon:"error",title:"Validation Error",text:"Please select an employee"});return}if(!l.resignation_date){x.fire({icon:"error",title:"Validation Error",text:"Please select resignation date"});return}if(!l.resignation_type){x.fire({icon:"error",title:"Validation Error",text:"Please select resignation type"});return}l.put(`/employee-resignations/${a.resignation.id}`,{onSuccess:()=>{x.fire({icon:"success",title:"Success!",text:"Employee resignation updated successfully!",confirmButtonText:"OK"})},onError:s=>{console.error("Failed to update resignation:",s),x.fire({icon:"error",title:"Error",text:s.message||"Failed to update employee resignation"})}})};return(s,e)=>(n(),H(G,{title:"Edit Employee Resignation"},{default:S(()=>[t("div",Q,[t("div",W,[e[8]||(e[8]=t("h1",{class:"text-2xl font-bold text-gray-800 flex items-center gap-2"},[t("i",{class:"fa-solid fa-user-minus text-red-500"}),h(" Edit Employee Resignation ")],-1)),j(i(F),{href:`/employee-resignations/${E.resignation.id}`,class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"},{default:S(()=>e[7]||(e[7]=[t("i",{class:"fas fa-arrow-left mr-2"},null,-1),h(" Back to Detail ")])),_:1},8,["href"])]),t("div",X,[t("form",{onSubmit:z(L,["prevent"])},[t("div",Y,[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Outlet *",-1)),w(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>i(l).outlet_id=o),required:"",onChange:U,disabled:!a.canSelectOutlet,class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed"},[e[9]||(e[9]=t("option",{value:""},"Select Outlet",-1)),(n(!0),r(V,null,A(a.outlets,o=>(n(),r("option",{key:o.id_outlet,value:o.id_outlet},u(o.nama_outlet),9,ee))),128))],40,Z),[[P,i(l).outlet_id]]),a.canSelectOutlet?v("",!0):(n(),r("p",te," Outlet otomatis dipilih sesuai outlet Anda "))]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Nama Karyawan *",-1)),j(i(J),{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=o=>m.value=o),options:p.value,searchable:!0,"clear-on-select":!1,"close-on-select":!0,"show-labels":!1,disabled:!i(l).outlet_id||p.value.length===0,"track-by":"id",label:"name",placeholder:"Pilih karyawan...",onSelect:T,onRemove:B,class:"w-full"},{default:S(()=>[t("template",oe,[t("div",le,[t("div",se,u(a.option.name),1),t("div",ae,u(a.option.nik),1)])])]),_:1},8,["modelValue","options","disabled"]),i(l).outlet_id?v("",!0):(n(),r("p",ne," Pilih outlet terlebih dahulu ")),i(l).outlet_id&&p.value.length===0?(n(),r("p",ie," Tidak ada karyawan aktif di outlet ini ")):v("",!0)]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tanggal Resign *",-1)),w(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>i(l).resignation_date=o),type:"date",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[O,i(l).resignation_date]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tipe Resign *",-1)),w(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>i(l).resignation_type=o),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},e[13]||(e[13]=[t("option",{value:""},"Select Type",-1),t("option",{value:"prosedural"},"Prosedural",-1),t("option",{value:"non_prosedural"},"Non Prosedural",-1)]),512),[[P,i(l).resignation_type]])])]),t("div",re,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Notes",-1)),w(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=o=>i(l).notes=o),rows:"4",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter notes about the resignation..."},null,512),[[O,i(l).notes]])]),t("div",de,[e[20]||(e[20]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Approval Flow",-1)),e[21]||(e[21]=t("p",{class:"text-sm text-gray-600 mb-4"},"Add approvers in order from lowest to highest level. The first approver will be the lowest level, and the last approver will be the highest level.",-1)),t("div",ue,[t("div",pe,[w(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>y.value=o),type:"text",placeholder:"Search users by name, email, or NIK...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",onFocus:e[6]||(e[6]=o=>y.value.length>=2&&$(y.value)),onInput:M},null,544),[[O,y.value]]),b.value&&g.value.length>0?(n(),r("div",me,[(n(!0),r(V,null,A(g.value,o=>(n(),r("div",{key:o.id,onClick:d=>D(o),class:"px-3 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-200 last:border-b-0"},[t("div",ve,u(o.nama_lengkap),1),t("div",ge,u(o.email),1),o.jabatan?(n(),r("div",ye,u(typeof o.jabatan=="object"?o.jabatan.nama_jabatan||"":o.jabatan),1)):v("",!0)],8,ce))),128))])):v("",!0)])]),i(l).approvers.length>0?(n(),r("div",fe,[e[19]||(e[19]=t("h4",{class:"font-medium text-gray-700"},"Approval Order (Lowest to Highest):",-1)),(n(!0),r(V,null,A(i(l).approvers,(o,d)=>(n(),r("div",{key:o.id,class:"flex items-center justify-between p-3 rounded-md bg-gray-50 border border-gray-200"},[t("div",be,[t("div",xe,[d>0?(n(),r("button",{key:0,onClick:c=>N(d,d-1),type:"button",class:"p-1 text-gray-500 hover:text-gray-700",title:"Move Up"},e[16]||(e[16]=[t("i",{class:"fa fa-arrow-up"},null,-1)]),8,_e)):v("",!0),d<i(l).approvers.length-1?(n(),r("button",{key:1,onClick:c=>N(d,d+1),type:"button",class:"p-1 text-gray-500 hover:text-gray-700",title:"Move Down"},e[17]||(e[17]=[t("i",{class:"fa fa-arrow-down"},null,-1)]),8,ke)):v("",!0)]),t("div",he,[t("span",we," Level "+u(d+1),1),t("div",null,[t("div",Se,u(o.nama_lengkap),1),t("div",Ee,u(o.email),1),o.jabatan?(n(),r("div",je,u(typeof o.jabatan=="object"?o.jabatan.nama_jabatan||"":o.jabatan),1)):v("",!0)])])]),t("button",{onClick:c=>I(d),type:"button",class:"p-1 text-red-500 hover:text-red-700",title:"Remove Approver"},e[18]||(e[18]=[t("i",{class:"fa fa-times"},null,-1)]),8,Ve)]))),128))])):v("",!0)]),t("div",Ae,[j(i(F),{href:`/employee-resignations/${E.resignation.id}`,class:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"},{default:S(()=>e[22]||(e[22]=[h(" Cancel ")])),_:1},8,["href"]),t("button",{type:"submit",disabled:C.value,class:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"},[C.value?(n(),r("span",Ce,e[23]||(e[23]=[t("i",{class:"fa fa-spinner fa-spin mr-2"},null,-1),h(" Updating... ")]))):(n(),r("span",$e,e[24]||(e[24]=[t("i",{class:"fa fa-save mr-2"},null,-1),h(" Update Resignation ")])))],8,Oe)])],32)])])]),_:1}))}};export{Ke as default};
