import{$ as Q,c as j,r as i,A as Y,B as r,C as X,D as e,L as u,E as Z,N as v,O as ee,H as m,F as x,M as k,I as te,J as b,V as oe,Q as ae,G as se,W as w}from"./vendor-vue-g7iCcTkf.js";import{A as le}from"./AppLayout-PZ6hJL3l.js";import{S as P}from"./app-HnvVj7H8.js";import"./vendor-utils-CpgP2uT4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-BAmbAIMe.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const ne={class:"py-8 px-2 md:px-8 lg:px-16"},re={class:"text-2xl font-bold text-blue-700 mb-6"},ie={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ue=["value"],ce={class:"md:col-span-2"},de=["value"],pe={class:"overflow-x-auto w-full"},me={class:"table-auto w-full min-w-[900px] border mb-4"},he={class:"border px-2 py-1"},fe=["rowspan"],ve={key:1,style:{display:"none"}},ge={class:"border px-2 py-1"},be={class:"border px-2 py-1 text-center"},ye=["onUpdate:modelValue"],_e={class:"border px-2 py-1"},xe=["onUpdate:modelValue"],ke={class:"border px-2 py-1"},we=["onUpdate:modelValue"],Ce={class:"border px-2 py-1"},Ue={class:"flex flex-col gap-1"},Ve=["capture","onChange"],$e=["onClick"],Be={class:"flex flex-wrap gap-1 mt-1"},Ae=["src"],Ee=["onClick"],Fe={class:"border px-2 py-1"},Me=["onUpdate:modelValue"],Se={class:"flex gap-2 justify-end mt-8"},je=["disabled"],Pe={key:0},Te={key:1},Re={key:0,class:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50"},De={class:"bg-white p-4 rounded shadow-lg relative flex flex-col items-center"},Qe={__name:"Form",setup(Le){var A,E,F,M;const c=Q(),C=j(()=>c.props.isEdit),T=i(c.props.outlets||[]),R=i(c.props.template||[]),d=i(c.props.checklist||null),D=/Android|iPhone|iPad|iPod/i.test(navigator.userAgent),n=i({outlet_id:((A=d.value)==null?void 0:A.outlet_id)||"",visit_date:((E=d.value)==null?void 0:E.visit_date)||"",items:((M=(F=d.value)==null?void 0:F.items)==null?void 0:M.map(o=>({...o,checked:!!o.checked,photos:o.photos?o.photos.map(t=>t.photo_path):[]})))||R.value.map(([o,t,a])=>({no:o,category:t,checklist_point:a,checked:!1,actual_condition:"",action:"",remarks:"",photos:[]}))}),y=i(!1),U=i(null),g=i(null),V=i(null),p=i(null),_=i("environment"),h=i(!1);function L(o){U.value=o,y.value=!0,$()}function $(){p.value&&(p.value.getTracks().forEach(o=>o.stop()),p.value=null),navigator.mediaDevices.getUserMedia({video:{facingMode:_.value}}).then(o=>{p.value=o,g.value.srcObject=o,g.value.play()})}function O(){_.value=_.value==="environment"?"user":"environment",$()}function N(){const o=g.value,t=V.value;t.width=o.videoWidth,t.height=o.videoHeight,t.getContext("2d").drawImage(o,0,0),t.toBlob(a=>{n.value.items[U.value].photos.push(new File([a],`photo_${Date.now()}.png`,{type:"image/png"})),B()})}function B(){y.value=!1,p.value&&(p.value.getTracks().forEach(o=>o.stop()),p.value=null)}function I(o,t){n.value.items[o].photos.splice(t,1)}function q(o,t){const a=Array.from(o.target.files);n.value.items[t].photos||(n.value.items[t].photos=[]),a.forEach(l=>{n.value.items[t].photos.push(l)})}function W(o){return typeof o=="string"?`/storage/${o}`:URL.createObjectURL(o)}function G(o){return o===0?!0:n.value.items[o].category!==n.value.items[o-1].category}function H(o){return n.value.items.filter(t=>t.category===o).length}async function K(){if(!(await P.fire({title:"Simpan Checklist?",text:"Apakah Anda yakin ingin menyimpan data checklist ini?",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Simpan",cancelButtonText:"Batal"})).isConfirmed)return;h.value=!0;const t=new FormData;t.append("outlet_id",n.value.outlet_id),t.append("visit_date",n.value.visit_date),n.value.items.forEach((l,s)=>{t.append(`items[${s}][no]`,l.no),t.append(`items[${s}][category]`,l.category),t.append(`items[${s}][checklist_point]`,l.checklist_point),t.append(`items[${s}][checked]`,l.checked?1:0),t.append(`items[${s}][actual_condition]`,l.actual_condition||""),t.append(`items[${s}][action]`,l.action||""),t.append(`items[${s}][remarks]`,l.remarks||""),l.photos&&l.photos.length&&l.photos.forEach((f,S)=>{typeof f!="string"&&t.append(`items[${s}][photos][${S}]`,f)})});const a={forceFormData:!0,onError:()=>{h.value=!1,P.fire("Gagal","Terjadi kesalahan saat menyimpan data.","error")},onFinish:()=>{h.value=!1}};C.value?w.post(route("marketing-visit-checklist.update",d.value.id),t,a):w.post(route("marketing-visit-checklist.store"),t,a)}function z(){w.get(route("marketing-visit-checklist.index"))}const J=j(()=>d.value&&d.value.user?d.value.user.nama_lengkap||d.value.user.name||"-":c.props.auth&&c.props.auth.user&&(c.props.auth.user.nama_lengkap||c.props.auth.user.name)||"-");return(o,t)=>(r(),Y(le,null,{default:X(()=>[e("div",ne,[e("h1",re,v(C.value?"Edit Checklist":"Tambah Checklist"),1),e("form",{onSubmit:ee(K,["prevent"]),enctype:"multipart/form-data",class:"space-y-5 bg-white rounded-2xl shadow-xl p-4 md:p-8"},[e("div",ie,[e("div",null,[t[3]||(t[3]=e("label",{class:"block text-sm font-medium text-gray-700"},"Outlet",-1)),m(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>n.value.outlet_id=a),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500",required:""},[t[2]||(t[2]=e("option",{value:""},"Pilih Outlet",-1)),(r(!0),u(x,null,k(T.value,a=>(r(),u("option",{key:a.id||a.id_outlet,value:a.id||a.id_outlet},v(a.name||a.nama_outlet),9,ue))),128))],512),[[te,n.value.outlet_id]])]),e("div",null,[t[4]||(t[4]=e("label",{class:"block text-sm font-medium text-gray-700"},"Tanggal Kunjungan",-1)),m(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=a=>n.value.visit_date=a),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500",required:""},null,512),[[b,n.value.visit_date]])]),e("div",ce,[t[5]||(t[5]=e("label",{class:"block text-sm font-medium text-gray-700"},"User Input",-1)),e("input",{type:"text",value:J.value,class:"mt-1 block w-full rounded-lg border-gray-200 bg-gray-100 text-gray-700",readonly:""},null,8,de)])]),e("div",pe,[e("table",me,[t[6]||(t[6]=e("thead",{class:"bg-gradient-to-r from-blue-50 to-blue-100"},[e("tr",null,[e("th",{class:"border px-2 py-1"},"No"),e("th",{class:"border px-2 py-1"},"Kategori"),e("th",{class:"border px-2 py-1"},"Checklist Point"),e("th",{class:"border px-2 py-1"},"Check"),e("th",{class:"border px-2 py-1"},"Actual Condition"),e("th",{class:"border px-2 py-1"},"Action"),e("th",{class:"border px-2 py-1"},"Picture"),e("th",{class:"border px-2 py-1"},"Remarks")])],-1)),e("tbody",null,[(r(!0),u(x,null,k(n.value.items,(a,l)=>(r(),u("tr",{key:l},[e("td",he,v(a.no),1),G(l)?(r(),u("td",{key:0,rowspan:H(a.category),class:"border px-2 py-1 align-top"},v(a.category),9,fe)):(r(),u("td",ve)),e("td",ge,v(a.checklist_point),1),e("td",be,[m(e("input",{type:"checkbox","onUpdate:modelValue":s=>a.checked=s},null,8,ye),[[oe,a.checked]])]),e("td",_e,[m(e("input",{"onUpdate:modelValue":s=>a.actual_condition=s,class:"border rounded-lg px-2 py-1 w-full focus:ring-blue-500 focus:border-blue-500"},null,8,xe),[[b,a.actual_condition]])]),e("td",ke,[m(e("input",{"onUpdate:modelValue":s=>a.action=s,class:"border rounded-lg px-2 py-1 w-full focus:ring-blue-500 focus:border-blue-500"},null,8,we),[[b,a.action]])]),e("td",Ce,[e("div",Ue,[e("input",{type:"file",multiple:"",accept:"image/*",capture:ae(D)?"environment":void 0,onChange:s=>q(s,l)},null,40,Ve),e("button",{type:"button",class:"bg-blue-500 text-white px-2 py-1 rounded mb-1",onClick:s=>L(l)},"Ambil Foto",8,$e),e("div",Be,[(r(!0),u(x,null,k(a.photos,(s,f)=>(r(),u("div",{key:f,class:"relative group"},[e("img",{src:W(s),class:"w-12 h-12 object-cover border rounded"},null,8,Ae),e("button",{type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs opacity-80 group-hover:opacity-100",onClick:S=>I(l,f)}," Ã— ",8,Ee)]))),128))])])]),e("td",Fe,[m(e("input",{"onUpdate:modelValue":s=>a.remarks=s,class:"border rounded-lg px-2 py-1 w-full focus:ring-blue-500 focus:border-blue-500"},null,8,Me),[[b,a.remarks]])])]))),128))])])]),e("div",Se,[e("button",{type:"button",class:"px-4 py-2 rounded bg-gray-100 text-gray-700 font-semibold hover:bg-gray-200",onClick:z},"Batal"),e("button",{type:"submit",class:"px-6 py-2 rounded bg-blue-600 text-white font-bold hover:bg-blue-700 flex items-center justify-center min-w-[100px]",disabled:h.value},[h.value?(r(),u("span",Pe,t[7]||(t[7]=[e("i",{class:"fa fa-spinner fa-spin mr-2"},null,-1),se("Loading...")]))):(r(),u("span",Te,"Simpan"))],8,je)])],32),y.value?(r(),u("div",Re,[e("div",De,[e("video",{ref_key:"videoRef",ref:g,autoplay:"",class:"w-80 h-60 bg-black rounded"},null,512),e("canvas",{ref_key:"canvasRef",ref:V,class:"hidden"},null,512),e("div",{class:"flex gap-2 mt-2"},[e("button",{onClick:N,class:"bg-green-500 text-white px-4 py-2 rounded"},"Capture"),e("button",{onClick:O,class:"bg-yellow-500 text-white px-4 py-2 rounded"},"Switch Camera"),e("button",{onClick:B,class:"bg-gray-300 px-4 py-2 rounded"},"Batal")])])])):Z("",!0)])]),_:1}))}};export{Qe as default};
