import{P as L,r as C,c as V,a8 as S,A as M,B as p,C as P,D as t,G as b,N as o,x as D,O as j,L as g,E as x,H as c,Q as m,V as $,l as E,Y as G,J as f,F as T,M as O}from"./vendor-vue-g7iCcTkf.js";import{A as J}from"./AppLayout-IVexHyAO.js";import{a as Q}from"./vendor-utils-CpgP2uT4.js";import{S as w}from"./app-V2AeMLhf.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-BZZ_tA4T.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const z={class:"w-full py-8 px-4"},H={class:"flex justify-between items-center mb-6"},Y={class:"text-2xl font-bold text-gray-800 flex items-center gap-2"},K={class:"flex space-x-2"},W={class:"bg-white rounded-xl shadow-lg p-6"},X={class:"mb-6"},Z={class:"flex items-center"},tt={key:0,class:"mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4"},et={class:"text-lg font-semibold text-gray-800 mb-3 flex items-center"},st={class:"ml-2 text-sm font-normal text-gray-600"},ot={key:0,class:"mb-4 p-3 bg-blue-100 border border-blue-200 rounded-lg"},nt={class:"text-sm text-blue-600"},rt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},dt={class:"bg-white p-3 rounded-lg border border-blue-200"},lt={class:"text-sm font-medium text-blue-600"},at={class:"text-lg font-bold text-blue-800"},it={key:0,class:"text-xs text-gray-500 mt-1"},ut={class:"bg-white p-3 rounded-lg border border-orange-200"},pt={class:"text-lg font-bold text-orange-800"},bt={class:"bg-white p-3 rounded-lg border border-green-200"},gt={class:"mt-4"},mt={class:"flex justify-between text-sm text-gray-600 mb-2"},ct={class:"w-full bg-gray-200 rounded-full h-3"},xt={key:1,class:"mt-4 pt-4 border-t border-gray-200"},ft={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3"},yt={class:"p-3 bg-white rounded-lg border border-blue-100 shadow-sm"},wt={class:"text-base font-bold text-blue-800"},vt={class:"p-3 bg-white rounded-lg border border-blue-100 shadow-sm"},ht={class:"text-base font-bold text-blue-800"},_t={class:"p-3 bg-white rounded-lg border border-orange-100 shadow-sm"},It={class:"text-base font-bold text-orange-600"},kt={class:"p-3 bg-white rounded-lg border border-yellow-100 shadow-sm"},Pt={class:"text-base font-bold text-yellow-600"},Et={class:"p-3 bg-white rounded-lg border border-green-100 shadow-sm"},Tt={class:"text-base font-bold text-green-600"},Ot={class:"p-3 bg-white rounded-lg border border-purple-100 shadow-sm"},Ut={class:"text-base font-bold text-purple-600"},Ft={class:"mb-6"},Nt={class:"mb-6"},At={class:"overflow-x-auto"},Bt={class:"min-w-full divide-y divide-gray-200"},Rt={class:"bg-white divide-y divide-gray-200"},qt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Lt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Ct={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Vt={class:"px-6 py-4 whitespace-nowrap"},St=["onUpdate:modelValue"],Mt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right"},Dt={class:"px-6 py-4 whitespace-nowrap text-center"},jt=["onClick"],$t={class:"mb-6"},Gt={class:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-4"},Jt={key:0,class:"overflow-x-auto"},Qt={class:"min-w-full divide-y divide-gray-200"},zt={class:"bg-white divide-y divide-gray-200"},Ht={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Yt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Kt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Wt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Xt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right"},Zt={class:"px-6 py-4 whitespace-nowrap text-center"},te=["onClick"],ee={class:"mt-6 p-4 bg-gray-50 rounded-lg"},se={class:"flex justify-between items-center"},oe={class:"text-xl font-bold text-blue-600"},ne={class:"mt-6 flex justify-end"},re=["disabled"],de={key:0,class:"fas fa-spinner fa-spin mr-2"},ye={__name:"Edit",props:{po:Object,suppliers:Array,budgetInfo:Object},setup(n){const l=n,d=L({notes:l.po.notes||"",ppn_enabled:l.po.ppn_enabled||!1,items:l.po.items.map(s=>({id:s.id,price:s.price,total:s.total})),new_items:[],deleted_items:[]}),a=C({item_name:"",quantity:0,unit:"",price:0}),i=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s),v=s=>s.price&&s.quantity?parseFloat(s.price)*parseFloat(s.quantity):0,U=V(()=>{let s=0;return d.items.forEach(e=>{e.price&&e.quantity&&(s+=parseFloat(e.price)*parseFloat(e.quantity))}),d.new_items.forEach(e=>{e.price&&e.quantity&&(s+=parseFloat(e.price)*parseFloat(e.quantity))}),d.ppn_enabled&&(s+=s*.11),s}),F=()=>{a.value.item_name&&a.value.quantity&&a.value.unit&&a.value.price?(d.new_items.push({item_name:a.value.item_name,quantity:parseFloat(a.value.quantity),unit:a.value.unit,price:parseFloat(a.value.price)}),a.value={item_name:"",quantity:0,unit:"",price:0}):w.fire("Error","Please fill all fields for new item","error")},N=s=>{d.new_items.splice(s,1)},A=s=>{d.deleted_items.push(s),d.items=d.items.filter(e=>e.id!==s)},B=async()=>{var s,e;try{const u=await Q.put(`/po-ops/${l.po.id}`,d.data());u.data.success?(w.fire("Success","PO updated successfully!","success"),window.location.href=`/po-ops/${l.po.id}`):w.fire("Error",u.data.message||"Failed to update PO","error")}catch(u){console.error("Error updating PO:",u),w.fire("Error",((e=(s=u.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to update PO","error")}};function h(){return l.budgetInfo?l.budgetInfo.budget_type==="PER_OUTLET"?l.budgetInfo.outlet_budget:l.budgetInfo.category_budget:0}function _(){return l.budgetInfo?l.budgetInfo.budget_type==="PER_OUTLET"?l.budgetInfo.outlet_used_amount:l.budgetInfo.category_used_amount:0}function I(){return l.budgetInfo?l.budgetInfo.budget_type==="PER_OUTLET"?l.budgetInfo.outlet_remaining_amount:l.budgetInfo.category_remaining_amount:0}function k(){const s=_(),e=h();return e===0?0:s/e*100}function R(s,e){const u=s/e*100;return u>=100?"bg-red-500":u>=80?"bg-yellow-500":u>=60?"bg-orange-500":"bg-green-500"}function q(s){return["January","February","March","April","May","June","July","August","September","October","November","December"][s-1]||"Unknown"}return(s,e)=>{const u=S("Link");return p(),M(J,{title:"Edit Purchase Order Ops"},{default:P(()=>[t("div",z,[t("div",H,[t("h1",Y,[e[6]||(e[6]=t("i",{class:"fa-solid fa-edit text-blue-500"},null,-1)),b(" Edit Purchase Order: "+o(n.po.number),1)]),t("div",K,[D(u,{href:`/po-ops/${n.po.id}`,class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"},{default:P(()=>e[7]||(e[7]=[t("i",{class:"fas fa-arrow-left mr-2"},null,-1),b(" Back to Detail ")])),_:1},8,["href"])])]),t("div",W,[t("form",{onSubmit:j(B,["prevent"])},[t("div",X,[t("label",Z,[c(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=r=>m(d).ppn_enabled=r),class:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"},null,512),[[$,m(d).ppn_enabled]]),e[8]||(e[8]=t("span",{class:"ml-2 text-sm text-gray-700"},"Enable PPN (11%)",-1))])]),n.budgetInfo?(p(),g("div",tt,[t("h3",et,[e[9]||(e[9]=t("i",{class:"fa fa-chart-pie mr-2 text-blue-500"},null,-1)),b(" "+o(n.budgetInfo.budget_type==="PER_OUTLET"?"Informasi Budget Outlet":"Informasi Budget Category")+" - "+o(q(n.budgetInfo.current_month))+" "+o(n.budgetInfo.current_year)+" ",1),t("span",st," ("+o(n.budgetInfo.budget_type==="PER_OUTLET"?"Per Outlet":"Global")+") ",1)]),n.budgetInfo.budget_type==="PER_OUTLET"&&n.budgetInfo.outlet_info?(p(),g("div",ot,[t("p",nt,[e[10]||(e[10]=t("i",{class:"fa fa-store mr-2"},null,-1)),e[11]||(e[11]=t("strong",null,"Outlet:",-1)),b(" "+o(n.budgetInfo.outlet_info.name),1)])])):x("",!0),t("div",rt,[t("div",dt,[t("div",lt,o(n.budgetInfo.budget_type==="PER_OUTLET"?"Outlet Budget":"Total Budget"),1),t("div",at,o(i(n.budgetInfo.budget_type==="PER_OUTLET"?n.budgetInfo.outlet_budget:n.budgetInfo.category_budget)),1),n.budgetInfo.budget_type==="PER_OUTLET"?(p(),g("div",it," Global: "+o(i(n.budgetInfo.category_budget)),1)):x("",!0)]),t("div",ut,[e[12]||(e[12]=t("div",{class:"text-sm font-medium text-orange-600"},"Used This Month",-1)),t("div",pt,o(i(n.budgetInfo.budget_type==="PER_OUTLET"?n.budgetInfo.outlet_used_amount:n.budgetInfo.category_used_amount)),1)]),t("div",bt,[e[13]||(e[13]=t("div",{class:"text-sm font-medium text-green-600"},"Remaining Budget",-1)),t("div",{class:E(["text-lg font-bold",I()<0?"text-red-800":"text-green-800"])},o(i(I())),3)])]),t("div",gt,[t("div",mt,[e[14]||(e[14]=t("span",null,"Budget Usage",-1)),t("span",null,o(Math.round(k()))+"%",1)]),t("div",ct,[t("div",{class:E(["h-3 rounded-full transition-all duration-300",R(_(),h())]),style:G({width:Math.min(k(),100)+"%"})},null,6)])]),n.budgetInfo.breakdown?(p(),g("div",xt,[e[24]||(e[24]=t("h5",{class:"text-sm font-semibold text-gray-800 mb-3 flex items-center gap-2"},[t("i",{class:"fa fa-list-ul text-blue-500"}),b("Budget Breakdown Detail ")],-1)),t("div",ft,[t("div",yt,[e[15]||(e[15]=t("p",{class:"text-blue-600 font-medium text-xs mb-1"},"PR Unpaid",-1)),t("p",wt,o(i(n.budgetInfo.breakdown.pr_unpaid||0)),1),e[16]||(e[16]=t("p",{class:"text-xs text-gray-500 mt-1"},[b("PR Submitted & Approved"),t("br"),b("yang belum dibuat PO")],-1))]),t("div",vt,[e[17]||(e[17]=t("p",{class:"text-blue-600 font-medium text-xs mb-1"},"PO Unpaid",-1)),t("p",ht,o(i(n.budgetInfo.breakdown.po_unpaid||0)),1),e[18]||(e[18]=t("p",{class:"text-xs text-gray-500 mt-1"},[b("PO Submitted & Approved"),t("br"),b("yang belum dibuat NFP")],-1))]),t("div",_t,[e[19]||(e[19]=t("p",{class:"text-orange-600 font-medium text-xs mb-1"},"NFP Submitted",-1)),t("p",It,o(i(n.budgetInfo.breakdown.nfp_submitted||0)),1)]),t("div",kt,[e[20]||(e[20]=t("p",{class:"text-yellow-600 font-medium text-xs mb-1"},"NFP Approved",-1)),t("p",Pt,o(i(n.budgetInfo.breakdown.nfp_approved||0)),1)]),t("div",Et,[e[21]||(e[21]=t("p",{class:"text-green-600 font-medium text-xs mb-1"},"NFP Paid",-1)),t("p",Tt,o(i(n.budgetInfo.breakdown.nfp_paid||0)),1)]),t("div",Ot,[e[22]||(e[22]=t("p",{class:"text-purple-600 font-medium text-xs mb-1"},"Retail Non Food",-1)),t("p",Ut,o(i(n.budgetInfo.breakdown.retail_non_food||0)),1),e[23]||(e[23]=t("p",{class:"text-xs text-gray-500 mt-1"},"Status: Approved",-1))])])])):x("",!0)])):x("",!0),t("div",Ft,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Notes",-1)),c(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=r=>m(d).notes=r),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter notes..."},null,512),[[f,m(d).notes]])]),t("div",Nt,[e[28]||(e[28]=t("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"Existing Items",-1)),t("div",At,[t("table",Bt,[e[27]||(e[27]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Item Name"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Qty"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Unit"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Price"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total"),t("th",{class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),t("tbody",Rt,[(p(!0),g(T,null,O(m(d).items,r=>(p(),g("tr",{key:r.id},[t("td",qt,o(r.item_name),1),t("td",Lt,o(r.quantity),1),t("td",Ct,o(r.unit),1),t("td",Vt,[c(t("input",{type:"number","onUpdate:modelValue":y=>r.price=y,min:"0",step:"0.01",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,8,St),[[f,r.price,void 0,{number:!0}]])]),t("td",Mt,o(i(v(r))),1),t("td",Dt,[t("button",{type:"button",onClick:y=>A(r.id),class:"text-red-600 hover:text-red-900"},e[26]||(e[26]=[t("i",{class:"fas fa-trash"},null,-1)]),8,jt)])]))),128))])])])]),t("div",$t,[e[36]||(e[36]=t("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"Add New Items",-1)),t("div",Gt,[t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Item Name",-1)),c(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=r=>a.value.item_name=r),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter item name"},null,512),[[f,a.value.item_name]])]),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Quantity",-1)),c(t("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=r=>a.value.quantity=r),min:"0",step:"0.01",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[f,a.value.quantity,void 0,{number:!0}]])]),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Unit",-1)),c(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=r=>a.value.unit=r),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., pcs, kg"},null,512),[[f,a.value.unit]])]),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Price",-1)),c(t("input",{type:"number","onUpdate:modelValue":e[5]||(e[5]=r=>a.value.price=r),min:"0",step:"0.01",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[f,a.value.price,void 0,{number:!0}]])]),t("div",{class:"flex items-end"},[t("button",{type:"button",onClick:F,class:"w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700"},e[33]||(e[33]=[t("i",{class:"fas fa-plus mr-2"},null,-1),b(" Add Item ")]))])]),m(d).new_items.length>0?(p(),g("div",Jt,[t("table",Qt,[e[35]||(e[35]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Item Name"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Qty"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Unit"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Price"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total"),t("th",{class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),t("tbody",zt,[(p(!0),g(T,null,O(m(d).new_items,(r,y)=>(p(),g("tr",{key:y},[t("td",Ht,o(r.item_name),1),t("td",Yt,o(r.quantity),1),t("td",Kt,o(r.unit),1),t("td",Wt,o(i(r.price)),1),t("td",Xt,o(i(v(r))),1),t("td",Zt,[t("button",{type:"button",onClick:le=>N(y),class:"text-red-600 hover:text-red-900"},e[34]||(e[34]=[t("i",{class:"fas fa-trash"},null,-1)]),8,te)])]))),128))])])])):x("",!0)]),t("div",ee,[t("div",se,[e[37]||(e[37]=t("span",{class:"text-lg font-semibold"},"Grand Total:",-1)),t("span",oe,o(i(U.value)),1)])]),t("div",ne,[t("button",{type:"submit",disabled:m(d).processing,class:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"},[m(d).processing?(p(),g("i",de)):x("",!0),e[38]||(e[38]=b(" Update Purchase Order "))],8,re)])],32)])])]),_:1})}}};export{ye as default};
