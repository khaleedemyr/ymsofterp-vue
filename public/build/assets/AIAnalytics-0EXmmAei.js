import{r,a as P,L as i,B as n,D as t,E as h,R as y,F as z,M as U,N as p,H as X,J as Y,O as T,Z as K,l as B,G as S,n as C}from"./vendor-vue-g7iCcTkf.js";import{a as I}from"./vendor-utils-CpgP2uT4.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"space-y-6 mb-6"},Z={class:"bg-gradient-to-br from-white via-purple-50/30 to-white rounded-2xl shadow-2xl border border-purple-100/50 flex flex-col overflow-hidden backdrop-blur-sm",style:{height:"700px"}},ee={class:"relative bg-gradient-to-r from-purple-600 via-purple-500 to-indigo-600 p-5 border-b border-purple-300/30"},ae={class:"relative flex items-center justify-between"},te=["disabled"],se={key:1,class:"flex flex-col items-center justify-center h-full text-gray-400"},oe=["data-chat-id"],le={class:"max-w-[85%] bg-gradient-to-br from-purple-600 to-indigo-600 text-white rounded-2xl rounded-tr-sm px-5 py-4 shadow-xl transform hover:scale-[1.02] transition-transform duration-200"},re={class:"text-sm whitespace-pre-line leading-relaxed"},ie={class:"text-xs opacity-70 mt-3 flex items-center gap-1"},ne={class:"flex justify-start"},de={class:"max-w-[85%] bg-white border border-gray-200 rounded-2xl rounded-tl-sm px-5 py-4 shadow-xl hover:shadow-2xl transition-all duration-200 relative overflow-hidden"},ue=["innerHTML"],ce={class:"text-xs text-gray-400 mt-4 flex items-center gap-1 pt-3 border-t border-gray-100"},pe={key:2,class:"flex justify-start animate-fade-in"},fe={key:0,class:"mx-6 mb-4 bg-gradient-to-r from-red-50 to-pink-50 border border-red-200 rounded-xl p-4 shadow-lg animate-shake"},ve={class:"flex items-center gap-3 text-red-800"},be={class:"text-sm font-medium"},ge={class:"p-5 bg-gradient-to-r from-white via-purple-50/30 to-white border-t border-purple-100/50 backdrop-blur-sm"},me={class:"flex gap-3"},xe={class:"flex-1 relative"},he=["onKeyup","disabled"],ye=["disabled"],we={class:"relative z-10 hidden sm:inline"},_e={key:0,class:"bg-white rounded-lg shadow-lg p-6 border-l-4 border-blue-500"},ke={class:"flex items-center justify-between mb-4"},Se=["disabled"],Ce={key:0,class:"text-center py-8"},Ie={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-4"},Ae={class:"flex items-center gap-2 text-red-800"},qe={key:2,class:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 border-l-4 border-blue-500"},Te={class:"prose prose-sm max-w-none"},Me={class:"whitespace-pre-line text-gray-700 leading-relaxed text-sm"},He={class:"mt-4 text-xs text-gray-500 flex items-center gap-2"},je={key:3,class:"text-center py-8 text-gray-500"},Ee={__name:"AIAnalytics",props:{filters:{type:Object,required:!0}},setup(O){const w=O,b=r(null),f=r(""),o=r([]),v=r(!1),u=r(null),c=r(null),M=r(!1),_=r(null),g=r(!1),m=r(null),H=r(null),N=e=>e?(e=e.replace(/^### (.*$)/gim,'<h3 class="text-lg font-bold text-gray-800 mt-4 mb-2">$1</h3>'),e=e.replace(/^## (.*$)/gim,'<h2 class="text-xl font-bold text-gray-900 mt-6 mb-3 border-b border-gray-200 pb-2">$1</h2>'),e=e.replace(/^# (.*$)/gim,'<h1 class="text-2xl font-bold text-gray-900 mt-6 mb-4">$1</h1>'),e=e.replace(/\*\*(.*?)\*\*/gim,'<strong class="font-semibold text-gray-900">$1</strong>'),e=e.replace(/^\- (.*$)/gim,'<li class="ml-4 mb-1">$1</li>'),e=e.replace(/^(\d+)\. (.*$)/gim,'<li class="ml-4 mb-1 list-decimal">$2</li>'),e=e.replace(/(<li.*<\/li>)/gim,'<ul class="list-disc space-y-1 my-2">$1</ul>'),e=e.replace(/\n/gim,"<br>"),e):"",j=()=>{if(!b.value){const e=localStorage.getItem("ai_chat_session_id");e?b.value=e:(b.value="ai_chat_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),localStorage.setItem("ai_chat_session_id",b.value))}return b.value},F=async()=>{try{console.log("=== Loading Chat History ===");const e=await I.get("/sales-outlet-dashboard/ai/chat-history",{params:{session_id:""},withCredentials:!0});if(console.log("=== Chat History Response ==="),console.log("Full response:",JSON.stringify(e.data,null,2)),console.log("Success:",e.data.success),console.log("History type:",typeof e.data.history),console.log("History is array:",Array.isArray(e.data.history)),console.log("History count:",e.data.history?e.data.history.length:0),e.data.success){const a=e.data.history||[];Array.isArray(a)?(o.value=a,console.log("âœ… Chat history loaded successfully:",o.value.length,"items"),o.value.length>0&&console.log("First chat item:",o.value[0])):(console.error("âŒ History is not an array:",a),o.value=[]),e.data.session_id&&(b.value=e.data.session_id,localStorage.setItem("ai_chat_session_id",e.data.session_id),console.log("âœ… Updated session_id to:",e.data.session_id)),await C(),Q()}else console.error("âŒ Failed to load chat history:",e.data.message),o.value=[]}catch(e){console.error("âŒ Load Chat History Error:",e),e.response&&(console.error("Error response:",e.response.data),console.error("Error status:",e.response.status)),e.request&&console.error("Error request:",e.request),o.value=[]}},G=async()=>{if(confirm("Apakah Anda yakin ingin menghapus semua chat?"))try{const e=j();await I.delete("/sales-outlet-dashboard/ai/chat-history",{params:{session_id:e},withCredentials:!0}),o.value=[],u.value=null}catch(e){console.error("Clear Chat Error:",e),u.value="Gagal menghapus chat history"}},Q=()=>{C(()=>{c.value&&(c.value.scrollTop=c.value.scrollHeight)})},V=e=>{C(()=>{if(c.value&&e){const a=c.value.querySelector(`[data-chat-id="${e}"]`);a&&(a.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),setTimeout(()=>{c.value&&(c.value.scrollTop=Math.max(0,c.value.scrollTop-30))},300))}})},E=async()=>{g.value=!0,m.value=null;try{const e=await I.get("/sales-outlet-dashboard/ai/insight",{params:{date_from:w.filters.date_from,date_to:w.filters.date_to},withCredentials:!0});e.data.success?(_.value=e.data.insight,H.value=new Date().toLocaleString("id-ID",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})):m.value=e.data.message||"Gagal memuat insight"}catch(e){console.error("AI Insight Error:",e),e.response&&e.response.data&&e.response.data.message?m.value=e.response.data.message:m.value="Gagal memuat insight. Silakan coba lagi nanti."}finally{g.value=!1}},D=async e=>{var k,$,L,R;if(e&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()),!f.value||f.value.trim()==="")return;const a=f.value.trim(),d=j();f.value="",v.value=!0,u.value=null;try{const s=(k=document.querySelector('meta[name="csrf-token"]'))==null?void 0:k.getAttribute("content"),A={"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json"};s&&(A["X-CSRF-TOKEN"]=s);const q={question:a,date_from:w.filters.date_from,date_to:w.filters.date_to,session_id:d};console.log("ðŸ”µ AI Q&A Request Config (Before Axios):",{method:"POST",url:"/sales-outlet-dashboard/ai/ask",hasData:!!q,dataKeys:Object.keys(q),hasCsrfToken:!!s,headers:A});const l=await I.post("/sales-outlet-dashboard/ai/ask",q,{headers:A,withCredentials:!0,maxRedirects:0,validateStatus:function(x){return x>=200&&x<300}});if(console.log("ðŸŸ¢ AI Q&A Response received:",{status:l.status,success:($=l.data)==null?void 0:$.success}),l.data.success){l.data.session_id&&(b.value=l.data.session_id,localStorage.setItem("ai_chat_session_id",l.data.session_id));const x={id:l.data.chat_id,question:a,answer:l.data.answer,date_from:l.data.date_from,date_to:l.data.date_to,created_at:new Date().toISOString(),created_at_formatted:new Date().toLocaleString("id-ID",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})};o.value.push(x),await C(),V(x.id)}else u.value=l.data.message||"Gagal mendapatkan jawaban"}catch(s){console.error("AI Q&A Error:",s),console.error("Error details:",{message:s.message,response:s.response,request:s.config,status:(L=s.response)==null?void 0:L.status,statusText:(R=s.response)==null?void 0:R.statusText}),s.response&&s.response.data&&s.response.data.message?(u.value=s.response.data.message,s.response.status===405&&(u.value="Error: Request menggunakan method yang salah. Silakan refresh halaman dan coba lagi.",console.error("Method error detected - request config:",s.config))):u.value="Gagal mendapatkan jawaban. Silakan coba lagi nanti."}finally{v.value=!1}};return P(()=>{F(),M.value&&E()}),(e,a)=>(n(),i("div",W,[t("div",Z,[t("div",ee,[a[5]||(a[5]=t("div",{class:"absolute inset-0 bg-gradient-to-r from-purple-600/90 to-indigo-600/90 backdrop-blur-sm"},null,-1)),t("div",ae,[a[4]||(a[4]=y('<div class="flex items-center gap-3" data-v-ae6fe1eb><div class="relative" data-v-ae6fe1eb><div class="absolute inset-0 bg-purple-400 rounded-full blur-lg opacity-50 animate-pulse" data-v-ae6fe1eb></div><div class="relative bg-gradient-to-br from-purple-500 to-indigo-600 p-3 rounded-2xl shadow-lg" data-v-ae6fe1eb><span class="text-2xl" data-v-ae6fe1eb>ðŸ¤–</span></div></div><div data-v-ae6fe1eb><h3 class="text-xl font-bold text-white flex items-center gap-2 drop-shadow-lg" data-v-ae6fe1eb> Tanya YMSoft AI </h3><p class="text-xs text-purple-100 flex items-center gap-1 mt-0.5" data-v-ae6fe1eb><i class="fa-solid fa-bolt text-yellow-300" data-v-ae6fe1eb></i> Powered By Claude Sonnet </p></div></div>',1)),t("button",{onClick:G,disabled:o.value.length===0,class:"relative px-4 py-2 bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center gap-2 text-sm font-medium border border-white/30 shadow-lg hover:shadow-xl transform hover:scale-105",title:"Hapus semua chat"},a[3]||(a[3]=[t("i",{class:"fa-solid fa-trash"},null,-1),t("span",{class:"hidden sm:inline"},"Hapus Chat",-1)]),8,te)])]),t("div",{ref_key:"chatContainer",ref:c,class:"flex-1 overflow-y-auto p-6 space-y-5 bg-gradient-to-b from-gray-50/50 to-white",style:{"scrollbar-width":"thin","scrollbar-color":"rgba(147, 51, 234, 0.3) transparent"}},[h("",!0),o.value.length===0&&!v.value?(n(),i("div",se,a[6]||(a[6]=[y('<div class="relative mb-6" data-v-ae6fe1eb><div class="absolute inset-0 bg-purple-200 rounded-full blur-2xl opacity-30 animate-pulse" data-v-ae6fe1eb></div><div class="relative bg-gradient-to-br from-purple-100 to-indigo-100 p-8 rounded-3xl shadow-xl" data-v-ae6fe1eb><i class="fa-solid fa-comments text-6xl text-purple-500" data-v-ae6fe1eb></i></div></div><p class="text-xl font-semibold text-gray-600 mb-2" data-v-ae6fe1eb>Mulai percakapan dengan AI</p><p class="text-sm text-gray-500" data-v-ae6fe1eb>Masukkan pertanyaan di bawah untuk mendapatkan jawaban yang cerdas</p>',3)]))):h("",!0),(n(!0),i(z,null,U(o.value,(d,k)=>(n(),i("div",{key:d.id||k,class:"space-y-4 animate-fade-in"},[t("div",{class:"flex justify-end","data-chat-id":d.id},[t("div",le,[a[8]||(a[8]=t("div",{class:"flex items-center gap-2 mb-2"},[t("div",{class:"w-6 h-6 bg-white/20 rounded-full flex items-center justify-center"},[t("i",{class:"fa-solid fa-user text-xs"})]),t("p",{class:"text-xs font-semibold opacity-90"},"Anda")],-1)),t("p",re,p(d.question),1),t("p",ie,[a[7]||(a[7]=t("i",{class:"fa-solid fa-clock text-xs"},null,-1)),S(" "+p(d.created_at_formatted),1)])])],8,oe),t("div",ne,[t("div",de,[a[10]||(a[10]=y('<div class="absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b from-purple-500 to-indigo-500" data-v-ae6fe1eb></div><div class="flex items-center gap-2 mb-3" data-v-ae6fe1eb><div class="relative" data-v-ae6fe1eb><div class="absolute inset-0 bg-purple-200 rounded-full blur-md opacity-50" data-v-ae6fe1eb></div><div class="relative bg-gradient-to-br from-purple-500 to-indigo-600 p-2 rounded-xl" data-v-ae6fe1eb><i class="fa-solid fa-robot text-white text-sm" data-v-ae6fe1eb></i></div></div><div data-v-ae6fe1eb><p class="text-sm font-semibold text-gray-800" data-v-ae6fe1eb>YMSoft AI</p><p class="text-xs text-gray-500 flex items-center gap-1" data-v-ae6fe1eb><i class="fa-solid fa-bolt text-yellow-500 text-xs" data-v-ae6fe1eb></i> Claude Sonnet </p></div></div>',2)),t("div",{class:"text-sm text-gray-700 whitespace-pre-line leading-relaxed prose prose-sm max-w-none",innerHTML:N(d.answer)},null,8,ue),t("p",ce,[a[9]||(a[9]=t("i",{class:"fa-solid fa-clock text-xs"},null,-1)),S(" "+p(d.created_at_formatted),1)])])])]))),128)),v.value?(n(),i("div",pe,a[11]||(a[11]=[y('<div class="max-w-[85%] bg-white border border-gray-200 rounded-2xl rounded-tl-sm px-5 py-4 shadow-xl hover:shadow-2xl transition-all duration-200 relative overflow-hidden" data-v-ae6fe1eb><div class="absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b from-purple-500 to-indigo-500" data-v-ae6fe1eb></div><div class="flex items-center gap-3" data-v-ae6fe1eb><div class="relative" data-v-ae6fe1eb><div class="absolute inset-0 bg-purple-200 rounded-full blur-md opacity-50 animate-pulse" data-v-ae6fe1eb></div><div class="relative bg-gradient-to-br from-purple-500 to-indigo-600 p-2 rounded-xl" data-v-ae6fe1eb><i class="fa-solid fa-robot text-white text-sm" data-v-ae6fe1eb></i></div></div><div class="flex-1" data-v-ae6fe1eb><div class="flex items-center gap-2 mb-1" data-v-ae6fe1eb><p class="text-sm font-semibold text-gray-800" data-v-ae6fe1eb>YMSoft AI</p><span class="text-xs text-gray-500 flex items-center gap-1" data-v-ae6fe1eb><i class="fa-solid fa-bolt text-yellow-500 text-xs" data-v-ae6fe1eb></i> Claude Sonnet </span></div><div class="flex items-center gap-1" data-v-ae6fe1eb><span class="text-sm text-gray-600 font-medium" data-v-ae6fe1eb>Sedang memikirkan</span><div class="flex gap-1 ml-1" data-v-ae6fe1eb><span class="w-2 h-2 bg-purple-500 rounded-full animate-bounce" style="animation-delay:0s;" data-v-ae6fe1eb></span><span class="w-2 h-2 bg-indigo-500 rounded-full animate-bounce" style="animation-delay:0.2s;" data-v-ae6fe1eb></span><span class="w-2 h-2 bg-purple-500 rounded-full animate-bounce" style="animation-delay:0.4s;" data-v-ae6fe1eb></span></div></div><div class="mt-2 flex items-center gap-1" data-v-ae6fe1eb><div class="flex-1 h-1 bg-gradient-to-r from-purple-200 via-purple-400 to-purple-200 rounded-full overflow-hidden relative" data-v-ae6fe1eb><div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/80 to-transparent" style="animation:shimmer 1.5s ease-in-out infinite;" data-v-ae6fe1eb></div></div></div><p class="text-xs text-gray-500 mt-2 flex items-center gap-1" data-v-ae6fe1eb><i class="fa-solid fa-brain text-purple-500 animate-pulse" data-v-ae6fe1eb></i><span data-v-ae6fe1eb>Menganalisis data dashboard...</span></p></div></div></div>',1)]))):h("",!0)],512),u.value?(n(),i("div",fe,[t("div",ve,[a[12]||(a[12]=t("div",{class:"bg-red-100 p-2 rounded-lg"},[t("i",{class:"fa-solid fa-exclamation-circle text-red-600"})],-1)),t("p",be,p(u.value),1)])])):h("",!0),t("div",ge,[t("div",me,[t("div",xe,[a[13]||(a[13]=t("div",{class:"absolute inset-0 bg-gradient-to-r from-purple-100/50 to-indigo-100/50 rounded-2xl blur-sm"},null,-1)),X(t("input",{"onUpdate:modelValue":a[0]||(a[0]=d=>f.value=d),onKeyup:K(T(D,["prevent"]),["enter"]),onKeydown:a[1]||(a[1]=K(T(()=>{},["prevent"]),["enter"])),onSubmit:a[2]||(a[2]=T(()=>{},["prevent"])),type:"text",placeholder:"Tanyakan sesuatu tentang dashboard...",class:"relative w-full px-5 py-3.5 bg-white border-2 border-purple-200 rounded-2xl focus:outline-none focus:ring-4 focus:ring-purple-300/50 focus:border-purple-400 transition-all duration-300 text-sm shadow-lg hover:shadow-xl",disabled:v.value},null,40,he),[[Y,f.value]])]),t("button",{type:"button",onClick:D,disabled:v.value||!f.value||f.value.trim()==="",class:"relative px-6 py-3.5 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-2xl hover:from-purple-700 hover:to-indigo-700 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed transition-all duration-300 flex items-center gap-2 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 disabled:transform-none group"},[a[14]||(a[14]=t("div",{class:"absolute inset-0 bg-white/20 rounded-2xl blur-md opacity-0 group-hover:opacity-100 transition-opacity duration-300"},null,-1)),t("i",{class:B(["fa-solid fa-paper-plane relative z-10",{"fa-spin":v.value}])},null,2),t("span",we,p(v.value?"Mengirim...":"Kirim"),1)],8,ye)]),a[15]||(a[15]=y('<div class="flex items-center justify-between mt-3" data-v-ae6fe1eb><p class="text-xs text-gray-500 flex items-center gap-1.5" data-v-ae6fe1eb><i class="fa-solid fa-lightbulb text-yellow-500" data-v-ae6fe1eb></i><span class="hidden sm:inline" data-v-ae6fe1eb>Contoh: </span><span class="text-gray-400" data-v-ae6fe1eb>&quot;Kenapa revenue turun?&quot;, &quot;Item apa yang paling menguntungkan?&quot;</span></p><div class="flex items-center gap-2 text-xs text-gray-400 bg-gray-50 px-3 py-1.5 rounded-full border border-gray-200" data-v-ae6fe1eb><i class="fa-solid fa-bolt text-yellow-500" data-v-ae6fe1eb></i><span class="font-medium" data-v-ae6fe1eb>Powered By Claude Sonnet</span></div></div>',1))])]),M.value?(n(),i("div",_e,[t("div",ke,[a[16]||(a[16]=t("h3",{class:"text-xl font-bold text-gray-800 flex items-center gap-2"},[t("span",{class:"text-2xl"},"ðŸ¤–"),S(" AI Insight ")],-1)),t("button",{onClick:E,disabled:g.value,class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center gap-2"},[t("i",{class:B(["fa-solid fa-refresh",{"fa-spin":g.value}])},null,2),S(" "+p(g.value?"Loading...":"Refresh"),1)],8,Se)]),g.value&&!_.value?(n(),i("div",Ce,a[17]||(a[17]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},null,-1),t("p",{class:"mt-2 text-gray-600"},"Menganalisa data...",-1)]))):m.value?(n(),i("div",Ie,[t("div",Ae,[a[18]||(a[18]=t("i",{class:"fa-solid fa-exclamation-circle"},null,-1)),t("p",null,p(m.value),1)])])):_.value?(n(),i("div",qe,[t("div",Te,[t("div",Me,p(_.value),1)]),t("div",He,[a[19]||(a[19]=t("i",{class:"fa-solid fa-clock"},null,-1)),t("span",null,"Terakhir diupdate: "+p(H.value),1)])])):(n(),i("div",je,a[20]||(a[20]=[t("i",{class:"fa-solid fa-robot text-4xl mb-2"},null,-1),t("p",null,'Klik "Refresh" untuk mendapatkan insight AI',-1)])))])):h("",!0)]))}},Re=J(Ee,[["__scopeId","data-v-ae6fe1eb"]]);export{Re as default};
