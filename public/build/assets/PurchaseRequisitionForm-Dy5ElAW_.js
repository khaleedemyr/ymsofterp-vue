import{r as f,a as M,w as j,L as d,B as p,D as e,E as P,H as r,J as u,G as c,F as U,M as V,N as k,O as B,I as $}from"./vendor-vue-g7iCcTkf.js";import{a as v}from"./vendor-utils-CpgP2uT4.js";import{S as x}from"./app-BSTQjgZq.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-charts-CuqD4wLC.js";const D={class:"mb-2"},G={class:"mb-2"},T={class:"mb-4"},A={class:"w-full text-xs border mb-2"},E={class:"border px-2 py-1"},H=["onUpdate:modelValue"],L={class:"border px-2 py-1"},O=["onUpdate:modelValue"],Q={class:"border px-2 py-1"},z=["onUpdate:modelValue"],J={class:"border px-2 py-1"},K=["onUpdate:modelValue","onInput"],W={class:"border px-2 py-1"},X=["onUpdate:modelValue"],Y=["value"],Z={class:"border px-2 py-1"},ee=["onUpdate:modelValue","onInput"],te={class:"border px-2 py-1"},se=["onUpdate:modelValue"],ae={class:"border px-2 py-1"},oe=["onUpdate:modelValue"],ne={class:"border px-2 py-1 text-center"},le=["onClick"],re={class:"mb-2 flex justify-end items-center"},ie={key:0,class:"text-red-500 text-xs mb-2"},ue={key:1,class:"fixed inset-0 z-[99999] flex items-center justify-center bg-black/30"},de={__name:"PurchaseRequisitionForm",props:{taskId:[String,Number],onSaved:Function,editPr:Object},setup(q){const l=q,t=f({pr_number:"",description:"",specifications:"",total_amount:null,items:[]}),_=f([]),i=f(""),y=f(!1);async function h(){const n=await v.get("/api/maintenance-purchase-requisitions/generate-number");t.value.pr_number=n.data.pr_number}async function S(){const n=await v.get("/api/units");_.value=n.data}function m(){t.value.items.push({item_name:"",description:"",specifications:"",quantity:1,unit_id:"",price:0,subtotal:0,notes:""})}function I(n){t.value.items.splice(n,1)}function g(n){const s=t.value.items[n];s.subtotal=(parseFloat(s.quantity)||0)*(parseFloat(s.price)||0),R()}function R(){t.value.total_amount=t.value.items.reduce((n,s)=>n+(parseFloat(s.subtotal)||0),0)}function F(){if(!t.value.description)return i.value="Reason for Purchase wajib diisi",!1;if(!t.value.items.length)return i.value="Minimal 1 item",!1;for(const n of t.value.items){if(!n.item_name)return i.value="Nama item wajib diisi",!1;if(!n.unit_id)return i.value="Unit wajib dipilih",!1;if(!n.quantity||n.quantity<=0)return i.value="Quantity harus lebih dari 0",!1;if(n.price<0)return i.value="Harga tidak boleh negatif",!1}return i.value="",!0}async function N(){if(F()){y.value=!0;try{l.editPr&&l.editPr.id?(await v.put(`/api/maintenance-purchase-requisitions/${l.editPr.id}`,t.value),x.fire({icon:"success",title:"Berhasil",text:"PR berhasil diupdate!"})):(await v.post(`/api/maintenance-tasks/${l.taskId}/purchase-requisitions`,t.value),x.fire({icon:"success",title:"Berhasil",text:"PR berhasil disimpan!"})),l.onSaved&&l.onSaved(),await h(),t.value.description="",t.value.specifications="",t.value.total_amount=null,t.value.items=[],m()}catch{i.value="Gagal simpan PR",x.fire({icon:"error",title:"Gagal",text:"Gagal menyimpan PR!"})}finally{y.value=!1}}}function w(){l.editPr?(t.value.pr_number=l.editPr.pr_number,t.value.description=l.editPr.description,t.value.specifications=l.editPr.specifications,t.value.total_amount=l.editPr.total_amount,t.value.items=(l.editPr.items||[]).map(n=>({...n})),t.value.items.length||m()):(h(),t.value.description="",t.value.specifications="",t.value.total_amount=null,t.value.items=[],m())}return M(()=>{S(),w()}),j(()=>l.editPr,w),(n,s)=>(p(),d("div",null,[e("form",{onSubmit:B(N,["prevent"])},[e("div",D,[s[3]||(s[3]=e("label",{class:"block text-sm font-semibold"},"PR Number",-1)),r(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>t.value.pr_number=a),class:"border rounded px-2 py-1 w-full bg-gray-100",readonly:""},null,512),[[u,t.value.pr_number]])]),e("div",G,[s[4]||(s[4]=e("label",{class:"block text-sm font-semibold"},[c("Reason for Purchase "),e("span",{class:"text-red-500"},"*")],-1)),r(e("textarea",{"onUpdate:modelValue":s[1]||(s[1]=a=>t.value.description=a),class:"border rounded px-2 py-1 w-full",required:""},null,512),[[u,t.value.description]])]),e("div",T,[s[9]||(s[9]=e("label",{class:"block text-sm font-semibold mb-2"},[c("Items "),e("span",{class:"text-red-500"},"*")],-1)),e("table",A,[s[7]||(s[7]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"border px-2 py-1"},[c("Item Name"),e("span",{class:"text-red-500"},"*")]),e("th",{class:"border px-2 py-1"},"Description"),e("th",{class:"border px-2 py-1"},"Specs"),e("th",{class:"border px-2 py-1"},[c("Qty"),e("span",{class:"text-red-500"},"*")]),e("th",{class:"border px-2 py-1"},[c("Unit"),e("span",{class:"text-red-500"},"*")]),e("th",{class:"border px-2 py-1"},"Price"),e("th",{class:"border px-2 py-1"},"Subtotal"),e("th",{class:"border px-2 py-1"},"Notes"),e("th",{class:"border px-2 py-1"})])],-1)),e("tbody",null,[(p(!0),d(U,null,V(t.value.items,(a,b)=>(p(),d("tr",{key:b},[e("td",E,[r(e("input",{"onUpdate:modelValue":o=>a.item_name=o,class:"border rounded px-1 py-0.5 w-full",required:""},null,8,H),[[u,a.item_name]])]),e("td",L,[r(e("input",{"onUpdate:modelValue":o=>a.description=o,class:"border rounded px-1 py-0.5 w-full"},null,8,O),[[u,a.description]])]),e("td",Q,[r(e("input",{"onUpdate:modelValue":o=>a.specifications=o,class:"border rounded px-1 py-0.5 w-full"},null,8,z),[[u,a.specifications]])]),e("td",J,[r(e("input",{"onUpdate:modelValue":o=>a.quantity=o,type:"number",min:"1",class:"border rounded px-1 py-0.5 w-14",required:"",onInput:o=>g(b)},null,40,K),[[u,a.quantity,void 0,{number:!0}]])]),e("td",W,[r(e("select",{"onUpdate:modelValue":o=>a.unit_id=o,class:"border rounded px-1 py-0.5 w-full",required:""},[s[5]||(s[5]=e("option",{value:"",disabled:""},"Pilih",-1)),(p(!0),d(U,null,V(_.value,o=>(p(),d("option",{key:o.id,value:o.id},k(o.name),9,Y))),128))],8,X),[[$,a.unit_id]])]),e("td",Z,[r(e("input",{"onUpdate:modelValue":o=>a.price=o,type:"number",min:"0",class:"border rounded px-1 py-0.5 w-20",onInput:o=>g(b)},null,40,ee),[[u,a.price,void 0,{number:!0}]])]),e("td",te,[r(e("input",{"onUpdate:modelValue":o=>a.subtotal=o,type:"number",min:"0",class:"border rounded px-1 py-0.5 w-24 bg-gray-100",readonly:""},null,8,se),[[u,a.subtotal,void 0,{number:!0}]])]),e("td",ae,[r(e("input",{"onUpdate:modelValue":o=>a.notes=o,class:"border rounded px-1 py-0.5 w-full"},null,8,oe),[[u,a.notes]])]),e("td",ne,[e("button",{type:"button",onClick:o=>I(b),class:"text-red-500 hover:text-red-700"},s[6]||(s[6]=[e("i",{class:"fas fa-trash"},null,-1)]),8,le)])]))),128))])]),e("button",{type:"button",onClick:m,class:"mt-2 px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600"},s[8]||(s[8]=[e("i",{class:"fas fa-plus"},null,-1),c(" Add Row")]))]),e("div",re,[s[10]||(s[10]=e("label",{class:"block text-sm font-semibold mr-2"},"Total Amount",-1)),r(e("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>t.value.total_amount=a),type:"number",class:"border rounded px-2 py-1 w-40 bg-gray-100",readonly:""},null,512),[[u,t.value.total_amount,void 0,{number:!0}]])]),i.value?(p(),d("div",ie,k(i.value),1)):P("",!0),y.value?(p(),d("div",ue,s[11]||(s[11]=[e("div",{class:"bg-white px-6 py-4 rounded shadow flex items-center gap-2"},[e("span",{class:"loader border-2 border-blue-500 border-t-transparent rounded-full w-6 h-6 animate-spin"}),e("span",null,"Menyimpan...")],-1)]))):P("",!0),s[12]||(s[12]=e("button",{type:"submit",class:"mt-2 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"},"Simpan PR",-1))],32)]))}},ve=C(de,[["__scopeId","data-v-1cd09533"]]);export{ve as default};
