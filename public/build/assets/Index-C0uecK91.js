import{r as k,c as I,W as y,A as K,B as l,C as R,D as e,G as x,N as r,H as _,J,V as T,L as n,E as C,F as N,M as A,l as E}from"./vendor-vue-g7iCcTkf.js";import{l as W}from"./lodash-DB3HVzpp.js";import{S as o}from"./app-5sHs3Z-e.js";import{a as S}from"./vendor-utils-CpgP2uT4.js";import{A as z}from"./AppLayout-IyEgvQ-G.js";import"./vendor-charts-CuqD4wLC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-C59QAxMM.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const Q={class:"w-full py-8 px-0"},X={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},Z={class:"bg-white rounded-xl shadow-lg p-4 border-l-4 border-blue-500"},tt={class:"text-2xl font-bold text-gray-800"},et={class:"bg-white rounded-xl shadow-lg p-4 border-l-4 border-green-500"},at={class:"text-2xl font-bold text-green-600"},st={class:"bg-white rounded-xl shadow-lg p-4 border-l-4 border-purple-500"},it={class:"text-2xl font-bold text-purple-600"},rt={class:"bg-white rounded-xl shadow-lg p-4 border-l-4 border-yellow-500"},lt={class:"text-2xl font-bold text-yellow-600"},ot={class:"bg-white rounded-xl shadow-lg p-4 mb-6"},nt={class:"flex gap-4 items-end"},dt={class:"flex-1"},ut={class:"flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors"},ct={class:"flex gap-2"},gt=["disabled"],mt=["disabled"],pt={key:0,class:"fa fa-spinner fa-spin"},xt={key:1,class:"fa fa-check-square"},ft=["disabled"],bt={key:0,class:"fa fa-spinner fa-spin"},yt={key:1,class:"fa fa-database"},ht={class:"bg-white rounded-xl shadow-lg overflow-hidden"},vt={class:"overflow-x-auto"},wt={class:"min-w-full divide-y divide-gray-200"},kt={class:"bg-gradient-to-r from-blue-500 to-blue-700 text-white"},_t={class:"px-6 py-3 text-left text-xs font-bold uppercase tracking-wider"},Ct={class:"bg-white divide-y divide-gray-200"},Bt={class:"px-6 py-4 whitespace-nowrap"},Tt=["value","disabled"],St={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Mt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},$t={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Dt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},It={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Nt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},At={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Et={key:0,class:"text-green-600 text-xs ml-1"},Vt={key:1,class:"text-yellow-600 text-xs ml-1"},jt={class:"px-6 py-4 whitespace-nowrap"},Gt={class:"px-6 py-4 whitespace-nowrap text-sm"},Lt=["onClick","disabled"],Pt={key:1,class:"text-green-600"},Yt={key:2,class:"text-gray-400"},Ut={key:0},Ft={key:0,class:"bg-gray-50 px-4 py-3 border-t border-gray-200"},Ht={class:"flex items-center justify-between"},Ot={class:"text-sm text-gray-700"},qt={class:"flex gap-2"},Kt=["onClick","disabled","innerHTML"],ie={__name:"Index",props:{customers:Object,filters:Object,stats:Object},setup(d){var $,D;const m=d,h=k((($=m.filters)==null?void 0:$.search)||""),v=k(((D=m.filters)==null?void 0:D.filter_not_migrated)!==void 0?m.filters.filter_not_migrated:!0),u=k(!1),c=k([]),w=I({get:()=>{const s=m.customers.data.filter(t=>t.can_migrate);return s.length>0&&s.every(t=>c.value.includes(t.id))},set:s=>{if(s){const t=m.customers.data.filter(a=>a.can_migrate).map(a=>a.id);c.value=[...new Set([...c.value,...t])]}else{const t=m.customers.data.map(a=>a.id);c.value=c.value.filter(a=>!t.includes(a))}}}),M=I(()=>m.customers.data.filter(s=>s.can_migrate).length);function V(){w.value=!w.value}const j=W.debounce(()=>{y.get("/member-migration",{search:h.value,filter_not_migrated:v.value?"1":"0"},{preserveState:!0,replace:!0})},400);function G(){j()}function L(){y.get("/member-migration",{search:h.value,filter_not_migrated:v.value?"1":"0"},{preserveState:!0,replace:!0})}function P(s){s&&y.visit(s,{preserveState:!0,replace:!0})}function Y(s){return s?new Date(s).toLocaleDateString("id-ID"):"-"}function U(s){return{ready:"Siap Migrasi",migrated:"Sudah Migrasi",no_email:"Tidak Ada Email"}[s]||s}async function F(s){var a,g;if((await o.fire({title:"Migrasi Member?",text:"Yakin ingin migrasi member ini?",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#6c757d",confirmButtonText:"Ya, Migrasi",cancelButtonText:"Batal"})).isConfirmed){u.value=!0;try{const i=await S.post(`/member-migration/${s}/migrate`);i.data.success?(await o.fire({icon:"success",title:"Berhasil",text:i.data.message}),y.reload()):await o.fire({icon:"error",title:"Gagal",text:i.data.message})}catch(i){await o.fire({icon:"error",title:"Gagal",text:((g=(a=i.response)==null?void 0:a.data)==null?void 0:g.message)||"Gagal migrasi member"})}finally{u.value=!1}}}async function H(){var a,g;if(c.value.length===0){await o.fire({icon:"warning",title:"Tidak Ada Pilihan",text:"Silakan pilih customer yang akan di-migrasi"});return}const s=c.value.filter(i=>{const b=m.customers.data.find(p=>p.id===i);return b&&b.can_migrate});if(s.length===0){await o.fire({icon:"warning",title:"Tidak Ada yang Siap",text:"Customer yang dipilih tidak dapat di-migrasi"});return}if((await o.fire({title:"Migrasi Terpilih?",text:`Yakin ingin migrasi ${s.length} member yang dipilih?`,icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#6c757d",confirmButtonText:"Ya, Migrasi",cancelButtonText:"Batal"})).isConfirmed){u.value=!0;try{const i=await S.post("/member-migration/migrate-multiple",{customer_ids:s});i.data.success?(await o.fire({icon:"success",title:"Berhasil",html:`
          <p>${i.data.message}</p>
          ${i.data.errors&&i.data.errors.length>0?`
            <div class="mt-4 text-left">
              <p class="font-semibold">Error Details:</p>
              <ul class="list-disc list-inside text-sm mt-2">
                ${i.data.errors.slice(0,10).map(b=>`<li>${b}</li>`).join("")}
                ${i.data.errors.length>10?`<li>... dan ${i.data.errors.length-10} error lainnya</li>`:""}
              </ul>
            </div>
          `:""}
        `,width:"600px"}),c.value=[],y.reload()):await o.fire({icon:"error",title:"Gagal",text:i.data.message})}catch(i){await o.fire({icon:"error",title:"Gagal",text:((g=(a=i.response)==null?void 0:a.data)==null?void 0:g.message)||"Gagal migrasi member"})}finally{u.value=!1}}}async function O(){var a,g,i,b;const s=m.customers.data.filter(p=>p.can_migrate);if(s.length===0){await o.fire({icon:"warning",title:"Tidak Ada Data",text:"Tidak ada customer yang siap untuk di-migrasi di halaman ini"});return}if((await o.fire({title:"Migrasi Halaman Ini?",html:`
      <p>Yakin ingin migrasi <strong>${s.length} member</strong> yang siap di halaman ini?</p>
      <p class="text-sm text-gray-600 mt-2">Ini hanya akan memigrasi customer yang terlihat di halaman saat ini.</p>
    `,icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#6c757d",confirmButtonText:"Ya, Migrasi",cancelButtonText:"Batal"})).isConfirmed){u.value=!0;try{const p=s.map(B=>B.id),f=await S.post("/member-migration/migrate-multiple",{customer_ids:p});f.data.success?(await o.fire({icon:"success",title:"Berhasil",html:`
          <p>${f.data.message}</p>
          ${f.data.errors&&f.data.errors.length>0?`
            <div class="mt-4 text-left">
              <p class="font-semibold">Error Details:</p>
              <ul class="list-disc list-inside text-sm mt-2 max-h-60 overflow-y-auto">
                ${f.data.errors.slice(0,10).map(B=>`<li>${B}</li>`).join("")}
                ${f.data.errors.length>10?`<li>... dan ${f.data.errors.length-10} error lainnya</li>`:""}
              </ul>
            </div>
          `:""}
        `,width:"600px"}),y.reload()):await o.fire({icon:"error",title:"Gagal",text:f.data.message})}catch(p){await o.fire({icon:"error",title:"Gagal",html:`
        <p>${((g=(a=p.response)==null?void 0:a.data)==null?void 0:g.message)||"Gagal migrasi member"}</p>
        ${(b=(i=p.response)==null?void 0:i.data)!=null&&b.suggestion?`
          <div class="mt-4 bg-blue-50 p-3 rounded text-left">
            <p class="font-semibold text-sm">Saran:</p>
            <p class="text-sm">${p.response.data.suggestion}</p>
          </div>
        `:""}
      `})}finally{u.value=!1}}}function q(){if(m.stats.ready===0){o.fire({icon:"warning",title:"Tidak Ada Data",text:"Tidak ada customer yang siap untuk di-export"});return}o.fire({title:"Export CSV?",html:`
      <div class="text-left">
        <p>Yakin ingin export <strong>${m.stats.ready} customer</strong> yang belum migrasi ke CSV?</p>
        <p class="text-sm text-gray-600 mt-2">File CSV ini bisa langsung diimport ke Navicat ke table <strong>member_apps_members</strong></p>
        <div class="mt-4 p-3 bg-blue-50 rounded-lg text-sm">
          <p class="font-semibold mb-2">Penting saat Import di Navicat:</p>
          <ul class="list-disc list-inside space-y-1 text-xs">
            <li>Setting "Replace NULL with" harus <strong>DIKOSONGKAN</strong></li>
            <li>Field "id" TIDAK perlu di-map (AUTO_INCREMENT)</li>
            <li>Jika ada error duplicate, skip record tersebut</li>
            <li>Password default: <strong>default123</strong> (sudah di-hash)</li>
          </ul>
        </div>
      </div>
    `,icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#6c757d",confirmButtonText:"Ya, Export",cancelButtonText:"Batal",width:"600px"}).then(s=>{s.isConfirmed&&(window.location.href="/member-migration/export-csv")})}return(s,t)=>(l(),K(z,null,{default:R(()=>[e("div",Q,[t[28]||(t[28]=e("div",{class:"flex justify-between items-center mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-800 flex items-center gap-2"},[e("i",{class:"fa-solid fa-database"}),x(" Migrasi Data Member ")])],-1)),e("div",X,[e("div",Z,[t[4]||(t[4]=e("div",{class:"text-sm text-gray-600 mb-1"},"Total Customer",-1)),e("div",tt,r(d.stats.total),1)]),e("div",et,[t[5]||(t[5]=e("div",{class:"text-sm text-gray-600 mb-1"},"Siap Migrasi",-1)),e("div",at,r(d.stats.ready),1)]),e("div",st,[t[6]||(t[6]=e("div",{class:"text-sm text-gray-600 mb-1"},"Sudah Migrasi",-1)),e("div",it,r(d.stats.migrated),1)]),e("div",rt,[t[7]||(t[7]=e("div",{class:"text-sm text-gray-600 mb-1"},"Tidak Ada Email",-1)),e("div",lt,r(d.stats.no_email),1)])]),e("div",ot,[e("div",nt,[e("div",dt,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Cari",-1)),_(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=a=>h.value=a),onInput:G,placeholder:"Cari nama, email, ID, atau telepon...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,544),[[J,h.value]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Filter",-1)),e("label",ut,[_(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=a=>v.value=a),onChange:L,class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,544),[[T,v.value]]),t[9]||(t[9]=e("span",{class:"text-sm text-gray-700"},"Hanya Belum Migrasi",-1))])]),e("div",ct,[e("button",{onClick:q,disabled:u.value||d.stats.ready===0,class:"px-6 py-2 bg-gradient-to-r from-purple-500 to-purple-700 text-white rounded-lg font-semibold hover:from-purple-600 hover:to-purple-800 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"Export CSV untuk import langsung ke Navicat"},[t[11]||(t[11]=e("i",{class:"fa fa-file-csv"},null,-1)),x(" Export CSV ("+r(d.stats.ready)+") ",1)],8,gt),t[12]||(t[12]=e("div",{class:"text-xs text-gray-500 mt-1"},[e("i",{class:"fa fa-info-circle"}),x(' Pastikan setting Navicat: "Replace NULL with" dikosongkan ')],-1)),c.value.length>0?(l(),n("button",{key:0,onClick:H,disabled:u.value,class:"px-6 py-2 bg-gradient-to-r from-blue-500 to-blue-700 text-white rounded-lg font-semibold hover:from-blue-600 hover:to-blue-800 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[u.value?(l(),n("i",pt)):(l(),n("i",xt)),x(" Migrasi Terpilih ("+r(c.value.length)+") ",1)],8,mt)):C("",!0),e("button",{onClick:O,disabled:u.value||M.value===0,class:"px-6 py-2 bg-gradient-to-r from-green-500 to-green-700 text-white rounded-lg font-semibold hover:from-green-600 hover:to-green-800 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[u.value?(l(),n("i",bt)):(l(),n("i",yt)),x(" Migrasi Halaman Ini ("+r(M.value)+") ",1)],8,ft)])])]),e("div",ht,[e("div",vt,[e("table",wt,[e("thead",kt,[e("tr",null,[e("th",_t,[_(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=a=>w.value=a),onChange:V,class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,544),[[T,w.value]])]),t[13]||(t[13]=e("th",{class:"px-6 py-3 text-left text-xs font-bold uppercase tracking-wider"},"ID",-1)),t[14]||(t[14]=e("th",{class:"px-6 py-3 text-left text-xs font-bold uppercase tracking-wider"},"Nama",-1)),t[15]||(t[15]=e("th",{class:"px-6 py-3 text-left text-xs font-bold uppercase tracking-wider"},"Email",-1)),t[16]||(t[16]=e("th",{class:"px-6 py-3 text-left text-xs font-bold uppercase tracking-wider"},"Telepon",-1)),t[17]||(t[17]=e("th",{class:"px-6 py-3 text-left text-xs font-bold uppercase tracking-wider"},"Tanggal Lahir",-1)),t[18]||(t[18]=e("th",{class:"px-6 py-3 text-left text-xs font-bold uppercase tracking-wider"},"Jenis Kelamin",-1)),t[19]||(t[19]=e("th",{class:"px-6 py-3 text-left text-xs font-bold uppercase tracking-wider"},"Pekerjaan",-1)),t[20]||(t[20]=e("th",{class:"px-6 py-3 text-left text-xs font-bold uppercase tracking-wider"},"Status",-1)),t[21]||(t[21]=e("th",{class:"px-6 py-3 text-left text-xs font-bold uppercase tracking-wider"},"Aksi",-1))])]),e("tbody",Ct,[(l(!0),n(N,null,A(d.customers.data,a=>(l(),n("tr",{key:a.id,class:"hover:bg-gray-50"},[e("td",Bt,[_(e("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=g=>c.value=g),value:a.id,disabled:!a.can_migrate,class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,8,Tt),[[T,c.value]])]),e("td",St,r(a.costumers_id),1),e("td",Mt,r(a.name),1),e("td",$t,r(a.email||"-"),1),e("td",Dt,r(a.telepon||"-"),1),e("td",It,r(a.tanggal_lahir?Y(a.tanggal_lahir):"-"),1),e("td",Nt,r(a.jenis_kelamin_text||"-"),1),e("td",At,[x(r(a.pekerjaan||"-")+" ",1),a.pekerjaan_id_mapped?(l(),n("span",Et,t[22]||(t[22]=[e("i",{class:"fa fa-check"},null,-1)]))):a.pekerjaan?(l(),n("span",Vt,t[23]||(t[23]=[e("i",{class:"fa fa-exclamation-triangle"},null,-1)]))):C("",!0)]),e("td",jt,[e("span",{class:E([{"bg-green-100 text-green-800":a.migration_status==="ready","bg-purple-100 text-purple-800":a.migration_status==="migrated","bg-yellow-100 text-yellow-800":a.migration_status==="no_email"},"px-2 py-1 rounded-full text-xs font-semibold"])},r(U(a.migration_status)),3)]),e("td",Gt,[a.can_migrate?(l(),n("button",{key:0,onClick:g=>F(a.id),disabled:u.value,class:"text-blue-600 hover:text-blue-800 font-semibold disabled:opacity-50 disabled:cursor-not-allowed"},t[24]||(t[24]=[e("i",{class:"fa fa-upload mr-1"},null,-1),x(" Migrasi ")]),8,Lt)):a.is_migrated?(l(),n("span",Pt,t[25]||(t[25]=[e("i",{class:"fa fa-check-circle"},null,-1),x(" Sudah Migrasi ")]))):(l(),n("span",Yt,t[26]||(t[26]=[e("i",{class:"fa fa-ban"},null,-1),x(" Tidak Dapat Migrasi ")])))])]))),128)),d.customers.data.length===0?(l(),n("tr",Ut,t[27]||(t[27]=[e("td",{colspan:"10",class:"px-6 py-4 text-center text-gray-500"}," Tidak ada data ",-1)]))):C("",!0)])])]),d.customers.links&&d.customers.links.length>3?(l(),n("div",Ft,[e("div",Ht,[e("div",Ot," Menampilkan "+r(d.customers.from)+" sampai "+r(d.customers.to)+" dari "+r(d.customers.total)+" data ",1),e("div",qt,[(l(!0),n(N,null,A(d.customers.links,a=>(l(),n("button",{key:a.label,onClick:g=>P(a.url),disabled:!a.url,innerHTML:a.label,class:E({"px-4 py-2 rounded-lg font-semibold":!0,"bg-blue-500 text-white":a.active,"bg-white text-gray-700 hover:bg-gray-100":!a.active&&a.url,"bg-gray-100 text-gray-400 cursor-not-allowed":!a.url})},null,10,Kt))),128))])])])):C("",!0)])])]),_:1}))}};export{ie as default};
