import{r as g,P as He,w as le,a as qe,b as Pe,L as m,B as d,x as F,A as Ee,C as J,D as n,N as K,E as X,G as O,H as re,F as Z,M as ie,I as $e,Z as Fe,J as Te,T as Me}from"./vendor-vue-g7iCcTkf.js";import{_ as De}from"./Modal-BBL5yay4.js";import{_ as Ie}from"./TextInput-B7P_xVe4.js";import{P as Le}from"./PrimaryButton-BbBAD9SX.js";import{_ as Ve}from"./SecondaryButton-DMNVinm_.js";import{a as de}from"./vendor-utils-CpgP2uT4.js";import Ne from"./SmallPrintPreview-DsLcUPiu.js";import{J as ce}from"./JsBarcode-7kUKaxTf.js";import{E as ue}from"./jspdf.es.min-C4-Cm-Ip.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./app-e_83ELsm.js";import"./vendor-charts-CuqD4wLC.js";const je={class:"p-6"},ze={class:"text-lg font-medium text-gray-900"},Qe={class:"mt-6"},Re={class:"mb-6"},Ue={class:"flex items-center justify-between mb-4"},Ye={class:"flex items-center gap-2"},Ae={key:0,class:"mb-2"},Ge={key:0,class:"mb-2"},Je=["value"],Ke={class:"flex gap-2"},Xe={key:0},Oe={key:1},Ze={class:"mt-4"},et={class:"min-w-full divide-y divide-gray-200"},tt={class:"bg-white divide-y divide-gray-200"},nt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},at={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium flex items-center justify-end gap-2"},st=["onUpdate:modelValue"],ot=["onClick"],lt=["onClick"],rt=["onClick"],it=["onClick"],dt={class:"mt-6 flex justify-end"},ct={key:0,class:"fixed inset-0 z-[99999] flex items-center justify-center bg-black/60"},ut={class:"bg-white rounded-xl shadow-lg p-4"},mt={class:"flex justify-end mt-4"},St={__name:"ItemBarcodeModal",props:{show:Boolean,item:Object},emits:["close"],setup(z,{emit:me}){var se;const l=z,fe=me,ee=g(((se=l.item)==null?void 0:se.barcodes)||[]),w=g(""),_=g(!1),T=g([]),W=g("");let o=null;const M=g(!1),H=g({}),Q=g(!1),D=g({sku:"",name:"",qty:1}),pe=He({barcode:""});le(_,async t=>{if(t)if(window.Html5Qrcode)te();else{const e=document.createElement("script");e.src="https://unpkg.com/html5-qrcode",e.onload=te,document.body.appendChild(e)}else if(o)try{await o.stop(),o.clear();const e=document.getElementById("qr-reader");e&&(e.innerHTML="")}catch(e){console.error("Error cleaning up scanner:",e)}});async function te(){var t;if(window.Html5Qrcode)try{T.value=await window.Html5Qrcode.getCameras(),W.value=((t=T.value[0])==null?void 0:t.id)||"",ne()}catch(e){console.error("Error setting up cameras:",e)}}function ne(){if(!(!window.Html5Qrcode||!W.value)){if(o)try{o.stop().then(()=>{o.clear();const t=document.getElementById("qr-reader");t&&(t.innerHTML="")})}catch(t){console.error("Error cleaning up existing scanner:",t)}o=new window.Html5Qrcode("qr-reader"),o.start(W.value,{fps:10,qrbox:200},t=>{w.value=t,R()}).catch(t=>{console.error("Error starting scanner:",t)})}}function ge(){ne()}function he(){_.value=!1}const I=async()=>{try{const t=await de.get(route("items.barcodes.index",l.item.id));ee.value=t.data.barcodes}catch{}},R=async()=>{var t,e,r;if(w.value){M.value=!0;try{await de.post(route("items.barcodes.store",l.item.id),{barcode:w.value}),await I(),w.value=""}catch(a){if(a.response&&a.response.status===422){const f=((r=(e=(t=a.response.data)==null?void 0:t.errors)==null?void 0:e.barcode)==null?void 0:r[0])||"Gagal menyimpan barcode";alert(f)}else alert("Terjadi kesalahan server")}finally{M.value=!1}}},ve=async t=>{window.confirm("Hapus barcode ini?")&&pe.delete(route("items.barcodes.destroy",[l.item.id,t.id]),{preserveScroll:!0,onSuccess:()=>{I()}})},ae=()=>{if(_.value=!1,o)try{o.stop().then(()=>{o.clear();const t=document.getElementById("qr-reader");t&&(t.innerHTML="")})}catch(t){console.error("Error cleaning up scanner:",t)}fe("close")};le(()=>l.show,t=>{t&&(I(),_.value=!1)}),qe(async()=>{I()}),Pe(()=>{if(o)try{o.stop().then(()=>{o.clear();const t=document.getElementById("qr-reader");t&&(t.innerHTML="")})}catch(t){console.error("Error cleaning up scanner:",t)}});function ye(t,e){var r;D.value={sku:t,name:((r=l.item)==null?void 0:r.name)||"",qty:e},Q.value=!0}function be(t,e){var C,h,q,p,P,B,y,b,x;const L=e,Y=Math.ceil(L/3),A=297,c=210,s=new ue({orientation:"landscape",unit:"mm",format:[A,c]}),k=Array(L).fill(t);let v=5;for(let E=0;E<Y;E++){for(let $=0;$<3;$++){const S=E*3+$;if(S>=k.length)continue;const u=5+$*105,oe=k[S];s.setDrawColor(0,0,0),s.setLineWidth(.5),s.rect(u,v,100,50);const G=90,V=20,N=3,j=document.createElement("canvas");j.width=G*N,j.height=V*N,ce(j,oe,{width:1.5*N,height:V*N,displayValue:!1});const _e=u+(100-G)/2;s.addImage(j,"PNG",_e,v+3,G,V);let i=v+V+5;s.setFontSize(8),s.setFont(void 0,"bold"),s.text(`SKU: ${oe}`,u+100/2,i,{align:"center"}),i+=4;const ke=((C=l.item)==null?void 0:C.name)||"";s.setFontSize(9),s.setFont(void 0,"bold"),s.text(`Nama: ${ke}`,u+100/2,i,{align:"center"}),i+=4.5;const Ce=((q=(h=l.item)==null?void 0:h.warehouse_division)==null?void 0:q.name)||"-";s.setFontSize(6),s.setFont(void 0,"normal"),s.text(`Warehouse: ${Ce}`,u+100/2,i,{align:"center"}),i+=3;const Be=((P=(p=l.item)==null?void 0:p.category)==null?void 0:P.name)||"-";s.text(`Category: ${Be}`,u+100/2,i,{align:"center"}),i+=3;const Se=((y=(B=l.item)==null?void 0:B.sub_category)==null?void 0:y.name)||"-";s.text(`Sub Category: ${Se}`,u+100/2,i,{align:"center"}),i+=3;const We=((b=l.item)==null?void 0:b.sku)||((x=l.item)==null?void 0:x.code)||"-";s.text(`Code: ${We}`,u+100/2,i,{align:"center"})}v+=55}s.save(`${t}_labels_10x5cm.pdf`)}function xe(t,e){var v;const U=e,L=Math.ceil(U/3),Y=297,A=210,c=new ue({orientation:"landscape",unit:"mm",format:[Y,A]}),s=Array(U).fill(t);let k=2;for(let C=0;C<L;C++){for(let h=0;h<3;h++){const q=C*3+h;if(q>=s.length)continue;let p;h===0?p=5:h===1?p=35:p=65;const P=s[q],B=24,y=9,b=2,x=document.createElement("canvas");x.width=B*b,x.height=y*b,ce(x,P,{width:1*b,height:y*b,displayValue:!1});const E=p+(25-B)/2;c.addImage(x,"PNG",E,k+.2,B,y);let S=k+y+.5;c.setFontSize(4),c.setFont(void 0,"bold"),c.text(P,p+25/2,S,{align:"center"}),S+=1.5;const u=((v=l.item)==null?void 0:v.name)||"";c.setFontSize(3),c.setFont(void 0,"bold"),c.text(u,p+25/2,S,{align:"center"})}k+=15}c.save(`${t}_small_labels_3x1.5cm.pdf`)}return(t,e)=>(d(),m(Z,null,[F(De,{show:z.show,onClose:ae},{default:J(()=>{var r;return[n("div",je,[n("h2",ze," Manage Barcodes for "+K((r=z.item)==null?void 0:r.name),1),n("div",Qe,[n("div",Re,[n("div",Ue,[e[5]||(e[5]=n("h3",{class:"text-md font-medium text-gray-700"},"Scan Barcode",-1)),n("div",Ye,[n("button",{onClick:e[0]||(e[0]=a=>_.value=!0),class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-500 hover:bg-green-600"},e[4]||(e[4]=[n("i",{class:"fa-solid fa-qrcode mr-2"},null,-1),O(" Scan Barcode ")]))])]),_.value?(d(),m("div",Ae,[T.value.length>1?(d(),m("div",Ge,[re(n("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>W.value=a),onChange:ge,class:"border rounded px-2 py-1"},[(d(!0),m(Z,null,ie(T.value,a=>(d(),m("option",{key:a.id,value:a.id},K(a.label),9,Je))),128))],544),[[$e,W.value]])])):X("",!0),e[6]||(e[6]=n("div",{id:"qr-reader",style:{width:"100%"}},null,-1)),n("button",{onClick:he,class:"mt-2 bg-gray-300 hover:bg-gray-400 text-gray-700 px-3 py-1 rounded"},"Tutup Scanner")])):X("",!0)]),n("div",Ke,[F(Ie,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=a=>w.value=a),type:"text",class:"flex-1",placeholder:"Enter barcode",onKeyup:Fe(R,["enter"])},null,8,["modelValue"]),F(Le,{onClick:R,disabled:M.value},{default:J(()=>[M.value?(d(),m("span",Xe,e[7]||(e[7]=[n("i",{class:"fa fa-spinner fa-spin"},null,-1),O(" Menyimpan... ")]))):(d(),m("span",Oe," Add "))]),_:1},8,["disabled"])]),n("div",Ze,[n("table",et,[e[11]||(e[11]=n("thead",{class:"bg-gray-50"},[n("tr",null,[n("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Barcode "),n("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),n("tbody",tt,[(d(!0),m(Z,null,ie(ee.value,a=>(d(),m("tr",{key:a.id},[n("td",nt,K(a.barcode),1),n("td",at,[re(n("input",{type:"number","onUpdate:modelValue":f=>H.value[a.id]=f,min:"1",class:"w-14 border rounded px-1 mr-2"},null,8,st),[[Te,H.value[a.id],void 0,{number:!0}]]),n("button",{onClick:f=>ye(a.barcode,H.value[a.id]||1),class:"text-teal-600 hover:text-teal-900 mr-2",title:"Small Label Preview"},e[8]||(e[8]=[n("i",{class:"fa-solid fa-tag"},null,-1)]),8,ot),n("button",{onClick:f=>be(a.barcode,H.value[a.id]||1),class:"text-blue-600 hover:text-blue-900 mr-2",title:"Download PDF (10x5cm)"},e[9]||(e[9]=[n("i",{class:"fa-solid fa-file-pdf"},null,-1)]),8,lt),n("button",{onClick:f=>xe(a.barcode,H.value[a.id]||1),class:"text-indigo-600 hover:text-indigo-900 mr-2",title:"Download Small Label PDF (3x1.5cm)"},e[10]||(e[10]=[n("i",{class:"fa-solid fa-tag"},null,-1)]),8,rt),n("button",{onClick:f=>ve(a),class:"text-red-600 hover:text-red-900"}," Delete ",8,it)])]))),128))])])])]),n("div",dt,[F(Ve,{onClick:ae},{default:J(()=>e[12]||(e[12]=[O(" Close ")])),_:1})])])]}),_:1},8,["show"]),(d(),Ee(Me,{to:"body"},[Q.value?(d(),m("div",ct,[n("div",ut,[F(Ne,{sku:D.value.sku,name:D.value.name,qty:D.value.qty},null,8,["sku","name","qty"]),n("div",mt,[n("button",{onClick:e[3]||(e[3]=r=>Q.value=!1),class:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"},"Tutup")])])])):X("",!0)]))],64))}};export{St as default};
