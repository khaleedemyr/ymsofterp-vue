import{_}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as g,a as M,j as S,L as s,B as i,D as a,N as E,E as v,l as U,G as f}from"./vendor-vue-g7iCcTkf.js";import"./vendor-utils-CpgP2uT4.js";const j={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60"},B={class:"bg-white w-full h-full sm:h-auto sm:max-h-[90vh] sm:max-w-xl sm:rounded-2xl shadow-2xl relative flex flex-col"},T={class:"flex-shrink-0 p-4 border-b border-gray-200 bg-gray-50 sm:bg-white sm:rounded-t-2xl"},L={class:"flex items-center justify-between"},$={class:"text-lg font-bold text-gray-900"},z={class:"flex-1 flex flex-col min-h-0 p-4"},D={class:"relative bg-black rounded-lg overflow-hidden mb-4 flex-1 min-h-0"},V={key:0,class:"absolute top-3 left-3"},G={key:0,class:"flex items-center gap-2 px-3 py-2 bg-red-600 text-white rounded-full text-sm font-medium"},N={class:"flex-shrink-0 space-y-3"},P={key:0,class:"flex gap-3"},K={key:1,class:"flex gap-3"},O={class:"text-center text-xs text-gray-500 px-2"},A={key:0},F={key:1},H={key:2},I={__name:"CameraModal",props:{mode:{type:String,default:"photo"}},emits:["close","capture"],setup(c,{emit:y}){const h=y,p=c,o=g(null);let l=null,n=null,m=[];const r=g(!1),b=g(""),u=g("environment");async function k(e=null){try{l&&l.getTracks().forEach(d=>d.stop());const t={video:{facingMode:e||u.value,width:{ideal:1280},height:{ideal:720}},audio:p.mode==="video"};try{l=await navigator.mediaDevices.getUserMedia(t)}catch{console.log("Trying fallback camera..."),u.value=u.value==="user"?"environment":"user",l=await navigator.mediaDevices.getUserMedia({video:{facingMode:u.value,width:{ideal:1280},height:{ideal:720}},audio:p.mode==="video"})}o.value&&(o.value.srcObject=l,o.value.onloadedmetadata=()=>{console.log("Video ready:",o.value.videoWidth,"x",o.value.videoHeight)}),p.mode==="video"&&r.value&&x()}catch(t){console.error("Error accessing camera:",t),alert("Tidak dapat mengakses kamera. Pastikan Anda memberikan izin akses kamera.")}}async function w(){u.value=u.value==="user"?"environment":"user",await k()}M(async()=>{await k()}),S(()=>{l&&l.getTracks().forEach(e=>e.stop()),b.value&&URL.revokeObjectURL(b.value)});function R(){if(!o.value||!l){alert("Kamera belum siap. Silakan tunggu sebentar.");return}try{const e=document.createElement("canvas");e.width=o.value.videoWidth,e.height=o.value.videoHeight,e.getContext("2d").drawImage(o.value,0,0);const d=e.toDataURL("image/jpeg",.9);h("capture",d)}catch(e){console.error("Error capturing photo:",e),alert("Gagal mengambil foto. Silakan coba lagi.")}}function x(){if(!l){alert("Kamera belum siap. Silakan tunggu sebentar.");return}try{m=[],n=new MediaRecorder(l,{mimeType:"video/webm;codecs=vp8,opus"}),n.ondataavailable=e=>{e.data.size>0&&m.push(e.data)},n.onstop=()=>{const e=new Blob(m,{type:"video/webm"});b.value=URL.createObjectURL(e)},n.start(),r.value=!0,console.log("Recording started")}catch(e){console.error("Error starting recording:",e),alert("Gagal memulai perekaman. Silakan coba lagi.")}}function C(){if(n&&r.value)try{n.stop(),r.value=!1,console.log("Recording stopped"),n.onstop=()=>{const e=new Blob(m,{type:"video/webm"});h("capture",e)}}catch(e){console.error("Error stopping recording:",e),alert("Gagal menghentikan perekaman. Silakan coba lagi.")}}return(e,t)=>(i(),s("div",j,[a("div",B,[a("div",T,[a("div",L,[a("h2",$,E(c.mode==="photo"?"Ambil Foto":"Rekam Video"),1),a("button",{onClick:t[0]||(t[0]=d=>e.$emit("close")),class:"p-2 text-gray-400 hover:text-red-500 rounded-full hover:bg-gray-100 transition-colors"},t[3]||(t[3]=[a("i",{class:"fas fa-times text-xl"},null,-1)]))])]),a("div",z,[a("div",D,[a("video",{ref_key:"video",ref:o,autoplay:"",playsinline:"",class:U(["w-full h-full object-cover",c.mode==="photo"?"aspect-[4/3]":"aspect-video"])},null,2),a("button",{onClick:w,class:"absolute top-3 right-3 p-3 bg-black/60 hover:bg-black/80 text-white rounded-full transition-all shadow-lg",title:"Switch Kamera"},t[4]||(t[4]=[a("i",{class:"fas fa-camera-rotate text-lg"},null,-1)])),c.mode==="video"?(i(),s("div",V,[r.value?(i(),s("div",G,t[5]||(t[5]=[a("div",{class:"w-2 h-2 bg-white rounded-full animate-pulse"},null,-1),f(" Recording... ")]))):v("",!0)])):v("",!0)]),a("div",N,[c.mode==="photo"?(i(),s("div",P,[a("button",{onClick:t[1]||(t[1]=d=>e.$emit("close")),class:"flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium"}," Batal "),a("button",{onClick:R,class:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-lg"},t[6]||(t[6]=[a("i",{class:"fas fa-camera mr-2"},null,-1),f(" Capture ")]))])):(i(),s("div",K,[a("button",{onClick:t[2]||(t[2]=d=>e.$emit("close")),class:"flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium"}," Batal "),r.value?v("",!0):(i(),s("button",{key:0,onClick:x,class:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-lg"},t[7]||(t[7]=[a("i",{class:"fas fa-video mr-2"},null,-1),f(" Mulai Rekam ")]))),r.value?(i(),s("button",{key:1,onClick:C,class:"flex-1 px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium shadow-lg"},t[8]||(t[8]=[a("i",{class:"fas fa-stop mr-2"},null,-1),f(" Stop Rekam ")]))):v("",!0)])),a("div",O,[c.mode==="photo"?(i(),s("p",A,"Posisikan kamera dan tekan Capture")):r.value?(i(),s("p",H,"Tekan Stop Rekam untuk mengakhiri")):(i(),s("p",F,"Tekan Mulai Rekam untuk memulai"))])])])])]))}},Q=_(I,[["__scopeId","data-v-0c9f6331"]]);export{Q as default};
