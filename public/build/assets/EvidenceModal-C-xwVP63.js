import{r as m,A as M,B as n,C as y,x,Q as f,D as t,L as d,E as w,F as V,M as L,H as T,J as Y}from"./vendor-vue-g7iCcTkf.js";import{a as q}from"./vendor-utils-CpgP2uT4.js";import{S as F}from"./app-D3yJLFoH.js";import H from"./CameraModal-UOq4SzNh.js";import{Y as J,h as R,_ as Q,G as W,S as K}from"./vendor-ui-CrPgGUUb.js";import"./vendor-charts-CuqD4wLC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const X={class:"fixed inset-0 overflow-y-auto"},Z={class:"flex min-h-full items-center justify-center p-4"},ee={class:"space-y-4"},te={key:0,class:"flex gap-4 justify-center"},se={key:2,class:"space-y-4"},oe={key:0,class:"space-y-2"},ae={class:"flex flex-wrap gap-2"},le=["src"],ne=["onClick"],re={key:1,class:"space-y-2"},ie={class:"flex flex-wrap gap-2"},de=["src"],ue=["onClick"],ce={class:"space-y-2"},ve={class:"flex justify-end"},pe=["disabled"],me={key:0},fe={key:1},ke={__name:"EvidenceModal",props:{taskId:{type:[String,Number],required:!0}},emits:["close","evidence-added"],setup(U,{emit:z}){const $=U,S=z,B=m(!0),_=m(""),k=m(!1),u=m([]),r=m([]),b=m(!1),C=m("photo");function A(s){C.value=s,b.value=!0}function D(){b.value=!1}function N(s){C.value==="photo"?u.value.push(s):C.value==="video"&&r.value.push({blob:s,url:URL.createObjectURL(s)}),b.value=!1}const j=()=>{S("close")},P=s=>{u.value.splice(s,1)},O=s=>{var e;(e=r.value[s])!=null&&e.url&&URL.revokeObjectURL(r.value[s].url),r.value.splice(s,1)};function G(s,e){for(var o=s.split(","),i=o[0].match(/:(.*?);/)[1],v=atob(o[1]),p=v.length,h=new Uint8Array(p);p--;)h[p]=v.charCodeAt(p);return new File([h],e,{type:i})}const I=async()=>{var s,e,o,i,v,p,h;if(!u.value.length&&!r.value.length){F.fire("Warning","Please capture at least one photo or video","warning");return}k.value=!0;try{const l=new FormData;l.append("task_id",$.taskId),l.append("notes",_.value),u.value.forEach((c,E)=>{const a=G(c,`photo_${E}.jpg`);a&&a.size>0&&(console.log("Adding photo:",a.name,a.type,a.size),l.append("media[]",a))}),r.value.forEach((c,E)=>{const a=new File([c.blob],`video_${E}.webm`,{type:"video/webm"});a&&a.size>0&&(console.log("Adding video:",a.name,a.type,a.size),l.append("media[]",a))}),console.log("FormData contents:");for(let c of l.entries())console.log(c[0],c[1],(s=c[1])==null?void 0:s.type,(e=c[1])==null?void 0:e.name,(o=c[1])==null?void 0:o.size);const g=await q.post("/api/maintenance-evidence",l,{headers:{"Content-Type":"multipart/form-data"}});console.log("Response:",g.data),F.fire("Success","Evidence submitted successfully","success"),S("evidence-added"),j(),u.value=[],r.value=[],_.value=""}catch(l){console.error("Error submitting evidence:",l);let g="Failed to submit evidence";(v=(i=l.response)==null?void 0:i.data)!=null&&v.errors?g=Object.values(l.response.data.errors).flat().join("<br>"):(h=(p=l.response)==null?void 0:p.data)!=null&&h.message&&(g=l.response.data.message),F.fire("Error",g,"error")}finally{k.value=!1}};return(s,e)=>(n(),M(f(K),{appear:"",show:B.value,as:"template"},{default:y(()=>[x(f(J),{as:"div",onClose:j,class:"relative z-[8888]"},{default:y(()=>[x(f(R),{enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:y(()=>[x(f(Q),{class:"fixed inset-0 bg-black/40"})]),_:1}),t("div",X,[t("div",Z,[x(f(R),{enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:y(()=>[x(f(W),{class:"w-full max-w-3xl transform overflow-hidden rounded-lg bg-white p-6 text-left align-middle shadow-xl transition-all"},{default:y(()=>[t("div",{class:"flex justify-between items-center mb-4"},[e[4]||(e[4]=t("h3",{class:"text-lg font-medium leading-6 text-gray-900"}," Add Evidence ",-1)),t("button",{onClick:j,class:"text-gray-400 hover:text-gray-500"},e[3]||(e[3]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",ee,[b.value?w("",!0):(n(),d("div",te,[t("button",{onClick:e[0]||(e[0]=o=>A("photo")),class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"},"Ambil Foto"),t("button",{onClick:e[1]||(e[1]=o=>A("video")),class:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"},"Rekam Video")])),b.value?(n(),M(H,{key:1,mode:C.value,onClose:D,onCapture:N},null,8,["mode"])):w("",!0),u.value.length>0||r.value.length>0?(n(),d("div",se,[e[9]||(e[9]=t("h4",{class:"font-medium text-gray-700"},"Captured Media",-1)),u.value.length>0?(n(),d("div",oe,[e[6]||(e[6]=t("h5",{class:"text-sm font-medium text-gray-600"},"Photos",-1)),t("div",ae,[(n(!0),d(V,null,L(u.value,(o,i)=>(n(),d("div",{key:i,class:"relative"},[t("img",{src:o,class:"w-24 h-24 object-cover rounded"},null,8,le),t("button",{onClick:v=>P(i),class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600"},e[5]||(e[5]=[t("i",{class:"fas fa-times"},null,-1)]),8,ne)]))),128))])])):w("",!0),r.value.length>0?(n(),d("div",re,[e[8]||(e[8]=t("h5",{class:"text-sm font-medium text-gray-600"},"Videos",-1)),t("div",ie,[(n(!0),d(V,null,L(r.value,(o,i)=>(n(),d("div",{key:i,class:"relative"},[t("video",{src:o.url,class:"w-24 h-24 object-cover rounded",controls:""},null,8,de),t("button",{onClick:v=>O(i),class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600"},e[7]||(e[7]=[t("i",{class:"fas fa-times"},null,-1)]),8,ue)]))),128))])])):w("",!0)])):w("",!0),t("div",ce,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700"},"Notes",-1)),T(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=o=>_.value=o),rows:"3",class:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Add notes about the evidence..."},null,512),[[Y,_.value]])]),t("div",ve,[t("button",{onClick:I,disabled:k.value||!u.value.length&&!r.value.length,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed"},[k.value?(n(),d("span",me,"Submitting...")):(n(),d("span",fe,"Submit Evidence"))],8,pe)])])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}};export{ke as default};
