import{r as f,w as ae,c as se,A as I,B as r,C as T,D as t,L as l,E as b,G as i,x as re,Q as $,S as H,H as _,J as B,F as D,M as j,N as u,l as U,I as oe,W as m}from"./vendor-vue-g7iCcTkf.js";import{A as ne}from"./AppLayout-CytV2Jsj.js";import{S as d}from"./app-B-3LCfNP.js";import{a as le}from"./vendor-utils-CpgP2uT4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-BWyEbEQC.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const ue={class:"w-full py-8 px-0"},ie={class:"flex justify-between items-center mb-6"},de={class:"flex gap-2"},pe={class:"flex flex-wrap gap-3 mb-4 items-center"},ce={class:"bg-white rounded-2xl shadow-2xl overflow-x-auto transition-all"},fe={class:"w-full min-w-full divide-y divide-gray-200"},be={key:0},xe={class:"px-6 py-3 font-mono font-semibold text-blue-700"},me={class:"px-6 py-3"},ge={class:"px-6 py-3"},he={class:"px-6 py-3"},ve={class:"px-6 py-3"},ye={class:"px-6 py-3"},we={class:"px-6 py-3"},ke={class:"px-6 py-3"},_e={class:"px-6 py-3"},Ce={class:"flex gap-2 flex-wrap"},Se=["onClick"],Ae=["href"],Te=["onClick"],Be=["onClick"],De=["onClick"],je={class:"flex justify-end mt-4 gap-2"},Oe=["disabled","onClick","innerHTML"],Me={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40"},Ne={class:"bg-white rounded-xl shadow-2xl w-full max-w-md p-6"},Pe={class:"mb-4"},Ee=["value"],Ve={class:"flex justify-end gap-3"},Le=["disabled"],Fe={key:0,class:"fa fa-spinner fa-spin mr-2"},Ke={__name:"Index",props:{transfers:Object,filters:Object,outlets:Object,user:Object,users:Array,canDelete:Boolean},setup(x){var E,V,L;const o=x,h=f(((E=o.filters)==null?void 0:E.search)||""),v=f(((V=o.filters)==null?void 0:V.from)||""),y=f(((L=o.filters)==null?void 0:L.to)||""),C=f(!1),w=f(null),p=f([]),k=f(!1);ae(()=>o.filters,a=>{h.value=(a==null?void 0:a.search)||"",v.value=(a==null?void 0:a.from)||"",y.value=(a==null?void 0:a.to)||""},{immediate:!0});function W(a){return a?new Date(a).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"}):"-"}const z=se(()=>{var a;return(((a=o.user)==null?void 0:a.id_outlet)??null)==1});function O(a){var e;return!a||!o.outlets?"-":((e=o.outlets[a])==null?void 0:e.nama_outlet)||"-"}function M(){m.get("/outlet-transfer",{search:h.value,from:v.value,to:y.value},{preserveState:!0,replace:!0})}function J(){M()}function N(){M()}function G(a){a&&m.visit(a,{preserveState:!0,replace:!0})}function Y(a){m.visit(`/outlet-transfer/${a}`)}function q(a){return{draft:"Draft",submitted:"Menunggu Approval",approved:"Disetujui",rejected:"Ditolak"}[a]||a}function K(a){return{draft:"bg-gray-100 text-gray-800",submitted:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"}[a]||"bg-gray-100 text-gray-800"}function Q(a){const s=((a==null?void 0:a.approval_flows)||[]).filter(n=>(n==null?void 0:n.status)==="PENDING");return s.sort((n,c)=>(n.approval_level??0)-(c.approval_level??0)),s[0]||null}function R(a){var g;if(!o.user||!((g=a.warehouse_outlet_to)!=null&&g.name))return!1;const e=o.user.id_jabatan,s=o.user.status;if(o.user.id_role==="5af56935b011a"&&s==="A")return!0;const c=Q(a);if(c)return c.approver_id==o.user.id;switch(a.warehouse_outlet_to.name){case"Kitchen":return[163,174,180,345,346,347,348,349].includes(e)&&s==="A";case"Bar":return[175,182,323].includes(e)&&s==="A";case"Service":return[176,322,164,321].includes(e)&&s==="A";default:return!1}}function X(a){a&&(w.value=a,p.value=[],C.value=!0)}function P(){C.value=!1,w.value=null,p.value=[]}async function Z(){if(w.value){if(!p.value||p.value.length===0){d.fire("Error!","Pilih minimal 1 approver.","error");return}k.value=!0;try{await le.post(route("outlet-transfer.submit",w.value),{approvers:p.value}),P(),d.fire("Berhasil!","Transfer berhasil di-submit untuk approval.","success"),m.reload({preserveScroll:!0})}catch{d.fire("Error!","Terjadi kesalahan saat submit transfer.","error")}finally{k.value=!1}}}function ee(a){a&&d.fire({title:"Approve Transfer?",text:"Transfer akan disetujui dan stock akan dipindahkan.",icon:"question",showCancelButton:!0,confirmButtonColor:"#28a745",cancelButtonColor:"#d33",confirmButtonText:"Ya, Approve!",cancelButtonText:"Batal",input:"textarea",inputPlaceholder:"Catatan approval (opsional)",inputAttributes:{"aria-label":"Catatan approval"}}).then(e=>{e.isConfirmed&&m.post(route("outlet-transfer.approve",a),{action:"approve",comments:e.value||""},{onSuccess:()=>{d.fire("Berhasil!","Transfer berhasil di-approve.","success")},onError:()=>{d.fire("Error!","Terjadi kesalahan saat approve transfer.","error")}})})}function te(a){a&&d.fire({title:"Apakah Anda yakin?",text:"Data yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"}).then(e=>{e.isConfirmed&&m.delete(route("outlet-transfer.destroy",a),{onSuccess:()=>{d.fire("Terhapus!","Data berhasil dihapus.","success")},onError:()=>{d.fire("Error!","Terjadi kesalahan saat menghapus data.","error")}})})}return(a,e)=>(r(),I(ne,null,{default:T(()=>[t("div",ue,[t("div",ie,[e[6]||(e[6]=t("h1",{class:"text-2xl font-bold text-gray-800 flex items-center gap-2"},[t("i",{class:"fa-solid fa-right-left"}),i(" Pindah Outlet ")],-1)),t("div",de,[z.value?(r(),I($(H),{key:0,href:a.route("outlet-transfer.report"),class:"bg-gray-100 text-gray-700 px-4 py-2 rounded-xl shadow hover:bg-gray-200 transition font-semibold"},{default:T(()=>e[4]||(e[4]=[t("i",{class:"fa-solid fa-file-lines mr-2"},null,-1),i(" Laporan ")])),_:1},8,["href"])):b("",!0),re($(H),{href:a.route("outlet-transfer.create"),class:"bg-gradient-to-r from-blue-500 to-blue-700 text-white px-4 py-2 rounded-xl shadow-lg hover:shadow-2xl transition-all font-semibold"},{default:T(()=>e[5]||(e[5]=[i(" + Buat Pindah Outlet ")])),_:1},8,["href"])])]),t("div",pe,[_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>h.value=s),onInput:J,type:"text",placeholder:"Cari nomor transfer/warehouse outlet...",class:"w-64 px-4 py-2 rounded-xl border border-blue-200 shadow focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition"},null,544),[[B,h.value]]),_(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=s=>v.value=s),onChange:N,class:"px-2 py-2 rounded-xl border border-blue-200 shadow focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition",placeholder:"Dari tanggal"},null,544),[[B,v.value]]),e[7]||(e[7]=t("span",null,"-",-1)),_(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=s=>y.value=s),onChange:N,class:"px-2 py-2 rounded-xl border border-blue-200 shadow focus:ring-2 focus:ring-blue-400 focus-border-blue-400 transition",placeholder:"Sampai tanggal"},null,544),[[B,y.value]])]),t("div",ce,[t("table",fe,[e[14]||(e[14]=t("thead",{class:"bg-gradient-to-r from-blue-50 to-blue-100"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider rounded-tl-2xl"},"Nomor"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Tanggal"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Outlet Asal"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Warehouse Outlet Asal"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Outlet Tujuan"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Warehouse Outlet Tujuan"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Status"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Dibuat Oleh"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider rounded-tr-2xl"},"Aksi")])],-1)),t("tbody",null,[!x.transfers.data||!x.transfers.data.length?(r(),l("tr",be,e[8]||(e[8]=[t("td",{colspan:"9",class:"text-center py-10 text-gray-400"},"Belum ada data Pindah Outlet.",-1)]))):b("",!0),(r(!0),l(D,null,j(x.transfers.data,s=>{var n,c,S,g,F;return r(),l("tr",{key:s.id,class:"hover:bg-blue-50 transition shadow-sm"},[t("td",xe,u(s.transfer_number),1),t("td",me,u(W(s.transfer_date)),1),t("td",ge,u(O((n=s.warehouse_outlet_from)==null?void 0:n.outlet_id)),1),t("td",he,u((c=s.warehouse_outlet_from)==null?void 0:c.name),1),t("td",ve,u(O((S=s.warehouse_outlet_to)==null?void 0:S.outlet_id)),1),t("td",ye,u((g=s.warehouse_outlet_to)==null?void 0:g.name),1),t("td",we,[t("span",{class:U(["px-2 py-1 text-xs font-semibold rounded-full",K(s.status)])},u(q(s.status)),3)]),t("td",ke,u((F=s.creator)==null?void 0:F.nama_lengkap),1),t("td",_e,[t("div",Ce,[t("button",{onClick:A=>Y(s.id),class:"inline-flex items-center btn btn-xs bg-blue-100 text-blue-800 hover:bg-blue-200 rounded px-2 py-1 font-semibold transition"},e[9]||(e[9]=[t("i",{class:"fa fa-eye mr-1"},null,-1),i(" Detail ")]),8,Se),t("a",{href:a.route("outlet-transfer.print-pdf",s.id),target:"_blank",class:"inline-flex items-center btn btn-xs bg-purple-100 text-purple-800 hover:bg-purple-200 rounded px-2 py-1 font-semibold transition"},e[10]||(e[10]=[t("i",{class:"fa fa-print mr-1"},null,-1),i(" Print PDF ")]),8,Ae),s.status==="draft"?(r(),l("button",{key:0,onClick:A=>X(s.id),class:"inline-flex items-center btn btn-xs bg-green-100 text-green-800 hover:bg-green-200 rounded px-2 py-1 font-semibold transition"},e[11]||(e[11]=[t("i",{class:"fa fa-paper-plane mr-1"},null,-1),i(" Submit ")]),8,Te)):b("",!0),s.status==="submitted"&&R(s)?(r(),l("button",{key:1,onClick:A=>ee(s.id),class:"inline-flex items-center btn btn-xs bg-yellow-100 text-yellow-800 hover:bg-yellow-200 rounded px-2 py-1 font-semibold transition"},e[12]||(e[12]=[t("i",{class:"fa fa-check mr-1"},null,-1),i(" Approve ")]),8,Be)):b("",!0),s.status==="draft"&&o.canDelete?(r(),l("button",{key:2,onClick:A=>te(s.id),class:"inline-flex items-center btn btn-xs bg-red-100 text-red-700 hover:bg-red-200 rounded px-2 py-1 font-semibold transition"},e[13]||(e[13]=[t("i",{class:"fa fa-trash mr-1"},null,-1),i(" Hapus ")]),8,De)):b("",!0)])])])}),128))])])]),t("div",je,[(r(!0),l(D,null,j(x.transfers.links,s=>(r(),l("button",{key:s.label,disabled:!s.url,onClick:n=>G(s.url),innerHTML:s.label,class:U(["px-3 py-1 rounded-lg border text-sm font-semibold",[s.active?"bg-blue-600 text-white shadow-lg":"bg-white text-blue-700 hover:bg-blue-50",s.url?"cursor-pointer":"opacity-50 cursor-not-allowed"]])},null,10,Oe))),128))])]),C.value?(r(),l("div",Me,[t("div",Ne,[e[18]||(e[18]=t("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"Submit untuk Approval",-1)),t("div",Pe,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Pilih Approvers (berurutan dari terendah ke tertinggi)",-1)),_(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>p.value=s),multiple:"",size:"8",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},[(r(!0),l(D,null,j(x.users||[],s=>{var n;return r(),l("option",{key:s.id,value:s.id},u(s.nama_lengkap)+" - "+u(((n=s.jabatan)==null?void 0:n.nama_jabatan)||"-"),9,Ee)}),128))],512),[[oe,p.value]]),e[16]||(e[16]=t("p",{class:"mt-2 text-xs text-gray-500"},"Jika ingin multi approval, pilih lebih dari 1 approver. Approver level tertinggi akan eksekusi pindah stok saat approve terakhir.",-1))]),t("div",Ve,[t("button",{onClick:P,class:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600"}," Batal "),t("button",{onClick:Z,disabled:k.value||p.value.length===0,class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50"},[k.value?(r(),l("i",Fe)):b("",!0),e[17]||(e[17]=i(" Submit "))],8,Le)])])])):b("",!0)]),_:1}))}};export{Ke as default};
