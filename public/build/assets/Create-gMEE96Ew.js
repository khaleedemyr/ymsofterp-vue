import{r as g,A as P,B as i,C as I,D as t,G as x,O as N,H as b,L as o,E as p,l as v,J as A,N as n,F as k,M as h,I as D,W as T}from"./vendor-vue-g7iCcTkf.js";import{S as _}from"./app-Bb65-N1P.js";import{A as W}from"./AppLayout-cuNKSDqJ.js";import{a as q}from"./vendor-utils-CpgP2uT4.js";import"./vendor-charts-CuqD4wLC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-aFVowX1N.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const $={class:"max-w-4xl w-full mx-auto py-8 px-2"},G={class:"bg-white rounded-2xl shadow-lg p-6"},H={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},K={class:"md:col-span-2"},R={key:0,class:"text-red-500 text-xs mt-1"},J=["value"],Q={key:0,class:"text-red-500 text-xs mt-1"},X=["value"],Y={key:0,class:"text-red-500 text-xs mt-1"},Z={key:1,class:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded-lg"},ee={class:"flex items-center"},te={class:"text-sm text-blue-700 ml-2"},se=["value"],ie={key:0,class:"text-red-500 text-xs mt-1"},oe=["value"],le={key:0,class:"text-red-500 text-xs mt-1"},ae={class:"md:col-span-2"},re={key:0,class:"text-red-500 text-xs mt-1"},de={class:"md:col-span-2"},ne={class:"space-y-3"},ue={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},ce={key:0,class:"relative group"},pe={class:"aspect-square bg-gray-100 border border-gray-200 rounded-lg overflow-hidden"},me=["src","alt"],fe=["onClick"],ge={class:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-70 text-white p-1"},be={class:"text-xs truncate"},ve={key:1,class:"relative"},ye={class:"aspect-square bg-gray-100 border border-gray-200 rounded-lg flex flex-col items-center justify-center p-2"},xe={key:0,class:"fas fa-file-pdf text-red-500 text-2xl mb-1"},ke={key:1,class:"fas fa-file-alt text-gray-500 text-2xl mb-1"},he={class:"text-xs text-gray-600 text-center truncate w-full"},_e=["onClick"],we={class:"flex justify-end gap-4 mt-8"},Ce=["disabled"],De={key:0,class:"fa-solid fa-spinner fa-spin"},Be={key:1,class:"fa-solid fa-save"},Le={__name:"Create",props:{categories:Array,priorities:Array,divisis:Array,outlets:Array},setup(y){const E=y,d=g({title:"",description:"",category_id:"",priority_id:"",divisi_id:"",outlet_id:""}),w=g(!1),l=g({}),C=g(""),m=g([]),B=g(null);function F(){if(d.value.priority_id){const a=E.priorities.find(e=>e.id==d.value.priority_id);if(a&&a.max_days){const e=new Date;e.setDate(e.getDate()+a.max_days),C.value=e.toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}}else C.value=""}function M(){B.value.click()}function V(a){Array.from(a.target.files).forEach(s=>{if(s.size<=10*1024*1024){const r={file:s,name:s.name,type:s.type,size:s.size,preview:null};if(s.type.startsWith("image/")){const u=new FileReader;u.onload=c=>{r.preview=c.target.result},u.readAsDataURL(s)}m.value.push(r)}else _.fire({title:"File terlalu besar!",text:"Ukuran file maksimal 10MB",icon:"warning",confirmButtonText:"OK"})}),a.target.value=""}function j(a){m.value.splice(a,1)}function S(){const a=document.createElement("div");a.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",a.innerHTML=`
    <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold">Capture Camera</h3>
        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="space-y-4">
        <video id="camera-video" class="w-full h-64 bg-gray-200 rounded" autoplay></video>
        <div class="flex gap-2">
          <button id="capture-btn" class="flex-1 bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600">
            <i class="fas fa-camera mr-2"></i>Capture
          </button>
          <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-2 px-4 rounded hover:bg-gray-600">
            Cancel
          </button>
        </div>
      </div>
    </div>
  `,document.body.appendChild(a),navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{const s=a.querySelector("#camera-video");s.srcObject=e,a.querySelector("#capture-btn").addEventListener("click",()=>{const r=document.createElement("canvas");r.width=s.videoWidth,r.height=s.videoHeight,r.getContext("2d").drawImage(s,0,0),r.toBlob(c=>{const f=new File([c],`camera-capture-${Date.now()}.jpg`,{type:"image/jpeg"}),L={file:f,name:f.name,type:f.type,size:f.size,preview:r.toDataURL("image/jpeg",.8)};m.value.push(L),e.getTracks().forEach(O=>O.stop()),a.remove()},"image/jpeg",.8)})}).catch(e=>{console.error("Camera access denied:",e),_.fire({title:"Camera tidak dapat diakses",text:"Pastikan browser memiliki izin untuk mengakses camera",icon:"error",confirmButtonText:"OK"}),a.remove()})}async function z(){var a,e,s;w.value=!0,l.value={};try{const r=new FormData;Object.keys(d.value).forEach(c=>{r.append(c,d.value[c])}),m.value.forEach((c,f)=>{r.append(`attachments[${f}]`,c.file)});const u=await q.post("/tickets",r,{headers:{"Content-Type":"multipart/form-data"}});u.data.success&&(_.fire("Berhasil!",u.data.message,"success"),T.visit("/tickets"))}catch(r){((a=r.response)==null?void 0:a.status)===422?(l.value=r.response.data.errors,_.fire("Validasi Gagal","Mohon periksa kembali input Anda.","error")):_.fire("Error!",((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.message)||"Gagal membuat ticket.","error")}finally{w.value=!1}}function U(){T.visit("/tickets")}return(a,e)=>(i(),P(W,{title:"Buat Ticket Baru"},{default:I(()=>[t("div",$,[t("div",{class:"flex justify-between items-center mb-6"},[e[7]||(e[7]=t("h1",{class:"text-2xl font-bold text-gray-800 flex items-center gap-2"},[t("i",{class:"fa-solid fa-plus-circle text-blue-500"}),x(" Buat Ticket Baru ")],-1)),t("button",{onClick:U,class:"bg-gray-500 text-white px-4 py-2 rounded-xl hover:bg-gray-600 transition-colors"},e[6]||(e[6]=[t("i",{class:"fa-solid fa-arrow-left mr-2"},null,-1),x(" Kembali ")]))]),t("div",G,[t("form",{onSubmit:N(z,["prevent"])},[t("div",H,[t("div",K,[e[8]||(e[8]=t("label",{for:"title",class:"block text-sm font-medium text-gray-700 mb-1"},"Title *",-1)),b(t("input",{type:"text",id:"title","onUpdate:modelValue":e[0]||(e[0]=s=>d.value.title=s),class:v(["w-full px-4 py-2 rounded-xl border border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",{"border-red-500":l.value.title}]),placeholder:"Masukkan title ticket"},null,2),[[A,d.value.title]]),l.value.title?(i(),o("p",R,n(l.value.title[0]),1)):p("",!0)]),t("div",null,[e[10]||(e[10]=t("label",{for:"category_id",class:"block text-sm font-medium text-gray-700 mb-1"},"Category *",-1)),b(t("select",{id:"category_id","onUpdate:modelValue":e[1]||(e[1]=s=>d.value.category_id=s),class:v(["w-full px-4 py-2 rounded-xl border border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",{"border-red-500":l.value.category_id}])},[e[9]||(e[9]=t("option",{value:""},"Pilih Category",-1)),(i(!0),o(k,null,h(y.categories,s=>(i(),o("option",{key:s.id,value:s.id},n(s.name),9,J))),128))],2),[[D,d.value.category_id]]),l.value.category_id?(i(),o("p",Q,n(l.value.category_id[0]),1)):p("",!0)]),t("div",null,[e[14]||(e[14]=t("label",{for:"priority_id",class:"block text-sm font-medium text-gray-700 mb-1"},"Priority *",-1)),b(t("select",{id:"priority_id","onUpdate:modelValue":e[2]||(e[2]=s=>d.value.priority_id=s),onChange:F,class:v(["w-full px-4 py-2 rounded-xl border border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",{"border-red-500":l.value.priority_id}])},[e[11]||(e[11]=t("option",{value:""},"Pilih Priority",-1)),(i(!0),o(k,null,h(y.priorities,s=>(i(),o("option",{key:s.id,value:s.id},n(s.name),9,X))),128))],34),[[D,d.value.priority_id]]),l.value.priority_id?(i(),o("p",Y,n(l.value.priority_id[0]),1)):p("",!0),C.value?(i(),o("div",Z,[t("div",ee,[e[12]||(e[12]=t("i",{class:"fas fa-calendar-alt text-blue-600 mr-2"},null,-1)),e[13]||(e[13]=t("span",{class:"text-sm font-medium text-blue-800"},"Due Date:",-1)),t("span",te,n(C.value),1)])])):p("",!0)]),t("div",null,[e[16]||(e[16]=t("label",{for:"divisi_id",class:"block text-sm font-medium text-gray-700 mb-1"},"Divisi *",-1)),b(t("select",{id:"divisi_id","onUpdate:modelValue":e[3]||(e[3]=s=>d.value.divisi_id=s),class:v(["w-full px-4 py-2 rounded-xl border border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",{"border-red-500":l.value.divisi_id}])},[e[15]||(e[15]=t("option",{value:""},"Pilih Divisi",-1)),(i(!0),o(k,null,h(y.divisis,s=>(i(),o("option",{key:s.id,value:s.id},n(s.nama_divisi),9,se))),128))],2),[[D,d.value.divisi_id]]),l.value.divisi_id?(i(),o("p",ie,n(l.value.divisi_id[0]),1)):p("",!0)]),t("div",null,[e[18]||(e[18]=t("label",{for:"outlet_id",class:"block text-sm font-medium text-gray-700 mb-1"},"Outlet *",-1)),b(t("select",{id:"outlet_id","onUpdate:modelValue":e[4]||(e[4]=s=>d.value.outlet_id=s),class:v(["w-full px-4 py-2 rounded-xl border border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",{"border-red-500":l.value.outlet_id}])},[e[17]||(e[17]=t("option",{value:""},"Pilih Outlet",-1)),(i(!0),o(k,null,h(y.outlets,s=>(i(),o("option",{key:s.id_outlet,value:s.id_outlet},n(s.nama_outlet),9,oe))),128))],2),[[D,d.value.outlet_id]]),l.value.outlet_id?(i(),o("p",le,n(l.value.outlet_id[0]),1)):p("",!0)]),t("div",ae,[e[19]||(e[19]=t("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-1"},"Description *",-1)),b(t("textarea",{id:"description","onUpdate:modelValue":e[5]||(e[5]=s=>d.value.description=s),rows:"6",class:v(["w-full px-4 py-2 rounded-xl border border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",{"border-red-500":l.value.description}]),placeholder:"Masukkan deskripsi ticket"},null,2),[[A,d.value.description]]),l.value.description?(i(),o("p",re,n(l.value.description[0]),1)):p("",!0)]),t("div",de,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Attachments",-1)),t("div",ne,[t("div",{class:"flex gap-2"},[t("button",{type:"button",onClick:M,class:"flex items-center px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors"},e[20]||(e[20]=[t("i",{class:"fas fa-upload mr-2"},null,-1),x(" Upload File ")])),t("button",{type:"button",onClick:S,class:"flex items-center px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg transition-colors"},e[21]||(e[21]=[t("i",{class:"fas fa-camera mr-2"},null,-1),x(" Capture Camera ")]))]),t("input",{ref_key:"fileInput",ref:B,type:"file",multiple:"",accept:"image/*,.pdf,.doc,.docx",onChange:V,class:"hidden"},null,544),m.value.length>0?(i(),o("div",ue,[(i(!0),o(k,null,h(m.value,(s,r)=>(i(),o("div",{key:r,class:"relative"},[s.type.startsWith("image/")?(i(),o("div",ce,[t("div",pe,[t("img",{src:s.preview,alt:s.name,class:"w-full h-full object-cover"},null,8,me)]),t("button",{type:"button",onClick:u=>j(r),class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600 shadow-lg"},e[22]||(e[22]=[t("i",{class:"fas fa-times text-xs"},null,-1)]),8,fe),t("div",ge,[t("p",be,n(s.name),1)])])):(i(),o("div",ve,[t("div",ye,[s.type==="application/pdf"?(i(),o("i",xe)):(i(),o("i",ke)),t("p",he,n(s.name),1)]),t("button",{type:"button",onClick:u=>j(r),class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600 shadow-lg"},e[23]||(e[23]=[t("i",{class:"fas fa-times text-xs"},null,-1)]),8,_e)]))]))),128))])):p("",!0)])])]),t("div",we,[t("button",{type:"button",onClick:U,class:"bg-gray-500 text-white px-6 py-2 rounded-xl hover:bg-gray-600 transition-colors"}," Batal "),t("button",{type:"submit",disabled:w.value,class:"bg-gradient-to-r from-blue-500 to-blue-700 text-white px-6 py-2 rounded-xl shadow-lg hover:shadow-2xl transition-all font-semibold flex items-center gap-2"},[w.value?(i(),o("i",De)):(i(),o("i",Be)),e[25]||(e[25]=x(" Simpan Ticket "))],8,Ce)])],32)])])]),_:1}))}};export{Le as default};
