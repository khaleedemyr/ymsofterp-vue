import{r as u,c as V,w as H,A as G,B as i,C as d,x as m,Q as p,D as e,L as r,E as x,N as n,H as k,F as S,M as P,I as L,J as M}from"./vendor-vue-g7iCcTkf.js";import{a as _}from"./vendor-utils-CpgP2uT4.js";import{S as C}from"./app-CXnLHfhT.js";import{Y as A,h as I,G as q,S as E}from"./vendor-ui-CrPgGUUb.js";import"./vendor-charts-CuqD4wLC.js";const J={class:"fixed inset-0 overflow-y-auto"},O={class:"flex min-h-full items-center justify-center p-4 text-center"},Q={class:"mb-4"},R={key:0,class:"text-xs text-gray-500 mt-1"},T={class:"mb-4"},Y=["value"],z={key:0,class:"mb-4"},K={class:"w-full text-sm mb-2"},W=["onUpdate:modelValue"],X={class:"flex justify-end gap-2 mt-6"},Z=["disabled"],ne={__name:"BiddingSupplierInputModal",props:{show:Boolean,items:Array},emits:["close","supplier-input-done"],setup(c,{emit:B}){const f=c,h=B,v=u([]),o=u(""),y=u(null),b=u(""),s=u({}),D=V(()=>f.items.length?f.items.every(a=>s.value[a.id]&&s.value[a.id]>0):!1);H(()=>f.show,a=>{a&&(F(),o.value="",s.value={})});async function F(){try{const a=await _.get("/api/suppliers?status=active");v.value=a.data}catch{v.value=[]}}function N(a){const t=a.target.files[0];t&&(y.value=t,b.value=t.name)}function g(){h("close")}async function U(){const a=new FormData;a.append("supplier_id",o.value),y.value&&a.append("file",y.value),a.append("offers",JSON.stringify(s.value));try{await _.post("/api/maintenance-tasks/bidding-offers",a,{headers:{"Content-Type":"multipart/form-data"}}),C.fire("Sukses","Penawaran berhasil disimpan!","success"),h("supplier-input-done")}catch{C.fire("Gagal","Gagal menyimpan penawaran!","error")}}function w(a){return a?"Rp "+Number(a).toLocaleString("id-ID"):"-"}return(a,t)=>(i(),G(p(E),{appear:"",show:c.show,as:"template"},{default:d(()=>[m(p(A),{as:"div",onClose:g,class:"relative z-[99999]"},{default:d(()=>[m(p(I),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:d(()=>t[1]||(t[1]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",J,[e("div",O,[m(p(I),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:d(()=>[m(p(q),{class:"w-full max-w-3xl transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all"},{default:d(()=>[e("div",{class:"flex justify-between items-center mb-4"},[t[3]||(t[3]=e("h3",{class:"text-lg font-medium"},"Input Supplier & Upload Permintaan Penawaran",-1)),e("button",{onClick:g,class:"text-gray-400 hover:text-gray-600"},t[2]||(t[2]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",Q,[t[4]||(t[4]=e("label",{class:"block font-medium mb-2"},"Upload File Permintaan Penawaran (PDF/Dokumen)",-1)),e("input",{type:"file",onChange:N,accept:"application/pdf,.doc,.docx,.jpg,.jpeg,.png"},null,32),b.value?(i(),r("div",R,"File: "+n(b.value),1)):x("",!0)]),e("div",T,[t[6]||(t[6]=e("label",{class:"block font-medium mb-2"},"Pilih Supplier",-1)),k(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>o.value=l),class:"border rounded px-2 py-1 w-full"},[t[5]||(t[5]=e("option",{value:""},"-- Pilih Supplier --",-1)),(i(!0),r(S,null,P(v.value,l=>(i(),r("option",{key:l.id,value:l.id},n(l.name),9,Y))),128))],512),[[L,o.value]])]),o.value&&c.items.length?(i(),r("div",z,[t[8]||(t[8]=e("label",{class:"block font-medium mb-2"},"Input Harga Penawaran per Item",-1)),e("table",K,[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",null,"Item"),e("th",null,"Spesifikasi"),e("th",null,"Qty"),e("th",null,"Unit"),e("th",null,"Harga PR"),e("th",null,"Harga Penawaran"),e("th",null,"Subtotal")])],-1)),e("tbody",null,[(i(!0),r(S,null,P(c.items,l=>(i(),r("tr",{key:l.id},[e("td",null,n(l.item_name),1),e("td",null,n(l.specifications||"-"),1),e("td",null,n(l.quantity),1),e("td",null,n(l.unit_name||"-"),1),e("td",null,n(w(l.price)),1),e("td",null,[k(e("input",{type:"number",min:"0","onUpdate:modelValue":j=>s.value[l.id]=j,class:"border rounded px-2 py-1 w-32",placeholder:"Harga"},null,8,W),[[M,s.value[l.id]]])]),e("td",null,n(w(l.quantity*(s.value[l.id]||0))),1)]))),128))])])])):x("",!0),e("div",X,[e("button",{onClick:g,class:"px-4 py-2 text-gray-700 bg-gray-100 rounded hover:bg-gray-200"},"Batal"),e("button",{onClick:U,disabled:!o.value||!D.value,class:"px-4 py-2 text-white bg-blue-500 rounded hover:bg-blue-600"}," Lanjut Input Penawaran ",8,Z)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}};export{ne as default};
