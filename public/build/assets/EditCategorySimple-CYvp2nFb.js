import{r as k,k as S,w,A as V,B as a,C as p,D as t,L as i,N as r,O as C,E as g,G as c,H as b,a6 as O,J as B,V as E,F as _,M as v,x as L,Q as U,S as T,W as N}from"./vendor-vue-g7iCcTkf.js";import{A as P}from"./AppLayout-D_GBiqpN.js";import"./vendor-utils-CpgP2uT4.js";import"./app-D3yJLFoH.js";import"./vendor-charts-CuqD4wLC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-DW6hwgWG.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const D={class:"flex items-center justify-between"},G={class:"py-12"},M={class:"max-w-4xl mx-auto sm:px-6 lg:px-8"},$={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},j={class:"p-6"},F={key:0,class:"text-center py-8"},q={key:1},W={class:"mb-6"},H={class:"bg-gray-50 p-4 rounded-lg"},J={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Q={class:"mt-1 text-sm text-gray-900"},z={class:"mt-1 text-sm text-gray-900"},K={class:"mt-1 text-sm text-gray-900"},X={class:"mt-1 text-sm text-gray-900"},Y={class:"space-y-6"},Z={class:"space-y-3"},I={class:"flex items-center"},tt={class:"flex items-center"},et={key:0,class:"mt-1 text-sm text-red-600"},st={class:"relative"},lt={key:0,class:"mt-1 text-sm text-red-600"},ot={class:"mt-1 text-xs text-gray-500"},dt={key:0},at={class:"border border-gray-300 rounded-md p-4 max-h-60 overflow-y-auto"},it={class:"space-y-2"},rt={class:"flex items-center"},ut=["id","value"],nt=["for"],gt={key:0,class:"mt-1 text-sm text-red-600"},mt={key:1},ct={class:"space-y-3"},bt={class:"flex-1"},yt={class:"block text-sm font-medium text-gray-700"},xt={class:"flex-1"},pt={class:"relative"},ft=["id","onUpdate:modelValue"],_t={key:0,class:"mt-1 text-sm text-red-600"},vt={key:2},ht={class:"bg-gray-50 p-4 rounded-lg"},kt={class:"overflow-x-auto"},wt={class:"min-w-full divide-y divide-gray-200"},Ot={class:"bg-white divide-y divide-gray-200"},Bt={class:"px-3 py-2 whitespace-nowrap text-sm text-gray-900"},Et={class:"px-3 py-2 whitespace-nowrap text-sm text-gray-900"},Lt={class:"px-3 py-2 whitespace-nowrap text-sm text-gray-900"},Ut={class:"px-3 py-2 whitespace-nowrap text-sm text-gray-900"},Tt={class:"mt-8 flex justify-end space-x-3"},At=["disabled"],Rt={key:0},St={key:1},qt={__name:"EditCategorySimple",props:{category:{type:Object,default:null},outlets:{type:Array,default:()=>[]},errors:{type:Object,default:()=>({})}},setup(d){const u=d,y=k(!1),x=k(!1),s=S({budget_type:"GLOBAL",budget_limit:0,selected_outlets:[],outlet_budgets:{}}),h=l=>{const e=u.outlets.find(n=>n.id_outlet==l);return e?e.nama_outlet:`Outlet ${l}`};w(()=>u.category,l=>{l&&(s.budget_type=l.budget_type||"GLOBAL",s.budget_limit=l.budget_limit||0,l.outlet_budgets&&l.outlet_budgets.length>0&&(s.selected_outlets=l.outlet_budgets.map(e=>e.outlet_id),s.outlet_budgets={},l.outlet_budgets.forEach(e=>{s.outlet_budgets[e.outlet_id]=e.allocated_budget})))},{immediate:!0});const A=()=>{x.value?(s.selected_outlets=u.outlets.map(l=>l.id_outlet),u.outlets.forEach(l=>{l.id_outlet in s.outlet_budgets||(s.outlet_budgets[l.id_outlet]="")})):(s.selected_outlets=[],s.outlet_budgets={})};w(()=>s.selected_outlets,l=>{x.value=l.length===u.outlets.length&&u.outlets.length>0,l.forEach(e=>{e in s.outlet_budgets||(s.outlet_budgets[e]="")}),Object.keys(s.outlet_budgets).forEach(e=>{l.includes(parseInt(e))||delete s.outlet_budgets[e]})},{deep:!0});const f=l=>l?"Rp "+new Intl.NumberFormat("id-ID").format(l):"Rp 0",R=()=>{var l;if((l=u.category)!=null&&l.id){if(s.budget_type==="PER_OUTLET"){if(!s.selected_outlets||s.selected_outlets.length===0){alert("Please select at least one outlet for per-outlet budget type.");return}for(const e of s.selected_outlets){const n=s.outlet_budgets[e];if(!n||n<=0){alert(`Please enter a valid budget amount for ${h(e)}.`);return}}}y.value=!0,N.put(`/budget-management/category/${u.category.id}`,s,{onFinish:()=>{y.value=!1},onError:e=>{}})}};return(l,e)=>(a(),V(P,{title:"Edit Category Budget"},{header:p(()=>[t("div",D,[e[6]||(e[6]=t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Edit Category Budget ",-1)),L(U(T),{href:"/budget-management",class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"},{default:p(()=>e[5]||(e[5]=[t("i",{class:"fa fa-arrow-left mr-2"},null,-1),c(" Back to Budget Management ")])),_:1})])]),default:p(()=>{var n;return[t("div",G,[t("div",M,[t("div",$,[t("div",j,[d.category?(a(),i("div",q,[t("div",W,[e[12]||(e[12]=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Category Information",-1)),t("div",H,[t("div",J,[t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700"},"Category Name",-1)),t("p",Q,r(d.category.name),1)]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700"},"Division",-1)),t("p",z,r(d.category.division),1)]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700"},"Subcategory",-1)),t("p",K,r(d.category.subcategory),1)]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700"},"Description",-1)),t("p",X,r(d.category.description||"-"),1)])])])]),t("form",{onSubmit:C(R,["prevent"])},[t("div",Y,[t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[c(" Budget Type "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Z,[t("div",I,[b(t("input",{id:"budget_type_global","onUpdate:modelValue":e[0]||(e[0]=o=>s.budget_type=o),type:"radio",value:"GLOBAL",class:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300"},null,512),[[O,s.budget_type]]),e[13]||(e[13]=t("label",{for:"budget_type_global",class:"ml-3 block text-sm font-medium text-gray-700"},[t("div",{class:"flex items-center"},[t("i",{class:"fa fa-globe text-blue-600 mr-2"}),t("div",null,[t("div",{class:"font-medium"},"Global Budget"),t("div",{class:"text-xs text-gray-500"},"Budget dihitung total semua outlet dalam kategori")])])],-1))]),t("div",tt,[b(t("input",{id:"budget_type_per_outlet","onUpdate:modelValue":e[1]||(e[1]=o=>s.budget_type=o),type:"radio",value:"PER_OUTLET",class:"focus:ring-orange-500 h-4 w-4 text-orange-600 border-gray-300"},null,512),[[O,s.budget_type]]),e[14]||(e[14]=t("label",{for:"budget_type_per_outlet",class:"ml-3 block text-sm font-medium text-gray-700"},[t("div",{class:"flex items-center"},[t("i",{class:"fa fa-building text-orange-600 mr-2"}),t("div",null,[t("div",{class:"font-medium"},"Per-Outlet Budget"),t("div",{class:"text-xs text-gray-500"},"Setiap outlet memiliki budget terpisah dalam kategori")])])],-1))])]),d.errors.budget_type?(a(),i("div",et,r(d.errors.budget_type),1)):g("",!0)]),t("div",null,[e[17]||(e[17]=t("label",{for:"budget_limit",class:"block text-sm font-medium text-gray-700 mb-2"},[c(" Budget Limit "),t("span",{class:"text-red-500"},"*")],-1)),t("div",st,[e[16]||(e[16]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("span",{class:"text-gray-500 sm:text-sm"},"Rp")],-1)),b(t("input",{id:"budget_limit","onUpdate:modelValue":e[2]||(e[2]=o=>s.budget_limit=o),type:"number",step:"0.01",min:"0",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"0.00",required:""},null,512),[[B,s.budget_limit]])]),d.errors.budget_limit?(a(),i("div",lt,r(d.errors.budget_limit),1)):g("",!0),t("p",ot,r(s.budget_type==="GLOBAL"?"Total budget untuk semua outlet":"Budget referensi untuk alokasi per outlet"),1)]),s.budget_type==="PER_OUTLET"?(a(),i("div",dt,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[c(" Select Outlets "),t("span",{class:"text-red-500"},"*")],-1)),t("div",at,[t("div",it,[t("div",rt,[b(t("input",{id:"select_all_outlets","onUpdate:modelValue":e[3]||(e[3]=o=>x.value=o),type:"checkbox",onChange:A,class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,544),[[E,x.value]]),e[18]||(e[18]=t("label",{for:"select_all_outlets",class:"ml-2 block text-sm font-medium text-gray-700"}," Select All Outlets ",-1))]),e[19]||(e[19]=t("hr",{class:"my-2"},null,-1)),(a(!0),i(_,null,v(d.outlets,o=>(a(),i("div",{key:o.id_outlet,class:"flex items-center"},[b(t("input",{id:`outlet_${o.id_outlet}`,"onUpdate:modelValue":e[4]||(e[4]=m=>s.selected_outlets=m),value:o.id_outlet,type:"checkbox",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,8,ut),[[E,s.selected_outlets]]),t("label",{for:`outlet_${o.id_outlet}`,class:"ml-2 block text-sm text-gray-700"},r(o.nama_outlet),9,nt)]))),128))])]),d.errors.selected_outlets?(a(),i("div",gt,r(d.errors.selected_outlets),1)):g("",!0),e[21]||(e[21]=t("p",{class:"mt-1 text-xs text-gray-500"}," Select outlets that will have individual budget allocations for this category. ",-1))])):g("",!0),s.budget_type==="PER_OUTLET"&&s.selected_outlets.length>0?(a(),i("div",mt,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[c(" Budget Allocation per Outlet "),t("span",{class:"text-red-500"},"*")],-1)),t("div",ct,[(a(!0),i(_,null,v(s.selected_outlets,o=>(a(),i("div",{key:o,class:"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg"},[t("div",bt,[t("label",yt,r(h(o)),1)]),t("div",xt,[t("div",pt,[e[22]||(e[22]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("span",{class:"text-gray-500 sm:text-sm"},"Rp")],-1)),b(t("input",{id:`budget_${o}`,"onUpdate:modelValue":m=>s.outlet_budgets[o]=m,type:"number",step:"0.01",min:"0",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"0.00",required:""},null,8,ft),[[B,s.outlet_budgets[o]]])])])]))),128))]),d.errors.outlet_budgets?(a(),i("div",_t,r(d.errors.outlet_budgets),1)):g("",!0),e[24]||(e[24]=t("p",{class:"mt-1 text-xs text-gray-500"}," Set individual budget allocation for each selected outlet. ",-1))])):g("",!0),d.category&&d.category.budget_type==="PER_OUTLET"&&((n=d.category.outlet_budgets)==null?void 0:n.length)>0?(a(),i("div",vt,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Current Outlet Budget Allocations ",-1)),t("div",ht,[t("div",kt,[t("table",wt,[e[25]||(e[25]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Outlet"),t("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Allocated Budget"),t("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Used Budget"),t("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Remaining")])],-1)),t("tbody",Ot,[(a(!0),i(_,null,v(d.category.outlet_budgets,o=>{var m;return a(),i("tr",{key:o.id},[t("td",Bt,r(((m=o.outlet)==null?void 0:m.nama_outlet)||"Unknown Outlet"),1),t("td",Et,r(f(o.allocated_budget)),1),t("td",Lt,r(f(o.used_budget)),1),t("td",Ut,r(f(o.allocated_budget-o.used_budget)),1)])}),128))])])])]),e[27]||(e[27]=t("p",{class:"mt-1 text-xs text-gray-500"}," These are the current outlet budget allocations. Changing budget type will reset these allocations. ",-1))])):g("",!0)]),t("div",Tt,[L(U(T),{href:"/budget-management",class:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded"},{default:p(()=>e[28]||(e[28]=[c(" Cancel ")])),_:1}),t("button",{type:"submit",disabled:y.value,class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded disabled:opacity-50"},[y.value?(a(),i("span",Rt,"Updating...")):(a(),i("span",St,"Update Category"))],8,At)])],32)])):(a(),i("div",F,e[7]||(e[7]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),t("p",{class:"mt-2 text-gray-600"},"Loading category data...",-1)])))])])])])]}),_:1}))}};export{qt as default};
