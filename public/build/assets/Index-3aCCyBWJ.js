import{r as f,w as ae,c as se,A as $,B as o,C as T,D as t,L as n,E as b,G as p,x as oe,Q as F,S as H,H as _,J as B,F as D,M as j,N as u,l as U,I as re,W as m}from"./vendor-vue-g7iCcTkf.js";import{A as le}from"./AppLayout-CCl6N_RX.js";import{S as i}from"./app-DvUgkxHf.js";import{a as ne}from"./vendor-utils-CpgP2uT4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-oDgFzWKX.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const ue={class:"w-full py-8 px-0"},ie={class:"flex justify-between items-center mb-6"},de={class:"flex gap-2"},pe={class:"flex flex-wrap gap-3 mb-4 items-center"},ce={class:"bg-white rounded-2xl shadow-2xl overflow-x-auto transition-all"},fe={class:"w-full min-w-full divide-y divide-gray-200"},be={key:0},xe={class:"px-6 py-3 font-mono font-semibold text-blue-700"},me={class:"px-6 py-3"},ge={class:"px-6 py-3"},he={class:"px-6 py-3"},ve={class:"px-6 py-3"},ye={class:"px-6 py-3"},we={class:"px-6 py-3"},ke={class:"px-6 py-3"},_e={class:"px-6 py-3"},Ce={class:"flex gap-2 flex-wrap"},Se=["onClick"],Ae=["onClick"],Te=["onClick"],Be=["onClick"],De={class:"flex justify-end mt-4 gap-2"},je=["disabled","onClick","innerHTML"],Oe={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40"},Me={class:"bg-white rounded-xl shadow-2xl w-full max-w-md p-6"},Ne={class:"mb-4"},Ee=["value"],Pe={class:"flex justify-end gap-3"},Ve=["disabled"],Le={key:0,class:"fa fa-spinner fa-spin mr-2"},qe={__name:"Index",props:{transfers:Object,filters:Object,outlets:Object,user:Object,users:Array,canDelete:Boolean},setup(x){var P,V,L;const r=x,h=f(((P=r.filters)==null?void 0:P.search)||""),v=f(((V=r.filters)==null?void 0:V.from)||""),y=f(((L=r.filters)==null?void 0:L.to)||""),C=f(!1),w=f(null),d=f([]),k=f(!1);ae(()=>r.filters,a=>{h.value=(a==null?void 0:a.search)||"",v.value=(a==null?void 0:a.from)||"",y.value=(a==null?void 0:a.to)||""},{immediate:!0});function W(a){return a?new Date(a).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"}):"-"}const z=se(()=>{var a;return(((a=r.user)==null?void 0:a.id_outlet)??null)==1});function O(a){var e;return!a||!r.outlets?"-":((e=r.outlets[a])==null?void 0:e.nama_outlet)||"-"}function M(){m.get("/outlet-transfer",{search:h.value,from:v.value,to:y.value},{preserveState:!0,replace:!0})}function J(){M()}function N(){M()}function G(a){a&&m.visit(a,{preserveState:!0,replace:!0})}function Y(a){m.visit(`/outlet-transfer/${a}`)}function q(a){return{draft:"Draft",submitted:"Menunggu Approval",approved:"Disetujui",rejected:"Ditolak"}[a]||a}function K(a){return{draft:"bg-gray-100 text-gray-800",submitted:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"}[a]||"bg-gray-100 text-gray-800"}function Q(a){const s=((a==null?void 0:a.approval_flows)||[]).filter(l=>(l==null?void 0:l.status)==="PENDING");return s.sort((l,c)=>(l.approval_level??0)-(c.approval_level??0)),s[0]||null}function R(a){var g;if(!r.user||!((g=a.warehouse_outlet_to)!=null&&g.name))return!1;const e=r.user.id_jabatan,s=r.user.status;if(r.user.id_role==="5af56935b011a"&&s==="A")return!0;const c=Q(a);if(c)return c.approver_id==r.user.id;switch(a.warehouse_outlet_to.name){case"Kitchen":return[163,174,180,345,346,347,348,349].includes(e)&&s==="A";case"Bar":return[175,182,323].includes(e)&&s==="A";case"Service":return[176,322,164,321].includes(e)&&s==="A";default:return!1}}function X(a){a&&(w.value=a,d.value=[],C.value=!0)}function E(){C.value=!1,w.value=null,d.value=[]}async function Z(){if(w.value){if(!d.value||d.value.length===0){i.fire("Error!","Pilih minimal 1 approver.","error");return}k.value=!0;try{await ne.post(route("outlet-transfer.submit",w.value),{approvers:d.value}),E(),i.fire("Berhasil!","Transfer berhasil di-submit untuk approval.","success"),m.reload({preserveScroll:!0})}catch{i.fire("Error!","Terjadi kesalahan saat submit transfer.","error")}finally{k.value=!1}}}function ee(a){a&&i.fire({title:"Approve Transfer?",text:"Transfer akan disetujui dan stock akan dipindahkan.",icon:"question",showCancelButton:!0,confirmButtonColor:"#28a745",cancelButtonColor:"#d33",confirmButtonText:"Ya, Approve!",cancelButtonText:"Batal",input:"textarea",inputPlaceholder:"Catatan approval (opsional)",inputAttributes:{"aria-label":"Catatan approval"}}).then(e=>{e.isConfirmed&&m.post(route("outlet-transfer.approve",a),{action:"approve",comments:e.value||""},{onSuccess:()=>{i.fire("Berhasil!","Transfer berhasil di-approve.","success")},onError:()=>{i.fire("Error!","Terjadi kesalahan saat approve transfer.","error")}})})}function te(a){a&&i.fire({title:"Apakah Anda yakin?",text:"Data yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"}).then(e=>{e.isConfirmed&&m.delete(route("outlet-transfer.destroy",a),{onSuccess:()=>{i.fire("Terhapus!","Data berhasil dihapus.","success")},onError:()=>{i.fire("Error!","Terjadi kesalahan saat menghapus data.","error")}})})}return(a,e)=>(o(),$(le,null,{default:T(()=>[t("div",ue,[t("div",ie,[e[6]||(e[6]=t("h1",{class:"text-2xl font-bold text-gray-800 flex items-center gap-2"},[t("i",{class:"fa-solid fa-right-left"}),p(" Pindah Outlet ")],-1)),t("div",de,[z.value?(o(),$(F(H),{key:0,href:a.route("outlet-transfer.report"),class:"bg-gray-100 text-gray-700 px-4 py-2 rounded-xl shadow hover:bg-gray-200 transition font-semibold"},{default:T(()=>e[4]||(e[4]=[t("i",{class:"fa-solid fa-file-lines mr-2"},null,-1),p(" Laporan ")])),_:1},8,["href"])):b("",!0),oe(F(H),{href:a.route("outlet-transfer.create"),class:"bg-gradient-to-r from-blue-500 to-blue-700 text-white px-4 py-2 rounded-xl shadow-lg hover:shadow-2xl transition-all font-semibold"},{default:T(()=>e[5]||(e[5]=[p(" + Buat Pindah Outlet ")])),_:1},8,["href"])])]),t("div",pe,[_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>h.value=s),onInput:J,type:"text",placeholder:"Cari nomor transfer/warehouse outlet...",class:"w-64 px-4 py-2 rounded-xl border border-blue-200 shadow focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition"},null,544),[[B,h.value]]),_(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=s=>v.value=s),onChange:N,class:"px-2 py-2 rounded-xl border border-blue-200 shadow focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition",placeholder:"Dari tanggal"},null,544),[[B,v.value]]),e[7]||(e[7]=t("span",null,"-",-1)),_(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=s=>y.value=s),onChange:N,class:"px-2 py-2 rounded-xl border border-blue-200 shadow focus:ring-2 focus:ring-blue-400 focus-border-blue-400 transition",placeholder:"Sampai tanggal"},null,544),[[B,y.value]])]),t("div",ce,[t("table",fe,[e[13]||(e[13]=t("thead",{class:"bg-gradient-to-r from-blue-50 to-blue-100"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider rounded-tl-2xl"},"Nomor"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Tanggal"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Outlet Asal"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Warehouse Outlet Asal"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Outlet Tujuan"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Warehouse Outlet Tujuan"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Status"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Dibuat Oleh"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider rounded-tr-2xl"},"Aksi")])],-1)),t("tbody",null,[!x.transfers.data||!x.transfers.data.length?(o(),n("tr",be,e[8]||(e[8]=[t("td",{colspan:"9",class:"text-center py-10 text-gray-400"},"Belum ada data Pindah Outlet.",-1)]))):b("",!0),(o(!0),n(D,null,j(x.transfers.data,s=>{var l,c,S,g,I;return o(),n("tr",{key:s.id,class:"hover:bg-blue-50 transition shadow-sm"},[t("td",xe,u(s.transfer_number),1),t("td",me,u(W(s.transfer_date)),1),t("td",ge,u(O((l=s.warehouse_outlet_from)==null?void 0:l.outlet_id)),1),t("td",he,u((c=s.warehouse_outlet_from)==null?void 0:c.name),1),t("td",ve,u(O((S=s.warehouse_outlet_to)==null?void 0:S.outlet_id)),1),t("td",ye,u((g=s.warehouse_outlet_to)==null?void 0:g.name),1),t("td",we,[t("span",{class:U(["px-2 py-1 text-xs font-semibold rounded-full",K(s.status)])},u(q(s.status)),3)]),t("td",ke,u((I=s.creator)==null?void 0:I.nama_lengkap),1),t("td",_e,[t("div",Ce,[t("button",{onClick:A=>Y(s.id),class:"inline-flex items-center btn btn-xs bg-blue-100 text-blue-800 hover:bg-blue-200 rounded px-2 py-1 font-semibold transition"},e[9]||(e[9]=[t("i",{class:"fa fa-eye mr-1"},null,-1),p(" Detail ")]),8,Se),s.status==="draft"?(o(),n("button",{key:0,onClick:A=>X(s.id),class:"inline-flex items-center btn btn-xs bg-green-100 text-green-800 hover:bg-green-200 rounded px-2 py-1 font-semibold transition"},e[10]||(e[10]=[t("i",{class:"fa fa-paper-plane mr-1"},null,-1),p(" Submit ")]),8,Ae)):b("",!0),s.status==="submitted"&&R(s)?(o(),n("button",{key:1,onClick:A=>ee(s.id),class:"inline-flex items-center btn btn-xs bg-yellow-100 text-yellow-800 hover:bg-yellow-200 rounded px-2 py-1 font-semibold transition"},e[11]||(e[11]=[t("i",{class:"fa fa-check mr-1"},null,-1),p(" Approve ")]),8,Te)):b("",!0),s.status==="draft"&&r.canDelete?(o(),n("button",{key:2,onClick:A=>te(s.id),class:"inline-flex items-center btn btn-xs bg-red-100 text-red-700 hover:bg-red-200 rounded px-2 py-1 font-semibold transition"},e[12]||(e[12]=[t("i",{class:"fa fa-trash mr-1"},null,-1),p(" Hapus ")]),8,Be)):b("",!0)])])])}),128))])])]),t("div",De,[(o(!0),n(D,null,j(x.transfers.links,s=>(o(),n("button",{key:s.label,disabled:!s.url,onClick:l=>G(s.url),innerHTML:s.label,class:U(["px-3 py-1 rounded-lg border text-sm font-semibold",[s.active?"bg-blue-600 text-white shadow-lg":"bg-white text-blue-700 hover:bg-blue-50",s.url?"cursor-pointer":"opacity-50 cursor-not-allowed"]])},null,10,je))),128))])]),C.value?(o(),n("div",Oe,[t("div",Me,[e[17]||(e[17]=t("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"Submit untuk Approval",-1)),t("div",Ne,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Pilih Approvers (berurutan dari terendah ke tertinggi)",-1)),_(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>d.value=s),multiple:"",size:"8",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},[(o(!0),n(D,null,j(x.users||[],s=>{var l;return o(),n("option",{key:s.id,value:s.id},u(s.nama_lengkap)+" - "+u(((l=s.jabatan)==null?void 0:l.nama_jabatan)||"-"),9,Ee)}),128))],512),[[re,d.value]]),e[15]||(e[15]=t("p",{class:"mt-2 text-xs text-gray-500"},"Jika ingin multi approval, pilih lebih dari 1 approver. Approver level tertinggi akan eksekusi pindah stok saat approve terakhir.",-1))]),t("div",Pe,[t("button",{onClick:E,class:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600"}," Batal "),t("button",{onClick:Z,disabled:k.value||d.value.length===0,class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50"},[k.value?(o(),n("i",Le)):b("",!0),e[16]||(e[16]=p(" Submit "))],8,Ve)])])])):b("",!0)]),_:1}))}};export{qe as default};
