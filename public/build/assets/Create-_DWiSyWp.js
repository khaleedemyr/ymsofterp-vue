import{k as I,r as v,a as q,A as H,B as a,C as k,D as t,x as w,G as f,Q as S,S as F,O as K,H as b,L as r,E as u,F as C,M as V,N as n,I as R,J as j,W}from"./vendor-vue-g7iCcTkf.js";import{A as z}from"./AppLayout-_5DIDCQX.js";import{s as G}from"./vue-multiselect.esm-V-bx43V9.js";/* empty css                            */import{a as P}from"./vendor-utils-CpgP2uT4.js";import{S as x}from"./app-fC6wJyCz.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-OI-F7Vdc.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const J={class:"w-full py-8 px-4"},Q={class:"flex justify-between items-center mb-6"},X={class:"bg-white rounded-xl shadow-lg p-6"},Y={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},Z=["disabled"],ee=["value"],te={key:0,class:"mt-1 text-xs text-gray-500"},oe={slot:"option","slot-scope":"props"},le={class:"flex flex-col"},se={class:"font-medium"},ae={class:"text-xs text-gray-500"},re={key:0,class:"mt-1 text-xs text-gray-500"},ne={key:1,class:"mt-1 text-xs text-yellow-600"},ie={class:"mb-6"},de={class:"mb-6"},ue={class:"mb-4"},pe={class:"relative"},me={key:0,class:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto"},ce=["onClick"],ve={class:"font-medium"},ye={class:"text-sm text-gray-600"},ge={key:0,class:"text-xs text-blue-600 font-medium"},fe={key:0,class:"space-y-2"},be={class:"flex items-center space-x-3"},xe={class:"flex items-center space-x-2"},_e=["onClick"],he=["onClick"],ke={class:"flex items-center space-x-2"},we={class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Se={class:"font-medium"},Ce={class:"text-sm text-gray-600"},Ve={key:0,class:"text-xs text-blue-600 font-medium"},je=["onClick"],Ae={class:"flex justify-end space-x-4"},Ee=["disabled"],Oe={key:0},Ne={key:1},He={__name:"Create",props:{outlets:Array,userOutletId:{type:Number,default:null},canSelectOutlet:{type:Boolean,default:!0}},setup(B){const i=B,l=I({outlet_id:"",employee_id:null,resignation_date:"",resignation_type:"",notes:"",approvers:[]}),_=v([]),y=v([]),m=v(null),c=v(""),p=v([]),g=v(!1),h=v(!1);q(()=>{!i.canSelectOutlet&&i.userOutletId&&i.outlets.length>0&&(l.outlet_id=i.outlets[0].id_outlet,A())});const A=async()=>{if(!l.outlet_id){_.value=[],y.value=[],m.value=null,l.employee_id=null;return}try{const s=await P.get("/employee-resignations/get-employees",{params:{outlet_id:l.outlet_id}});_.value=s.data.employees||[],y.value=_.value.map(e=>({id:e.id,name:`${e.nama_lengkap} (${e.nik})`,nik:e.nik,nama_lengkap:e.nama_lengkap})),m.value=null,l.employee_id=null}catch(s){console.error("Failed to load employees:",s),_.value=[],y.value=[],m.value=null,l.employee_id=null}},M=s=>{l.employee_id=s.id},T=()=>{l.employee_id=null,m.value=null},U=()=>{c.value.length>=2?E(c.value):(g.value=!1,p.value=[])},E=async(s="")=>{if(s.length<2){p.value=[],g.value=!1;return}try{const e=await P.get("/employee-resignations/approvers",{params:{search:s}});p.value=e.data.approvers||[],g.value=p.value.length>0}catch(e){console.error("Failed to load approvers:",e),p.value=[],g.value=!1}},$=s=>{l.approvers.find(e=>e.id===s.id)||l.approvers.push(s),c.value="",g.value=!1,p.value=[]},L=s=>{l.approvers.splice(s,1)},O=(s,e)=>{const o=l.approvers.splice(s,1)[0];l.approvers.splice(e,0,o)},D=async()=>{var s,e;if(!l.outlet_id){x.fire({icon:"error",title:"Validation Error",text:"Please select an outlet"});return}if(!m.value||!l.employee_id){x.fire({icon:"error",title:"Validation Error",text:"Please select an employee"});return}if(!l.resignation_date){x.fire({icon:"error",title:"Validation Error",text:"Please select resignation date"});return}if(!l.resignation_type){x.fire({icon:"error",title:"Validation Error",text:"Please select resignation type"});return}h.value=!0;try{await W.post("/employee-resignations",{outlet_id:l.outlet_id,employee_id:l.employee_id,resignation_date:l.resignation_date,resignation_type:l.resignation_type,notes:l.notes,approvers:l.approvers.map(o=>o.id)})}catch(o){console.error("Failed to create resignation:",o),x.fire({icon:"error",title:"Error",text:((e=(s=o.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to create employee resignation"}),h.value=!1}};return(s,e)=>(a(),H(z,{title:"Create Employee Resignation"},{default:k(()=>[t("div",J,[t("div",Q,[e[8]||(e[8]=t("h1",{class:"text-2xl font-bold text-gray-800 flex items-center gap-2"},[t("i",{class:"fa-solid fa-user-minus text-red-500"}),f(" Create Employee Resignation ")],-1)),w(S(F),{href:"/employee-resignations",class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"},{default:k(()=>e[7]||(e[7]=[t("i",{class:"fas fa-arrow-left mr-2"},null,-1),f(" Back to List ")])),_:1})]),t("div",X,[t("form",{onSubmit:K(D,["prevent"])},[t("div",Y,[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Outlet *",-1)),b(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>l.outlet_id=o),required:"",onChange:A,disabled:!i.canSelectOutlet,class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed"},[e[9]||(e[9]=t("option",{value:""},"Select Outlet",-1)),(a(!0),r(C,null,V(i.outlets,o=>(a(),r("option",{key:o.id_outlet,value:o.id_outlet},n(o.nama_outlet),9,ee))),128))],40,Z),[[R,l.outlet_id]]),i.canSelectOutlet?u("",!0):(a(),r("p",te," Outlet otomatis dipilih sesuai outlet Anda "))]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Nama Karyawan *",-1)),w(S(G),{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=o=>m.value=o),options:y.value,searchable:!0,"clear-on-select":!1,"close-on-select":!0,"show-labels":!1,disabled:!l.outlet_id||y.value.length===0,"track-by":"id",label:"name",placeholder:"Pilih karyawan...",onSelect:M,onRemove:T,class:"w-full"},{default:k(()=>[t("template",oe,[t("div",le,[t("div",se,n(i.option.name),1),t("div",ae,n(i.option.nik),1)])])]),_:1},8,["modelValue","options","disabled"]),l.outlet_id?u("",!0):(a(),r("p",re," Pilih outlet terlebih dahulu ")),l.outlet_id&&y.value.length===0?(a(),r("p",ne," Tidak ada karyawan aktif di outlet ini ")):u("",!0)]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tanggal Resign *",-1)),b(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>l.resignation_date=o),type:"date",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[j,l.resignation_date]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tipe Resign *",-1)),b(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>l.resignation_type=o),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},e[13]||(e[13]=[t("option",{value:""},"Select Type",-1),t("option",{value:"prosedural"},"Prosedural",-1),t("option",{value:"non_prosedural"},"Non Prosedural",-1)]),512),[[R,l.resignation_type]])])]),t("div",ie,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Notes",-1)),b(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=o=>l.notes=o),rows:"4",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter notes about the resignation..."},null,512),[[j,l.notes]])]),t("div",de,[e[20]||(e[20]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Approval Flow",-1)),e[21]||(e[21]=t("p",{class:"text-sm text-gray-600 mb-4"},"Add approvers in order from lowest to highest level. The first approver will be the lowest level, and the last approver will be the highest level.",-1)),t("div",ue,[t("div",pe,[b(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>c.value=o),type:"text",placeholder:"Search users by name, email, or NIK...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",onFocus:e[6]||(e[6]=o=>c.value.length>=2&&E(c.value)),onInput:U},null,544),[[j,c.value]]),g.value&&p.value.length>0?(a(),r("div",me,[(a(!0),r(C,null,V(p.value,o=>(a(),r("div",{key:o.id,onClick:d=>$(o),class:"px-3 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-200 last:border-b-0"},[t("div",ve,n(o.nama_lengkap),1),t("div",ye,n(o.email),1),o.jabatan?(a(),r("div",ge,n(typeof o.jabatan=="object"?o.jabatan.nama_jabatan||"":o.jabatan),1)):u("",!0)],8,ce))),128))])):u("",!0)])]),l.approvers.length>0?(a(),r("div",fe,[e[19]||(e[19]=t("h4",{class:"font-medium text-gray-700"},"Approval Order (Lowest to Highest):",-1)),(a(!0),r(C,null,V(l.approvers,(o,d)=>(a(),r("div",{key:o.id,class:"flex items-center justify-between p-3 rounded-md bg-gray-50 border border-gray-200"},[t("div",be,[t("div",xe,[d>0?(a(),r("button",{key:0,onClick:N=>O(d,d-1),class:"p-1 text-gray-500 hover:text-gray-700",title:"Move Up"},e[16]||(e[16]=[t("i",{class:"fa fa-arrow-up"},null,-1)]),8,_e)):u("",!0),d<l.approvers.length-1?(a(),r("button",{key:1,onClick:N=>O(d,d+1),class:"p-1 text-gray-500 hover:text-gray-700",title:"Move Down"},e[17]||(e[17]=[t("i",{class:"fa fa-arrow-down"},null,-1)]),8,he)):u("",!0)]),t("div",ke,[t("span",we," Level "+n(d+1),1),t("div",null,[t("div",Se,n(o.nama_lengkap),1),t("div",Ce,n(o.email),1),o.jabatan?(a(),r("div",Ve,n(typeof o.jabatan=="object"?o.jabatan.nama_jabatan||"":o.jabatan),1)):u("",!0)])])]),t("button",{onClick:N=>L(d),class:"p-1 text-red-500 hover:text-red-700",title:"Remove Approver"},e[18]||(e[18]=[t("i",{class:"fa fa-times"},null,-1)]),8,je)]))),128))])):u("",!0)]),t("div",Ae,[w(S(F),{href:"/employee-resignations",class:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"},{default:k(()=>e[22]||(e[22]=[f(" Cancel ")])),_:1}),t("button",{type:"submit",disabled:h.value,class:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"},[h.value?(a(),r("span",Oe,e[23]||(e[23]=[t("i",{class:"fa fa-spinner fa-spin mr-2"},null,-1),f(" Creating... ")]))):(a(),r("span",Ne,e[24]||(e[24]=[t("i",{class:"fa fa-save mr-2"},null,-1),f(" Create Resignation ")])))],8,Ee)])],32)])])]),_:1}))}};export{He as default};
