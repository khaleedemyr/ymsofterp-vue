import{$ as lt,c as T,r as d,w as st,a as ot,A as rt,B as o,C as V,D as t,L as r,E as _,F as v,M as h,G as w,N as n,H as N,J as R,I as M,l as nt,x as ut,_ as it,W as q}from"./vendor-vue-g7iCcTkf.js";import{A as dt}from"./AppLayout-CCl6N_RX.js";import{a as K}from"./vendor-utils-CpgP2uT4.js";import{S as E}from"./app-DvUgkxHf.js";import{_ as ct}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-oDgFzWKX.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const pt={class:"w-full min-h-screen py-8 px-2 md:px-6"},bt={key:0,class:"mb-4 flex flex-wrap gap-4"},gt={class:"font-bold"},ft={class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4"},xt={class:"flex flex-col md:flex-row md:items-center gap-4"},yt={class:"flex items-center gap-2"},mt={class:"flex items-center gap-2"},vt={class:"flex items-center gap-2"},_t=["value"],ht={class:"flex items-center gap-2"},wt=["disabled"],kt={key:0,value:""},At=["value"],Dt={key:0,class:"text-xs text-gray-500"},Tt={class:"flex items-center gap-2"},Nt=["value"],St={class:"mt-4 flex justify-end gap-2"},Ct=["disabled"],Ot={key:0,class:"fa fa-spinner fa-spin"},Ft={key:1,class:"fa fa-file-excel"},Bt=["disabled"],Mt={key:0,class:"fa fa-spinner fa-spin"},Et={key:1,class:"fa fa-search"},Lt={key:1,class:"bg-white rounded-xl shadow-lg p-12 text-center"},It={key:2,class:"overflow-x-auto bg-white rounded-xl shadow-lg"},Wt={class:"min-w-full divide-y divide-gray-200"},jt={class:"bg-white divide-y divide-gray-200"},Ut={class:"hover:bg-blue-50 transition-colors duration-200 group"},Vt={class:"px-2 py-2 align-top"},Rt=["onClick"],qt={key:0},Kt={key:1},Pt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},$t={class:"px-6 py-4 whitespace-nowrap text-sm"},Gt={class:"px-6 py-4 whitespace-nowrap text-sm text-right font-semibold text-blue-700"},Qt={class:"px-6 py-4 whitespace-nowrap text-sm"},zt={class:"px-6 py-4 whitespace-nowrap text-sm"},Ht={class:"px-6 py-4 whitespace-nowrap text-sm"},Jt={colspan:"6",class:"bg-gray-50 px-0 py-0"},Xt={class:"rounded-lg border border-blue-100 bg-blue-50/60 shadow-inner mx-4 my-2 overflow-x-auto"},Yt={key:0,class:"text-gray-400 py-6 text-center"},Zt={key:1},te={class:"w-full text-xs"},ee={class:"px-4 py-2 border-b"},ae={class:"px-4 py-2 border-b text-right"},le={class:"px-4 py-2 border-b"},se={class:"px-4 py-2 border-b text-right"},oe={class:"px-4 py-2 border-b text-right"},re={class:"px-4 py-2 border-b text-right font-semibold"},ne={class:"px-4 py-2 border-b"},ue={key:0,class:"bg-blue-50 border-t-2 border-blue-300"},ie={class:"px-4 py-2 border-b font-bold text-right text-lg text-blue-700"},de={key:2,class:"text-gray-400 py-6 text-center"},ce={key:0,class:"bg-gray-100 border-t-2 border-gray-400"},pe={class:"px-6 py-4 text-right font-bold text-gray-900 text-xl"},be={key:3,class:"bg-white rounded-xl shadow-lg p-8 text-center"},ge={key:4,class:"bg-white rounded-xl shadow-lg p-8 text-center"},fe={__name:"ReportUniversal",props:{data:Array,types:Array,warehouse_outlets:Array,outlets:Array,filters:Object,total_per_type:Object,user_outlet_id:Number},setup(P){var L,I,W,j,U;const s=P,$=lt(),G=T(()=>{var e;return((e=$.props.auth)==null?void 0:e.user)||{}}),p=T(()=>s.user_outlet_id===1),Q=T(()=>{if(s.user_outlet_id&&s.user_outlet_id!==1&&s.outlets){const e=s.outlets.find(a=>a.id===s.user_outlet_id);return e?e.id:""}return""}),S=d(((L=s.filters)==null?void 0:L.type)||""),k=d(((I=s.filters)==null?void 0:I.warehouse_outlet_id)||""),b=d(p.value?((W=s.filters)==null?void 0:W.outlet_id)||"":Q.value),g=d(((j=s.filters)==null?void 0:j.from)||""),f=d(((U=s.filters)==null?void 0:U.to)||""),c=d([]);async function O(e){var l,i;if(console.log("Filtering warehouse outlets for outlet:",e),!e){if(p.value)c.value=s.warehouse_outlets||[];else{const m=s.user_outlet_id||G.value.id_outlet;c.value=(s.warehouse_outlets||[]).filter(C=>C.outlet_id==m)}console.log("No outlet selected, filtered warehouse outlets:",c.value.length);return}const a=Number(e);if(p.value)try{const m=await K.get(`/api/warehouse-outlets/by-outlet/${e}`);c.value=m.data||[],console.log("Fetched warehouse outlets from API:",c.value.length)}catch(m){console.error("Error fetching warehouse outlets:",m),c.value=(s.warehouse_outlets||[]).filter(C=>Number(C.outlet_id)===a),console.log("Fallback filtered warehouse outlets:",c.value.length,"from",((l=s.warehouse_outlets)==null?void 0:l.length)||0,"total")}else c.value=(s.warehouse_outlets||[]).filter(m=>Number(m.outlet_id)===a),console.log("Filtered warehouse outlets for regular user:",c.value.length,"from",((i=s.warehouse_outlets)==null?void 0:i.length)||0,"total")}const A=d({}),u=d({}),F=d({}),x=d(!1),D=d(!1);st(b,async(e,a)=>{console.log("Outlet changed from",a,"to",e),k.value="",await O(e)},{immediate:!0}),ot(()=>{b.value?O(b.value):O(null)});function z(){if(!g.value||!f.value){E.fire({icon:"warning",title:"Filter Wajib",text:"Filter tanggal (Dari dan Sampai) wajib diisi untuk melihat laporan.",confirmButtonText:"OK",confirmButtonColor:"#F59E0B"});return}x.value=!0,q.get(route("outlet-internal-use-waste.report-universal"),{type:S.value,warehouse_outlet_id:k.value,outlet_id:(p.value,b.value),from:g.value,to:f.value},{preserveState:!0,preserveScroll:!0,replace:!0,onFinish:()=>{x.value=!1},onError:()=>{x.value=!1}})}function H(e){return e?new Date(e).toLocaleDateString("id-ID"):"-"}function J(e){return e==="internal_use"?"Internal Use":e==="spoil"?"Spoil":e==="waste"?"Waste":e==="r_and_d"?"R & D":e==="marketing"?"Marketing":e==="non_commodity"?"Non Commodity":e==="guest_supplies"?"Guest Supplies":e==="wrong_maker"?"Wrong Maker":e==="training"?"Training":e}function X(){q.visit(route("outlet-internal-use-waste.index"))}function Y(){if(!g.value||!f.value){E.fire({icon:"warning",title:"Filter Wajib",text:"Filter tanggal (Dari dan Sampai) wajib diisi untuk export.",confirmButtonText:"OK",confirmButtonColor:"#F59E0B"});return}if(!s.data||s.data.length===0){E.fire({icon:"warning",title:"Tidak Ada Data",text:"Tidak ada data untuk diekspor. Silakan load data terlebih dahulu.",confirmButtonText:"OK",confirmButtonColor:"#F59E0B"});return}D.value=!0;const e=new URLSearchParams({type:S.value||"",warehouse_outlet_id:k.value||"",outlet_id:p.value?b.value||"":b.value,from:g.value,to:f.value});window.location.href=route("outlet-internal-use-waste.report-universal.export")+"?"+e.toString(),setTimeout(()=>{D.value=!1},2e3)}function Z(e){A.value[e]=!A.value[e],A.value[e]&&!u.value[e]&&(F.value[e]=!0,K.get(`/outlet-internal-use-waste/${e}/details`).then(a=>{u.value[e]=a.data.details||[],console.log("Details loaded for row",e,":",u.value[e]),console.log("Total MAC for row",e,":",B(u.value[e]))}).catch(a=>{console.error("Error loading details for row",e,":",a),u.value[e]=[]}).finally(()=>{F.value[e]=!1}))}function y(e){return e==null||isNaN(e)?"-":"Rp "+Number(e).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}function tt(e){return e==null||isNaN(e)?"0":Number(e).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}function et(e){return!e||e.qty===null||e.qty===void 0||e.mac_converted===null||e.mac_converted===void 0?0:(Number(e.qty)||0)*(Number(e.mac_converted)||0)}function B(e){return!e||!Array.isArray(e)||e.length===0?0:e.reduce((a,l)=>{const i=l.subtotal_mac!==null&&l.subtotal_mac!==void 0?Number(l.subtotal_mac):0;return a+i},0)}T(()=>{if(!s.data||!Array.isArray(s.data)||s.data.length===0)return 0;let e=0;return s.data.forEach(a=>{if(u.value[a.id]&&Array.isArray(u.value[a.id])&&u.value[a.id].length>0){const l=B(u.value[a.id]);e+=l}}),e});const at=T(()=>!s.data||!Array.isArray(s.data)||s.data.length===0?0:s.data.reduce((e,a)=>{const l=a.subtotal_mac!==null&&a.subtotal_mac!==void 0?Number(a.subtotal_mac):0;return e+l},0));return(e,a)=>(o(),rt(dt,null,{default:V(()=>[t("div",pt,[a[22]||(a[22]=t("h1",{class:"text-2xl font-bold mb-6"},"Laporan Category Cost Outlet",-1)),t("div",{class:"mb-4 flex justify-end"},[t("button",{onClick:X,class:"btn px-6 py-2 rounded-lg font-semibold bg-gray-200 text-gray-700 hover:bg-gray-300 transition"},"Kembali")]),s.total_per_type&&Object.keys(s.total_per_type).length?(o(),r("div",bt,[(o(!0),r(v,null,h(s.types.filter(l=>l.value),l=>(o(),r("div",{key:l.value,class:"px-4 py-2 rounded bg-blue-50 text-blue-900 font-semibold shadow"},[w(n(l.label)+": ",1),t("span",gt,n(y(s.total_per_type[l.value]||0)),1)]))),128))])):_("",!0),t("div",ft,[a[11]||(a[11]=t("p",{class:"text-sm text-yellow-800 mb-3"},[t("i",{class:"fa fa-info-circle mr-1"}),t("strong",null,"Penting:"),w(" Filter tanggal (Dari dan Sampai) wajib diisi dan maksimal range 3 bulan untuk mencegah timeout server. ")],-1)),t("div",xt,[t("div",yt,[a[5]||(a[5]=t("label",{class:"text-sm font-medium"},[w("Dari "),t("span",{class:"text-red-500"},"*")],-1)),N(t("input",{type:"date","onUpdate:modelValue":a[0]||(a[0]=l=>g.value=l),required:"",class:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[R,g.value]])]),t("div",mt,[a[6]||(a[6]=t("label",{class:"text-sm font-medium"},[w("Sampai "),t("span",{class:"text-red-500"},"*")],-1)),N(t("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=l=>f.value=l),required:"",class:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[R,f.value]])]),t("div",vt,[a[7]||(a[7]=t("label",{class:"text-sm"},"Tipe",-1)),N(t("select",{"onUpdate:modelValue":a[2]||(a[2]=l=>S.value=l),class:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500"},[(o(!0),r(v,null,h(s.types,l=>(o(),r("option",{key:l.value,value:l.value},n(l.label),9,_t))),128))],512),[[M,S.value]])]),t("div",ht,[a[8]||(a[8]=t("label",{class:"text-sm"},"Outlet",-1)),N(t("select",{"onUpdate:modelValue":a[3]||(a[3]=l=>b.value=l),disabled:!p.value,class:nt(["border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500",{"bg-gray-100 cursor-not-allowed":!p.value}])},[p.value?(o(),r("option",kt,"Semua")):_("",!0),(o(!0),r(v,null,h(s.outlets,l=>(o(),r("option",{key:l.id,value:l.id},n(l.name),9,At))),128))],10,wt),[[M,b.value]]),p.value?_("",!0):(o(),r("span",Dt,"(Outlet Anda)"))]),t("div",Tt,[a[10]||(a[10]=t("label",{class:"text-sm"},"Warehouse Outlet",-1)),N(t("select",{"onUpdate:modelValue":a[4]||(a[4]=l=>k.value=l),class:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500"},[a[9]||(a[9]=t("option",{value:""},"Semua",-1)),(o(!0),r(v,null,h(c.value,l=>(o(),r("option",{key:l.id,value:l.id},n(l.name),9,Nt))),128))],512),[[M,k.value]])])]),t("div",St,[t("button",{onClick:Y,disabled:!g.value||!f.value||x.value||D.value||!s.data||s.data.length===0,class:"px-6 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 transition disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2"},[D.value?(o(),r("i",Ot)):(o(),r("i",Ft)),t("span",null,n(D.value?"Exporting...":"Export Excel"),1)],8,Ct),t("button",{onClick:z,disabled:!g.value||!f.value||x.value,class:"px-6 py-2 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 transition disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2"},[x.value?(o(),r("i",Mt)):(o(),r("i",Et)),t("span",null,n(x.value?"Loading...":"Load Data"),1)],8,Bt)])]),x.value?(o(),r("div",Lt,a[12]||(a[12]=[t("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mb-4"},null,-1),t("p",{class:"text-gray-600 font-medium"},"Memuat data laporan...",-1)]))):s.data&&s.data.length>0?(o(),r("div",It,[t("table",Wt,[a[19]||(a[19]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Tanggal"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Tipe"),t("th",{class:"px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider"},"Subtotal MAC"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Outlet"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Warehouse Outlet"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Catatan")])],-1)),t("tbody",jt,[(o(!0),r(v,null,h(s.data,l=>(o(),r(v,{key:l.id},[t("tr",Ut,[t("td",Vt,[t("button",{onClick:i=>Z(l.id),class:"focus:outline-none transition-transform duration-200 group-hover:scale-110"},[A.value[l.id]?(o(),r("span",qt,"▼")):(o(),r("span",Kt,"▶"))],8,Rt)]),t("td",Pt,n(H(l.date)),1),t("td",$t,n(J(l.type)),1),t("td",Gt,n(y(l.subtotal_mac||0)),1),t("td",Qt,n(l.outlet_name),1),t("td",zt,n(l.warehouse_outlet_name),1),t("td",Ht,n(l.notes||"-"),1)]),ut(it,{name:"fade-expand"},{default:V(()=>[A.value[l.id]?(o(),r("tr",{key:"detail-"+l.id},[a[16]||(a[16]=t("td",null,null,-1)),t("td",Jt,[t("div",Xt,[F.value[l.id]?(o(),r("div",Yt,"Loading...")):u.value[l.id]&&u.value[l.id].length?(o(),r("div",Zt,[t("table",te,[a[15]||(a[15]=t("thead",{class:"sticky top-0 z-10 bg-blue-100/80"},[t("tr",null,[t("th",{class:"px-4 py-2 border-b font-semibold text-gray-700"},"Item"),t("th",{class:"px-4 py-2 border-b font-semibold text-gray-700 text-right"},"Qty"),t("th",{class:"px-4 py-2 border-b font-semibold text-gray-700"},"Unit"),t("th",{class:"px-4 py-2 border-b font-semibold text-gray-700 text-right"},[w("MAC"),t("br"),w("(per unit)")]),t("th",{class:"px-4 py-2 border-b font-semibold text-gray-700 text-right"},"Qty × MAC"),t("th",{class:"px-4 py-2 border-b font-semibold text-gray-700 text-right"},"Subtotal"),t("th",{class:"px-4 py-2 border-b font-semibold text-gray-700"},"Catatan")])],-1)),t("tbody",null,[(o(!0),r(v,null,h(u.value[l.id],i=>(o(),r("tr",{key:i.id,class:"hover:bg-blue-100/60 transition-colors"},[t("td",ee,n(i.item_name),1),t("td",ae,n(tt(i.qty)),1),t("td",le,n(i.unit_name),1),t("td",se,n(y(i.mac_converted)),1),t("td",oe,n(y(et(i))),1),t("td",re,n(y(i.subtotal_mac)),1),t("td",ne,n(i.note||"-"),1)]))),128)),u.value[l.id]&&Array.isArray(u.value[l.id])&&u.value[l.id].length>0?(o(),r("tr",ue,[a[13]||(a[13]=t("td",{colspan:"5",class:"px-4 py-2 border-b font-bold text-right text-gray-900"},"Total MAC",-1)),t("td",ie,n(y(B(u.value[l.id]))),1),a[14]||(a[14]=t("td",{class:"px-4 py-2 border-b"},null,-1))])):_("",!0)])])])):(o(),r("div",de,"Tidak ada detail."))])])])):_("",!0)]),_:2},1024)],64))),128))]),s.data&&s.data.length>0?(o(),r("tfoot",ce,[t("tr",null,[a[17]||(a[17]=t("td",{colspan:"3",class:"px-6 py-4 text-right font-bold text-gray-900 text-lg"}," GRAND TOTAL MAC ",-1)),t("td",pe,n(y(at.value)),1),a[18]||(a[18]=t("td",{colspan:"3",class:"px-6 py-4"},null,-1))])])):_("",!0)])])):g.value&&f.value?(o(),r("div",be,a[20]||(a[20]=[t("i",{class:"fa fa-info-circle text-gray-400 text-4xl mb-4"},null,-1),t("p",{class:"text-gray-500"},"Tidak ada data untuk filter yang dipilih.",-1)]))):(o(),r("div",ge,a[21]||(a[21]=[t("i",{class:"fa fa-calendar-alt text-gray-400 text-4xl mb-4"},null,-1),t("p",{class:"text-gray-500"},'Silakan isi filter tanggal dan klik tombol "Load Data" untuk melihat data.',-1)])))])]),_:1}))}},Ne=ct(fe,[["__scopeId","data-v-1be61d6f"]]);export{Ne as default};
