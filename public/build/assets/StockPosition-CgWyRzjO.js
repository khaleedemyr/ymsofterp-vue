import{r as _,c as k,w as z,A as G,B as l,C as J,D as a,L as n,E as c,G as L,N as i,H as M,J as Y,F as w,M as C,I as F,l as $}from"./vendor-vue-g7iCcTkf.js";import{A as Z}from"./AppLayout-CSX-_rnh.js";import{a as Q}from"./vendor-utils-CpgP2uT4.js";import"./app-DcTypqnW.js";import"./vendor-charts-CuqD4wLC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-B1e0pQ9F.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const ee={class:"w-full py-8 px-4"},te={class:"flex justify-between items-center mb-6"},se=["disabled"],ae={key:0,class:"fas fa-spinner fa-spin"},le={key:1,class:"fas fa-file-excel"},ne={class:"flex flex-col md:flex-row md:items-center gap-4 mb-4"},ie={class:"flex items-center gap-2"},oe=["value"],re={class:"flex items-center gap-2"},ue=["value"],de={class:"bg-white rounded-xl shadow-lg overflow-hidden"},pe={class:"min-w-full divide-y divide-gray-200"},me={class:"bg-white divide-y divide-gray-200"},_e={key:0},ye=["onClick"],ce={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},ge={class:"flex items-center gap-2"},xe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-700"},fe={class:"px-6 py-4 whitespace-nowrap text-sm text-right"},he={key:0},ve={key:0},be={key:1},ke={class:"px-6 py-4 whitespace-nowrap text-sm text-right"},we={key:0},$e={key:0},De={key:1},Se={class:"px-6 py-4 whitespace-nowrap text-sm text-right"},qe={key:0},Le={key:0},Ce={key:1},Ie={class:"px-6 py-4 whitespace-nowrap text-sm"},Ae={key:0,class:"bg-gray-50"},Me={colspan:"6",class:"px-6 py-4"},Ee={key:0,class:"text-center py-4"},Ne={key:1,class:"overflow-x-auto"},Te={class:"min-w-full divide-y divide-gray-200 text-sm"},Re={class:"bg-white divide-y divide-gray-200"},je={key:0,class:"bg-yellow-50 font-semibold"},Fe={class:"px-4 py-2 text-gray-700"},Qe={class:"px-4 py-2 text-right text-gray-700"},Ue={class:"px-4 py-2 text-gray-700"},Be={class:"px-4 py-2 text-right text-gray-700"},Pe={class:"px-4 py-2 text-right text-gray-700"},Ve={class:"px-4 py-2 text-right text-gray-700"},Ke={class:"px-4 py-2 text-gray-700"},We={class:"px-4 py-2 text-gray-700"},Oe={key:2,class:"text-center py-4 text-gray-500 text-sm"},He={key:0},Xe={key:1},ze={key:2},Ge={key:0,class:"flex justify-between items-center mt-4"},Je={class:"text-sm text-gray-600"},Ye={class:"flex gap-1"},Ze=["disabled"],et={class:"px-2"},tt=["disabled"],mt={__name:"StockPosition",props:{stocks:Array,warehouses:Array,warehouse_outlets:Array},setup(E){const U=E,b=_(""),g=_(25),m=_(1),x=_(""),f=_(!1),h=_([]),u=_({}),D=_({}),S=_({}),v=k(()=>{let e=U.stocks;if(x.value&&(e=e.filter(t=>String(t.warehouse_id)===String(x.value))),!b.value)return e;const s=b.value.toLowerCase();return e.filter(t=>t.item_name&&t.item_name.toLowerCase().includes(s)||t.warehouse_name&&t.warehouse_name.toLowerCase().includes(s))}),q=k(()=>Math.ceil(v.value.length/g.value)||1),I=k(()=>(m.value-1)*g.value),N=k(()=>Math.min(I.value+g.value,v.value.length)),B=k(()=>v.value.slice(I.value,N.value));function P(){m.value>1&&m.value--}function V(){m.value<q.value&&m.value++}z([g,b],()=>{m.value=1});function A(e,s=0){return!e||Number(e)===0?"-":Number(e).toLocaleString("id-ID",{minimumFractionDigits:s,maximumFractionDigits:s})}async function K(){if(!f.value)try{f.value=!0;const e=new URLSearchParams;x.value&&e.append("warehouse_id",x.value);const s=await Q.get(route("inventory.stock-position.export"),{params:e,responseType:"blob"}),t=new Blob([s.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),r=window.URL.createObjectURL(t),d=document.createElement("a");d.href=r,d.download=`laporan_stok_akhir_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(r)}catch(e){console.error("Export error:",e),alert("Terjadi kesalahan saat export. Silakan coba lagi.")}finally{f.value=!1}}function o(e){return`${e.item_id}-${e.warehouse_id}`}async function W(e){const s=o(e),t=h.value.indexOf(s);t>-1?h.value.splice(t,1):(h.value.push(s),!u.value[s]&&!S.value[s]&&await O(e))}async function O(e){var t,r;const s=o(e);S.value[s]=!0;try{const d={item_id:e.item_id,warehouse_id:e.warehouse_id};console.log("Fetching item detail with params:",d);const y=await Q.get("/inventory/stock-card/detail",{params:d,withCredentials:!0,headers:{"X-Requested-With":"XMLHttpRequest"}});if(console.log("Response received:",y.data),y.data&&y.data.cards){const j=Array.isArray(y.data.cards)?y.data.cards:[];u.value={...u.value,[s]:j},y.data.saldo_awal&&(D.value={...D.value,[s]:y.data.saldo_awal}),console.log("Item details set for key:",s,"Count:",j.length)}else console.warn("No cards data in response:",y.data),u.value={...u.value,[s]:[]}}catch(d){console.error("Error fetching item detail:",d),console.error("Error response:",(t=d.response)==null?void 0:t.data),console.error("Error status:",(r=d.response)==null?void 0:r.status),u.value={...u.value,[s]:[]}}finally{S.value[s]=!1}}function T(e,s=null){if(s==="in"){const t=[];return e.in_qty_small>0&&t.push(`${p(e.in_qty_small)} ${e.small_unit_name||""}`),e.in_qty_medium>0&&t.push(`${p(e.in_qty_medium)} ${e.medium_unit_name||""}`),e.in_qty_large>0&&t.push(`${p(e.in_qty_large)} ${e.large_unit_name||""}`),t.length>0?t.join(" | "):"-"}else if(s==="out"){const t=[];return e.out_qty_small>0&&t.push(`${p(e.out_qty_small)} ${e.small_unit_name||""}`),e.out_qty_medium>0&&t.push(`${p(e.out_qty_medium)} ${e.medium_unit_name||""}`),e.out_qty_large>0&&t.push(`${p(e.out_qty_large)} ${e.large_unit_name||""}`),t.length>0?t.join(" | "):"-"}else return"-"}function R(e){if(!e)return"-";if(e.small!==void 0||e.medium!==void 0||e.large!==void 0){const t=[];return e.small!==void 0&&e.small!==null&&t.push(`${p(e.small)} ${e.small_unit_name||""}`),e.medium!==void 0&&e.medium!==null&&t.push(`${p(e.medium)} ${e.medium_unit_name||""}`),e.large!==void 0&&e.large!==null&&t.push(`${p(e.large)} ${e.large_unit_name||""}`),t.length>0?t.join(" | "):"-"}const s=[];return e.saldo_qty_small!==void 0&&e.saldo_qty_small!==null&&s.push(`${p(e.saldo_qty_small)} ${e.small_unit_name||""}`),e.saldo_qty_medium!==void 0&&e.saldo_qty_medium!==null&&s.push(`${p(e.saldo_qty_medium)} ${e.medium_unit_name||""}`),e.saldo_qty_large!==void 0&&e.saldo_qty_large!==null&&s.push(`${p(e.saldo_qty_large)} ${e.large_unit_name||""}`),s.length>0?s.join(" | "):"-"}function H(e){if(!e.reference_type)return"-";let s=e.reference_type;return e.reference_type==="good_receive"&&e.reference_number?s+=" #"+e.reference_number:e.reference_type==="warehouse_transfer"&&e.transfer_number?s+=" #"+e.transfer_number:e.reference_type==="delivery_order"&&e.do_number?s+=" #"+e.do_number:e.reference_id&&(s+=" #"+e.reference_id),s}function p(e){return e==null?"0":Number(e)%1===0?Number(e).toLocaleString("id-ID"):Number(e).toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:2})}function X(){const e=new Date,s=e.getFullYear(),t=e.getMonth();return new Date(s,t,1).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"})}return(e,s)=>(l(),G(Z,null,{default:J(()=>[a("div",ee,[a("div",te,[s[3]||(s[3]=a("h1",{class:"text-2xl font-bold"},"Laporan Stok Akhir",-1)),a("button",{onClick:K,disabled:f.value,class:"bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors"},[f.value?(l(),n("i",ae)):(l(),n("i",le)),L(" "+i(f.value?"Exporting...":"Export Excel"),1)],8,se)]),a("div",ne,[M(a("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>b.value=t),type:"text",placeholder:"Cari nama barang atau warehouse...",class:"px-4 py-2 border border-gray-300 rounded-lg w-full md:w-64 focus:ring-blue-500 focus:border-blue-500"},null,512),[[Y,b.value]]),a("div",ie,[s[5]||(s[5]=a("label",{class:"text-sm"},"Warehouse",-1)),M(a("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>x.value=t),class:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500"},[s[4]||(s[4]=a("option",{value:""},"Semua Warehouse",-1)),(l(!0),n(w,null,C(E.warehouses,t=>(l(),n("option",{key:t.id,value:t.id},i(t.name),9,oe))),128))],512),[[F,x.value]])]),a("div",re,[s[6]||(s[6]=a("label",{class:"text-sm"},"Tampilkan",-1)),M(a("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>g.value=t),class:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500"},[(l(),n(w,null,C([10,25,50,100],t=>a("option",{key:t,value:t},i(t),9,ue)),64))],512),[[F,g.value]]),s[7]||(s[7]=a("span",{class:"text-sm"},"data",-1))])]),a("div",de,[a("table",pe,[s[17]||(s[17]=a("thead",{class:"bg-gray-50"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Nama Barang"),a("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Warehouse"),a("th",{class:"px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider"},"Qty Small"),a("th",{class:"px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider"},"Qty Medium"),a("th",{class:"px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider"},"Qty Large"),a("th",{class:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider"},"Tanggal Update")])],-1)),a("tbody",me,[v.value.length?c("",!0):(l(),n("tr",_e,s[8]||(s[8]=[a("td",{colspan:"6",class:"text-center py-10 text-gray-400"},"Tidak ada data stok.",-1)]))),(l(!0),n(w,null,C(B.value,t=>(l(),n(w,{key:t.item_id+"-"+t.warehouse_id},[a("tr",{class:$(["hover:bg-gray-50 transition cursor-pointer",{"bg-blue-50":h.value.includes(o(t))}]),onClick:r=>W(t)},[a("td",ce,[a("div",ge,[a("i",{class:$(h.value.includes(o(t))?"fa-solid fa-chevron-down text-blue-600":"fa-solid fa-chevron-right text-gray-400")},null,2),a("span",null,i(t.item_name),1)])]),a("td",xe,i(t.warehouse_name),1),a("td",fe,[t.display_small>0?(l(),n("span",he,[L(i(A(t.display_small))+" ",1),t.small_unit_name?(l(),n("span",ve,i(t.small_unit_name),1)):c("",!0)])):(l(),n("span",be,"-"))]),a("td",ke,[t.display_medium>0?(l(),n("span",we,[L(i(A(t.display_medium,2))+" ",1),t.medium_unit_name?(l(),n("span",$e,i(t.medium_unit_name),1)):c("",!0)])):(l(),n("span",De,"-"))]),a("td",Se,[t.display_large>0?(l(),n("span",qe,[L(i(A(t.display_large,2))+" ",1),t.large_unit_name?(l(),n("span",Le,i(t.large_unit_name),1)):c("",!0)])):(l(),n("span",Ce,"-"))]),a("td",Ie,i(t.updated_at?new Date(t.updated_at).toLocaleString():"-"),1)],10,ye),h.value.includes(o(t))?(l(),n("tr",Ae,[a("td",Me,[S.value[o(t)]?(l(),n("div",Ee,s[9]||(s[9]=[a("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},null,-1),a("p",{class:"mt-2 text-gray-600 text-sm"},"Memuat detail transaksi...",-1)]))):u.value[o(t)]&&Array.isArray(u.value[o(t)])&&u.value[o(t)].length>0?(l(),n("div",Ne,[a("table",Te,[s[14]||(s[14]=a("thead",{class:"bg-gray-100"},[a("tr",null,[a("th",{class:"px-4 py-2 text-left text-xs font-bold text-gray-700 uppercase"},"Tanggal"),a("th",{class:"px-4 py-2 text-right text-xs font-bold text-gray-700 uppercase"},"Masuk (Qty)"),a("th",{class:"px-4 py-2 text-right text-xs font-bold text-gray-700 uppercase"},"Keluar (Qty)"),a("th",{class:"px-4 py-2 text-right text-xs font-bold text-gray-700 uppercase"},"Saldo (Qty)"),a("th",{class:"px-4 py-2 text-left text-xs font-bold text-gray-700 uppercase"},"Referensi"),a("th",{class:"px-4 py-2 text-left text-xs font-bold text-gray-700 uppercase"},"Keterangan")])],-1)),a("tbody",Re,[D.value[o(t)]?(l(),n("tr",je,[a("td",Fe,i(X()),1),s[10]||(s[10]=a("td",{class:"px-4 py-2 text-right text-gray-700"},"-",-1)),s[11]||(s[11]=a("td",{class:"px-4 py-2 text-right text-gray-700"},"-",-1)),a("td",Qe,i(R(D.value[o(t)])),1),s[12]||(s[12]=a("td",{class:"px-4 py-2 text-gray-700"},"Saldo Awal Bulan",-1)),s[13]||(s[13]=a("td",{class:"px-4 py-2 text-gray-700"},"Saldo akhir bulan sebelumnya",-1))])):c("",!0),(l(!0),n(w,null,C(u.value[o(t)],(r,d)=>(l(),n("tr",{key:r.id,class:$(d===u.value[o(t)].length-1?"bg-yellow-200 font-bold":"hover:bg-gray-50")},[a("td",Ue,i(r.date?new Date(r.date).toLocaleDateString("id-ID"):"-"),1),a("td",Be,i(T(r,"in")),1),a("td",Pe,i(T(r,"out")),1),a("td",Ve,i(R(r)),1),a("td",Ke,i(H(r)),1),a("td",We,i(r.description||"-"),1)],2))),128))])])])):(l(),n("div",Oe,[u.value[o(t)]===void 0?(l(),n("div",He,s[15]||(s[15]=[a("p",null,"Memuat data...",-1)]))):u.value[o(t)]&&u.value[o(t)].length===0?(l(),n("div",Xe," Tidak ada data transaksi untuk item ini. ")):(l(),n("div",ze,s[16]||(s[16]=[a("p",null,"Data tidak tersedia.",-1)])))]))])])):c("",!0)],64))),128))])])]),v.value.length?(l(),n("div",Ge,[a("div",Je," Menampilkan "+i(I.value+1)+" - "+i(N.value)+" dari "+i(v.value.length)+" data ",1),a("div",Ye,[a("button",{onClick:P,disabled:m.value===1,class:$(["px-3 py-1 rounded border text-sm",m.value===1?"bg-gray-200 text-gray-400":"bg-white text-blue-700 hover:bg-blue-50"])},"<",10,Ze),a("span",et,"Halaman "+i(m.value)+" / "+i(q.value),1),a("button",{onClick:V,disabled:m.value===q.value,class:$(["px-3 py-1 rounded border text-sm",m.value===q.value?"bg-gray-200 text-gray-400":"bg-white text-blue-700 hover:bg-blue-50"])},">",10,tt)])])):c("",!0)])]),_:1}))}};export{mt as default};
