import{r as f,$ as et,c as V,a as tt,j as st,L as n,B as a,D as t,E as d,A as ot,G as g,H as K,I as ie,F as E,M,R as lt,J as at,N as i,x as ue,O as nt,l as R,Z as U,V as rt,n as de}from"./vendor-vue-g7iCcTkf.js";import{a as _}from"./vendor-utils-CpgP2uT4.js";import{S as y}from"./app-Vi2dpKR6.js";import it from"./CommentModal-CugzFnoQ.js";import ut from"./AddRetailItem-EikpTibz.js";import dt from"./RetailList-nbVbAXBp.js";import{A as ct}from"./AppLayout-DS2U8tWW.js";import{_ as mt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-charts-CuqD4wLC.js";import"./CameraModal-UOq4SzNh.js";import"./vendor-ui-CrPgGUUb.js";import"./id-C4ThNj35.js";import"./ProfileUpdateModal-Do674Z4r.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const ft={class:"w-full px-4 sm:px-6 lg:px-8 py-6"},vt={class:"bg-white rounded-lg shadow p-4 sm:p-6 mb-6"},pt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 2xl:grid-cols-8 gap-4"},gt=["value"],xt={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6"},bt=["onClick"],yt={class:"text-sm text-gray-600"},ht={class:"bg-white rounded-lg shadow overflow-hidden"},wt={class:"overflow-x-auto min-w-full"},_t={class:"min-w-full divide-y divide-gray-200"},kt={class:"bg-white divide-y divide-gray-200"},Ct={class:"px-6 py-4"},Et={class:"flex items-start"},Mt={class:"ml-4"},Tt={class:"text-sm font-medium text-gray-900"},Rt={class:"text-sm text-gray-500"},It={class:"text-sm text-gray-500 mt-1"},St={class:"px-6 py-4 whitespace-nowrap"},Nt={class:"relative"},Pt=["onClick"],Ot={key:0,class:"absolute z-10 mt-1 w-48 bg-white rounded-md shadow-lg border"},Dt={class:"py-1"},At=["onClick"],$t={class:"px-6 py-4 whitespace-nowrap"},Vt={class:"px-6 py-4 whitespace-nowrap"},Lt={class:"text-sm text-gray-900"},Gt={key:0,class:"text-sm text-gray-500"},zt={class:"px-6 py-4 whitespace-nowrap"},Kt={key:0,class:"text-sm text-red-600 font-medium"},Ut={key:1,class:"text-sm text-orange-600 font-medium"},jt={class:"px-6 py-4 whitespace-nowrap"},Ft={class:"flex flex-wrap gap-1"},Bt={key:0,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800 border border-purple-200"},Wt={key:0,class:"ml-1 text-xs text-blue-600 capitalize"},qt={key:1,class:"text-gray-400 text-xs"},Ht={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Jt={class:"relative group"},Yt=["onClick","onKeydown","title","disabled","aria-label"],Zt={key:0,class:"fas fa-spinner fa-spin text-blue-600","aria-hidden":"true"},Qt={key:1,class:"far fa-comment text-lg","aria-hidden":"true"},Xt={class:"font-medium"},es={class:"text-xs text-blue-500"},ts={key:2,class:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse",title:"New comments available","aria-label":"New comments available"},ss={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-10 max-w-xs"},os={class:"truncate"},ls={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},as={class:"relative group"},ns=["onClick","onKeydown","title","disabled","aria-label"],rs={key:0,class:"fas fa-spinner fa-spin text-blue-600","aria-hidden":"true"},is={key:1,class:"far fa-images text-lg","aria-hidden":"true"},us={class:"font-medium"},ds={class:"text-xs text-blue-500"},cs={key:2,class:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse",title:"New media available","aria-label":"New media available"},ms={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-10 max-w-xs"},fs={class:"truncate"},vs={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},ps={class:"flex gap-2"},gs=["onClick"],xs=["onClick"],bs=["onClick"],ys={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},hs={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},ws={class:"mt-3"},_s={class:"space-y-2"},ks={key:0,class:"ml-auto bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full"},Cs={key:1,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},Es={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},Ms={class:"mt-3"},Ts={class:"text-sm text-gray-600 mb-4"},Rs={key:2,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},Is={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},Ss={class:"mt-3"},Ns={key:0,class:"mb-4"},Ps={class:"space-y-2"},Os={key:0,class:"flex items-center justify-between p-2 bg-purple-50 rounded-md border border-purple-200"},Ds={class:"flex items-center gap-2"},As={class:"text-sm text-gray-900 font-medium"},$s={class:"flex items-center gap-2"},Vs={class:"text-sm text-gray-900"},Ls={class:"text-xs text-blue-600 capitalize"},Gs=["onClick"],zs={class:"mb-4"},Ks={class:"max-h-40 overflow-y-auto border border-gray-300 rounded-md"},Us=["id","value"],js=["for"],Fs={class:"text-xs text-gray-500 block"},Bs={key:1,class:"text-center py-2"},Ws={key:2,class:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md"},qs={class:"text-sm text-red-700"},Hs={class:"mt-6 flex justify-end gap-3"},Js=["disabled"],Ys={key:0,class:"fas fa-spinner fa-spin mr-2"},Zs={key:4,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},Qs={class:"relative top-10 mx-auto p-5 border w-full max-w-4xl shadow-lg rounded-md bg-white"},Xs={class:"mb-4"},eo={key:0,class:"mb-6 p-4 border rounded-lg bg-gray-50"},to={key:1},so={key:5,class:"fixed inset-0 bg-gray-900 bg-opacity-95 overflow-y-auto h-full w-full z-[9999]"},oo={class:"relative min-h-full flex items-center justify-center p-4"},lo={class:"max-w-4xl max-h-full mx-auto"},ao=["src","alt"],no=["src"],ro={class:"text-center mt-4 text-white"},io={class:"text-lg font-medium"},uo={class:"text-sm text-gray-300"},co={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2 max-w-4xl overflow-x-auto px-4"},mo=["onClick"],fo=["src","alt"],vo={key:1,class:"w-full h-full bg-gray-800 flex items-center justify-center relative"},po={key:2,class:"w-full h-full bg-gray-700 flex items-center justify-center"},go={layout:ct},xo=Object.assign(go,{__name:"List",setup(bo){const x=f([]),j=f([]),ce=f([]),D=f(null),F=f(!1),L=f(!1),B=f(!1),A=f(!1),u=f(null),I=f(""),v=f(null),W=f([]),k=f([]),S=f(!1),T=f("");f(!1);const q=f(!1),N=f(!1),H=f(null),$=f(!1),p=f([]),h=f(0),w=f(null),b=f({outlet:"",status:"",search:""}),me=et(),P=V(()=>{var s,e;return((e=(s=me.props.auth)==null?void 0:s.user)==null?void 0:e.id_outlet)||""}),fe=V(()=>{let s=[...x.value];if(b.value.outlet&&(s=s.filter(e=>e.id_outlet==b.value.outlet)),b.value.status&&(s=s.filter(e=>e.status===b.value.status)),b.value.search){const e=b.value.search.toLowerCase();s=s.filter(l=>l.title.toLowerCase().includes(e)||l.description.toLowerCase().includes(e)||l.task_number.toLowerCase().includes(e))}return s}),ve=V(()=>{const s=[{code:"TASK",label:"To Do",count:0,color:"text-gray-600"},{code:"PR",label:"PR",count:0,color:"text-yellow-600"},{code:"PO",label:"PO",count:0,color:"text-blue-600"},{code:"IN_PROGRESS",label:"In Progress",count:0,color:"text-purple-600"},{code:"IN_REVIEW",label:"In Review",count:0,color:"text-orange-600"},{code:"DONE",label:"Done",count:0,color:"text-green-600"}];return x.value.forEach(e=>{const l=s.find(r=>r.code===e.status);l&&l.count++}),s}),pe=[{value:"TASK",label:"To Do"},{value:"PR",label:"Purchase Requisition"},{value:"PO",label:"Purchase Order"},{value:"IN_PROGRESS",label:"In Progress"},{value:"IN_REVIEW",label:"In Review"},{value:"DONE",label:"Done"}],ge=V(()=>A.value&&u.value&&u.value.id),xe=V(()=>{var s;return(s=u.value)==null?void 0:s.id});async function be(){try{const[s,e]=await Promise.all([_.get("/api/outlet/active"),_.get("/api/maintenance-order-list")]);j.value=s.data,x.value=e.data,await ye(),await he(),P.value&&P.value!=1&&(b.value.outlet=P.value)}catch(s){console.error("Error fetching data:",s)}}async function ye(){try{const s=x.value.map(async l=>{try{const r=await _.get(`/api/maintenance-comments/${l.id}/count`);return{taskId:l.id,count:r.data.count}}catch(r){return console.error(`Error fetching comment count for task ${l.id}:`,r),{taskId:l.id,count:0}}});(await Promise.all(s)).forEach(({taskId:l,count:r})=>{const m=x.value.findIndex(C=>C.id===l);m!==-1&&(x.value[m].comment_count=r)})}catch(s){console.error("Error fetching comment counts:",s)}}async function he(){try{const s=x.value.map(async l=>{try{const r=await _.get(`/api/maintenance-order/${l.id}/media`);return{taskId:l.id,count:r.data.success?r.data.data.length:0}}catch(r){return console.error(`Error fetching media count for task ${l.id}:`,r),{taskId:l.id,count:0}}});(await Promise.all(s)).forEach(({taskId:l,count:r})=>{const m=x.value.findIndex(C=>C.id===l);m!==-1&&(x.value[m].media_count=r)})}catch(s){console.error("Error fetching media counts:",s)}}function we(){}function J(){}function _e(){b.value={outlet:P.value&&P.value!=1?P.value:"",status:"",search:""}}function ke(s){b.value.status=s}function Ce(s){D.value=D.value===s?null:s}function Ee(s,e){if(!Me(s.status,e)){y.fire("Invalid Status Change","This status transition is not allowed.","warning");return}if(e==="DONE"&&(!s.evidence||s.evidence.length===0)){y.fire("Cannot Complete Task","Please upload evidence of completed work first.","warning");return}u.value=s,I.value=e,L.value=!0,D.value=null}function Me(s,e){var r;return((r={TASK:["PR","IN_PROGRESS"],PR:["PO","TASK"],PO:["IN_PROGRESS","PR"],IN_PROGRESS:["IN_REVIEW","PO"],IN_REVIEW:["DONE","IN_PROGRESS"],DONE:["IN_REVIEW"]}[s])==null?void 0:r.includes(e))||!1}async function Te(){try{const s=await _.patch(`/api/maintenance-order/${u.value.id}`,{status:I.value});if(s.data.success){const e=x.value.findIndex(l=>l.id===u.value.id);e!==-1&&(x.value[e].status=I.value),y.fire("Success","Task status updated successfully!","success")}else throw new Error(s.data.error||"Failed to update status")}catch(s){console.error("Error updating status:",s),y.fire("Error","Failed to update task status","error")}finally{L.value=!1,u.value=null,I.value=""}}function Re(){L.value=!1,u.value=null,I.value=""}function Ie(s){u.value=s,F.value=!0}function O(){F.value=!1,u.value=null}function ee(){if(!u.value){console.error("No task selected for comment modal"),y.fire({title:"Error",text:"No task selected. Please try again.",icon:"error"});return}A.value=!0,O()}async function Y(s){if(!s||!s.id){console.error("Invalid task for comment modal:",s),y.fire({title:"Error",text:"Invalid task selected. Please try again.",icon:"error"});return}u.value=s,await de(),A.value=!0,await de()}function te(){A.value=!1,u.value=null}function Se(){if(u.value){const s=x.value.findIndex(e=>e.id===u.value.id);s!==-1&&_.get(`/api/maintenance-comments/${u.value.id}/count`).then(e=>{x.value[s].comment_count=e.data.count,y.fire({title:"Success!",text:"Comment added successfully!",icon:"success",timer:2e3,showConfirmButton:!1})}).catch(e=>{console.error("Error refreshing comment count:",e),Ne(e,u.value.id)})}}function Ne(s,e){var r,m,C;console.error("Comment error:",s);let l="An error occurred while processing your comment.";((r=s.response)==null?void 0:r.status)===413?l="File size is too large. Please use smaller files.":((m=s.response)==null?void 0:m.status)===422?l="Invalid comment data. Please check your input.":((C=s.response)==null?void 0:C.status)===500&&(l="Server error. Please try again later."),y.fire({title:"Error",text:l,icon:"error",confirmButtonText:"OK"})}async function Pe(){try{v.value=u.value,k.value=[],T.value="";const s=await _.get("/api/maintenance-order/assignable-users");if(W.value=s.data,v.value.members){const e=v.value.members.filter(l=>l.role==="ASSIGNEE").map(l=>l.id);k.value=e}B.value=!0,O()}catch(s){console.error("Error loading assignable users:",s),y.fire("Error","Failed to load assignable users","error")}}function Oe(){B.value=!1,v.value=null,W.value=[],k.value=[],T.value=""}async function De(){var s,e;if(!v.value||k.value.length===0){T.value="Please select at least one member to assign";return}try{S.value=!0,T.value="";const l=await _.post(`/api/maintenance-order/${v.value.id}/assign-members`,{task_id:v.value.id,user_ids:k.value});if(l.data.success){const r=x.value.findIndex(m=>m.id===v.value.id);if(r!==-1){const m=await _.get(`/api/maintenance-order/${v.value.id}`);x.value[r]=m.data,v.value=m.data}y.fire("Success","Members assigned successfully!","success"),k.value=[]}else throw new Error(l.data.error||"Failed to assign members")}catch(l){console.error("Error assigning members:",l),T.value=((e=(s=l.response)==null?void 0:s.data)==null?void 0:e.error)||"Failed to assign members"}finally{S.value=!1}}async function Ae(s){try{const e=await _.delete(`/api/maintenance-order/${v.value.id}/remove-member/${s}`);if(e.data.success){const l=x.value.findIndex(r=>r.id===v.value.id);if(l!==-1){const r=await _.get(`/api/maintenance-order/${v.value.id}`);x.value[l]=r.data,v.value=r.data}y.fire("Success","Member removed successfully!","success")}else throw new Error(e.data.error||"Failed to remove member")}catch(e){console.error("Error removing member:",e),y.fire("Error","Failed to remove member","error")}}function $e(){var s;console.log("Open action plan modal for task:",(s=u.value)==null?void 0:s.id),O()}function Ve(){var s;console.log("Open retail modal for task:",(s=u.value)==null?void 0:s.id),q.value=!0,N.value=!1,O()}function Le(){q.value=!1,N.value=!1}function Ge(){var s;N.value=!1,(s=H.value)!=null&&s.loadRetailData&&H.value.loadRetailData(),y.fire({icon:"success",title:"Berhasil!",text:"Data retail berhasil disimpan",timer:1500,showConfirmButton:!1})}function ze(){var s;console.log("Open timeline modal for task:",(s=u.value)==null?void 0:s.id),O()}function Z(s){return{TASK:"To Do",PR:"Purchase Requisition",PO:"Purchase Order",IN_PROGRESS:"In Progress",IN_REVIEW:"In Review",DONE:"Done"}[s]||s}function se(s){return{TASK:"bg-gray-100 text-gray-800",PR:"bg-yellow-100 text-yellow-800",PO:"bg-blue-100 text-blue-800",IN_PROGRESS:"bg-purple-100 text-purple-800",IN_REVIEW:"bg-orange-100 text-orange-800",DONE:"bg-green-100 text-green-800"}[s]||"bg-gray-100 text-gray-800"}function Ke(s){return{Low:"bg-green-100 text-green-800 border border-green-200",Medium:"bg-yellow-100 text-yellow-800 border border-yellow-200",High:"bg-red-100 text-red-800 border border-red-200",Critical:"bg-purple-100 text-purple-800 border border-purple-200","IMPORTANT VS URGENT":"bg-red-100 text-red-800 border border-red-200","IMPORTANT VS NOT URGENT":"bg-yellow-100 text-yellow-800 border border-yellow-200","NOT IMPORTANT VS URGENT":"bg-blue-100 text-blue-800 border border-blue-200","NOT IMPORTANT VS NOT URGENT":"bg-gray-100 text-gray-800 border border-gray-200"}[s]||"bg-gray-100 text-gray-800 border border-gray-200"}function Ue(s){return{Low:"bg-green-500",Medium:"bg-yellow-500",High:"bg-red-500",Critical:"bg-purple-500","IMPORTANT VS URGENT":"bg-red-500","IMPORTANT VS NOT URGENT":"bg-yellow-500","NOT IMPORTANT VS URGENT":"bg-blue-500","NOT IMPORTANT VS NOT URGENT":"bg-gray-500"}[s]||"bg-gray-500"}function je(s){const e=j.value.find(l=>l.id_outlet==s);return e?e.nama_outlet:"Unknown"}function Fe(s){const e=ce.value.find(l=>l.id_ruko==s);return e?e.nama_ruko:""}function G(s){return!s.members||!s.created_by?s.members||[]:s.members.filter(e=>e.id!=s.created_by)}function Be(s){if(!s)return"text-gray-500";const e=new Date,r=new Date(s)-e,m=Math.ceil(r/(1e3*60*60*24));return m<0?"text-red-700":m===0?"text-red-600":m<=1?"text-red-500":m<=3?"text-orange-600":m<=7?"text-yellow-600":m<=14?"text-blue-600":"text-green-600"}function We(s){return s?new Date(s).toLocaleDateString("id-ID"):"-"}function qe(s){return s?new Date(s)<new Date:!1}function He(s){if(!s)return!1;const e=new Date,r=new Date(s)-e,m=Math.ceil(r/(1e3*60*60*24));return m>=0&&m<=3}function Je(s){window.location.href=`/maintenance-order/${s.id}`}function Ye(s){window.location.href=`/maintenance-order/${s.id}/edit`}function Ze(){console.log("Export data")}function oe(s){s.target.closest(".relative")||(D.value=null)}function le(s){(s.ctrlKey||s.metaKey)&&s.key==="Enter"&&u.value&&(s.preventDefault(),ee()),s.key==="Escape"&&A.value&&te(),s.key==="Escape"&&$.value&&z(),$.value&&p.value.length>1&&(s.key==="ArrowRight"?(s.preventDefault(),X()):s.key==="ArrowLeft"&&(s.preventDefault(),ae()))}async function Q(s){if(console.log("openMediaModal called with task:",s),!s||!s.id){console.error("Invalid task for media modal:",s);return}try{u.value=s,$.value=!0,console.log("Modal opened, fetching media for task:",s.id);const e=await _.get(`/api/maintenance-order/${s.id}/media`);if(console.log("Media API response:",e.data),e.data.success)p.value=e.data.data.map(l=>({id:l.id,url:l.url,filename:l.filename,mediaType:l.media_type||"image",mimeType:l.mime_type,size:l.size,created_at:l.created_at})),console.log("Processed media data:",p.value),p.value.length>0?(h.value=0,w.value=p.value[0],console.log("Media modal ready with media:",w.value)):(console.log("No media available for this task"),y.fire({icon:"info",title:"No Media",text:"This task has no media attachments.",timer:2e3,showConfirmButton:!1}),z());else throw new Error(e.data.error||"Failed to fetch media")}catch(e){console.error("Error fetching media:",e),y.fire({icon:"error",title:"Error",text:"Failed to load media for this task."}),z()}}function z(){$.value=!1,u.value=null,p.value=[],h.value=0,w.value=null}function X(){p.value.length>0&&(h.value=(h.value+1)%p.value.length,w.value=p.value[h.value])}function ae(){p.value.length>0&&(h.value=(h.value-1+p.value.length)%p.value.length,w.value=p.value[h.value])}function Qe(s){h.value=s,w.value=p.value[h.value]}return tt(()=>{be(),document.title="Maintenance Order List - YMSoft",document.addEventListener("click",oe),document.addEventListener("keydown",le)}),st(()=>{document.removeEventListener("click",oe),document.removeEventListener("keydown",le)}),(s,e)=>{var l,r,m,C,ne,re;return a(),n("div",ft,[t("div",{class:"flex justify-between items-center mb-6"},[e[8]||(e[8]=t("h1",{class:"text-2xl font-bold text-blue-900"},"Maintenance Order List",-1)),t("div",{class:"flex gap-3"},[e[7]||(e[7]=t("a",{href:"/maintenance-order",class:"btn-secondary"},[t("i",{class:"fas fa-columns mr-2"}),g(" Kanban View ")],-1)),t("button",{onClick:Ze,class:"btn-primary"},e[6]||(e[6]=[t("i",{class:"fas fa-download mr-2"},null,-1),g(" Export ")]))])]),t("div",vt,[t("div",pt,[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Outlet",-1)),K(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>b.value.outlet=o),onChange:we,class:"w-full border rounded-lg px-3 py-2"},[e[9]||(e[9]=t("option",{value:""},"Semua Outlet",-1)),(a(!0),n(E,null,M(j.value,o=>(a(),n("option",{key:o.id_outlet,value:o.id_outlet},i(o.nama_outlet),9,gt))),128))],544),[[ie,b.value.outlet]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Status",-1)),K(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>b.value.status=o),onChange:J,class:"w-full border rounded-lg px-3 py-2"},e[11]||(e[11]=[lt('<option value="" data-v-6efd9f31>Semua Status</option><option value="TASK" data-v-6efd9f31>To Do</option><option value="PR" data-v-6efd9f31>Purchase Requisition</option><option value="PO" data-v-6efd9f31>Purchase Order</option><option value="IN_PROGRESS" data-v-6efd9f31>In Progress</option><option value="IN_REVIEW" data-v-6efd9f31>In Review</option><option value="DONE" data-v-6efd9f31>Done</option>',7)]),544),[[ie,b.value.status]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Search",-1)),K(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>b.value.search=o),onInput:J,type:"text",placeholder:"Search tasks...",class:"w-full border rounded-lg px-3 py-2"},null,544),[[at,b.value.search]])]),t("div",{class:"flex items-end gap-2"},[t("button",{onClick:_e,class:"px-4 py-2 text-gray-600 hover:text-gray-800"}," Clear "),t("button",{onClick:J,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"}," Apply ")])])]),t("div",xt,[(a(!0),n(E,null,M(ve.value,o=>(a(),n("div",{key:o.code,class:"bg-white rounded-lg shadow p-4 text-center cursor-pointer hover:shadow-lg transition-shadow",onClick:c=>ke(o.code)},[t("div",{class:R(["text-2xl font-bold",o.color])},i(o.count),3),t("div",yt,i(o.label),1)],8,bt))),128))]),t("div",ht,[t("div",wt,[t("table",_t,[e[26]||(e[26]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/4"}," Task Info "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24"}," Status "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32"}," Priority "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-48"}," Location "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32"}," Due Date "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-40"}," Members "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24"}," Comments "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32"}," Media "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24"}," Actions ")])],-1)),t("tbody",kt,[(a(!0),n(E,null,M(fe.value,o=>(a(),n("tr",{key:o.id,class:"hover:bg-gray-50"},[t("td",Ct,[t("div",Et,[e[14]||(e[14]=t("div",{class:"flex-shrink-0"},[t("div",{class:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center"},[t("i",{class:"fas fa-tools text-blue-600"})])],-1)),t("div",Mt,[t("div",Tt,i(o.title),1),t("div",Rt,i(o.task_number),1),t("div",It,i(o.description),1)])])]),t("td",St,[t("div",Nt,[t("button",{onClick:c=>Ce(o.id),class:R(["flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium hover:bg-gray-100",se(o.status)])},[g(i(Z(o.status))+" ",1),e[15]||(e[15]=t("i",{class:"fas fa-chevron-down text-xs"},null,-1))],10,Pt),D.value===o.id?(a(),n("div",Ot,[t("div",Dt,[(a(),n(E,null,M(pe,c=>t("button",{key:c.value,onClick:Xe=>Ee(o,c.value),class:R(["w-full text-left px-4 py-2 text-sm hover:bg-gray-100 flex items-center gap-2",se(c.value)])},i(c.label),11,At)),64))])])):d("",!0)])]),t("td",$t,[t("span",{class:R([Ke(o.priority_name),"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-full shadow-sm"])},[t("span",{class:R(["w-2 h-2 rounded-full mr-2",Ue(o.priority_name)])},null,2),g(" "+i(o.priority_name),1)],2)]),t("td",Vt,[t("div",Lt,i(je(o.id_outlet)),1),o.id_ruko?(a(),n("div",Gt,i(Fe(o.id_ruko)),1)):d("",!0)]),t("td",zt,[t("div",{class:R(["text-sm font-medium",Be(o.due_date)])},i(We(o.due_date)),3),qe(o.due_date)?(a(),n("div",Kt," Overdue ")):He(o.due_date)?(a(),n("div",Ut," Due Soon ")):d("",!0)]),t("td",jt,[t("div",Ft,[o.created_by_name?(a(),n("div",Bt,[e[16]||(e[16]=t("i",{class:"fas fa-crown mr-1 text-purple-600"},null,-1)),g(" "+i(o.created_by_name)+" ",1),e[17]||(e[17]=t("span",{class:"ml-1 text-xs text-purple-600"},"(Creator)",-1))])):d("",!0),(a(!0),n(E,null,M(G(o),c=>(a(),n("div",{key:c.id,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 border border-blue-200"},[e[18]||(e[18]=t("i",{class:"fas fa-user mr-1 text-blue-600"},null,-1)),g(" "+i(c.nama_lengkap)+" ",1),c.role?(a(),n("span",Wt,"("+i(c.role)+")",1)):d("",!0)]))),128)),G(o).length===0&&!o.created_by_name?(a(),n("div",qt," No members assigned ")):d("",!0)])]),t("td",Ht,[t("div",Jt,[t("button",{onClick:c=>Y(o),onKeydown:[U(c=>Y(o),["enter"]),U(c=>Y(o),["space"])],class:"comment-button flex items-center gap-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 px-3 py-2 rounded-lg transition-all duration-200 hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 relative",title:`View/Add Comments for task ${o.task_number}${o.comment_count>0?` (${o.comment_count} comments)`:""}`,disabled:o.loading_comments,"aria-label":`View or add comments for task ${o.task_number}. Currently has ${o.comment_count||0} comments.`,role:"button",tabindex:"0"},[o.loading_comments?(a(),n("i",Zt)):(a(),n("i",Qt)),t("span",Xt,i(o.comment_count||0),1),t("span",es,i(o.comment_count===1?"comment":"comments"),1),o.has_new_comments?(a(),n("span",ts)):d("",!0)],40,Yt),o.comment_count>0&&o.latest_comment?(a(),n("div",ss,[e[19]||(e[19]=t("div",{class:"font-medium mb-1"},"Latest comment:",-1)),t("div",os,i(o.latest_comment),1),e[20]||(e[20]=t("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"},null,-1))])):d("",!0)])]),t("td",ls,[t("div",as,[t("button",{onClick:c=>Q(o),onKeydown:[U(c=>Q(o),["enter"]),U(c=>Q(o),["space"])],class:"media-button flex items-center gap-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 px-3 py-2 rounded-lg transition-all duration-200 hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 relative",title:`View Media for task ${o.task_number}${o.media_count>0?` (${o.media_count} media)`:""}`,disabled:o.loading_media,"aria-label":`View or add media for task ${o.task_number}. Currently has ${o.media_count||0} media.`,role:"button",tabindex:"0"},[o.loading_media?(a(),n("i",rs)):(a(),n("i",is)),t("span",us,i(o.media_count||0),1),t("span",ds,i(((o.media_count||0)===1,"media")),1),o.has_new_media?(a(),n("span",cs)):d("",!0)],40,ns),o.media_count>0&&o.latest_media?(a(),n("div",ms,[e[21]||(e[21]=t("div",{class:"font-medium mb-1"},"Latest media:",-1)),t("div",fs,i(o.latest_media),1),e[22]||(e[22]=t("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"},null,-1))])):d("",!0)])]),t("td",vs,[t("div",ps,[t("button",{onClick:c=>Je(o),class:"text-blue-600 hover:text-blue-900",title:"View Task"},e[23]||(e[23]=[t("i",{class:"fas fa-eye"},null,-1)]),8,gs),t("button",{onClick:c=>Ye(o),class:"text-green-600 hover:text-green-900",title:"Edit Task"},e[24]||(e[24]=[t("i",{class:"fas fa-edit"},null,-1)]),8,xs),t("button",{onClick:c=>Ie(o),class:"text-gray-600 hover:text-gray-900",title:"More Actions"},e[25]||(e[25]=[t("i",{class:"fas fa-ellipsis-v"},null,-1)]),8,bs)])])]))),128))])])])]),F.value?(a(),n("div",ys,[t("div",hs,[t("div",ws,[e[33]||(e[33]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Task Actions",-1)),t("div",_s,[t("button",{onClick:ee,class:"w-full text-left px-4 py-2 hover:bg-blue-50 text-gray-700 flex items-center gap-2"},[e[27]||(e[27]=t("i",{class:"fas fa-comment"},null,-1)),e[28]||(e[28]=g(" Add Comment ")),((l=u.value)==null?void 0:l.comment_count)>0?(a(),n("span",ks,i(u.value.comment_count),1)):d("",!0)]),t("button",{onClick:Pe,class:"w-full text-left px-4 py-2 hover:bg-blue-50 text-gray-700 flex items-center gap-2"},e[29]||(e[29]=[t("i",{class:"fas fa-user-plus"},null,-1),g(" Assign Member ")])),t("button",{onClick:$e,class:"w-full text-left px-4 py-2 hover:bg-blue-50 text-gray-700 flex items-center gap-2"},e[30]||(e[30]=[t("i",{class:"fas fa-tasks"},null,-1),g(" Action Plan ")])),t("button",{onClick:Ve,class:"w-full text-left px-4 py-2 hover:bg-blue-50 text-gray-700 flex items-center gap-2"},e[31]||(e[31]=[t("i",{class:"fas fa-shopping-cart"},null,-1),g(" Retail Items ")])),t("button",{onClick:ze,class:"w-full text-left px-4 py-2 hover:bg-blue-50 text-gray-700 flex items-center gap-2"},e[32]||(e[32]=[t("i",{class:"fas fa-stream"},null,-1),g(" Timeline ")]))]),t("div",{class:"mt-4 flex justify-end"},[t("button",{onClick:O,class:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400"}," Close ")])])])])):d("",!0),L.value?(a(),n("div",Cs,[t("div",Es,[t("div",Ms,[e[38]||(e[38]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Change Task Status",-1)),t("p",Ts,[e[34]||(e[34]=g(" Are you sure you want to change the status of task ")),t("strong",null,i((r=u.value)==null?void 0:r.task_number),1),e[35]||(e[35]=g(" from ")),t("strong",null,i(Z((m=u.value)==null?void 0:m.status)),1),e[36]||(e[36]=g(" to ")),t("strong",null,i(Z(I.value)),1),e[37]||(e[37]=g("? "))]),t("div",{class:"flex justify-end gap-2"},[t("button",{onClick:Re,class:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400"}," Cancel "),t("button",{onClick:Te,class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"}," Confirm ")])])])])):d("",!0),B.value?(a(),n("div",Rs,[t("div",Is,[t("div",Ss,[e[46]||(e[46]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Assign Members",-1)),v.value&&(G(v.value).length>0||v.value.created_by_name)?(a(),n("div",Ns,[e[43]||(e[43]=t("h4",{class:"text-sm font-medium text-gray-700 mb-2"},"Current Members:",-1)),t("div",Ps,[v.value.created_by_name?(a(),n("div",Os,[t("div",Ds,[e[39]||(e[39]=t("i",{class:"fas fa-crown text-purple-600"},null,-1)),t("span",As,i(v.value.created_by_name),1),e[40]||(e[40]=t("span",{class:"text-xs text-purple-600 font-medium"},"(Creator)",-1))]),e[41]||(e[41]=t("span",{class:"text-xs text-purple-600 bg-purple-100 px-2 py-1 rounded-full"},"Cannot Remove",-1))])):d("",!0),(a(!0),n(E,null,M(G(v.value),o=>(a(),n("div",{key:o.id,class:"flex items-center justify-between p-2 bg-blue-50 rounded-md border border-blue-200"},[t("div",$s,[e[42]||(e[42]=t("i",{class:"fas fa-user text-blue-600"},null,-1)),t("span",Vs,i(o.nama_lengkap),1),t("span",Ls,"("+i(o.role)+")",1)]),t("button",{onClick:c=>Ae(o.id),class:"text-xs text-red-600 hover:text-red-800 hover:bg-red-50 px-2 py-1 rounded-full transition-colors"}," Remove ",8,Gs)]))),128))])])):d("",!0),t("div",zs,[e[44]||(e[44]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Select Members:",-1)),t("div",Ks,[(a(!0),n(E,null,M(W.value,o=>(a(),n("div",{key:o.id,class:"flex items-center p-2 hover:bg-gray-50 border-b border-gray-100 last:border-b-0"},[K(t("input",{type:"checkbox",id:"user-"+o.id,value:o.id,"onUpdate:modelValue":e[3]||(e[3]=c=>k.value=c),class:"mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,8,Us),[[rt,k.value]]),t("label",{for:"user-"+o.id,class:"text-sm text-gray-900 cursor-pointer"},[g(i(o.nama_lengkap)+" ",1),t("span",Fs,i(o.email),1)],8,js)]))),128))])]),S.value?(a(),n("div",Bs,e[45]||(e[45]=[t("i",{class:"fas fa-spinner fa-spin text-blue-600"},null,-1),t("span",{class:"ml-2 text-sm text-gray-600"},"Assigning members...",-1)]))):d("",!0),T.value?(a(),n("div",Ws,[t("p",qs,i(T.value),1)])):d("",!0),t("div",Hs,[t("button",{onClick:Oe,class:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400"}," Cancel "),t("button",{onClick:De,disabled:S.value||k.value.length===0,class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"},[S.value?(a(),n("i",Ys)):d("",!0),g(" "+i(S.value?"Assigning...":"Assign Members"),1)],8,Js)])])])])):d("",!0),ge.value?(a(),ot(it,{key:3,"task-id":xe.value,onClose:te,onCommentAdded:Se},null,8,["task-id"])):d("",!0),q.value?(a(),n("div",Zs,[t("div",Qs,[t("div",{class:"flex justify-between items-center mb-4"},[e[48]||(e[48]=t("h3",{class:"text-lg font-medium text-gray-900"},"Retail Management",-1)),t("button",{onClick:Le,class:"text-gray-400 hover:text-gray-500"},e[47]||(e[47]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",Xs,[t("button",{onClick:e[4]||(e[4]=o=>N.value=!0),class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"},e[49]||(e[49]=[t("i",{class:"fas fa-plus mr-2"},null,-1),g(" Add Retail Item ")]))]),N.value?(a(),n("div",eo,[ue(ut,{"task-id":(C=u.value)==null?void 0:C.id,onSaved:Ge},null,8,["task-id"])])):d("",!0),N.value?d("",!0):(a(),n("div",to,[ue(dt,{ref_key:"retailList",ref:H,"task-id":(ne=u.value)==null?void 0:ne.id},null,8,["task-id"])]))])])):d("",!0),$.value?(a(),n("div",so,[t("div",oo,[t("button",{onClick:z,class:"absolute top-4 right-4 text-white hover:text-gray-300 text-2xl z-10"},e[50]||(e[50]=[t("i",{class:"fas fa-times"},null,-1)])),h.value>0?(a(),n("button",{key:0,onClick:ae,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300 text-3xl z-10"},e[51]||(e[51]=[t("i",{class:"fas fa-chevron-left"},null,-1)]))):d("",!0),h.value<p.value.length-1?(a(),n("button",{key:1,onClick:X,class:"absolute right-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300 text-3xl z-10"},e[52]||(e[52]=[t("i",{class:"fas fa-chevron-right"},null,-1)]))):d("",!0),t("div",lo,[w.value&&w.value.mediaType==="image"?(a(),n("img",{key:0,src:w.value.url,alt:w.value.filename||"Image",class:"max-w-full max-h-[80vh] object-contain rounded-lg shadow-2xl",onClick:X},null,8,ao)):w.value&&w.value.mediaType==="video"?(a(),n("video",{key:1,src:w.value.url,controls:"",class:"max-w-full max-h-[80vh] rounded-lg shadow-2xl",onClick:e[5]||(e[5]=nt(()=>{},["stop"]))},null,8,no)):d("",!0),t("div",ro,[t("p",io,i(((re=w.value)==null?void 0:re.filename)||"Media"),1),t("p",uo,i(h.value+1)+" of "+i(p.value.length),1)])]),p.value.length>1?(a(),n("div",co,[(a(!0),n(E,null,M(p.value,(o,c)=>(a(),n("button",{key:c,onClick:Xe=>Qe(c),class:R(["flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden border-2 transition-all hover:scale-110",c===h.value?"border-blue-400 scale-110 shadow-lg":"border-gray-600 hover:border-gray-400"])},[o.mediaType==="image"?(a(),n("img",{key:0,src:o.url,alt:o.filename,class:"w-full h-full object-cover"},null,8,fo)):o.mediaType==="video"?(a(),n("div",vo,e[53]||(e[53]=[t("i",{class:"fas fa-play text-white text-xl"},null,-1),t("div",{class:"absolute bottom-1 right-1 bg-black bg-opacity-70 text-white text-xs px-1 rounded"},[t("i",{class:"fas fa-video mr-1"})],-1)]))):(a(),n("div",po,e[54]||(e[54]=[t("i",{class:"fas fa-file-alt text-white text-xl"},null,-1),t("div",{class:"absolute bottom-1 right-1 bg-black bg-opacity-70 text-white text-xs px-1 rounded"},[t("i",{class:"fas fa-file mr-1"})],-1)])))],10,mo))),128))])):d("",!0)])])):d("",!0)])}}}),Ao=mt(xo,[["__scopeId","data-v-6efd9f31"]]);export{Ao as default};
