import{r as f,a8 as M,L as o,B as a,D as e,E as w,N as r,F as $,M as C,x as T,c as B,a as D,A as E,C as S,H as V,I,l as L}from"./vendor-vue-g7iCcTkf.js";import{a as A}from"./vendor-utils-CpgP2uT4.js";import{A as H}from"./AppLayout-lnDyFfsm.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./app-CUjRlmlQ.js";import"./vendor-charts-CuqD4wLC.js";import"./ProfileUpdateModal-CXOsavaw.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const U=["data-level"],F={class:"bg-white border border-gray-300 rounded-lg shadow-sm p-4 mb-6 relative z-10 max-w-sm mx-auto"},G={class:"text-center"},J={class:"flex justify-center mb-3"},K={class:"w-20 h-20 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg"},q={class:"text-white font-bold text-2xl"},P={class:"text-lg font-bold text-gray-900 mb-1"},Q={class:"text-sm text-gray-600 mb-3"},R={class:"flex justify-center space-x-2 mb-3"},W={key:0,class:"mt-4 pt-3 border-t border-gray-100"},X={class:"space-y-2"},Y={class:"flex-shrink-0"},Z=["src","alt"],ee={key:1,class:"w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center"},te={class:"text-xs font-medium text-gray-600"},se={class:"min-w-0 flex-1"},ae={class:"text-xs font-medium text-gray-900 truncate"},le={key:0,class:"relative"},ne={class:"flex justify-center space-x-8 pt-8"},oe={__name:"OrganizationTreeNode",props:{node:{type:Object,required:!0},level:{type:Number,default:0}},setup(i){const _=f(!1),x=f(!1),v=u=>u?u.split(" ").map(d=>d[0]).join("").toUpperCase().slice(0,2):"J",b=u=>u?u.split(" ").map(d=>d[0]).join("").toUpperCase().slice(0,2):"",g=u=>u?`/storage/${u}`:null,m=()=>{_.value=!_.value},y=()=>{x.value=!x.value};return(u,d)=>{const k=M("OrganizationTreeNode",!0);return a(),o("div",{class:"organization-node relative","data-level":i.level},[e("div",F,[e("div",G,[e("div",J,[e("div",K,[e("span",q,r(v(i.node.nama_jabatan)),1)])]),e("h4",P,r(i.node.nama_jabatan),1),e("p",Q,r(i.node.nama_level||"Level"),1),e("div",R,[i.node.employees&&i.node.employees.length>0?(a(),o("button",{key:0,onClick:m,class:"text-xs text-blue-600 hover:text-blue-800 font-medium px-2 py-1 rounded hover:bg-blue-50"},r(_.value?"Hide":"Show")+" Employees ",1)):w("",!0),i.node.children&&i.node.children.length>0?(a(),o("button",{key:1,onClick:y,class:"text-xs text-green-600 hover:text-green-800 font-medium px-2 py-1 rounded hover:bg-green-50"},r(x.value?"Hide":"Show")+" Subordinates ",1)):w("",!0)]),_.value&&i.node.employees&&i.node.employees.length>0?(a(),o("div",W,[d[0]||(d[0]=e("h5",{class:"text-xs font-medium text-gray-700 mb-2"},"Employees:",-1)),e("div",X,[(a(!0),o($,null,C(i.node.employees,l=>(a(),o("div",{key:l.id,class:"flex items-center space-x-2 p-2 bg-gray-50 rounded text-xs"},[e("div",Y,[l.avatar?(a(),o("img",{key:0,src:g(l.avatar),alt:l.nama_lengkap,class:"w-6 h-6 rounded-full object-cover"},null,8,Z)):(a(),o("div",ee,[e("span",te,r(b(l.nama_lengkap)),1)]))]),e("div",se,[e("p",ae,r(l.nama_lengkap),1)])]))),128))])])):w("",!0)])]),x.value&&i.node.children&&i.node.children.length>0?(a(),o("div",le,[d[2]||(d[2]=e("div",{class:"absolute left-1/2 top-0 w-px h-8 bg-gray-400 transform -translate-x-1/2"},null,-1)),d[3]||(d[3]=e("div",{class:"absolute left-1/2 top-8 w-full h-px bg-gray-400 transform -translate-x-1/2"},null,-1)),e("div",ne,[(a(!0),o($,null,C(i.node.children,(l,t)=>(a(),o("div",{key:l.id_jabatan,class:"relative"},[d[1]||(d[1]=e("div",{class:"absolute left-1/2 top-0 w-px h-8 bg-gray-400 transform -translate-x-1/2"},null,-1)),T(k,{node:l,level:i.level+1},null,8,["node","level"])]))),128))])])):w("",!0)],8,U)}}},ie=N(oe,[["__scopeId","data-v-b9527616"]]),re={class:"min-h-screen bg-gray-50"},de={class:"bg-white shadow-sm border-b"},ue={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},ce={class:"flex justify-between items-center py-4"},xe={class:"flex items-center space-x-4"},me={class:"flex items-center space-x-2"},ve=["value"],ge={class:"flex items-center space-x-2"},he={key:0,class:"flex items-center justify-center py-12"},pe={key:1,class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},fe={class:"bg-red-50 border border-red-200 rounded-md p-4"},_e={class:"flex"},be={class:"ml-3"},ye={class:"mt-2 text-sm text-red-700"},we={key:2,class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},ke={key:0,class:"mb-6 bg-white rounded-lg shadow p-6"},je={class:"text-lg font-semibold text-gray-900"},$e={class:"text-sm text-gray-600"},Ce={key:1,class:"bg-white rounded-lg shadow overflow-hidden"},Oe={class:"p-6"},ze={class:"organization-tree"},Ee={key:2,class:"bg-white rounded-lg shadow overflow-hidden"},Le={class:"p-6"},Ne={class:"overflow-x-auto"},Me={class:"min-w-full divide-y divide-gray-200"},Te={class:"bg-white divide-y divide-gray-200"},Be={class:"px-6 py-4 whitespace-nowrap"},De={class:"flex items-center"},Se=["src","alt"],Ve={key:1,class:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3"},Ie={class:"text-blue-600 font-semibold text-sm"},Ae={class:"text-sm font-medium text-gray-900"},He={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Ue={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Fe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Ge={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Je={key:3,class:"text-center py-12"},Ke={__name:"Index",props:{outlets:{type:Array,default:()=>[]}},setup(i){const _=i,x=f(!1),v=f(null),b=f(""),g=f("tree"),m=f([]),y=f(null),u=B(()=>{if(!m.value.length)return[];const l={};m.value.forEach(n=>{l[n.id_jabatan]||(l[n.id_jabatan]={id_jabatan:n.id_jabatan,nama_jabatan:n.nama_jabatan,id_atasan:n.id_atasan,nama_level:n.nama_level,nama_divisi:n.nama_divisi,employees:[]}),l[n.id_jabatan].employees.push(n)});const t=[],s=new Set,O=(n,h=0)=>{if(s.has(n))return null;s.add(n);const p=l[n];if(!p)return null;const c={...p,level:h,children:[]};return Object.values(l).forEach(j=>{if(j.id_atasan==n){const z=O(j.id_jabatan,h+1);z&&c.children.push(z)}}),c};if(Object.values(l).forEach(n=>{if(!n.id_atasan){const h=O(n.id_jabatan);h&&t.push(h)}}),t.length===0){let n=null,h=999;if(Object.values(l).forEach(p=>{const c=p.employees[0];if(c&&c.nilai_level){const j=parseInt(c.nilai_level.replace(/\D/g,""));j<h&&(h=j,n=p)}}),n||(n=Object.values(l)[0]),n){const p={...n,level:0,children:[]};Object.values(l).forEach(c=>{c.id_jabatan!==n.id_jabatan&&c.id_atasan==n.id_jabatan&&p.children.push({...c,level:1,children:[]})}),t.push(p)}}return t}),d=l=>l?l.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2):"",k=async()=>{var l,t;if(!b.value){m.value=[],y.value=null;return}x.value=!0,v.value=null;try{const s=await A.get(`/api/organization-chart?outlet_id=${b.value}`);s.data.success?(m.value=s.data.data,y.value=s.data.outlet):v.value=s.data.message||"Gagal memuat data"}catch(s){console.error("Error loading organization data:",s),v.value=((t=(l=s.response)==null?void 0:l.data)==null?void 0:t.message)||"Terjadi kesalahan saat memuat data"}finally{x.value=!1}};return D(()=>{_.outlets.length>0&&(b.value=_.outlets[0].id_outlet,k())}),(l,t)=>(a(),E(H,null,{default:S(()=>[e("div",re,[e("div",de,[e("div",ue,[e("div",ce,[t[5]||(t[5]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900"},"Struktur Organisasi"),e("p",{class:"text-sm text-gray-600"},"Hierarki organisasi berdasarkan outlet")],-1)),e("div",xe,[e("div",me,[t[4]||(t[4]=e("label",{class:"text-sm font-medium text-gray-700"},"Outlet:",-1)),V(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>b.value=s),onChange:k,class:"border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},[t[3]||(t[3]=e("option",{value:""},"Pilih Outlet",-1)),(a(!0),o($,null,C(i.outlets,s=>(a(),o("option",{key:s.id_outlet,value:s.id_outlet},r(s.nama_outlet),9,ve))),128))],544),[[I,b.value]])]),e("div",ge,[e("button",{onClick:t[1]||(t[1]=s=>g.value="tree"),class:L(["px-3 py-2 text-sm font-medium rounded-md",g.value==="tree"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"])}," Tree View ",2),e("button",{onClick:t[2]||(t[2]=s=>g.value="list"),class:L(["px-3 py-2 text-sm font-medium rounded-md",g.value==="list"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"])}," List View ",2)])])])])]),x.value?(a(),o("div",he,t[6]||(t[6]=[e("div",{class:"text-center"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e("p",{class:"mt-4 text-gray-600"},"Memuat struktur organisasi...")],-1)]))):v.value?(a(),o("div",pe,[e("div",fe,[e("div",_e,[t[8]||(t[8]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),e("div",be,[t[7]||(t[7]=e("h3",{class:"text-sm font-medium text-red-800"},"Error",-1)),e("div",ye,[e("p",null,r(v.value),1)]),e("div",{class:"mt-4"},[e("button",{onClick:k,class:"bg-red-100 text-red-800 px-3 py-2 rounded-md text-sm font-medium hover:bg-red-200"}," Coba Lagi ")])])])])])):!x.value&&!v.value?(a(),o("div",we,[y.value?(a(),o("div",ke,[e("h2",je,r(y.value.nama_outlet),1),e("p",$e,r(y.value.lokasi),1)])):w("",!0),g.value==="tree"&&u.value.length>0?(a(),o("div",Ce,[e("div",Oe,[t[9]||(t[9]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Struktur Organisasi",-1)),e("div",ze,[(a(!0),o($,null,C(u.value,s=>(a(),E(ie,{key:s.id_jabatan,node:s,level:0},null,8,["node"]))),128))])])])):g.value==="list"&&m.value.length>0?(a(),o("div",Ee,[e("div",Le,[t[11]||(t[11]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Daftar Karyawan",-1)),e("div",Ne,[e("table",Me,[t[10]||(t[10]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Karyawan"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Jabatan"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Level"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Divisi"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Atasan")])],-1)),e("tbody",Te,[(a(!0),o($,null,C(m.value,s=>(a(),o("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",Be,[e("div",De,[s.avatar?(a(),o("img",{key:0,src:`/storage/${s.avatar}`,alt:s.nama_lengkap,class:"w-10 h-10 rounded-full object-cover mr-3"},null,8,Se)):(a(),o("div",Ve,[e("span",Ie,r(d(s.nama_lengkap)),1)])),e("div",null,[e("div",Ae,r(s.nama_lengkap),1)])])]),e("td",He,r(s.nama_jabatan),1),e("td",Ue,r(s.nama_level||"-"),1),e("td",Fe,r(s.nama_divisi||"-"),1),e("td",Ge,r(s.atasan_jabatan||"-"),1)]))),128))])])])])])):m.value.length===0?(a(),o("div",Je,t[12]||(t[12]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})],-1),e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Tidak ada data",-1),e("p",{class:"mt-1 text-sm text-gray-500"},"Belum ada struktur organisasi untuk outlet ini.",-1)]))):w("",!0)])):w("",!0)])]),_:1}))}},st=N(Ke,[["__scopeId","data-v-31419d02"]]);export{st as default};
