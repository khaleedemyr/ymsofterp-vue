import{r as f,P as O,w as P,A as R,B as r,C as S,D as t,L as a,E as x,G as m,F as j,M as D,N as d,O as h,x as L,Q as b,l as _,H as C,J as E,W as F}from"./vendor-vue-g7iCcTkf.js";import{S as g}from"./app-DvUgkxHf.js";import{A as U}from"./AppLayout-CCl6N_RX.js";import{s as W}from"./vue-multiselect.esm-V-bx43V9.js";/* empty css                            */import{a as $}from"./vendor-utils-CpgP2uT4.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-charts-CuqD4wLC.js";import"./ProfileUpdateModal-oDgFzWKX.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const G={class:"max-w-4xl w-full mx-auto py-8 px-2"},I={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-xl mb-4"},H={class:"list-disc list-inside"},J={class:"bg-white rounded-2xl shadow-lg p-6"},Q={slot:"option","slot-scope":"props"},q={class:"flex items-center"},X={class:"flex-1"},Y={key:0,class:"font-bold text-purple-600"},Z={key:1},ee={class:"font-medium text-gray-900"},te={class:"text-sm text-gray-600"},le={key:0,class:"text-xs text-gray-500"},se={slot:"tag","slot-scope":"props"},re={key:0,class:"multiselect__tag bg-purple-600"},ae={key:1,class:"multiselect__tag"},ie={key:0,class:"text-red-500 text-sm mt-1"},oe={key:0,class:"text-red-500 text-sm mt-1"},ne={key:0,class:"text-red-500 text-sm mt-1"},ue={key:0,class:"mt-4"},me=["src"],de={class:"flex justify-end gap-4 pt-6 border-t"},pe=["disabled"],ce={key:0,class:"fa-solid fa-spinner fa-spin mr-2"},fe={key:1,class:"fa fa-paper-plane mr-2"},xe={__name:"Create",props:{errors:Object},setup(i){const n=i,c=f(!1),v=f(null),u=f([]),y=f([{email:"all",name:"All",label:"All - Kirim ke Semua Member",isAll:!0}]),k=f(!1),A=f(null),o=O({txt_target:"",txt_title:"",txt_body:"",file_foto:null});P(u,l=>{if(l.length===0){o.txt_target="";return}if(l.some(s=>s.isAll))o.txt_target="all";else{const s=l.map(p=>p.email).filter(p=>p&&p!=="all");o.txt_target=s.join(",")}},{deep:!0});async function K(l){if(!l||l.length<2){y.value=[{email:"all",name:"All",label:"All - Kirim ke Semua Member",isAll:!0}];return}clearTimeout(A.value),k.value=!0,A.value=setTimeout(async()=>{try{const e=await $.get("/push-notification/search-members",{params:{search:l}});y.value=[{email:"all",name:"All",label:"All - Kirim ke Semua Member",isAll:!0},...e.data]}catch(e){console.error("Error searching members:",e),y.value=[{email:"all",name:"All",label:"All - Kirim ke Semua Member",isAll:!0}]}finally{k.value=!1}},300)}function T(l){l.isAll?u.value=[l]:u.value=u.value.filter(e=>!e.isAll)}function w(l){u.value=u.value.filter(e=>e.email!==l.email)}function M(l){w(l)}function N(l){const e=l.target.files[0];if(e){if(e.size>2*1024*1024){g.fire("Error","Ukuran file maksimal 2MB","error"),l.target.value="";return}if(!e.type.startsWith("image/")){g.fire("Error","File harus berupa gambar","error"),l.target.value="";return}o.file_foto=e;const s=new FileReader;s.onload=p=>{v.value=p.target.result},s.readAsDataURL(e)}}function V(){if(u.value.length===0||!o.txt_target){g.fire("Error",'Silakan pilih minimal 1 member atau pilih "All"',"error"),c.value=!1;return}c.value=!0,o.post("/push-notification",{forceFormData:!0,onSuccess:()=>{g.fire("Berhasil","Push notification berhasil dibuat!","success"),F.visit("/push-notification")},onError:l=>{console.error("Error:",l),g.fire("Error","Gagal membuat push notification","error")},onFinish:()=>{c.value=!1}})}function B(){F.visit("/push-notification")}return(l,e)=>(r(),R(U,{title:"Buat Push Notification Baru"},{default:S(()=>[t("div",G,[t("div",{class:"flex justify-between items-center mb-6"},[e[6]||(e[6]=t("h1",{class:"text-2xl font-bold text-gray-800 flex items-center gap-2"},[t("i",{class:"fa-solid fa-bell text-purple-500"}),m(" Buat Push Notification Baru ")],-1)),t("button",{onClick:B,class:"bg-gray-500 text-white px-4 py-2 rounded-xl hover:bg-gray-600 transition"},e[5]||(e[5]=[t("i",{class:"fa-solid fa-arrow-left mr-2"},null,-1),m(" Kembali ")]))]),Object.keys(i.errors).length>0?(r(),a("div",I,[t("ul",H,[(r(!0),a(j,null,D(i.errors,(s,p)=>(r(),a("li",{key:p},d(s),1))),128))])])):x("",!0),t("div",J,[t("form",{onSubmit:h(V,["prevent"]),class:"space-y-6"},[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[m(" Target Member "),t("span",{class:"text-red-500"},"*")],-1)),L(b(W),{modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=s=>u.value=s),options:y.value,multiple:!0,searchable:!0,loading:k.value,"internal-search":!1,"options-limit":20,limit:20,"limit-text":s=>`dan ${s} member lainnya`,placeholder:"Cari dan pilih member atau pilih 'All' untuk semua member",label:"label","track-by":"email",onSearchChange:K,onSelect:T,onRemove:w,class:_({"border-red-500":i.errors.txt_target})},{default:S(()=>[t("template",Q,[t("div",q,[t("div",X,[n.option.isAll?(r(),a("div",Y,e[7]||(e[7]=[t("i",{class:"fa-solid fa-users mr-2"},null,-1),m("All - Kirim ke Semua Member ")]))):(r(),a("div",Z,[t("div",ee,d(n.option.name),1),t("div",te,d(n.option.email),1),n.option.telepon?(r(),a("div",le,d(n.option.telepon),1)):x("",!0)]))])])]),t("template",se,[n.option.isAll?(r(),a("span",re,[e[8]||(e[8]=t("span",null,"All",-1)),t("i",{class:"multiselect__tag-icon",onClick:e[0]||(e[0]=h(s=>M(n.option),["stop"]))})])):(r(),a("span",ae,[t("span",null,d(n.option.name),1),t("i",{class:"multiselect__tag-icon",onClick:e[1]||(e[1]=h(s=>M(n.option),["stop"]))})]))]),e[9]||(e[9]=t("template",{slot:"noOptions"},[t("div",{class:"text-center py-2 text-gray-500"},[t("i",{class:"fa-solid fa-search mr-2"}),m(" Ketik minimal 2 karakter untuk mencari member... ")])],-1)),e[10]||(e[10]=t("template",{slot:"noResult"},[t("div",{class:"text-center py-2 text-gray-500"},[t("i",{class:"fa-solid fa-user-slash mr-2"}),m(" Tidak ada member ditemukan ")])],-1))]),_:1},8,["modelValue","options","loading","limit-text","class"]),e[12]||(e[12]=t("p",{class:"mt-1 text-sm text-gray-500"},' Pilih member secara individual atau pilih "All" untuk mengirim ke semua member yang memiliki firebase token. ',-1)),i.errors.txt_target?(r(),a("p",ie,d(i.errors.txt_target),1)):x("",!0)]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[m(" Title "),t("span",{class:"text-red-500"},"*")],-1)),C(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>b(o).txt_title=s),type:"text",class:_(["w-full px-4 py-2 rounded-xl border border-gray-300 focus:ring-2 focus:ring-purple-400 focus:border-purple-400",{"border-red-500":i.errors.txt_title}]),placeholder:"Masukkan title notifikasi",required:""},null,2),[[E,b(o).txt_title]]),i.errors.txt_title?(r(),a("p",oe,d(i.errors.txt_title),1)):x("",!0)]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[m(" Body "),t("span",{class:"text-red-500"},"*")],-1)),C(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=s=>b(o).txt_body=s),class:_(["w-full px-4 py-2 rounded-xl border border-gray-300 focus:ring-2 focus:ring-purple-400 focus:border-purple-400",{"border-red-500":i.errors.txt_body}]),rows:"4",placeholder:"Masukkan isi notifikasi",required:""},null,2),[[E,b(o).txt_body]]),i.errors.txt_body?(r(),a("p",ne,d(i.errors.txt_body),1)):x("",!0)]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Foto (Opsional) ",-1)),t("input",{onChange:N,type:"file",accept:"image/*",class:"w-full px-4 py-2 rounded-xl border border-gray-300 focus:ring-2 focus:ring-purple-400 focus:border-purple-400"},null,32),e[16]||(e[16]=t("p",{class:"mt-1 text-sm text-gray-500"}," Best Resolution 1024x500 px (Max: 2MB) ",-1)),v.value?(r(),a("div",ue,[t("img",{src:v.value,alt:"Preview",class:"max-w-xs rounded-lg shadow"},null,8,me)])):x("",!0)]),t("div",de,[t("button",{type:"button",onClick:B,class:"px-6 py-2 bg-gray-500 text-white rounded-xl hover:bg-gray-600 transition"}," Batal "),t("button",{type:"submit",disabled:c.value,class:"px-6 py-2 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition disabled:opacity-50"},[c.value?(r(),a("i",ce)):(r(),a("i",fe)),m(" "+d(c.value?"Menyimpan...":"Simpan & Kirim"),1)],8,pe)])],32)])])]),_:1}))}},Ce=z(xe,[["__scopeId","data-v-3c5adbc7"]]);export{Ce as default};
