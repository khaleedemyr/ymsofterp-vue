import{k as H,r as d,a as Y,A as D,B as a,C as P,D as i,G as h,O as B,H as _,L as u,F as c,M as f,N as p,I as C,l as $,E as O,Z as w,J as N,T as W,Y as J,W as V}from"./vendor-vue-g7iCcTkf.js";import{A as Q}from"./AppLayout-CA90k2MT.js";import{a as b}from"./vendor-utils-CpgP2uT4.js";import{S as g}from"./app-CXnLHfhT.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-qPWVCAys.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const R={class:"max-w-2xl mx-auto py-10"},Z={class:"bg-white rounded-2xl shadow-2xl p-8"},X=["value"],ee={class:"flex flex-wrap gap-2 mb-2"},te=["onClick"],ie={class:"grid grid-cols-2 md:grid-cols-3 gap-2"},oe=["onClick","disabled"],le={class:"col-span-4 relative"},se=["onUpdate:modelValue","onInput","onFocus","onBlur","onKeydown","id"],ne=["id"],ae=["id","onMousedown"],ue={class:"font-medium"},re={class:"text-xs text-gray-500"},de={class:"text-sm text-gray-600"},pe={key:0,class:"absolute right-2 top-2"},me={class:"col-span-3"},ce=["onUpdate:modelValue"],fe=["value"],ge={class:"col-span-3"},he=["onUpdate:modelValue"],be={class:"col-span-2 flex gap-1"},ve=["onClick"],Oe={__name:"Form",props:{itemSupplier:Object,suppliers:Array,outlets:Array},setup(T){const r=T,n=H({supplier_id:"",outlet_ids:[],items:[{item_id:"",itemName:"",unit_id:"",price:"",itemSuggestions:[],showItemDropdown:!1,unitOptions:[]}]}),U=d("");d([]),d(!1);const M=d("");d([]);const A=d(!1),m=d([]);function E(l){m.value.find(t=>t.id_outlet===l.id_outlet)||(m.value.push(l),n.outlet_ids.push(l.id_outlet)),M.value="",A.value=!1}function q(l){m.value=m.value.filter(t=>t.id_outlet!==l),n.outlet_ids=n.outlet_ids.filter(t=>t!==l)}function F(){n.items.push({item_id:"",itemName:"",unit_id:"",price:"",itemSuggestions:[],showItemDropdown:!1,unitOptions:[]})}function L(l){n.items.splice(l,1)}function x(l,t){const e=n.items[l],s=t?t.target.value:e.itemName;if(e.item_id="",e.itemName=s,e.showItemDropdown=!0,e.loading=!0,e.highlightedIndex=0,!s||s.length<2){e.itemSuggestions=[],e.showItemDropdown=!1,e.loading=!1;return}b.get("/api/items",{params:{q:s}}).then(o=>{e.itemSuggestions=o.data,e.showItemDropdown=!0,e.highlightedIndex=0}).finally(()=>{e.loading=!1})}function z(l){setTimeout(()=>{n.items[l].showItemDropdown=!1},200)}function v(l,t){const e=n.items[l];!e.showItemDropdown||!e.itemSuggestions.length||(t.key==="ArrowDown"?(t.preventDefault(),e.highlightedIndex=(e.highlightedIndex+1)%e.itemSuggestions.length,y(l)):t.key==="ArrowUp"?(t.preventDefault(),e.highlightedIndex=(e.highlightedIndex-1+e.itemSuggestions.length)%e.itemSuggestions.length,y(l)):t.key==="Enter"?(t.preventDefault(),e.highlightedIndex>=0&&e.itemSuggestions[e.highlightedIndex]&&I(l,e.itemSuggestions[e.highlightedIndex])):t.key==="Escape"&&(e.showItemDropdown=!1))}function y(l){setTimeout(()=>{const t=n.items[l],e=document.getElementById(`autocomplete-item-${l}-${t.highlightedIndex}`);e&&e.scrollIntoView({block:"nearest"})},0)}function K(l){const t=document.getElementById(`item-input-${l}`);if(!t)return{};const e=t.getBoundingClientRect();return{position:"fixed",left:`${e.left}px`,top:`${e.bottom}px`,width:`${e.width}px`,zIndex:99999}}function I(l,t){const e=n.items[l];e.item_id=t.id,e.itemName=t.name,e.showItemDropdown=!1,e.highlightedIndex=-1,b.get(`/retail-food/get-item-units/${t.id}`).then(s=>{e.unitOptions=s.data.units})}Y(()=>{var l;r.itemSupplier&&(n.supplier_id=r.itemSupplier.supplier_id,n.outlet_ids=r.itemSupplier.item_supplier_outlets.map(t=>t.outlet_id),U.value=((l=r.itemSupplier.supplier)==null?void 0:l.name)||"",m.value=r.itemSupplier.item_supplier_outlets.map(t=>{var e;return{id_outlet:t.outlet_id,nama_outlet:((e=t.outlet)==null?void 0:e.nama_outlet)||""}}),n.items=r.itemSupplier.items.map(t=>{var e;return{item_id:t.item_id,itemName:((e=t.item)==null?void 0:e.name)||"",unit_id:t.unit_id,price:t.price,itemSuggestions:[],showItemDropdown:!1,unitOptions:[]}}),n.items.forEach((t,e)=>{t.item_id&&b.get(`/retail-food/get-item-units/${t.item_id}`).then(s=>{t.unitOptions=s.data.units})}))});let S=d(!1);async function j(){var t,e;if((await g.fire({title:"Simpan Data?",text:"Yakin ingin menyimpan data item supplier ini?",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Simpan",cancelButtonText:"Batal"})).isConfirmed){S.value=!0,g.fire({title:"Menyimpan...",allowOutsideClick:!1,didOpen:()=>{g.showLoading()}});try{r.itemSupplier?(await b.put(`/item-supplier/${r.itemSupplier.id}`,n),g.fire({icon:"success",title:"Berhasil",text:"Data berhasil diupdate",timer:1500,showConfirmButton:!1})):(await b.post("/item-supplier",n),g.fire({icon:"success",title:"Berhasil",text:"Data berhasil disimpan",timer:1500,showConfirmButton:!1})),V.visit("/item-supplier")}catch(s){g.fire({icon:"error",title:"Gagal",text:((e=(t=s.response)==null?void 0:t.data)==null?void 0:e.message)||"Gagal menyimpan data"})}finally{S.value=!1}}}function G(){V.visit("/item-supplier")}return(l,t)=>(a(),D(Q,null,{default:P(()=>[i("div",R,[i("div",Z,[t[12]||(t[12]=i("h1",{class:"text-2xl font-bold mb-8 flex items-center gap-2 text-blue-700"},[i("i",{class:"fa-solid fa-link text-blue-500"}),h(" Input Item Supplier ")],-1)),i("form",{onSubmit:B(j,["prevent"]),class:"space-y-6"},[i("div",null,[t[2]||(t[2]=i("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Supplier",-1)),_(i("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.supplier_id=e),class:"input input-bordered w-full",required:""},[t[1]||(t[1]=i("option",{value:""},"Pilih Supplier",-1)),(a(!0),u(c,null,f(r.suppliers,e=>(a(),u("option",{key:e.id,value:e.id},p(e.name),9,X))),128))],512),[[C,n.supplier_id]])]),i("div",null,[t[5]||(t[5]=i("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Outlet (bisa lebih dari satu)",-1)),i("div",ee,[(a(!0),u(c,null,f(m.value,e=>(a(),u("span",{key:e.id_outlet,class:"bg-blue-100 text-blue-700 px-3 py-1 rounded-full flex items-center gap-1"},[h(p(e.nama_outlet)+" ",1),i("button",{type:"button",onClick:s=>q(e.id_outlet),class:"ml-1 text-red-500 hover:text-red-700"},t[3]||(t[3]=[i("i",{class:"fa fa-times"},null,-1)]),8,te)]))),128))]),i("div",ie,[(a(!0),u(c,null,f(r.outlets,e=>(a(),u("button",{key:e.id_outlet,type:"button",onClick:s=>E(e),disabled:n.outlet_ids.includes(e.id_outlet),class:$(["w-full px-3 py-2 rounded border border-blue-200 hover:bg-blue-50 text-left flex items-center gap-2",n.outlet_ids.includes(e.id_outlet)?"bg-blue-100 text-blue-700 font-bold":""])},[t[4]||(t[4]=i("i",{class:"fa fa-store"},null,-1)),h(" "+p(e.nama_outlet),1)],10,oe))),128))])]),i("div",null,[t[10]||(t[10]=i("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Daftar Item",-1)),(a(!0),u(c,null,f(n.items,(e,s)=>(a(),u("div",{key:s,class:"grid grid-cols-12 gap-2 mb-2 items-end"},[i("div",le,[_(i("input",{type:"text","onUpdate:modelValue":o=>e.itemName=o,onInput:o=>x(s,o),onFocus:o=>x(s,o),onBlur:o=>z(s),onKeydown:[w(o=>v(s,o),["down"]),w(o=>v(s,o),["up"]),w(o=>v(s,o),["enter"]),w(o=>v(s,o),["esc"])],id:`item-input-${s}`,class:"input input-bordered w-full",placeholder:"Cari item...",autocomplete:"off",required:""},null,40,se),[[N,e.itemName]]),(a(),D(W,{to:"body"},[e.showItemDropdown&&e.itemSuggestions.length?(a(),u("div",{key:0,style:J(K(s)),id:`autocomplete-dropdown-${s}`,class:"fixed z-[99999] bg-white border border-blue-200 rounded shadow max-w-xs w-[260px] max-h-96 overflow-auto mt-1"},[(a(!0),u(c,null,f(e.itemSuggestions,(o,k)=>(a(),u("div",{key:o.id,id:`autocomplete-item-${s}-${k}`,onMousedown:B(_e=>I(s,o),["prevent"]),class:$(["px-3 py-2 flex justify-between items-center cursor-pointer",e.highlightedIndex===k?"bg-blue-100":"hover:bg-blue-50"])},[i("div",null,[i("div",ue,p(o.name),1),i("div",re,p(o.sku),1)]),i("div",de,p(o.unit_small||o.unit||""),1)],42,ae))),128))],12,ne)):O("",!0)])),e.loading?(a(),u("div",pe,t[6]||(t[6]=[i("i",{class:"fa fa-spinner fa-spin text-blue-400"},null,-1)]))):O("",!0)]),i("div",me,[_(i("select",{"onUpdate:modelValue":o=>e.unit_id=o,class:"input input-bordered w-full",required:""},[t[7]||(t[7]=i("option",{value:""},"Pilih Unit",-1)),(a(!0),u(c,null,f(e.unitOptions,o=>(a(),u("option",{key:o.id,value:o.id},p(o.name),9,fe))),128))],8,ce),[[C,e.unit_id]])]),i("div",ge,[_(i("input",{type:"number","onUpdate:modelValue":o=>e.price=o,min:"0",class:"input input-bordered w-full",placeholder:"Harga",required:""},null,8,he),[[N,e.price,void 0,{number:!0}]])]),i("div",be,[i("button",{type:"button",onClick:o=>L(s),class:"btn bg-red-100 text-red-600 hover:bg-red-200"},t[8]||(t[8]=[i("i",{class:"fa fa-trash"},null,-1)]),8,ve)])]))),128)),i("button",{type:"button",onClick:F,class:"btn bg-green-100 text-green-700 hover:bg-green-200 mt-2"},t[9]||(t[9]=[i("i",{class:"fa fa-plus"},null,-1),h(" Tambah Item")]))]),i("div",{class:"flex justify-end gap-2 mt-8"},[i("button",{type:"button",onClick:G,class:"btn px-6 py-2 rounded-lg font-bold bg-gradient-to-r from-gray-200 to-gray-400 text-gray-700 shadow-md hover:from-gray-300 hover:to-gray-500 active:scale-95 transition-all"},"Batal"),t[11]||(t[11]=i("button",{type:"submit",class:"btn px-6 py-2 rounded-lg font-bold bg-gradient-to-r from-blue-500 to-blue-700 text-white shadow-lg hover:from-blue-600 hover:to-blue-800 active:scale-95 transition-all flex items-center gap-2"},[i("i",{class:"fa fa-save"}),h(" Simpan ")],-1))])],32)])])]),_:1}))}};export{Oe as default};
