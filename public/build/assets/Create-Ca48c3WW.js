import{P as L,r as f,c as B,w as E,A as I,B as a,C as V,D as e,x as K,G as u,Q as r,S as R,N as n,O as q,L as i,E as c,H as m,J as w,l as h,a6 as M,F as y,M as k,I as S,W as z}from"./vendor-vue-g7iCcTkf.js";import{A as J}from"./AppLayout-DP-q1yH_.js";import{a as T}from"./vendor-utils-CpgP2uT4.js";import"./app-BoyRvw0M.js";import"./vendor-charts-CuqD4wLC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-Cs9EnNrk.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const O={class:"w-full py-8 px-0"},W={class:"flex justify-between items-center mb-6"},$={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},G={class:"bg-white rounded-xl shadow-lg p-4 border-l-4 border-blue-500"},H={class:"text-2xl font-bold text-gray-800"},Q={class:"bg-white rounded-xl shadow-lg p-4 border-l-4 border-green-500"},Y={class:"text-2xl font-bold text-green-600"},X={class:"bg-white rounded-xl shadow-lg p-4 border-l-4 border-purple-500"},Z={class:"text-2xl font-bold text-purple-600"},ee={class:"text-xs text-gray-500 mt-1"},te={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},le={key:0,class:"border-t pt-6"},se={class:"space-y-4"},re={class:"relative"},oe={key:0,class:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto"},ae=["onClick"],ie={class:"font-medium"},ne={class:"text-sm text-gray-600"},de={key:0,class:"space-y-2"},ue={class:"text-sm font-medium text-gray-700"},me={class:"flex flex-wrap gap-2"},be=["onClick"],ge={key:1,class:"border-t pt-6"},pe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ve=["value"],fe=["value"],ce={key:0,class:"mt-4 p-3 bg-blue-50 rounded-lg"},xe={class:"text-sm text-blue-800"},ye={class:"flex justify-end gap-4 pt-4 border-t"},ke=["disabled"],_e={key:0,class:"fa fa-spinner fa-spin"},we={key:1,class:"fa-solid fa-paper-plane"},Pe={__name:"Create",props:{memberLevels:Array,occupations:Array,stats:Object},setup(v){const l=L({title:"",message:"",target_type:"all",member_ids:[],member_level:"",pekerjaan_id:"",is_exclusive_member:null}),x=f(!1),b=f(""),g=f([]),d=f([]),p=f(null);let _=null;const j=B(()=>!l.title||!l.message?!1:l.target_type==="selected"?d.value.length>0:!0),N=()=>{_&&clearTimeout(_),_=setTimeout(async()=>{if(b.value.length<2){g.value=[];return}try{const o=await T.get("/member-notification/search-members",{params:{search:b.value}});g.value=o.data}catch(o){console.error("Error searching members:",o),g.value=[]}},300)},U=o=>{d.value.find(t=>t.id===o.id)||(d.value.push(o),l.member_ids=d.value.map(t=>t.id)),b.value="",g.value=[]},A=o=>{d.value=d.value.filter(t=>t.id!==o),l.member_ids=d.value.map(t=>t.id)},P=async()=>{if(l.target_type!=="filtered"){p.value=null;return}try{const o={};l.member_level&&(o.member_level=l.member_level),l.pekerjaan_id&&(o.pekerjaan_id=l.pekerjaan_id),l.is_exclusive_member!==null&&(o.is_exclusive_member=l.is_exclusive_member),o.has_device_token=!0;const t=await T.get("/member-notification/get-members",{params:o});p.value=t.data.count}catch(o){console.error("Error getting filtered members count:",o),p.value=null}};E([()=>l.target_type,()=>l.member_level,()=>l.pekerjaan_id,()=>l.is_exclusive_member],()=>{l.target_type==="filtered"&&P()},{deep:!0});const D=()=>{j.value&&(x.value=!0,l.post("/member-notification/send",{preserveScroll:!0,onSuccess:()=>{C(),z.visit("/member-notification")},onFinish:()=>{x.value=!1}}))},C=()=>{l.reset(),l.target_type="all",d.value=[],b.value="",g.value=[],p.value=null};return(o,t)=>(a(),I(J,null,{default:V(()=>[e("div",O,[e("div",W,[t[10]||(t[10]=e("h1",{class:"text-2xl font-bold text-gray-800 flex items-center gap-2"},[e("i",{class:"fa-solid fa-bell"}),u(" Kirim Notifikasi Member ")],-1)),K(r(R),{href:"/member-notification",class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition flex items-center gap-2"},{default:V(()=>t[9]||(t[9]=[e("i",{class:"fa-solid fa-list"},null,-1),u(" Daftar Notifikasi ")])),_:1})]),e("div",$,[e("div",G,[t[11]||(t[11]=e("div",{class:"text-sm text-gray-600 mb-1"},"Total Member Aktif",-1)),e("div",H,n(v.stats.total_members),1)]),e("div",Q,[t[12]||(t[12]=e("div",{class:"text-sm text-gray-600 mb-1"},"Member dengan Device Token",-1)),e("div",Y,n(v.stats.members_with_tokens),1)]),e("div",X,[t[13]||(t[13]=e("div",{class:"text-sm text-gray-600 mb-1"},"Total Device Token Aktif",-1)),e("div",Z,n(v.stats.total_device_tokens),1)])]),e("form",{onSubmit:q(D,["prevent"]),class:"bg-white rounded-xl shadow-lg p-6 space-y-6"},[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[u(" Judul Notifikasi "),e("span",{class:"text-red-500"},"*")],-1)),m(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>r(l).title=s),required:"",maxlength:"255",placeholder:"Masukkan judul notifikasi",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[w,r(l).title]]),e("div",ee,n(r(l).title.length)+"/255 karakter",1)]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[u(" Pesan Notifikasi "),e("span",{class:"text-red-500"},"*")],-1)),m(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=s=>r(l).message=s),required:"",rows:"4",placeholder:"Masukkan pesan notifikasi",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[w,r(l).message]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[u(" Target Pengiriman "),e("span",{class:"text-red-500"},"*")],-1)),e("div",te,[e("label",{class:h(["flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition",r(l).target_type==="all"?"border-blue-500 bg-blue-50":"border-gray-300"])},[m(e("input",{type:"radio","onUpdate:modelValue":t[2]||(t[2]=s=>r(l).target_type=s),value:"all",class:"mr-3 text-blue-600 focus:ring-blue-500"},null,512),[[M,r(l).target_type]]),t[16]||(t[16]=e("div",null,[e("div",{class:"font-semibold"},"Semua Member"),e("div",{class:"text-sm text-gray-600"},"Kirim ke semua member yang aktif")],-1))],2),e("label",{class:h(["flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition",r(l).target_type==="selected"?"border-blue-500 bg-blue-50":"border-gray-300"])},[m(e("input",{type:"radio","onUpdate:modelValue":t[3]||(t[3]=s=>r(l).target_type=s),value:"selected",class:"mr-3 text-blue-600 focus:ring-blue-500"},null,512),[[M,r(l).target_type]]),t[17]||(t[17]=e("div",null,[e("div",{class:"font-semibold"},"Pilih Member"),e("div",{class:"text-sm text-gray-600"},"Pilih member secara manual")],-1))],2),e("label",{class:h(["flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition",r(l).target_type==="filtered"?"border-blue-500 bg-blue-50":"border-gray-300"])},[m(e("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=s=>r(l).target_type=s),value:"filtered",class:"mr-3 text-blue-600 focus:ring-blue-500"},null,512),[[M,r(l).target_type]]),t[18]||(t[18]=e("div",null,[e("div",{class:"font-semibold"},"Filter Member"),e("div",{class:"text-sm text-gray-600"},"Filter berdasarkan kriteria")],-1))],2)])]),r(l).target_type==="selected"?(a(),i("div",le,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[u(" Pilih Member "),e("span",{class:"text-red-500"},"*")],-1)),e("div",se,[e("div",re,[m(e("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=s=>b.value=s),onInput:N,placeholder:"Cari member (nama, email, ID, atau telepon)...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,544),[[w,b.value]]),g.value.length>0&&b.value?(a(),i("div",oe,[(a(!0),i(y,null,k(g.value,s=>(a(),i("div",{key:s.id,onClick:F=>U(s),class:"px-4 py-2 hover:bg-blue-50 cursor-pointer border-b last:border-b-0"},[e("div",ie,n(s.nama_lengkap),1),e("div",ne,n(s.email)+" - "+n(s.member_level),1)],8,ae))),128))])):c("",!0)]),d.value.length>0?(a(),i("div",de,[e("div",ue,"Member Terpilih ("+n(d.value.length)+")",1),e("div",me,[(a(!0),i(y,null,k(d.value,s=>(a(),i("div",{key:s.id,class:"flex items-center gap-2 bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm"},[e("span",null,n(s.nama_lengkap),1),e("button",{type:"button",onClick:F=>A(s.id),class:"text-blue-600 hover:text-blue-800"},t[20]||(t[20]=[e("i",{class:"fa-solid fa-times"},null,-1)]),8,be)]))),128))])])):c("",!0)])])):c("",!0),r(l).target_type==="filtered"?(a(),i("div",ge,[e("div",pe,[e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Member Level ",-1)),m(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>r(l).member_level=s),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[t[22]||(t[22]=e("option",{value:""},"Semua Level",-1)),(a(!0),i(y,null,k(v.memberLevels,s=>(a(),i("option",{key:s,value:s},n(s),9,ve))),128))],512),[[S,r(l).member_level]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Pekerjaan ",-1)),m(e("select",{"onUpdate:modelValue":t[7]||(t[7]=s=>r(l).pekerjaan_id=s),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[t[24]||(t[24]=e("option",{value:""},"Semua Pekerjaan",-1)),(a(!0),i(y,null,k(v.occupations,s=>(a(),i("option",{key:s.id,value:s.id},n(s.name),9,fe))),128))],512),[[S,r(l).pekerjaan_id]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Exclusive Member ",-1)),m(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>r(l).is_exclusive_member=s),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},t[26]||(t[26]=[e("option",{value:null},"Semua",-1),e("option",{value:!0},"Ya",-1),e("option",{value:!1},"Tidak",-1)]),512),[[S,r(l).is_exclusive_member]])])]),p.value!==null?(a(),i("div",ce,[e("div",xe,[t[28]||(t[28]=e("i",{class:"fa-solid fa-info-circle mr-2"},null,-1)),t[29]||(t[29]=u(" Akan mengirim ke ")),e("strong",null,n(p.value),1),t[30]||(t[30]=u(" member yang memenuhi kriteria "))])])):c("",!0)])):c("",!0),e("div",ye,[e("button",{type:"button",onClick:C,class:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition"}," Reset "),e("button",{type:"submit",disabled:x.value||!j.value,class:"px-6 py-2 bg-gradient-to-r from-blue-500 to-blue-700 text-white rounded-lg font-semibold hover:from-blue-600 hover:to-blue-800 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[x.value?(a(),i("i",_e)):(a(),i("i",we)),t[31]||(t[31]=u(" Kirim Notifikasi "))],8,ke)])],32)])]),_:1}))}};export{Pe as default};
