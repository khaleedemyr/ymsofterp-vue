import{c as O,P as re,r as le,w as z,a as ue,j as de,A as H,B as r,C as me,D as n,G as Q,L as l,O as Y,H as h,E as c,Q as u,J as y,N as m,F as w,M as x,I as T,l as J,Z as q,T as ce,Y as ge,W as k,n as R}from"./vendor-vue-g7iCcTkf.js";import{A as fe}from"./AppLayout-DFHlgV7Y.js";import{S as g}from"./app-BAhc_I4B.js";import{a as W}from"./vendor-utils-CpgP2uT4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-Cwic3ZqH.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const he={class:"max-w-5xl w-full mx-auto py-8 px-2"},_e={class:"flex items-center gap-2 mb-6"},pe={class:"text-2xl font-bold text-gray-800 flex items-center gap-2 ml-4"},ye={key:0},be={key:1},we={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},xe={key:0,class:"text-xs text-red-500 mt-1"},ke=["value"],ve={key:0,class:"text-xs text-red-500 mt-1"},De=["value"],Ie={key:0,class:"text-xs text-red-500 mt-1"},qe={key:0,class:"text-xs text-red-500 mt-1"},Se={key:0,class:"text-red-600 text-sm mb-2"},$e={class:"w-full min-w-full divide-y divide-gray-200"},Be={class:"px-3 py-2 min-w-[260px]"},Ce={class:"relative"},Ne=["id","onUpdate:modelValue","onInput","onFocus","onBlur","onKeydown"],Te=["id"],Ue=["id","onMousedown"],Ve={class:"font-medium"},Ae={class:"text-xs text-gray-500"},Ee={class:"text-sm text-gray-600"},Me={key:0,class:"absolute right-2 top-2"},Ge={key:1,class:"text-xs text-yellow-600 mt-1"},je={key:2,class:"text-xs text-gray-500 mt-1"},Fe={key:0,class:"text-xs text-red-500 mt-1"},Ke={class:"px-3 py-2 min-w-[100px]"},Le=["onUpdate:modelValue"],Pe={key:0,class:"text-xs text-red-500 mt-1"},Oe={class:"px-3 py-2 min-w-[100px]"},ze=["onUpdate:modelValue","onChange"],He=["value"],Qe=["onUpdate:modelValue"],Ye={key:2,class:"text-xs text-red-500 mt-1"},Je={class:"px-3 py-2 min-w-[120px]"},Re=["onUpdate:modelValue"],We={class:"px-3 py-2"},Ze=["onClick","disabled"],Xe=["disabled"],et={class:"flex justify-end gap-2"},tt=["disabled"],ct={__name:"Form",props:{warehouses:Array,items:Array,editData:Object},setup(S){var G,j,F,K,L,P;const f=S,v=O(()=>!!f.editData),s=re({transfer_date:((G=f.editData)==null?void 0:G.transfer_date)||"",warehouse_from_id:((j=f.editData)==null?void 0:j.warehouse_from_id)||"",warehouse_to_id:((F=f.editData)==null?void 0:F.warehouse_to_id)||"",notes:((K=f.editData)==null?void 0:K.notes)||"",items:(P=(L=f.editData)==null?void 0:L.items)!=null&&P.length?JSON.parse(JSON.stringify(f.editData.items)):[{item_id:"",item_name:"",qty:"",unit:"",note:"",suggestions:[],showDropdown:!1,loading:!1,highlightedIndex:-1,available_units:[],selected_unit:"",_rowKey:Date.now()+"-"+Math.random()}]}),b=le([]);z(()=>s.items.length,o=>{Array.isArray(b.value)||(b.value=[]),b.value.length=o});function Z(){s.items.push({item_id:"",item_name:"",qty:"",unit:"",note:"",suggestions:[],showDropdown:!1,loading:!1,highlightedIndex:-1,available_units:[],selected_unit:"",_rowKey:Date.now()+"-"+Math.random()}),R(()=>{setTimeout(()=>{const o=s.items.length-1;b.value[o]&&b.value[o].focus()},0)})}function X(o){s.items.length!==1&&s.items.splice(o,1)}function ee(){var o,e,t,i,a,_;for(const[C,d]of s.items.entries()){console.log("DEBUG VALIDASI QTY",{item:d,stock:d.stock,qty:d.qty,unit:d.selected_unit||d.unit});const N=Number(d.qty||0);let p=0;const I=d.selected_unit||d.unit;if(I===((o=d.stock)==null?void 0:o.unit_small)?p=Number(((e=d.stock)==null?void 0:e.qty_small)||0):I===((t=d.stock)==null?void 0:t.unit_medium)?p=Number(((i=d.stock)==null?void 0:i.qty_medium)||0):I===((a=d.stock)==null?void 0:a.unit_large)?p=Number(((_=d.stock)==null?void 0:_.qty_large)||0):p=0,N>p){g.fire({icon:"error",title:"Gagal!",text:`Qty item "${d.item_name}" melebihi stok di gudang asal untuk unit ${I} (${p})`});return}}g.fire({title:v.value?"Menyimpan Perubahan...":"Menyimpan Data...",text:"Mohon tunggu sebentar",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1,didOpen:()=>{g.showLoading()}}),v.value?s.put(`/warehouse-transfer/${f.editData.id}`,{onSuccess:()=>{g.fire({icon:"success",title:"Berhasil!",text:"Data berhasil diupdate",timer:1500,showConfirmButton:!1}).then(()=>{k.visit("/warehouse-transfer")})},onError:()=>{g.fire({icon:"error",title:"Gagal!",text:"Terjadi kesalahan saat update data"})}}):s.post("/warehouse-transfer",{onSuccess:()=>{g.fire({icon:"success",title:"Berhasil!",text:"Data berhasil disimpan",timer:1500,showConfirmButton:!1}).then(()=>{k.visit("/warehouse-transfer")})},onError:()=>{g.fire({icon:"error",title:"Gagal!",text:"Terjadi kesalahan saat menyimpan data"})}})}function te(){g.fire({title:"Hapus Data?",text:"Data transfer dan mutasi stok akan dihapus. Lanjutkan?",icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal"}).then(o=>{o.isConfirmed&&k.delete(`/warehouse-transfer/${f.editData.id}`,{onSuccess:()=>{g.fire({icon:"success",title:"Berhasil!",text:"Data berhasil dihapus",timer:1500,showConfirmButton:!1}).then(()=>{k.visit("/warehouse-transfer")})},onError:()=>{g.fire({icon:"error",title:"Gagal!",text:"Terjadi kesalahan saat menghapus data"})}})})}function U(){k.visit("/warehouse-transfer")}async function se(o,e){if(console.log("fetchItemSuggestions called",{idx:o,q:e,warehouse:s.warehouse_from_id}),!e||e.length<2||!s.warehouse_from_id){s.items[o].suggestions=[],s.items[o].highlightedIndex=-1;return}s.items[o].loading=!0;try{const t=await W.get("/items/search-for-warehouse-transfer",{params:{q:e,warehouse_id:s.warehouse_from_id}});console.log("API response:",t.data);let i=Array.isArray(t.data)?t.data:[];s.items[o].suggestions=i.map(a=>({...a,available_units:[a.unit_small,a.unit_medium,a.unit_large].filter(Boolean),unit_small:a.unit_small,unit_medium:a.unit_medium,unit_large:a.unit_large,small_unit_id:a.small_unit_id,medium_unit_id:a.medium_unit_id,large_unit_id:a.large_unit_id})),s.items[o].showDropdown=!0,s.items[o].highlightedIndex=0,console.log("Suggestions:",s.items[o].suggestions)}catch(t){console.error("Error fetching suggestions:",t),s.items[o].suggestions=[],s.items[o].highlightedIndex=-1}finally{s.items[o].loading=!1}}async function V(o){const e=s.items[o];if(!(!e.item_id||!s.warehouse_from_id))try{const t=await W.get("/api/inventory/stock",{params:{item_id:e.item_id,warehouse_id:s.warehouse_from_id}});if(e.stock=t.data,e.stock&&e.stock.qty_small!=null&&e.stock.medium_conversion_qty&&e.stock.small_conversion_qty){const i=Number(e.stock.qty_small||0),a=Number(e.stock.small_conversion_qty||1),_=Number(e.stock.medium_conversion_qty||1),C=Math.floor(i/(a*_)),d=i%(a*_),N=Math.floor(d/a),p=d%a;e.stock_display={qty_large:C,qty_medium:N,qty_small:p}}else e.stock_display=null}catch{e.stock={qty_small:0,qty_medium:0,qty_large:0},e.stock_display=null}}function $(o){return o==null?0:Number(o)%1===0?Number(o):Number(o).toLocaleString("id-ID",{minimumFractionDigits:0,maximumFractionDigits:2})}function oe(o){if(!o.stock)return"Stok: 0";const e=Number(o.stock.qty_small||0),t=Number(o.stock.qty_medium||0),i=Number(o.stock.qty_large||0);return`Stok: ${$(e)} ${o.stock.unit_small||""} | ${$(t)} ${o.stock.unit_medium||""} | ${$(i)} ${o.stock.unit_large||""}`}z(()=>s.warehouse_from_id,o=>{s.items.forEach((e,t)=>{e.item_id&&o&&V(t)})});function A(o,e){s.items[o].item_id=e.id,s.items[o].item_name=e.name,s.items[o].unit=e.unit_small||e.unit||"",s.items[o].selected_unit=e.unit_small||e.unit||"",s.items[o].available_units=[e.unit_small,e.unit_medium,e.unit_large].filter(Boolean),s.items[o].suggestions=[],s.items[o].showDropdown=!1,s.items[o].highlightedIndex=-1,s.warehouse_from_id&&R(()=>{V(o)})}function E(o,e){const t=e.target.value;s.items[o].item_id="",s.items[o].item_name=t,s.items[o].showDropdown=!0,se(o,t)}function ne(o){setTimeout(()=>{s.items[o].showDropdown=!1},200)}function D(o,e){const t=s.items[o];!t.showDropdown||!t.suggestions.length||(e.key==="ArrowDown"?(e.preventDefault(),t.highlightedIndex=(t.highlightedIndex+1)%t.suggestions.length):e.key==="ArrowUp"?(e.preventDefault(),t.highlightedIndex=(t.highlightedIndex-1+t.suggestions.length)%t.suggestions.length):e.key==="Enter"?(e.preventDefault(),t.highlightedIndex>=0&&t.suggestions[t.highlightedIndex]&&A(o,t.suggestions[t.highlightedIndex])):e.key==="Escape"&&(t.showDropdown=!1))}function ae(o,e){s.items[o].selected_unit=e.target.value,s.items[o].unit=e.target.value}function ie(o){const t=document.querySelectorAll('input[placeholder="Cari nama item..."]')[o];if(!t)return{};const i=t.getBoundingClientRect();return{left:i.left+"px",top:i.bottom+"px",width:i.width+"px",position:"fixed",zIndex:9999}}function M(o){if(o.key==="F1"){o.preventDefault();const t=`item-input-${s.items.length-1}`,i=document.getElementById(t);i&&(i.focus(),i.select(),i.style.outline="2px solid #2563eb",i.style.boxShadow="0 0 0 2px rgba(37, 99, 235, 0.2)",setTimeout(()=>{i.style.outline="",i.style.boxShadow=""},1e3))}}const B=O(()=>s.warehouse_from_id&&s.warehouse_to_id&&s.warehouse_from_id!==s.warehouse_to_id);return ue(()=>{if(window.addEventListener("keydown",M),!s.transfer_date){const o=new Date,e=o.getFullYear(),t=String(o.getMonth()+1).padStart(2,"0"),i=String(o.getDate()).padStart(2,"0");s.transfer_date=`${e}-${t}-${i}`}}),de(()=>{window.removeEventListener("keydown",M)}),(o,e)=>(r(),H(fe,null,{default:me(()=>[n("div",he,[n("div",_e,[n("button",{onClick:U,class:"text-blue-500 hover:underline"},e[4]||(e[4]=[n("i",{class:"fa fa-arrow-left"},null,-1),Q(" Kembali")])),n("h1",pe,[e[5]||(e[5]=n("i",{class:"fa-solid fa-right-left text-blue-500"},null,-1)),v.value?(r(),l("span",ye,"Edit Pindah Gudang")):(r(),l("span",be,"Tambah Pindah Gudang"))])]),n("form",{onSubmit:Y(ee,["prevent"]),class:"space-y-6"},[n("div",we,[n("div",null,[e[6]||(e[6]=n("label",{class:"block text-sm font-medium text-gray-700"},"Tanggal",-1)),h(n("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=t=>u(s).transfer_date=t),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500",required:""},null,512),[[y,u(s).transfer_date]]),u(s).errors.transfer_date?(r(),l("div",xe,m(u(s).errors.transfer_date),1)):c("",!0)]),n("div",null,[e[8]||(e[8]=n("label",{class:"block text-sm font-medium text-gray-700"},"Gudang Asal",-1)),h(n("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>u(s).warehouse_from_id=t),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500",required:""},[e[7]||(e[7]=n("option",{value:""},"Pilih Gudang Asal",-1)),(r(!0),l(w,null,x(S.warehouses,t=>(r(),l("option",{key:t.id,value:t.id},m(t.name),9,ke))),128))],512),[[T,u(s).warehouse_from_id]]),u(s).errors.warehouse_from_id?(r(),l("div",ve,m(u(s).errors.warehouse_from_id),1)):c("",!0)]),n("div",null,[e[10]||(e[10]=n("label",{class:"block text-sm font-medium text-gray-700"},"Gudang Tujuan",-1)),h(n("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>u(s).warehouse_to_id=t),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500",required:""},[e[9]||(e[9]=n("option",{value:""},"Pilih Gudang Tujuan",-1)),(r(!0),l(w,null,x(S.warehouses,t=>(r(),l("option",{key:t.id,value:t.id},m(t.name),9,De))),128))],512),[[T,u(s).warehouse_to_id]]),u(s).errors.warehouse_to_id?(r(),l("div",Ie,m(u(s).errors.warehouse_to_id),1)):c("",!0)])]),n("div",null,[e[11]||(e[11]=n("label",{class:"block text-sm font-medium text-gray-700"},"Keterangan",-1)),h(n("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>u(s).notes=t),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[y,u(s).notes]]),u(s).errors.notes?(r(),l("div",qe,m(u(s).errors.notes),1)):c("",!0)]),n("div",null,[e[16]||(e[16]=n("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Detail Item",-1)),B.value?c("",!0):(r(),l("div",Se," Pilih gudang asal dan tujuan terlebih dahulu, dan pastikan tidak sama. ")),n("div",{class:J(["overflow-x-auto",{"pointer-events-none opacity-60":!B.value}])},[n("table",$e,[e[14]||(e[14]=n("thead",{class:"bg-gradient-to-r from-blue-50 to-blue-100"},[n("tr",null,[n("th",{class:"px-3 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Item"),n("th",{class:"px-3 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Qty"),n("th",{class:"px-3 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Unit"),n("th",{class:"px-3 py-2 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Note"),n("th",{class:"px-3 py-2"})])],-1)),n("tbody",null,[(r(!0),l(w,null,x(u(s).items,(t,i)=>(r(),l("tr",{key:t._rowKey||i},[n("td",Be,[n("div",Ce,[h(n("input",{id:`item-input-${i}`,type:"text","onUpdate:modelValue":a=>t.item_name=a,onInput:a=>E(i,a),onFocus:a=>E(i,a),onBlur:a=>ne(i),onKeydown:[q(a=>D(i,a),["down"]),q(a=>D(i,a),["up"]),q(a=>D(i,a),["enter"]),q(a=>D(i,a),["esc"])],class:"w-full rounded border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:"",autocomplete:"off",placeholder:"Cari nama item..."},null,40,Ne),[[y,t.item_name]]),(r(),H(ce,{to:"body"},[t.showDropdown&&t.suggestions&&t.suggestions.length>0?(r(),l("div",{key:0,style:ge(ie(i)),id:`autocomplete-dropdown-${i}`,class:"fixed z-[9999] bg-white border border-blue-200 rounded shadow max-w-xs w-[260px] max-h-96 overflow-auto mt-1"},[(r(!0),l(w,null,x(t.suggestions,(a,_)=>(r(),l("div",{key:a.id,id:`autocomplete-item-${i}-${_}`,onMousedown:Y(C=>A(i,a),["prevent"]),class:J(["px-3 py-2 flex justify-between items-center cursor-pointer",t.highlightedIndex===_?"bg-blue-100":"hover:bg-blue-50"])},[n("div",null,[n("div",Ve,m(a.name),1),n("div",Ae,m(a.sku),1)]),n("div",Ee,m(a.unit),1)],42,Ue))),128))],12,Te)):c("",!0)])),t.loading?(r(),l("div",Me,e[12]||(e[12]=[n("i",{class:"fa fa-spinner fa-spin text-blue-400"},null,-1)]))):c("",!0),u(s).warehouse_from_id?c("",!0):(r(),l("div",Ge," Pilih warehouse terlebih dahulu untuk mencari item. ")),t.stock?(r(),l("div",je," Stok: "+m(oe(t)),1)):c("",!0)]),u(s).errors[`items.${i}.item_id`]?(r(),l("div",Fe,m(u(s).errors[`items.${i}.item_id`]),1)):c("",!0)]),n("td",Ke,[h(n("input",{type:"number",min:"0.01",step:"0.01","onUpdate:modelValue":a=>t.qty=a,class:"w-full rounded border-gray-300",required:""},null,8,Le),[[y,t.qty]]),u(s).errors[`items.${i}.qty`]?(r(),l("div",Pe,m(u(s).errors[`items.${i}.qty`]),1)):c("",!0)]),n("td",Oe,[t.available_units&&t.available_units.length?h((r(),l("select",{key:0,"onUpdate:modelValue":a=>t.selected_unit=a,onChange:a=>ae(i,a),class:"w-full rounded border-gray-300"},[(r(!0),l(w,null,x(t.available_units,a=>(r(),l("option",{key:a,value:a},m(a),9,He))),128))],40,ze)),[[T,t.selected_unit]]):h((r(),l("input",{key:1,type:"text","onUpdate:modelValue":a=>t.unit=a,class:"w-full rounded border-gray-300",required:""},null,8,Qe)),[[y,t.unit]]),u(s).errors[`items.${i}.unit`]?(r(),l("div",Ye,m(u(s).errors[`items.${i}.unit`]),1)):c("",!0)]),n("td",Je,[h(n("input",{type:"text","onUpdate:modelValue":a=>t.note=a,class:"w-full rounded border-gray-300"},null,8,Re),[[y,t.note]])]),n("td",We,[n("button",{type:"button",onClick:a=>X(i),class:"text-red-500 hover:text-red-700",disabled:u(s).items.length===1},e[13]||(e[13]=[n("i",{class:"fa fa-trash"},null,-1)]),8,Ze)])]))),128))])])],2),n("button",{type:"button",onClick:Z,class:"mt-2 px-3 py-1 rounded bg-blue-100 text-blue-700 font-semibold hover:bg-blue-200",disabled:!B.value},e[15]||(e[15]=[n("i",{class:"fa fa-plus"},null,-1),Q(" Tambah Item")]),8,Xe)]),n("div",et,[n("button",{type:"button",onClick:U,class:"px-4 py-2 rounded bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300"},"Batal"),v.value?(r(),l("button",{key:0,type:"button",onClick:te,class:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700"},"Hapus")):c("",!0),n("button",{type:"submit",disabled:u(s).processing,class:"px-4 py-2 rounded bg-blue-600 text-white font-semibold hover:bg-blue-700 disabled:opacity-50"},"Simpan",8,tt)])],32)])]),_:1}))}};export{ct as default};
