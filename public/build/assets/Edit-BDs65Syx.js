import{r as x,a as T,j as P,A as z,B as s,C as O,D as t,L as o,E as c,G as y,N as n,O as L,H as p,l as m,J as U,F as v,M as b,I as k,W as I}from"./vendor-vue-g7iCcTkf.js";import{S as D}from"./app-3SxMownK.js";import{A as N}from"./AppLayout-D8A3r8FT.js";import{a as W}from"./vendor-utils-CpgP2uT4.js";import"./vendor-charts-CuqD4wLC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-BaUvls0f.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const F={class:"max-w-4xl w-full mx-auto py-8 px-2"},G={class:"flex justify-between items-center mb-6"},q={class:"text-2xl font-bold text-gray-800 flex items-center gap-2"},K={class:"bg-white rounded-2xl shadow-lg p-6"},H={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},J={class:"md:col-span-2"},R={key:0,class:"text-red-500 text-xs mt-1"},Q=["value"],X={key:0,class:"text-red-500 text-xs mt-1"},Y=["value"],Z={key:0,class:"text-red-500 text-xs mt-1"},ee={key:1,class:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded-lg"},te={class:"flex items-center"},ie={class:"text-sm text-blue-700 ml-2"},se=["value"],oe={key:0,class:"text-red-500 text-xs mt-1"},le=["value"],re={key:0,class:"text-red-500 text-xs mt-1"},ae=["value"],ne={key:0,class:"text-red-500 text-xs mt-1"},de={class:"md:col-span-2"},ue={key:0,class:"text-red-500 text-xs mt-1"},ce={key:0,class:"md:col-span-2"},ge={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},fe={key:0,class:"relative group"},me={class:"aspect-square bg-gray-100 border border-gray-200 rounded-lg overflow-hidden cursor-pointer hover:shadow-lg transition-all duration-200"},pe=["src","alt","onClick"],ve={class:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent text-white p-2"},be={class:"text-xs truncate font-medium"},xe={key:1,class:"relative group"},ye={class:"aspect-square bg-gray-100 border border-gray-200 rounded-lg flex flex-col items-center justify-center p-2 cursor-pointer"},ke={key:0,class:"fas fa-file-pdf text-red-500 text-2xl mb-1"},_e={key:1,class:"fas fa-file-alt text-gray-500 text-2xl mb-1"},he={class:"text-xs text-gray-600 text-center truncate w-full"},we={class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center"},Ie=["href"],De={class:"flex justify-end gap-4 mt-8"},Ce=["disabled"],je={key:0,class:"fa-solid fa-spinner fa-spin"},Ae={key:1,class:"fa-solid fa-save"},Ve={class:"relative"},Ee=["src","alt"],Le={class:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent text-white p-4 rounded-b-lg"},Ue={class:"flex justify-between items-center"},$e={class:"text-lg font-semibold"},Be={class:"text-sm opacity-80"},Me={class:"flex gap-2"},Se=["href"],Te=["href"],Pe={key:2,class:"flex justify-center mt-4 gap-2 overflow-x-auto max-w-full"},ze=["onClick"],Oe=["src","alt"],Ye={__name:"Edit",props:{ticket:Object,categories:Array,priorities:Array,statuses:Array,divisis:Array,outlets:Array},setup(f){const g=f,d=x({title:"",description:"",category_id:"",priority_id:"",status_id:"",divisi_id:"",outlet_id:""}),_=x(!1),r=x({}),l=x({show:!1,currentIndex:0,images:[],currentImage:{}}),h=x("");T(()=>{d.value={title:g.ticket.title||"",description:g.ticket.description||"",category_id:g.ticket.category_id||"",priority_id:g.ticket.priority_id||"",status_id:g.ticket.status_id||"",divisi_id:g.ticket.divisi_id||"",outlet_id:g.ticket.outlet_id||""},C(),document.addEventListener("keydown",E)}),P(()=>{document.removeEventListener("keydown",E),document.body.style.overflow=""});function C(){if(d.value.priority_id){const u=g.priorities.find(e=>e.id==d.value.priority_id);if(u&&u.max_days){const e=new Date;e.setDate(e.getDate()+u.max_days),h.value=e.toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}}else h.value=""}async function $(){var u,e,i;_.value=!0,r.value={};try{const a=await W.put(`/tickets/${g.ticket.id}`,d.value);a.data.success&&(D.fire("Berhasil!",a.data.message,"success"),I.visit(`/tickets/${g.ticket.id}`))}catch(a){((u=a.response)==null?void 0:u.status)===422?(r.value=a.response.data.errors,D.fire("Validasi Gagal","Mohon periksa kembali input Anda.","error")):D.fire("Error!",((i=(e=a.response)==null?void 0:e.data)==null?void 0:i.message)||"Gagal memperbarui ticket.","error")}finally{_.value=!1}}function j(){I.visit("/tickets")}function B(u){const e=g.ticket.attachments.filter(a=>a.mime_type&&a.mime_type.startsWith("image/")),i=e.findIndex(a=>a.id===u.id);l.value={show:!0,currentIndex:i,images:e.map(a=>({src:`/storage/${a.file_path}`,name:a.file_name,id:a.id})),currentImage:{src:`/storage/${u.file_path}`,name:u.file_name,id:u.id}},document.body.style.overflow="hidden"}function w(){l.value.show=!1,document.body.style.overflow=""}function A(){l.value.currentIndex<l.value.images.length-1&&(l.value.currentIndex++,l.value.currentImage=l.value.images[l.value.currentIndex])}function V(){l.value.currentIndex>0&&(l.value.currentIndex--,l.value.currentImage=l.value.images[l.value.currentIndex])}function M(u){l.value.currentIndex=u,l.value.currentImage=l.value.images[u]}function E(u){if(l.value.show)switch(u.key){case"Escape":w();break;case"ArrowLeft":V();break;case"ArrowRight":A();break}}function S(){I.visit(`/tickets/${g.ticket.id}`)}return(u,e)=>(s(),z(N,{title:"Edit Ticket"},{default:O(()=>[t("div",F,[t("div",G,[t("h1",q,[e[8]||(e[8]=t("i",{class:"fa-solid fa-edit text-green-500"},null,-1)),y(" Edit Ticket - "+n(f.ticket.ticket_number),1)]),t("div",{class:"flex gap-2"},[t("button",{onClick:S,class:"bg-blue-600 text-white px-4 py-2 rounded-xl hover:bg-blue-700 transition-colors"},e[9]||(e[9]=[t("i",{class:"fa-solid fa-eye mr-2"},null,-1),y(" View ")])),t("button",{onClick:j,class:"bg-gray-500 text-white px-4 py-2 rounded-xl hover:bg-gray-600 transition-colors"},e[10]||(e[10]=[t("i",{class:"fa-solid fa-arrow-left mr-2"},null,-1),y(" Kembali ")]))])]),t("div",K,[t("form",{onSubmit:L($,["prevent"])},[t("div",H,[t("div",J,[e[11]||(e[11]=t("label",{for:"title",class:"block text-sm font-medium text-gray-700 mb-1"},"Title *",-1)),p(t("input",{type:"text",id:"title","onUpdate:modelValue":e[0]||(e[0]=i=>d.value.title=i),class:m(["w-full px-4 py-2 rounded-xl border border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",{"border-red-500":r.value.title}]),placeholder:"Masukkan title ticket"},null,2),[[U,d.value.title]]),r.value.title?(s(),o("p",R,n(r.value.title[0]),1)):c("",!0)]),t("div",null,[e[13]||(e[13]=t("label",{for:"category_id",class:"block text-sm font-medium text-gray-700 mb-1"},"Category *",-1)),p(t("select",{id:"category_id","onUpdate:modelValue":e[1]||(e[1]=i=>d.value.category_id=i),class:m(["w-full px-4 py-2 rounded-xl border border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",{"border-red-500":r.value.category_id}])},[e[12]||(e[12]=t("option",{value:""},"Pilih Category",-1)),(s(!0),o(v,null,b(f.categories,i=>(s(),o("option",{key:i.id,value:i.id},n(i.name),9,Q))),128))],2),[[k,d.value.category_id]]),r.value.category_id?(s(),o("p",X,n(r.value.category_id[0]),1)):c("",!0)]),t("div",null,[e[17]||(e[17]=t("label",{for:"priority_id",class:"block text-sm font-medium text-gray-700 mb-1"},"Priority *",-1)),p(t("select",{id:"priority_id","onUpdate:modelValue":e[2]||(e[2]=i=>d.value.priority_id=i),onChange:C,class:m(["w-full px-4 py-2 rounded-xl border border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",{"border-red-500":r.value.priority_id}])},[e[14]||(e[14]=t("option",{value:""},"Pilih Priority",-1)),(s(!0),o(v,null,b(f.priorities,i=>(s(),o("option",{key:i.id,value:i.id},n(i.name),9,Y))),128))],34),[[k,d.value.priority_id]]),r.value.priority_id?(s(),o("p",Z,n(r.value.priority_id[0]),1)):c("",!0),h.value?(s(),o("div",ee,[t("div",te,[e[15]||(e[15]=t("i",{class:"fas fa-calendar-alt text-blue-600 mr-2"},null,-1)),e[16]||(e[16]=t("span",{class:"text-sm font-medium text-blue-800"},"Due Date:",-1)),t("span",ie,n(h.value),1)])])):c("",!0)]),t("div",null,[e[19]||(e[19]=t("label",{for:"status_id",class:"block text-sm font-medium text-gray-700 mb-1"},"Status *",-1)),p(t("select",{id:"status_id","onUpdate:modelValue":e[3]||(e[3]=i=>d.value.status_id=i),class:m(["w-full px-4 py-2 rounded-xl border border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",{"border-red-500":r.value.status_id}])},[e[18]||(e[18]=t("option",{value:""},"Pilih Status",-1)),(s(!0),o(v,null,b(f.statuses,i=>(s(),o("option",{key:i.id,value:i.id},n(i.name),9,se))),128))],2),[[k,d.value.status_id]]),r.value.status_id?(s(),o("p",oe,n(r.value.status_id[0]),1)):c("",!0)]),t("div",null,[e[21]||(e[21]=t("label",{for:"divisi_id",class:"block text-sm font-medium text-gray-700 mb-1"},"Divisi *",-1)),p(t("select",{id:"divisi_id","onUpdate:modelValue":e[4]||(e[4]=i=>d.value.divisi_id=i),class:m(["w-full px-4 py-2 rounded-xl border border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",{"border-red-500":r.value.divisi_id}])},[e[20]||(e[20]=t("option",{value:""},"Pilih Divisi",-1)),(s(!0),o(v,null,b(f.divisis,i=>(s(),o("option",{key:i.id,value:i.id},n(i.nama_divisi),9,le))),128))],2),[[k,d.value.divisi_id]]),r.value.divisi_id?(s(),o("p",re,n(r.value.divisi_id[0]),1)):c("",!0)]),t("div",null,[e[23]||(e[23]=t("label",{for:"outlet_id",class:"block text-sm font-medium text-gray-700 mb-1"},"Outlet *",-1)),p(t("select",{id:"outlet_id","onUpdate:modelValue":e[5]||(e[5]=i=>d.value.outlet_id=i),class:m(["w-full px-4 py-2 rounded-xl border border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",{"border-red-500":r.value.outlet_id}])},[e[22]||(e[22]=t("option",{value:""},"Pilih Outlet",-1)),(s(!0),o(v,null,b(f.outlets,i=>(s(),o("option",{key:i.id_outlet,value:i.id_outlet},n(i.nama_outlet),9,ae))),128))],2),[[k,d.value.outlet_id]]),r.value.outlet_id?(s(),o("p",ne,n(r.value.outlet_id[0]),1)):c("",!0)]),t("div",de,[e[24]||(e[24]=t("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-1"},"Description *",-1)),p(t("textarea",{id:"description","onUpdate:modelValue":e[6]||(e[6]=i=>d.value.description=i),rows:"6",class:m(["w-full px-4 py-2 rounded-xl border border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",{"border-red-500":r.value.description}]),placeholder:"Masukkan deskripsi ticket"},null,2),[[U,d.value.description]]),r.value.description?(s(),o("p",ue,n(r.value.description[0]),1)):c("",!0)]),f.ticket.attachments&&f.ticket.attachments.length>0?(s(),o("div",ce,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Existing Attachments",-1)),t("div",ge,[(s(!0),o(v,null,b(f.ticket.attachments,i=>(s(),o("div",{key:i.id,class:"relative"},[i.mime_type&&i.mime_type.startsWith("image/")?(s(),o("div",fe,[t("div",me,[t("img",{src:`/storage/${i.file_path}`,alt:i.file_name,class:"w-full h-full object-cover hover:scale-105 transition-transform duration-200",onClick:a=>B(i)},null,8,pe)]),e[25]||(e[25]=t("div",{class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center"},[t("div",{class:"opacity-0 group-hover:opacity-100 bg-white bg-opacity-90 text-gray-800 px-3 py-1 rounded-full text-sm transition-all duration-200 flex items-center gap-2"},[t("i",{class:"fas fa-search-plus"}),t("span",null,"View")])],-1)),t("div",ve,[t("p",be,n(i.file_name),1)])])):(s(),o("div",xe,[t("div",ye,[i.mime_type==="application/pdf"?(s(),o("i",ke)):(s(),o("i",_e)),t("p",he,n(i.file_name),1)]),t("div",we,[t("a",{href:`/storage/${i.file_path}`,target:"_blank",class:"opacity-0 group-hover:opacity-100 bg-white bg-opacity-90 text-gray-800 px-3 py-1 rounded-full text-sm transition-all duration-200"},e[26]||(e[26]=[t("i",{class:"fas fa-download mr-1"},null,-1),y("Download ")]),8,Ie)])]))]))),128))])])):c("",!0)]),t("div",De,[t("button",{type:"button",onClick:j,class:"bg-gray-500 text-white px-6 py-2 rounded-xl hover:bg-gray-600 transition-colors"}," Batal "),t("button",{type:"submit",disabled:_.value,class:"bg-gradient-to-r from-green-500 to-green-700 text-white px-6 py-2 rounded-xl shadow-lg hover:shadow-2xl transition-all font-semibold flex items-center gap-2"},[_.value?(s(),o("i",je)):(s(),o("i",Ae)),e[28]||(e[28]=y(" Update Ticket "))],8,Ce)])],32)])]),l.value.show?(s(),o("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:w},[t("div",{class:"relative max-w-6xl max-h-full p-4",onClick:e[7]||(e[7]=L(()=>{},["stop"]))},[t("button",{onClick:w,class:"absolute top-4 right-4 text-white text-3xl hover:text-gray-300 z-10 bg-black bg-opacity-50 rounded-full w-12 h-12 flex items-center justify-center transition-all duration-200 hover:bg-opacity-70"},e[29]||(e[29]=[t("i",{class:"fas fa-times"},null,-1)])),l.value.currentIndex>0?(s(),o("button",{key:0,onClick:V,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white text-3xl hover:text-gray-300 z-10 bg-black bg-opacity-50 rounded-full w-12 h-12 flex items-center justify-center transition-all duration-200 hover:bg-opacity-70"},e[30]||(e[30]=[t("i",{class:"fas fa-chevron-left"},null,-1)]))):c("",!0),l.value.currentIndex<l.value.images.length-1?(s(),o("button",{key:1,onClick:A,class:"absolute right-4 top-1/2 transform -translate-y-1/2 text-white text-3xl hover:text-gray-300 z-10 bg-black bg-opacity-50 rounded-full w-12 h-12 flex items-center justify-center transition-all duration-200 hover:bg-opacity-70"},e[31]||(e[31]=[t("i",{class:"fas fa-chevron-right"},null,-1)]))):c("",!0),t("div",Ve,[t("img",{src:l.value.currentImage.src,alt:l.value.currentImage.name,class:"max-w-full max-h-[80vh] object-contain rounded-lg shadow-2xl"},null,8,Ee),t("div",Le,[t("div",Ue,[t("div",null,[t("p",$e,n(l.value.currentImage.name),1),t("p",Be,n(l.value.currentIndex+1)+" of "+n(l.value.images.length),1)]),t("div",Me,[t("a",{href:l.value.currentImage.src,target:"_blank",class:"bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-3 py-2 rounded-lg transition-all duration-200 flex items-center gap-2"},e[32]||(e[32]=[t("i",{class:"fas fa-external-link-alt"},null,-1),t("span",null,"Open",-1)]),8,Se),t("a",{href:l.value.currentImage.src,download:"",class:"bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-3 py-2 rounded-lg transition-all duration-200 flex items-center gap-2"},e[33]||(e[33]=[t("i",{class:"fas fa-download"},null,-1),t("span",null,"Download",-1)]),8,Te)])])])]),l.value.images.length>1?(s(),o("div",Pe,[(s(!0),o(v,null,b(l.value.images,(i,a)=>(s(),o("div",{key:a,onClick:Ne=>M(a),class:m(["flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden cursor-pointer border-2 transition-all duration-200",a===l.value.currentIndex?"border-white":"border-transparent hover:border-gray-400"])},[t("img",{src:i.src,alt:i.name,class:"w-full h-full object-cover"},null,8,Oe)],10,ze))),128))])):c("",!0)])])):c("",!0)]),_:1}))}};export{Ye as default};
