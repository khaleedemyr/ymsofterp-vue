import{r as v,k as j,c as O,w as W,L as a,B as l,D as t,G as u,N as m,E as S,H as y,J as P,F as h,M as k,O as E,V as G,I as U,W as J}from"./vendor-vue-g7iCcTkf.js";import"./vendor-utils-CpgP2uT4.js";const R={class:"p-6"},T={class:"flex justify-between items-center mb-6 pb-4 border-b border-amber-200"},q={class:"text-3xl font-serif text-amber-900"},H={class:"mt-2"},z={key:1,class:"relative"},K=["src"],Q={key:2,class:"mt-2 text-sm text-red-600"},X={class:"relative mb-2"},Y={class:"border-2 border-amber-200 rounded-xl p-4 max-h-64 overflow-y-auto bg-white"},Z={key:0,class:"text-center text-amber-500 py-4"},ee={key:1,class:"space-y-2"},te=["value"],re={class:"ml-3 flex-1"},se={class:"font-medium text-amber-900"},oe={class:"text-sm text-amber-600"},ae={key:0},le={class:"mt-2 text-sm text-amber-600"},ie={class:"space-y-3"},ne={class:"flex-1"},de=["onUpdate:modelValue"],ue=["value"],me={class:"flex-1"},be=["onUpdate:modelValue","disabled"],ce=["value"],ge=["onClick","disabled"],fe={class:"flex gap-4 pt-4 border-t border-amber-200"},pe=["disabled"],ve={key:0},ye={key:1},he={__name:"Form",props:{menuBookId:{type:Number,required:!0},items:{type:Array,default:()=>[]},categories:{type:Array,default:()=>[]},subCategories:{type:Array,default:()=>[]},editingPage:{type:Object,default:null}},emits:["close","success"],setup(w,{emit:B}){const n=w,F=B,x=v(null),_=v(""),g=v(null),f=v(!1),c=v({}),s=j({image:null,page_order:null,item_ids:[],categories:[{category_id:"",sub_category_id:""}]}),C=O(()=>{if(!_.value)return n.items||[];const r=_.value.toLowerCase();return(n.items||[]).filter(e=>{var d,o;return((d=e.name)==null?void 0:d.toLowerCase().includes(r))||((o=e.sku)==null?void 0:o.toLowerCase().includes(r))})}),V=r=>r?(n.subCategories||[]).filter(e=>e.category_id===parseInt(r)):[],N=()=>{var r;(r=x.value)==null||r.click()},A=r=>{const e=r.target.files[0];if(e){s.image=e;const d=new FileReader;d.onload=o=>{g.value=o.target.result},d.readAsDataURL(e)}},L=()=>{s.image=null,g.value=null,x.value&&(x.value.value="")},M=()=>{s.categories.push({category_id:"",sub_category_id:""})},D=r=>{s.categories.length>1&&s.categories.splice(r,1)},I=r=>{if(!r)return null;try{return r instanceof File?URL.createObjectURL(r):r.startsWith("http://")||r.startsWith("https://")||r.startsWith("/storage/")?r:`/storage/${r}`}catch(e){return console.error("Error processing image:",e),null}},$=()=>{if(!n.menuBookId){c.value={menuBookId:"Menu Book ID is required"};return}if(!s.image&&!n.editingPage){c.value={image:"Image is required"};return}f.value=!0,c.value={};const r=new FormData;r.append("menu_book_id",n.menuBookId),s.image&&r.append("image",s.image),s.page_order&&r.append("page_order",s.page_order),s.item_ids&&s.item_ids.length>0&&r.append("item_ids",JSON.stringify(s.item_ids)),s.categories&&s.categories.length>0&&r.append("categories",JSON.stringify(s.categories.filter(o=>o.category_id)));const e=n.editingPage?`/menu-book/page/${n.editingPage.id}`:`/menu-book/${n.menuBookId}/page`;n.editingPage&&r.append("_method","PUT");const d={forceFormData:!0,onSuccess:()=>{F("success")},onError:o=>{o?c.value=o:c.value={general:"An error occurred. Please try again."},f.value=!1},onFinish:()=>{f.value=!1}};J.post(e,r,d)};return W(()=>n.editingPage,r=>{var e,d;r?(s.page_order=r.page_order,s.item_ids=((e=r.items)==null?void 0:e.map(o=>o.id))||[],s.categories=((d=r.categories)==null?void 0:d.map(o=>{var b;return{category_id:o.id,sub_category_id:((b=o.pivot)==null?void 0:b.sub_category_id)||null}}))||[{category_id:"",sub_category_id:""}],r.image&&(g.value=I(r.image))):(s.image=null,s.page_order=null,s.item_ids=[],s.categories=[{category_id:"",sub_category_id:""}],g.value=null)},{immediate:!0}),(r,e)=>{var d;return l(),a("div",R,[t("div",T,[t("h2",q,[e[5]||(e[5]=t("i",{class:"fa-solid fa-upload mr-3 text-amber-600"},null,-1)),u(" "+m(n.editingPage?"Edit Page":"Add New Page"),1)]),t("button",{onClick:e[0]||(e[0]=o=>r.$emit("close")),class:"w-10 h-10 rounded-full bg-amber-100 hover:bg-amber-200 text-amber-700 flex items-center justify-center transition-all duration-300 hover:scale-110"},e[6]||(e[6]=[t("i",{class:"fa-solid fa-times"},null,-1)]))]),t("form",{onSubmit:E($,["prevent"]),class:"space-y-6"},[t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-semibold text-amber-800 mb-2"},[t("i",{class:"fa-solid fa-image mr-2"}),u(" Menu Page Image * ")],-1)),t("div",H,[!g.value&&!(s!=null&&s.image)?(l(),a("div",{key:0,onClick:N,class:"border-2 border-dashed border-amber-300 rounded-xl p-8 text-center cursor-pointer hover:border-amber-500 hover:bg-amber-50 transition-all duration-300"},e[7]||(e[7]=[t("i",{class:"fa-solid fa-cloud-arrow-up text-4xl text-amber-400 mb-4"},null,-1),t("p",{class:"text-amber-700 font-medium"},"Click to upload image",-1),t("p",{class:"text-sm text-amber-500 mt-2"},"PNG, JPG, GIF up to 10MB",-1)]))):(l(),a("div",z,[t("img",{src:g.value||I(s==null?void 0:s.image),alt:"Preview",class:"w-full h-auto rounded-xl shadow-lg max-h-96 object-contain bg-amber-50"},null,8,K),t("button",{type:"button",onClick:L,class:"absolute top-2 right-2 w-10 h-10 rounded-full bg-red-500 hover:bg-red-600 text-white flex items-center justify-center shadow-lg transition-all duration-300 hover:scale-110"},e[8]||(e[8]=[t("i",{class:"fa-solid fa-times"},null,-1)]))])),t("input",{ref_key:"fileInput",ref:x,type:"file",accept:"image/*",onChange:A,class:"hidden"},null,544),c.value.image?(l(),a("div",Q,m(c.value.image),1)):S("",!0)])]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-semibold text-amber-800 mb-2"},[t("i",{class:"fa-solid fa-sort-numeric-up mr-2"}),u(" Page Order ")],-1)),y(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>s.page_order=o),type:"number",min:"1",class:"w-full px-4 py-3 rounded-xl border-2 border-amber-200 focus:border-amber-500 focus:ring-2 focus:ring-amber-300 transition-all duration-300 bg-white",placeholder:"Auto (will be last)"},null,512),[[P,s.page_order,void 0,{number:!0}]]),e[11]||(e[11]=t("p",{class:"mt-1 text-sm text-amber-600"},"Leave empty to add at the end",-1))]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-semibold text-amber-800 mb-2"},[t("i",{class:"fa-solid fa-utensils mr-2"}),u(" Menu Items on This Page ")],-1)),t("div",X,[e[12]||(e[12]=t("i",{class:"fa-solid fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-amber-600"},null,-1)),y(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>_.value=o),type:"text",placeholder:"Search items...",class:"w-full pl-12 pr-4 py-3 rounded-xl border-2 border-amber-200 focus:border-amber-500 focus:ring-2 focus:ring-amber-300 transition-all duration-300 bg-white"},null,512),[[P,_.value]])]),t("div",Y,[C.value.length===0?(l(),a("div",Z,e[13]||(e[13]=[t("i",{class:"fa-solid fa-inbox text-2xl mb-2"},null,-1),t("p",null,"No items found",-1)]))):(l(),a("div",ee,[(l(!0),a(h,null,k(C.value,o=>{var b,p;return l(),a("label",{key:o.id,class:"flex items-center p-3 rounded-lg hover:bg-amber-50 cursor-pointer transition-all duration-200 border border-transparent hover:border-amber-200"},[y(t("input",{type:"checkbox",value:o.id,"onUpdate:modelValue":e[3]||(e[3]=i=>s.item_ids=i),class:"w-5 h-5 text-amber-600 border-amber-300 rounded focus:ring-amber-500"},null,8,te),[[G,s.item_ids]]),t("div",re,[t("p",se,m(o.name),1),t("p",oe,[u(m((b=o.category)==null?void 0:b.name)+" ",1),o.sub_category?(l(),a("span",ae," / "+m((p=o.sub_category)==null?void 0:p.name),1)):S("",!0)])])])}),128))]))]),t("p",le," Selected: "+m(((d=s.item_ids)==null?void 0:d.length)||0)+" item(s) ",1)]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-semibold text-amber-800 mb-2"},[t("i",{class:"fa-solid fa-tags mr-2"}),u(" Categories & Sub Categories ")],-1)),t("div",ie,[(l(!0),a(h,null,k(s.categories,(o,b)=>{var p;return l(),a("div",{key:b,class:"flex gap-3 items-end p-4 bg-amber-50 rounded-xl border border-amber-200"},[t("div",ne,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-amber-700 mb-1"},"Category",-1)),y(t("select",{"onUpdate:modelValue":i=>o.category_id=i,class:"w-full px-4 py-2 rounded-lg border-2 border-amber-200 focus:border-amber-500 focus:ring-2 focus:ring-amber-300 transition-all duration-300 bg-white"},[e[15]||(e[15]=t("option",{value:""},"Select Category",-1)),(l(!0),a(h,null,k(w.categories,i=>(l(),a("option",{key:i.id,value:i.id},m(i.name),9,ue))),128))],8,de),[[U,o.category_id]])]),t("div",me,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-amber-700 mb-1"},"Sub Category (Optional)",-1)),y(t("select",{"onUpdate:modelValue":i=>o.sub_category_id=i,disabled:!o.category_id,class:"w-full px-4 py-2 rounded-lg border-2 border-amber-200 focus:border-amber-500 focus:ring-2 focus:ring-amber-300 transition-all duration-300 bg-white disabled:bg-amber-100 disabled:cursor-not-allowed"},[e[17]||(e[17]=t("option",{value:""},"Select Sub Category",-1)),(l(!0),a(h,null,k(V(o.category_id),i=>(l(),a("option",{key:i.id,value:i.id},m(i.name),9,ce))),128))],8,be),[[U,o.sub_category_id]])]),t("button",{type:"button",onClick:i=>D(b),class:"w-10 h-10 rounded-lg bg-red-100 hover:bg-red-200 text-red-600 flex items-center justify-center transition-all duration-300 hover:scale-110",disabled:((p=s.categories)==null?void 0:p.length)===1},e[19]||(e[19]=[t("i",{class:"fa-solid fa-trash"},null,-1)]),8,ge)])}),128)),t("button",{type:"button",onClick:M,class:"w-full py-2 rounded-lg border-2 border-dashed border-amber-300 hover:border-amber-500 text-amber-700 hover:text-amber-900 transition-all duration-300 bg-amber-50 hover:bg-amber-100"},e[20]||(e[20]=[t("i",{class:"fa-solid fa-plus mr-2"},null,-1),u(" Add Category ")]))])]),t("div",fe,[t("button",{type:"button",onClick:e[4]||(e[4]=o=>r.$emit("close")),class:"flex-1 py-3 rounded-xl border-2 border-amber-300 text-amber-700 hover:bg-amber-50 font-semibold transition-all duration-300"}," Cancel "),t("button",{type:"submit",disabled:f.value,class:"flex-1 py-3 rounded-xl bg-gradient-to-r from-amber-600 to-amber-700 hover:from-amber-700 hover:to-amber-800 text-white font-semibold shadow-lg transform hover:scale-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100"},[f.value?(l(),a("span",ve,e[22]||(e[22]=[t("i",{class:"fa-solid fa-spinner fa-spin mr-2"},null,-1),u(" Processing... ")]))):(l(),a("span",ye,[e[23]||(e[23]=t("i",{class:"fa-solid fa-check mr-2"},null,-1)),u(" "+m(n.editingPage?"Update Page":"Add Page"),1)]))],8,pe)])],32)])}}};export{he as default};
