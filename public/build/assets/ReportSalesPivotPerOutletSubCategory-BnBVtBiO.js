import{r as c,c as y,w as se,A as re,B as o,C as ne,D as t,L as s,E as m,N as r,H as _,J as P,F as p,M as f,I as $,G as x,l as z,W as ie}from"./vendor-vue-g7iCcTkf.js";import{A as ue}from"./AppLayout-Cke2dYBX.js";import{a as W}from"./vendor-utils-CpgP2uT4.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./app-AaUk6aDd.js";import"./vendor-charts-CuqD4wLC.js";import"./ProfileUpdateModal-DtjcyHN1.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const ce={class:"w-full min-h-screen bg-gray-50 py-4 px-0"},ge={key:0,class:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg"},be={class:"flex items-center gap-2 text-blue-800"},pe={class:"flex flex-col md:flex-row md:items-center gap-4 mb-4"},fe={class:"flex items-center gap-2"},xe={class:"flex items-center gap-2"},ve={class:"flex items-center gap-2"},ye=["value"],me={class:"flex items-center gap-2"},he=["value"],we=["disabled"],ke={key:1,class:"bg-white rounded-xl shadow-lg p-8 text-center text-gray-500 font-bold"},De={key:2,class:"bg-white rounded-xl shadow-lg p-8 text-center text-gray-500 font-bold"},Te={key:3,class:"bg-white rounded-xl shadow-lg overflow-x-auto relative"},Oe={key:0,class:"absolute inset-0 bg-white/70 z-20 flex items-center justify-center"},Ce={class:"min-w-full border border-gray-300"},Se={class:"bg-yellow-300 text-gray-900"},Le={key:0},_e=["colspan"],Ie={key:1,class:"bg-blue-100 font-bold"},Ee=["colspan"],Re={class:"px-4 py-2 border border-gray-200 flex items-center gap-2"},Me=["onClick"],Ue={class:"px-4 py-2 border border-gray-200 text-right font-bold"},Be={key:2,class:"bg-blue-50 font-semibold"},Ne={class:"px-4 py-2 border border-gray-300 text-right"},Pe={key:3,class:"bg-green-100 font-bold"},je=["colspan"],He={class:"px-4 py-2 border border-gray-200 flex items-center gap-2"},Ve=["onClick"],Ae={class:"px-4 py-2 border border-gray-200 text-right font-bold"},Fe={key:4,class:"bg-green-50 font-semibold"},Ke={class:"px-4 py-2 border border-gray-300 text-right"},$e={key:0},ze={class:"bg-gray-100 font-bold"},We={class:"px-4 py-2 border border-gray-300 text-right"},Ge={key:4,class:"flex justify-between items-center mt-4"},Ye={class:"text-sm text-gray-600"},qe={class:"flex gap-1"},Je=["disabled"],Qe={class:"px-2"},Xe=["disabled"],Ze={key:5,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60"},et={class:"bg-gradient-to-br from-yellow-200 via-white to-yellow-100 rounded-3xl shadow-2xl p-8 min-w-[350px] max-w-2xl w-full relative animate-fade-in-3d"},tt={class:"text-xl font-bold mb-4 text-yellow-800 flex items-center gap-2"},lt={key:0,class:"text-center py-8 text-yellow-600"},at={key:1,class:"text-center py-8 text-gray-400"},ot={key:2,class:"space-y-6 max-h-[60vh] overflow-y-auto"},st={class:"font-bold text-yellow-700 text-lg mb-2 flex items-center gap-2"},rt={class:"w-full text-sm"},nt={class:"py-1"},it={class:"py-1 text-right"},ut={class:"py-1 text-right"},dt={class:"py-1 text-right"},ct={class:"py-1 text-right font-bold"},gt={__name:"ReportSalesPivotPerOutletSubCategory",props:{subCategories:Array,report:Object,filters:Object},setup(n){var A,F,K;const g=n,u=c(((A=g.filters)==null?void 0:A.from)||""),d=c(((F=g.filters)==null?void 0:F.to)||""),w=c(((K=g.filters)==null?void 0:K.tanggal)||""),T=c(""),O=c(""),k=c(25),v=c(1),M=c(!1),j=y(()=>{if(u.value&&d.value){const a=new Date(u.value).toLocaleDateString("id-ID"),e=new Date(d.value).toLocaleDateString("id-ID");return`${a} - ${e}`}return null}),G=y(()=>{var e,l;const a=[];return(e=g.report)!=null&&e.outlets&&a.push(...g.report.outlets.map(i=>i.customer)),(l=g.report)!=null&&l.nonOutlets&&a.push(...g.report.nonOutlets.map(i=>i.customer)),[...new Set(a)].sort()}),D=y(()=>{var e,l;const a=[];return(e=g.report)!=null&&e.outlets&&a.push(...g.report.outlets),(l=g.report)!=null&&l.nonOutlets&&a.push(...g.report.nonOutlets),a}),C=y(()=>{let a=D.value;if(O.value&&(a=a.filter(e=>e.customer===O.value)),T.value){const e=T.value.toLowerCase();a=a.filter(l=>l.customer&&l.customer.toLowerCase().includes(e))}return a}),I=y(()=>Math.ceil(C.value.length/k.value)||1),E=y(()=>(v.value-1)*k.value),Y=y(()=>Math.min(E.value+q.value.length,C.value.length)),q=y(()=>C.value.slice(E.value,E.value+k.value));function J(){v.value>1&&v.value--}function Q(){v.value<I.value&&v.value++}se([k,T,O],()=>{v.value=1});const U=c(!1);function X(){const a=new Date;u.value=a.toISOString().split("T")[0],d.value=a.toISOString().split("T")[0]}function Z(){const a=new Date,e=new Date(a.setDate(a.getDate()-a.getDay())),l=new Date(a.setDate(a.getDate()-a.getDay()+6));u.value=e.toISOString().split("T")[0],d.value=l.toISOString().split("T")[0]}function ee(){const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),1),l=new Date(a.getFullYear(),a.getMonth()+1,0);u.value=e.toISOString().split("T")[0],d.value=l.toISOString().split("T")[0]}async function te(){if(!u.value||!d.value){Swal.fire({icon:"warning",title:"Peringatan",text:"Silakan pilih rentang tanggal terlebih dahulu",confirmButtonText:"OK"});return}if(new Date(u.value)>new Date(d.value)){Swal.fire({icon:"error",title:"Kesalahan",text:'Tanggal "Sampai" tidak boleh lebih kecil dari tanggal "Dari"',confirmButtonText:"OK"});return}U.value=!0,M.value=!0;const a={};u.value&&d.value?(a.from=u.value,a.to=d.value):w.value&&(a.tanggal=w.value),await ie.get("/report-sales-pivot-per-outlet-sub-category",a,{preserveState:!0,preserveScroll:!0,onFinish:()=>{U.value=!1}})}const le=y(()=>D.value.reduce((a,e)=>a+(Number(e.line_total)||0),0)),ae=y(()=>{const a={};return g.subCategories.forEach(e=>{a[e.name]=D.value.reduce((l,i)=>l+(Number(i[e.name])||0),0)}),a});function R(a,e){return e.reduce((l,i)=>l+(Number(i[a])||0),0)}function b(a){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a||0)}const B=c(!1),H=c(""),S=c({}),N=c(!1);async function V(a){B.value=!0,H.value=a,S.value={},N.value=!0;try{const e={outlet:a};if(u.value&&d.value)e.from=u.value,e.to=d.value;else if(w.value)e.from=w.value,e.to=w.value;else throw new Error("No date range or single date provided");const{data:l}=await W.post(route("report.sales-pivot-outlet-detail"),e);S.value=l}catch(e){console.error("Detail error:",e),S.value={}}finally{N.value=!1}}async function oe(){if(!u.value||!d.value){Swal.fire({icon:"warning",title:"Peringatan",text:"Silakan pilih rentang tanggal terlebih dahulu",confirmButtonText:"OK"});return}try{const a=event.target,e=a.innerHTML;a.innerHTML='<span class="mr-2"><i class="fas fa-spinner fa-spin"></i></span>Exporting...',a.disabled=!0;const l=await W.get(route("report.sales-pivot-per-outlet-sub-category.export"),{params:{from:u.value,to:d.value,tanggal:w.value},responseType:"blob"}),i=new Blob([l.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),h=window.URL.createObjectURL(i),L=document.createElement("a");L.href=h,L.download=`sales_pivot_per_outlet_sub_category_${u.value}_to_${d.value}.xlsx`,document.body.appendChild(L),L.click(),document.body.removeChild(L),window.URL.revokeObjectURL(h),a.innerHTML=e,a.disabled=!1}catch(a){console.error("Export error:",a),Swal.fire({icon:"error",title:"Kesalahan Export",text:"Terjadi kesalahan saat export. Silakan coba lagi.",confirmButtonText:"OK"});const e=event.target;e.innerHTML='<span class="mr-2"><i class="fas fa-file-excel"></i></span>Export Excel',e.disabled=!1}}return(a,e)=>(o(),re(ue,null,{default:ne(()=>[t("div",ce,[e[33]||(e[33]=t("h1",{class:"text-2xl font-bold mb-6"},"Report Penjualan per Outlet per Sub Kategori",-1)),j.value?(o(),s("div",ge,[t("div",be,[e[6]||(e[6]=t("i",{class:"fa fa-calendar text-blue-600"},null,-1)),e[7]||(e[7]=t("span",{class:"font-medium"},"Rentang Tanggal:",-1)),t("span",null,r(j.value),1)])])):m("",!0),t("div",pe,[t("div",fe,[e[8]||(e[8]=t("label",{class:"text-sm font-medium text-gray-700"},"Dari:",-1)),_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>u.value=l),type:"date",class:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"},null,512),[[P,u.value]])]),t("div",xe,[e[9]||(e[9]=t("label",{class:"text-sm font-medium text-gray-700"},"Sampai:",-1)),_(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>d.value=l),type:"date",class:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"},null,512),[[P,d.value]])]),_(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>T.value=l),type:"text",placeholder:"Cari outlet...",class:"px-4 py-2 border border-gray-300 rounded-lg w-full md:w-64 focus:ring-blue-500 focus:border-blue-500"},null,512),[[P,T.value]]),t("div",ve,[e[11]||(e[11]=t("label",{class:"text-sm"},"Outlet",-1)),_(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>O.value=l),class:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500"},[e[10]||(e[10]=t("option",{value:""},"Semua Outlet",-1)),(o(!0),s(p,null,f(G.value,l=>(o(),s("option",{key:l,value:l},r(l),9,ye))),128))],512),[[$,O.value]])]),t("div",me,[e[12]||(e[12]=t("label",{class:"text-sm"},"Tampilkan",-1)),_(t("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>k.value=l),class:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-blue-500 focus:border-blue-500"},[(o(),s(p,null,f([10,25,50,100],l=>t("option",{key:l,value:l},r(l),9,he)),64))],512),[[$,k.value]]),e[13]||(e[13]=t("span",{class:"text-sm"},"data",-1))]),t("button",{onClick:X,class:"inline-flex items-center px-3 py-2 bg-green-600 text-white rounded-md font-semibold hover:bg-green-700 mr-2"},e[14]||(e[14]=[t("span",{class:"mr-2"},[t("i",{class:"fas fa-calendar-day"})],-1),x(" Hari Ini ")])),t("button",{onClick:Z,class:"inline-flex items-center px-3 py-2 bg-purple-600 text-white rounded-md font-semibold hover:bg-purple-700 mr-2"},e[15]||(e[15]=[t("span",{class:"mr-2"},[t("i",{class:"fas fa-calendar-week"})],-1),x(" Minggu Ini ")])),t("button",{onClick:ee,class:"inline-flex items-center px-3 py-2 bg-orange-600 text-white rounded-md font-semibold hover:bg-orange-700 mr-2"},e[16]||(e[16]=[t("span",{class:"mr-2"},[t("i",{class:"fas fa-calendar-alt"})],-1),x(" Bulan Ini ")])),t("button",{onClick:te,class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md font-semibold hover:bg-blue-700"},e[17]||(e[17]=[t("span",{class:"mr-2"},[t("i",{class:"fas fa-sync-alt"})],-1),x(" Load Data ")])),t("button",{onClick:oe,disabled:!u.value||!d.value||!M.value||!D.value.length,class:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-md font-semibold hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed"},e[18]||(e[18]=[t("span",{class:"mr-2"},[t("i",{class:"fas fa-file-excel"})],-1),x(" Export Excel ")]),8,we)]),!u.value||!d.value?(o(),s("div",ke," Silakan pilih rentang tanggal terlebih dahulu ")):M.value?(o(),s("div",Te,[U.value?(o(),s("div",Oe,e[19]||(e[19]=[t("svg",{class:"animate-spin h-12 w-12 text-yellow-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})],-1)]))):m("",!0),t("table",Ce,[t("thead",null,[t("tr",Se,[e[20]||(e[20]=t("th",{class:"px-4 py-2 border border-gray-300"},"Customer",-1)),e[21]||(e[21]=t("th",{class:"px-4 py-2 border border-gray-300 text-right"},"Line Total",-1)),(o(!0),s(p,null,f(n.subCategories,l=>(o(),s("th",{key:l.id,class:"px-4 py-2 border border-gray-300 text-right"},r(l.name),1))),128))])]),t("tbody",null,[D.value.length?m("",!0):(o(),s("tr",Le,[t("td",{colspan:2+n.subCategories.length,class:"text-center py-10 text-gray-400"},"Tidak ada data.",8,_e)])),n.report.outlets&&n.report.outlets.length>0?(o(),s("tr",Ie,[t("td",{colspan:2+n.subCategories.length,class:"px-4 py-2 border border-gray-300 text-center text-blue-800"},e[22]||(e[22]=[t("i",{class:"fas fa-store mr-2"},null,-1),x("OUTLET (is_outlet = 1) ")]),8,Ee)])):m("",!0),(o(!0),s(p,null,f(n.report.outlets,l=>(o(),s("tr",{key:"outlet-"+l.customer},[t("td",Re,[x(r(l.customer)+" ",1),t("button",{onClick:i=>V(l.customer),class:"ml-2 bg-gradient-to-br from-yellow-400 to-yellow-600 text-white rounded-full shadow-lg px-2 py-1 hover:scale-110 transition-all font-bold",title:"Lihat Detail"},e[23]||(e[23]=[t("i",{class:"fas fa-search-plus"},null,-1)]),8,Me)]),t("td",Ue,r(b(l.line_total)),1),(o(!0),s(p,null,f(n.subCategories,i=>(o(),s("td",{key:i.id,class:"px-4 py-2 border border-gray-200 text-right"},r(b(l[i.name])),1))),128))]))),128)),n.report.outlets&&n.report.outlets.length>0?(o(),s("tr",Be,[e[24]||(e[24]=t("td",{class:"px-4 py-2 border border-gray-300 text-right"},"SUBTOTAL OUTLET",-1)),t("td",Ne,r(b(R("line_total",n.report.outlets))),1),(o(!0),s(p,null,f(n.subCategories,l=>(o(),s("td",{key:l.id,class:"px-4 py-2 border border-gray-300 text-right"},r(b(R(l.name,n.report.outlets))),1))),128))])):m("",!0),n.report.nonOutlets&&n.report.nonOutlets.length>0?(o(),s("tr",Pe,[t("td",{colspan:2+n.subCategories.length,class:"px-4 py-2 border border-gray-300 text-center text-green-800"},e[25]||(e[25]=[t("i",{class:"fas fa-building mr-2"},null,-1),x("NON-OUTLET (is_outlet != 1) ")]),8,je)])):m("",!0),(o(!0),s(p,null,f(n.report.nonOutlets,l=>(o(),s("tr",{key:"non-outlet-"+l.customer},[t("td",He,[x(r(l.customer)+" ",1),t("button",{onClick:i=>V(l.customer),class:"ml-2 bg-gradient-to-br from-yellow-400 to-yellow-600 text-white rounded-full shadow-lg px-2 py-1 hover:scale-110 transition-all font-bold",title:"Lihat Detail"},e[26]||(e[26]=[t("i",{class:"fas fa-search-plus"},null,-1)]),8,Ve)]),t("td",Ae,r(b(l.line_total)),1),(o(!0),s(p,null,f(n.subCategories,i=>(o(),s("td",{key:i.id,class:"px-4 py-2 border border-gray-200 text-right"},r(b(l[i.name])),1))),128))]))),128)),n.report.nonOutlets&&n.report.nonOutlets.length>0?(o(),s("tr",Fe,[e[27]||(e[27]=t("td",{class:"px-4 py-2 border border-gray-300 text-right"},"SUBTOTAL NON-OUTLET",-1)),t("td",Ke,r(b(R("line_total",n.report.nonOutlets))),1),(o(!0),s(p,null,f(n.subCategories,l=>(o(),s("td",{key:l.id,class:"px-4 py-2 border border-gray-300 text-right"},r(b(R(l.name,n.report.nonOutlets))),1))),128))])):m("",!0)]),D.value.length?(o(),s("tfoot",$e,[t("tr",ze,[e[28]||(e[28]=t("td",{class:"px-4 py-2 border border-gray-300 text-right"},"TOTAL",-1)),t("td",We,r(b(le.value)),1),(o(!0),s(p,null,f(n.subCategories,l=>(o(),s("td",{key:l.id,class:"px-4 py-2 border border-gray-300 text-right"},r(b(ae.value[l.name]||0)),1))),128))])])):m("",!0)])])):(o(),s("div",De,' Silakan klik "Load Data" untuk menampilkan laporan ')),w.value&&C.value.length?(o(),s("div",Ge,[t("div",Ye," Menampilkan "+r(E.value+1)+" - "+r(Y.value)+" dari "+r(C.value.length)+" data ",1),t("div",qe,[t("button",{onClick:J,disabled:v.value===1,class:z(["px-3 py-1 rounded border text-sm",v.value===1?"bg-gray-200 text-gray-400":"bg-white text-blue-700 hover:bg-blue-50"])},"<",10,Je),t("span",Qe,"Halaman "+r(v.value)+" / "+r(I.value),1),t("button",{onClick:Q,disabled:v.value===I.value,class:z(["px-3 py-1 rounded border text-sm",v.value===I.value?"bg-gray-200 text-gray-400":"bg-white text-blue-700 hover:bg-blue-50"])},">",10,Xe)])])):m("",!0),B.value?(o(),s("div",Ze,[t("div",et,[t("button",{onClick:e[5]||(e[5]=l=>B.value=!1),class:"absolute top-3 right-4 text-2xl text-yellow-700 hover:text-red-500 font-bold"},"Ã—"),t("h2",tt,[e[29]||(e[29]=t("i",{class:"fas fa-list-alt"},null,-1)),x(" Detail Penjualan: "+r(H.value),1)]),N.value?(o(),s("div",lt,e[30]||(e[30]=[t("i",{class:"fa fa-spinner fa-spin mr-2"},null,-1),x("Loading...")]))):Object.keys(S.value).length===0?(o(),s("div",at,"Tidak ada data detail.")):(o(),s("div",ot,[(o(!0),s(p,null,f(S.value,(l,i)=>(o(),s("div",{key:i,class:"rounded-xl shadow bg-white/80 p-4 border-l-8 border-yellow-400"},[t("div",st,[e[31]||(e[31]=t("i",{class:"fa fa-folder-open"},null,-1)),x(" "+r(i),1)]),t("table",rt,[e[32]||(e[32]=t("thead",null,[t("tr",{class:"text-yellow-700"},[t("th",{class:"text-left py-1"},"Item"),t("th",{class:"text-right py-1"},"Qty"),t("th",{class:"text-right py-1"},"Unit"),t("th",{class:"text-right py-1"},"Harga"),t("th",{class:"text-right py-1"},"Subtotal")])],-1)),t("tbody",null,[(o(!0),s(p,null,f(l,h=>(o(),s("tr",{key:h.item_name},[t("td",nt,r(h.item_name),1),t("td",it,r(h.received_qty),1),t("td",ut,r(h.unit),1),t("td",dt,r(b(h.price)),1),t("td",ct,r(b(h.subtotal)),1)]))),128))])])]))),128))]))])])):m("",!0)])]),_:1}))}},Dt=de(gt,[["__scopeId","data-v-35b60922"]]);export{Dt as default};
