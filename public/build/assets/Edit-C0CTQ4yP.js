import{k as F,r as f,c as I,w as J,a as R,A as q,B as c,C as E,D as t,G as g,O as z,H as r,J as d,x as G,Q as H,N as x,L as m,E as w,F as W,M as Y,a6 as Q,l as X,W as Z}from"./vendor-vue-g7iCcTkf.js";import{A as ee}from"./AppLayout-De2jf5tO.js";import{S as _}from"./app-BSTQjgZq.js";import{s as te}from"./vue-multiselect.esm-V-bx43V9.js";/* empty css                                                                 */import"./vendor-utils-CpgP2uT4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-vaJ7DgVJ.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const ae={class:"w-full min-h-screen py-8 px-2 md:px-6"},oe={class:"bg-white rounded-xl shadow-lg p-6 mb-6"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},se={class:"bg-white rounded-xl shadow-lg p-6 mb-6"},ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},re={slot:"singleLabel","slot-scope":"{ option }"},ie={class:"flex items-center"},de={class:"flex-1"},ue={class:"font-medium text-gray-900"},ce={slot:"option","slot-scope":"{ option }"},ge={class:"flex items-center"},me={class:"flex-1"},pe={class:"font-medium text-gray-900"},fe={class:"md:col-span-2"},be={class:"bg-white rounded-xl shadow-lg p-6 mb-6"},ve={class:"space-y-3 mb-6"},ye=["value"],xe={class:"font-medium text-gray-800"},_e={key:0,class:"text-xs bg-orange-100 text-orange-800 px-2 py-1 rounded-full"},ke={key:0,class:"border border-blue-500 rounded-lg p-4 bg-blue-50"},he={class:"text-lg font-semibold text-blue-800 mb-4"},we={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Se=["disabled","title"],De={class:"bg-white rounded-xl shadow-lg p-6 mb-6"},Ae={class:"space-y-6"},Te={class:"relative"},Ve={key:0,class:"mt-2"},Ue=["src"],je={class:"relative"},Be={key:0,class:"mt-2"},Ce=["src"],Ee={class:"flex gap-4 justify-end"},Me=["href"],Pe=["disabled"],$e={key:0,class:"fa-solid fa-spinner fa-spin"},Ke={key:1,class:"fa-solid fa-save"},Ye={__name:"Edit",props:{coaching:Object,user:Object,employees:Array,outlets:Array},setup(S){var D,A,T,V,U,j,B,C;const l=S;function M(o){if(!o)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(o))return o;try{const e=new Date(o);if(isNaN(e.getTime()))return"";const a=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),y=String(e.getDate()).padStart(2,"0");return`${a}-${i}-${y}`}catch(e){return console.error("Error formatting date:",e),""}}const s=F({employee_id:l.coaching.employee_id,employee_name:((D=l.coaching.employee)==null?void 0:D.nama_lengkap)||"",jabatan:((T=(A=l.coaching.employee)==null?void 0:A.jabatan)==null?void 0:T.nama_jabatan)||"",divisi:((U=(V=l.coaching.employee)==null?void 0:V.divisi)==null?void 0:U.nama_divisi)||"",unit:((B=(j=l.coaching.employee)==null?void 0:j.outlet)==null?void 0:B.nama_outlet)||"",tanggal_mulai_bekerja:((C=l.coaching.employee)==null?void 0:C.tanggal_masuk)||"",violation_date:M(l.coaching.violation_date),location:l.coaching.location||"",violation_details:l.coaching.violation_details||"",supervisor_comments:l.coaching.supervisor_comments||"",employee_response:l.coaching.employee_response||""}),k=f(null),h=f(null),b=f(null),u=f(null),p=f([{name:"Teguran (berlaku 3 bulan)",selected:!1,effective_date:"",end_date:"",remarks:"",auto_calculate:!0},{name:"Surat Peringatan 1 (berlaku 3 bulan)",selected:!1,effective_date:"",end_date:"",remarks:"",auto_calculate:!0},{name:"Surat Peringatan 2 (berlaku 3 bulan)",selected:!1,effective_date:"",end_date:"",remarks:"",auto_calculate:!0},{name:"Surat Peringatan 3 (berlaku 3 bulan)",selected:!1,effective_date:"",end_date:"",remarks:"",auto_calculate:!0},{name:"Skors",selected:!1,effective_date:"",end_date:"",remarks:"",auto_calculate:!1},{name:"PHK",selected:!1,effective_date:"",end_date:"",remarks:"",auto_calculate:!1},{name:"Lainnya",selected:!1,effective_date:"",end_date:"",remarks:"",auto_calculate:!1}]),n=I(()=>u.value?p.value.find(o=>o.name===u.value):null),v=f(!1),P=()=>{let o=l.coaching.disciplinary_actions;if(typeof o=="string")try{o=JSON.parse(o)}catch(e){console.error("Error parsing disciplinary actions:",e);return}if(o&&Array.isArray(o)&&o.length>0){const e=o[0],a=p.value.findIndex(i=>i.name===e.name);a!==-1&&(p.value[a]={...p.value[a],effective_date:e.effective_date||"",end_date:e.end_date||"",remarks:e.remarks||""},u.value=e.name)}},$=()=>{var o,e;l.coaching.supervisor_signature?k.value=`/storage/${l.coaching.supervisor_signature}`:(o=l.user)!=null&&o.signature_path&&(k.value=`/storage/${l.user.signature_path}`),l.coaching.employee_signature?h.value=`/storage/${l.coaching.employee_signature}`:(e=l.coaching.employee)!=null&&e.signature_path&&(h.value=`/storage/${l.coaching.employee.signature_path}`)},K=o=>{o&&(b.value=o,s.location=o.name)},N=()=>{b.value=null,s.location=""},O=()=>{if(n.value&&n.value.auto_calculate&&n.value.effective_date){const o=new Date(n.value.effective_date),e=new Date(o);e.setMonth(e.getMonth()+3);const a=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),y=String(e.getDate()).padStart(2,"0");n.value.end_date=`${a}-${i}-${y}`}},L=async()=>{if(!s.violation_date){_.fire({title:"Peringatan!",text:"Pilih tanggal pelanggaran!",icon:"warning",confirmButtonText:"OK"});return}if(!s.violation_details.trim()){_.fire({title:"Peringatan!",text:"Isi perincian pelanggaran!",icon:"warning",confirmButtonText:"OK"});return}v.value=!0;try{console.log("Selected Action:",u.value),console.log("Selected Action Data:",n.value),console.log("All Disciplinary Actions:",p.value);const o=n.value?[{name:n.value.name,effective_date:n.value.effective_date,end_date:n.value.end_date,remarks:n.value.remarks}]:[];console.log("Disciplinary Actions Data to send:",o);const e={violation_date:s.violation_date,location:s.location,violation_details:s.violation_details,disciplinary_actions:o,supervisor_comments:s.supervisor_comments,employee_response:s.employee_response},a=await fetch(route("coaching.update",l.coaching.id),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(e)});if(a.ok){const i=await a.json();_.fire({title:"Berhasil!",text:"Coaching berhasil diperbarui!",icon:"success",timer:2e3,timerProgressBar:!0,showConfirmButton:!1}).then(()=>{Z.visit(route("coaching.show",l.coaching.id))})}else{const i=await a.json();_.fire({title:"Error!",text:i.message||"Gagal memperbarui coaching!",icon:"error",confirmButtonText:"OK"})}}catch(o){console.error("Error submitting form:",o),_.fire({title:"Error!",text:"Terjadi kesalahan saat memperbarui coaching!",icon:"error",confirmButtonText:"OK"})}finally{v.value=!1}};return J(u,(o,e)=>{if(console.log("Selected action changed from",e,"to",o),o){const a=p.value.find(i=>i.name===o);a&&console.log("Selected action data:",a)}}),R(()=>{if(console.log("Coaching data:",l.coaching),console.log("Violation date:",l.coaching.violation_date),console.log("Disciplinary actions:",l.coaching.disciplinary_actions),P(),$(),l.coaching.location){const o=l.outlets.find(e=>e.name===l.coaching.location);o&&(b.value=o)}}),(o,e)=>(c(),q(ee,null,{default:E(()=>[t("div",ae,[e[37]||(e[37]=t("h1",{class:"text-3xl font-bold mb-8 text-blue-800 flex items-center gap-3"},[t("i",{class:"fa-solid fa-user-graduate text-blue-500"}),g(" Edit Coaching ")],-1)),t("form",{onSubmit:z(L,["prevent"]),class:"max-w-6xl mx-auto"},[t("div",oe,[e[21]||(e[21]=t("h2",{class:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"},[t("i",{class:"fa-solid fa-user text-blue-600"}),g(" Employee Details ")],-1)),t("div",le,[t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Nama",-1)),r(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>s.employee_name=a),type:"text",class:"w-full border border-gray-300 rounded-lg px-3 py-2 bg-gray-100",readonly:""},null,512),[[d,s.employee_name]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Jabatan",-1)),r(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>s.jabatan=a),type:"text",class:"w-full border border-gray-300 rounded-lg px-3 py-2 bg-gray-100",readonly:""},null,512),[[d,s.jabatan]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Divisi",-1)),r(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>s.divisi=a),type:"text",class:"w-full border border-gray-300 rounded-lg px-3 py-2 bg-gray-100",readonly:""},null,512),[[d,s.divisi]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Unit",-1)),r(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>s.unit=a),type:"text",class:"w-full border border-gray-300 rounded-lg px-3 py-2 bg-gray-100",readonly:""},null,512),[[d,s.unit]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tanggal Mulai Bekerja",-1)),r(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>s.tanggal_mulai_bekerja=a),type:"date",class:"w-full border border-gray-300 rounded-lg px-3 py-2 bg-gray-100",readonly:""},null,512),[[d,s.tanggal_mulai_bekerja]])])])]),t("div",se,[e[27]||(e[27]=t("h2",{class:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"},[t("i",{class:"fa-solid fa-exclamation-triangle text-red-600"}),g(" Violation Record ")],-1)),t("div",ne,[t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tanggal Pelanggaran *",-1)),r(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>s.violation_date=a),type:"date",class:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:""},null,512),[[d,s.violation_date]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Lokasi",-1)),G(H(te),{modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=a=>b.value=a),options:S.outlets,searchable:!0,placeholder:"Pilih lokasi pelanggaran...",label:"name","track-by":"id","show-labels":!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,onSelect:K,onClear:N},{default:E(()=>[t("template",re,[t("div",ie,[t("div",de,[t("div",ue,x(o.option.name),1)])])]),t("template",ce,[t("div",ge,[t("div",me,[t("div",pe,x(o.option.name),1)])])]),e[23]||(e[23]=t("template",{slot:"noOptions"},[t("div",{class:"text-center py-2 text-gray-500"},[t("i",{class:"fa-solid fa-search mr-2"}),g(" Ketik untuk mencari lokasi... ")])],-1)),e[24]||(e[24]=t("template",{slot:"noResult"},[t("div",{class:"text-center py-2 text-gray-500"},[t("i",{class:"fa-solid fa-map-marker-slash mr-2"}),g(" Tidak ada lokasi ditemukan ")])],-1))]),_:1},8,["modelValue","options"])]),t("div",fe,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Perincian Pelanggaran *",-1)),r(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=a=>s.violation_details=a),rows:"4",class:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Jelaskan detail pelanggaran yang dilakukan",required:""},null,512),[[d,s.violation_details]])])])]),t("div",be,[e[31]||(e[31]=t("h2",{class:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"},[t("i",{class:"fa-solid fa-gavel text-orange-600"}),g(" Disciplinary Action ")],-1)),t("div",ve,[(c(!0),m(W,null,Y(p.value,(a,i)=>(c(),m("div",{key:i,class:"flex items-center gap-3 p-3 border border-gray-300 rounded-lg hover:bg-gray-50"},[r(t("input",{"onUpdate:modelValue":e[8]||(e[8]=y=>u.value=y),value:a.name,type:"radio",class:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"},null,8,ye),[[Q,u.value]]),t("span",xe,x(a.name),1),a.auto_calculate?(c(),m("span",_e," Auto 3 bulan ")):w("",!0)]))),128))]),u.value&&n.value?(c(),m("div",ke,[t("h3",he,x(u.value),1),t("div",we,[t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tanggal Berlaku *",-1)),r(t("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>n.value.effective_date=a),type:"date",class:"w-full border border-gray-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onChange:O,onInput:e[10]||(e[10]=a=>console.log("Effective date changed:",n.value.effective_date))},null,544),[[d,n.value.effective_date]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tanggal Berakhir *",-1)),r(t("input",{"onUpdate:modelValue":e[11]||(e[11]=a=>n.value.end_date=a),type:"date",class:X(["w-full border border-gray-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",n.value.auto_calculate?"bg-gray-100":""]),disabled:n.value.auto_calculate,title:n.value.auto_calculate?"Tanggal berakhir dihitung otomatis 3 bulan dari tanggal berlaku":"",onInput:e[12]||(e[12]=a=>console.log("End date changed:",n.value.end_date))},null,42,Se),[[d,n.value.end_date]])]),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Keterangan",-1)),r(t("input",{"onUpdate:modelValue":e[13]||(e[13]=a=>n.value.remarks=a),type:"text",class:"w-full border border-gray-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Keterangan tambahan (opsional)"},null,512),[[d,n.value.remarks]])])])])):w("",!0)]),t("div",De,[e[36]||(e[36]=t("h2",{class:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"},[t("i",{class:"fa-solid fa-comments text-green-600"}),g(" Comments & Signatures ")],-1)),t("div",Ae,[t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Komentar Atasan",-1)),t("div",Te,[r(t("textarea",{"onUpdate:modelValue":e[14]||(e[14]=a=>s.supervisor_comments=a),rows:"4",class:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Masukkan komentar atasan..."},null,512),[[d,s.supervisor_comments]]),e[32]||(e[32]=t("div",{class:"absolute bottom-2 right-2 text-xs text-gray-500"},"TTD",-1))]),k.value?(c(),m("div",Ve,[t("img",{src:k.value,alt:"Supervisor Signature",class:"h-16 w-auto border border-gray-300 rounded"},null,8,Ue)])):w("",!0)]),t("div",null,[e[35]||(e[35]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tanggapan Karyawan",-1)),t("div",je,[r(t("textarea",{"onUpdate:modelValue":e[15]||(e[15]=a=>s.employee_response=a),rows:"4",class:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Masukkan tanggapan karyawan..."},null,512),[[d,s.employee_response]]),e[34]||(e[34]=t("div",{class:"absolute bottom-2 right-2 text-xs text-gray-500"},"TTD",-1))]),h.value?(c(),m("div",Be,[t("img",{src:h.value,alt:"Employee Signature",class:"h-16 w-auto border border-gray-300 rounded"},null,8,Ce)])):w("",!0)])])]),t("div",Ee,[t("a",{href:o.route("coaching.show",S.coaching.id),class:"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"}," Cancel ",8,Me),t("button",{type:"submit",disabled:v.value,class:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[v.value?(c(),m("i",$e)):(c(),m("i",Ke)),g(" "+x(v.value?"Menyimpan...":"Update Coaching"),1)],8,Pe)])],32)])]),_:1}))}};export{Ye as default};
