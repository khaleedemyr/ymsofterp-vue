import{$ as re,r as b,c as O,P as pe,w as ce,A as fe,B as i,C as ve,D as l,L as n,E as m,G as y,H as x,Q as B,F as g,M as h,N as d,I as V,J as be,l as I,V as j,O as me,Y as ye,W as xe,n as ge}from"./vendor-vue-g7iCcTkf.js";import{A as he}from"./AppLayout-CCl6N_RX.js";import{S as F}from"./app-DvUgkxHf.js";import"./vendor-utils-CpgP2uT4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-oDgFzWKX.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";const ke={class:"max-w-6xl mx-auto py-8"},we={key:0,class:"fixed inset-0 bg-black bg-opacity-20 flex items-center justify-center z-50"},_e={class:"flex gap-4 mb-6"},Se=["disabled"],Te={key:0,value:""},De=["value"],Ae=["value"],Ue=["disabled"],Oe={key:1,class:"mb-6"},Fe={class:"bg-white rounded-2xl shadow-lg p-6"},Me={class:"flex items-center justify-between mb-4"},Ie={key:0,class:"space-y-4"},Be=["value"],Ve={class:"space-y-2"},je={class:"flex items-center"},Ee={key:0,class:"max-h-32 overflow-y-auto border border-gray-200 rounded-lg p-2"},Ke=["value"],Ce={class:"ml-2 text-sm text-gray-700"},Pe={class:"space-y-2"},Ne={class:"flex items-center"},$e={key:0,class:"flex flex-wrap gap-2"},Le=["value"],Je={class:"ml-2 text-sm text-gray-700"},ze={key:0,class:"bg-white rounded-2xl shadow-lg overflow-x-auto"},Ye={class:"min-w-full divide-y divide-blue-200"},He={class:"bg-blue-600 text-white"},Re=["onMouseenter","onMousemove"],We={key:0,class:"block text-xs font-bold mb-1",style:{"white-space":"normal","line-height":"1.2"}},Ge={class:"text-xs font-normal"},Xe={class:"px-4 py-2 whitespace-nowrap"},Qe={class:"font-semibold text-gray-900"},qe={class:"text-gray-500 text-xs mt-1"},Ze=["title"],et={key:0,class:"mb-1"},tt={key:1,class:"mb-1"},lt={class:"w-full text-xs bg-green-500 text-white px-1 py-0.5 rounded"},at={class:"hidden sm:inline"},st={class:"text-xs text-green-600 mt-0.5"},it=["onUpdate:modelValue","disabled"],nt=["value"],ot={key:1,class:"text-center text-gray-400 py-12"},ut={class:"flex justify-end mt-6"},dt=["disabled"],kt={__name:"Index",props:{outlets:Array,divisions:Array,users:Array,shifts:Array,dates:Array,userShifts:Array,filter:Object,holidays:Array,approvedAbsents:Array},setup(r){var W,G,X,Q,q;const u=r,M=((G=(W=re().props.auth)==null?void 0:W.user)==null?void 0:G.id_outlet)||"",k=b(((X=u.filter)==null?void 0:X.outlet_id)||""),_=b(((Q=u.filter)==null?void 0:Q.division_id)||""),S=b(((q=u.filter)==null?void 0:q.start_date)||""),ee=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];function L(s){const e=new Date(s);return ee[e.getDay()]}function te(s){const e=new Date(s),t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),c=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${c}`}const J=O(()=>{const s={};return(u.userShifts||[]).forEach(e=>{s[e.user_id]||(s[e.user_id]={}),s[e.user_id][e.tanggal]=e.shift_id}),s}),E=b(!1),w=b(!1),o=b({shift_id:null,selectedUsers:[],selectedDates:[],applyToAllUsers:!1,applyToAllDates:!1}),f=O(()=>{const s={};return(u.holidays||[]).forEach(e=>{const t=String(e.date).trim();s[t]=e.name}),s}),A=s=>String(te(s)).trim(),v=O(()=>(s,e)=>{if(!u.approvedAbsents)return null;const t=new Date(s).toISOString().split("T")[0];return u.approvedAbsents.find(a=>{const c=new Date(a.date_from).toISOString().split("T")[0],D=new Date(a.date_to).toISOString().split("T")[0];return a.user_id===e&&t>=c&&t<=D})}),T=O(()=>s=>{const e=new Date,t=new Date(s);return e.setHours(0,0,0,0),t.setHours(0,0,0,0),t<e});console.log("dates:",u.dates),console.log("holidays:",u.holidays),console.log("holidayMap:",f.value),console.log("approvedAbsents:",u.approvedAbsents);const p=pe({outlet_id:k.value,division_id:_.value,start_date:S.value,shifts:{},explicit_off:{}});ce(()=>[u.users,u.dates],()=>{p.shifts={},u.users.forEach(s=>{p.shifts[s.id]={},u.dates.forEach((e,t)=>{var a;p.shifts[s.id][e]=((a=J.value[s.id])==null?void 0:a[e])??null})})},{immediate:!0});function le(){if(!k.value||!_.value||!S.value){F.fire("Lengkapi Filter","Silakan pilih outlet, divisi, dan tanggal mulai!","warning");return}E.value=!0,xe.get("/user-shifts",{outlet_id:k.value,division_id:_.value,start_date:S.value},{preserveState:!0,replace:!0,onFinish:()=>{ge(()=>{E.value=!1})}})}function ae(){const s={};return u.users.forEach(e=>{s[e.id]={},u.dates.forEach(t=>{var D;const a=((D=J.value[e.id])==null?void 0:D[t])??null,c=p.shifts[e.id][t];a!==null&&c===null&&(s[e.id][t]=!0)}),Object.keys(s[e.id]).length===0&&delete s[e.id]}),s}function se(){p.outlet_id=k.value,p.division_id=_.value,p.start_date=S.value;const s=ae();p.explicit_off=JSON.parse(JSON.stringify(s)),console.log("DEBUG explicit_off",p.explicit_off),p.post("/user-shifts",{onSuccess:()=>F.fire("Berhasil","Jadwal shift berhasil disimpan!","success")})}const K=s=>{const e=A(s);return Object.keys(f.value).some(t=>t===e)},C=s=>{const e=A(s),t=Object.entries(f.value).find(([a])=>a===e);return t?t[1]:""},z=b(""),P=b(!1),Y=b(0),H=b(0);function R(s,e){z.value=s,P.value=!0,Y.value=e.clientX+10,H.value=e.clientY+10}function ie(){P.value=!1}function ne(){w.value=!w.value,w.value||N()}function N(){o.value={shift_id:null,selectedUsers:[],selectedDates:[],applyToAllUsers:!1,applyToAllDates:!1}}function oe(){var Z;if(!o.value.shift_id){F.fire("Pilih Shift","Silakan pilih shift yang akan diterapkan!","warning");return}if(!o.value.applyToAllUsers&&o.value.selectedUsers.length===0){F.fire("Pilih Karyawan",'Silakan pilih karyawan atau centang "Terapkan ke Semua Karyawan"!',"warning");return}if(!o.value.applyToAllDates&&o.value.selectedDates.length===0){F.fire("Pilih Tanggal",'Silakan pilih tanggal atau centang "Terapkan ke Semua Tanggal"!',"warning");return}const s=o.value.applyToAllUsers?u.users:u.users.filter(U=>o.value.selectedUsers.includes(U.id)),e=o.value.applyToAllDates?u.dates:o.value.selectedDates;let t=0,a=0;s.forEach(U=>{e.forEach($=>{if(T.value($)||v.value($,U.id)){a++;return}p.shifts[U.id][$]=o.value.shift_id==="OFF"?null:o.value.shift_id,t++})});let D=`Berhasil menerapkan ${o.value.shift_id==="OFF"?"OFF (Tidak Masuk Kerja)":((Z=u.shifts.find(U=>U.id==o.value.shift_id))==null?void 0:Z.shift_name)||"Shift"} ke ${t} slot jadwal.`;a>0&&(D+=` ${a} slot dilewati (tanggal lewat atau ada absen).`),F.fire("Bulk Input Berhasil",D,"success"),N(),w.value=!1}const ue=O(()=>u.dates.filter(s=>!T.value(s))),de=O(()=>u.users);return M&&M!=1&&(k.value=M),(s,e)=>(i(),fe(he,{title:"Input Shift Mingguan Karyawan"},{default:ve(()=>[l("div",ke,[E.value?(i(),n("div",we,e[8]||(e[8]=[l("div",{class:"animate-spin rounded-full h-20 w-20 border-t-4 border-b-4 border-blue-500"},null,-1)]))):m("",!0),e[27]||(e[27]=l("h1",{class:"text-2xl font-bold text-blue-800 mb-6 flex items-center gap-2"},[l("i",{class:"fa-solid fa-calendar-days text-blue-500"}),y(" Input Shift Mingguan Karyawan ")],-1)),l("div",_e,[x(l("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>k.value=t),class:"form-input rounded-xl",disabled:B(M)!=1,autofocus:""},[B(M)==1?(i(),n("option",Te,"Pilih Outlet")):m("",!0),(i(!0),n(g,null,h(r.outlets,t=>(i(),n("option",{key:t.id,value:t.id},d(t.name),9,De))),128))],8,Se),[[V,k.value]]),x(l("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>_.value=t),class:"form-input rounded-xl"},[e[9]||(e[9]=l("option",{value:""},"Pilih Divisi",-1)),(i(!0),n(g,null,h(r.divisions,t=>(i(),n("option",{key:t.id,value:t.id},d(t.name),9,Ae))),128))],512),[[V,_.value]]),x(l("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>S.value=t),type:"date",class:"form-input rounded-xl",placeholder:"Tanggal Mulai (Senin)"},null,512),[[be,S.value]]),l("button",{onClick:le,class:"bg-blue-600 text-white px-4 py-2 rounded-xl shadow hover:bg-blue-700",disabled:!k.value||!_.value||!S.value}," Tampilkan ",8,Ue)]),r.users.length&&r.dates.length?(i(),n("div",Oe,[l("div",Fe,[l("div",Me,[e[10]||(e[10]=l("h3",{class:"text-lg font-semibold text-gray-800 flex items-center"},[l("i",{class:"fa-solid fa-layer-group mr-2 text-blue-600"}),y(" Bulk Input Shift ")],-1)),l("button",{type:"button",onClick:ne,class:I(["px-4 py-2 rounded-lg font-medium transition-colors",w.value?"bg-red-100 text-red-700 hover:bg-red-200":"bg-blue-100 text-blue-700 hover:bg-blue-200"])},[l("i",{class:I([w.value?"fa-solid fa-times":"fa-solid fa-plus","mr-2"])},null,2),y(" "+d(w.value?"Tutup":"Bulk Input"),1)],2)]),w.value?(i(),n("div",Ie,[l("div",null,[e[13]||(e[13]=l("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[y(" Pilih Shift "),l("span",{class:"text-red-500"},"*")],-1)),x(l("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.shift_id=t),class:"w-full form-input rounded-lg border-gray-300 focus:border-blue-500 focus:ring-blue-500"},[e[11]||(e[11]=l("option",{value:null},"-- Pilih Shift --",-1)),e[12]||(e[12]=l("option",{value:"OFF"},"OFF (Tidak Masuk Kerja)",-1)),(i(!0),n(g,null,h(r.shifts,t=>(i(),n("option",{key:t.id,value:t.id},d(t.shift_name)+" ("+d(t.time_start)+" - "+d(t.time_end)+") ",9,Be))),128))],512),[[V,o.value.shift_id]])]),l("div",null,[e[15]||(e[15]=l("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Pilih Karyawan ",-1)),l("div",Ve,[l("label",je,[x(l("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=t=>o.value.applyToAllUsers=t),class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[j,o.value.applyToAllUsers]]),e[14]||(e[14]=l("span",{class:"ml-2 text-sm text-gray-700"},"Terapkan ke Semua Karyawan",-1))]),o.value.applyToAllUsers?m("",!0):(i(),n("div",Ee,[(i(!0),n(g,null,h(de.value,t=>(i(),n("label",{key:t.id,class:"flex items-center py-1"},[x(l("input",{type:"checkbox",value:t.id,"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.selectedUsers=a),class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,8,Ke),[[j,o.value.selectedUsers]]),l("span",Ce,d(t.nama_lengkap),1)]))),128))]))])]),l("div",null,[e[17]||(e[17]=l("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Pilih Tanggal ",-1)),l("div",Pe,[l("label",Ne,[x(l("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=t=>o.value.applyToAllDates=t),class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[j,o.value.applyToAllDates]]),e[16]||(e[16]=l("span",{class:"ml-2 text-sm text-gray-700"},"Terapkan ke Semua Tanggal (kecuali yang sudah lewat)",-1))]),o.value.applyToAllDates?m("",!0):(i(),n("div",$e,[(i(!0),n(g,null,h(ue.value,t=>(i(),n("label",{key:t,class:"flex items-center"},[x(l("input",{type:"checkbox",value:t,"onUpdate:modelValue":e[7]||(e[7]=a=>o.value.selectedDates=a),class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,8,Le),[[j,o.value.selectedDates]]),l("span",Je,d(L(t))+" ("+d(t)+")",1)]))),128))]))])]),l("div",{class:"flex justify-end space-x-3 pt-4 border-t"},[l("button",{type:"button",onClick:N,class:"px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors"},e[18]||(e[18]=[l("i",{class:"fa-solid fa-undo mr-2"},null,-1),y(" Reset ")])),l("button",{type:"button",onClick:oe,class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},e[19]||(e[19]=[l("i",{class:"fa-solid fa-check mr-2"},null,-1),y(" Terapkan ")]))])])):m("",!0)])])):m("",!0),l("form",{onSubmit:me(se,["prevent"])},[r.users.length&&r.dates.length?(i(),n("div",ze,[l("table",Ye,[l("thead",He,[l("tr",null,[e[21]||(e[21]=l("th",{class:"px-4 py-3 text-left text-xs font-bold uppercase tracking-wider"},"Nama Karyawan",-1)),(i(!0),n(g,null,h(r.dates,t=>(i(),n("th",{key:t,class:I(["px-4 py-3 text-center text-xs font-bold uppercase tracking-wider",K(t)?"holiday-header":"bg-blue-600 text-white"]),onMouseenter:a=>f.value.value&&f.value.value[A(t)]?R(C(t),a):null,onMousemove:a=>f.value.value&&f.value.value[A(t)]?R(C(t),a):null,onMouseleave:ie},[K(t)?(i(),n("div",We,d(C(t)),1)):m("",!0),y(" "+d(L(t)),1),e[20]||(e[20]=l("br",null,null,-1)),l("span",Ge,d(t),1)],42,Re))),128))])]),l("tbody",null,[(i(!0),n(g,null,h(r.users,t=>(i(),n("tr",{key:t.id,class:"hover:bg-blue-50 transition"},[l("td",Xe,[l("div",Qe,d(t.nama_lengkap),1),l("div",qe,d(t.jabatan||"-"),1)]),(i(!0),n(g,null,h(r.dates,a=>(i(),n("td",{key:a,class:I(["px-4 py-2 text-center",K(a)?"holiday-cell":"",v.value(a,t.id)?"bg-green-50":"",T.value(a)?"bg-gray-100":""]),title:v.value(a,t.id)?`Sudah ada absen: ${v.value(a,t.id).leave_type_name} - ${v.value(a,t.id).reason}`:T.value(a)?"Tanggal sudah lewat - tidak dapat diedit":f.value.value&&f.value.value[A(a)]?f.value.value[A(a)]:""},[T.value(a)?(i(),n("div",et,e[22]||(e[22]=[l("div",{class:"w-full text-xs bg-gray-500 text-white px-1 py-0.5 rounded"},[l("i",{class:"fa-solid fa-clock sm:mr-1"}),l("span",{class:"hidden sm:inline"},"Tanggal Lewat"),l("span",{class:"sm:hidden"},"⏰")],-1),l("div",{class:"text-xs text-gray-600 mt-0.5"}," Tidak dapat diedit ",-1)]))):v.value(a,t.id)?(i(),n("div",tt,[l("div",lt,[e[23]||(e[23]=l("i",{class:"fa-solid fa-check-circle sm:mr-1"},null,-1)),l("span",at,d(v.value(a,t.id).leave_type_name),1),e[24]||(e[24]=l("span",{class:"sm:hidden"},"✓",-1))]),l("div",st,d(v.value(a,t.id).reason),1)])):m("",!0),x(l("select",{"onUpdate:modelValue":c=>B(p).shifts[t.id][a]=c,disabled:v.value(a,t.id)||T.value(a),class:I(["form-input rounded",v.value(a,t.id)||T.value(a)?"bg-gray-100 cursor-not-allowed opacity-50":""])},[e[25]||(e[25]=l("option",{value:null},"OFF",-1)),(i(!0),n(g,null,h(r.shifts,c=>(i(),n("option",{key:c.id,value:c.id},d(c.shift_name),9,nt))),128))],10,it),[[V,B(p).shifts[t.id][a]]])],10,Ze))),128))]))),128))])])])):(i(),n("div",ot,e[26]||(e[26]=[y(" Silakan pilih outlet, divisi, dan tanggal mulai minggu (Senin), lalu klik "),l("b",null,"Tampilkan",-1),y(". ")]))),l("div",ut,[l("button",{type:"submit",class:"bg-blue-600 text-white px-6 py-2 rounded-xl shadow hover:bg-blue-700",disabled:!r.users.length||!r.dates.length},"Simpan Jadwal",8,dt)])],32),P.value?(i(),n("div",{key:2,style:ye({position:"fixed",left:Y.value+"px",top:H.value+"px",background:"linear-gradient(135deg, #fff 60%, #f87171 100%)",color:"#b91c1c",padding:"16px 24px",borderRadius:"12px",fontSize:"18px",fontWeight:"bold",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.37), 0 2px 8px 0 #f87171",border:"2px solid #f87171",zIndex:9999,textShadow:"1px 1px 2px #fff"})},d(z.value),5)):m("",!0)])]),_:1}))}};export{kt as default};
