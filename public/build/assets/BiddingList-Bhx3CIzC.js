import{a as b}from"./vendor-utils-CpgP2uT4.js";import{S as _}from"./app-Vi2dpKR6.js";import{r as x,a as C,w as P,c as y,A as S,B as l,D as t,L as i,F as c,M as f,T as j,E as k,G as v,N as n,l as F}from"./vendor-vue-g7iCcTkf.js";import"./vendor-charts-CuqD4wLC.js";const L={class:"fixed inset-0 z-[110000] flex items-center justify-center bg-black/40"},N={class:"bg-white rounded-xl shadow-lg w-full max-w-3xl p-6 relative"},D={class:"flex justify-between items-center mb-4"},T={key:0,class:"py-8 text-center text-gray-500"},$={key:1},G={key:0,class:"max-h-[60vh] overflow-y-auto"},H={class:"flex items-center justify-between mb-2"},V={class:"font-bold text-blue-700 text-lg flex items-center gap-2"},q={key:0},z=["href"],E={class:"w-full text-sm"},M={class:"text-right"},Q={class:"w-full text-sm mb-2"},R={class:"text-green-600 font-bold"},U=["href"],A={key:1,class:"text-center text-gray-500 py-8"},Y={__name:"BiddingList",props:{show:Boolean,taskId:[String,Number]},setup(w){const o=w,d=x([]),u=x(!1);C(m),P(()=>o.show,s=>{s&&m()});async function m(){if(o.taskId){u.value=!0;try{const s=await b.get("/api/maintenance-tasks/bidding-offers",{params:{task_id:o.taskId}});d.value=s.data}catch{d.value=[]}finally{u.value=!1}}}const g=y(()=>{const s={};for(const e of d.value)s[e.supplier_id]||(s[e.supplier_id]=[]),s[e.supplier_id].push(e);return s}),p=y(()=>{const s={};for(const e of d.value)(!s[e.item_id]||e.price<s[e.item_id].price)&&(s[e.item_id]=e);return Object.values(s)});function B(s){const e=p.value.find(a=>a.item_id===s.item_id);return e&&e.supplier_id===s.supplier_id}function h(s){return s?"Rp "+Number(s).toLocaleString("id-ID"):"-"}async function O(){try{await b.post("/api/maintenance-tasks/create-po-from-bidding",{task_id:o.taskId,items:p.value.map(s=>({pr_item_id:s.item_id,supplier_id:s.supplier_id,price:s.price}))}),_.fire("Sukses","Draft PO berhasil dibuat dari hasil bidding!","success")}catch{_.fire("Gagal","Gagal membuat PO dari bidding!","error")}}return(s,e)=>(l(),S(j,{to:"body"},[t("div",L,[t("div",N,[t("button",{onClick:e[0]||(e[0]=a=>s.$emit("close")),class:"absolute top-3 right-3 text-gray-400 hover:text-gray-600"},e[2]||(e[2]=[t("i",{class:"fas fa-times text-lg"},null,-1)])),t("div",D,[e[3]||(e[3]=t("h1",{class:"text-2xl font-bold"},"Daftar Bidding",-1)),t("button",{onClick:e[1]||(e[1]=a=>s.$emit("input-bidding")),class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"}," Input Hasil Bidding ")]),u.value?(l(),i("div",T,"Loading...")):(l(),i("div",$,[Object.keys(g.value).length?(l(),i("div",G,[(l(!0),i(c,null,f(g.value,(a,I)=>(l(),i("div",{key:I,class:"mb-4 border rounded-lg p-4"},[t("div",H,[t("div",V,[e[4]||(e[4]=t("i",{class:"fas fa-user-tie"},null,-1)),v(" "+n(a[0].supplier_name),1)]),a[0].file_path?(l(),i("div",q,[t("a",{href:"/storage/"+a[0].file_path,target:"_blank",class:"text-blue-600 underline flex items-center gap-1"},e[5]||(e[5]=[t("i",{class:"fas fa-paperclip"},null,-1),v(" File Penawaran ")]),8,z)])):k("",!0)]),t("table",E,[e[6]||(e[6]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Item"),t("th",{class:"text-right"},"Qty"),t("th",{class:"text-left"},"Unit"),t("th",{class:"text-right"},"Harga Penawaran")])],-1)),t("tbody",null,[(l(!0),i(c,null,f(a,r=>(l(),i("tr",{key:r.item_id},[t("td",null,n(r.item_name),1),t("td",M,n(r.quantity),1),t("td",null,n(r.unit_name||"-"),1),t("td",{class:F([B(r)?"text-green-600 font-bold":"","text-right"])},n(h(r.price)),3)]))),128))])])]))),128)),e[8]||(e[8]=t("h2",{class:"font-bold mt-6 mb-2"},"Rekap Penawaran Termurah",-1)),t("table",Q,[e[7]||(e[7]=t("thead",null,[t("tr",null,[t("th",null,"Item"),t("th",null,"Qty"),t("th",null,"Unit"),t("th",null,"Supplier"),t("th",null,"Harga Termurah"),t("th",null,"File")])],-1)),t("tbody",null,[(l(!0),i(c,null,f(p.value,a=>(l(),i("tr",{key:a.item_id},[t("td",null,n(a.item_name),1),t("td",null,n(a.quantity),1),t("td",null,n(a.unit_name),1),t("td",null,n(a.supplier_name),1),t("td",R,n(h(a.price)),1),t("td",null,[a.file_path?(l(),i("a",{key:0,href:"/storage/"+a.file_path,target:"_blank",class:"text-blue-600 underline"},"File",8,U)):k("",!0)])]))),128))])]),t("button",{onClick:O,class:"mt-4 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"}," Lanjutkan ke PO ")])):(l(),i("div",A,"Belum ada penawaran bidding."))]))])])]))}};export{Y as default};
