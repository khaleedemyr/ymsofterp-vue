import{r as g,c as ee,a as Ke,w as te,A as qe,B as l,C as Y,D as e,L as n,E as v,O as Le,H as V,Q as se,J as ue,G as h,F as f,M as m,N as o,I as ie,l as M,X as Z,x as de,S as re}from"./vendor-vue-g7iCcTkf.js";import{A as Pe}from"./AppLayout-BXpmQkyt.js";import{a as B}from"./vendor-utils-CpgP2uT4.js";import"./app-ErXbte2J.js";import"./vendor-charts-CuqD4wLC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-C0i_S3gs.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const Ve={class:"flex items-center justify-between"},$e={class:"flex gap-2"},Qe={class:"py-12"},Re={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Ge={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-6"},De=["max"],Ue={key:0},We=["value"],ze={key:1},He=["value"],Je={class:"flex gap-2 mt-4"},Xe=["disabled"],Ye={key:0,class:"animate-spin mr-2"},Ze={key:0,class:"mt-6"},Ne={class:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded"},et={class:"mt-2 text-sm"},tt={key:0},st={class:"font-semibold"},at={key:1,class:"font-semibold"},lt={class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded"},nt={class:"mt-2 text-sm"},ot={key:0},ut={key:0,class:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mt-4"},it={class:"mt-2 text-sm"},dt={key:0},rt={key:1},ct={key:2},gt={key:3},vt={key:4},pt={key:1,class:"mt-6"},kt={key:2,class:"mt-6"},ft=["onClick"],mt=["onClick"],_t=["onClick"],bt={class:"min-w-full divide-y divide-gray-200 bg-white rounded shadow mt-2"},xt={class:"px-4 py-2"},ht={class:"px-4 py-2 text-right"},yt={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mt-4"},St={class:"mt-2 list-disc ml-6"},wt={key:1,class:"mt-6"},Tt=["onClick"],Ct={class:"bg-white rounded-lg shadow border"},jt={class:"min-w-full divide-y divide-gray-200"},Ot={class:"px-4 py-2 text-sm"},Mt={class:"px-4 py-2 text-sm font-medium"},Et={class:"px-4 py-2 text-sm text-right font-semibold"},Bt={key:0,class:"bg-orange-100 border border-orange-400 text-orange-700 px-4 py-3 rounded mt-4"},Ft={class:"mt-2 list-disc ml-6"},At={class:"mt-4"},It=["disabled"],Kt={key:0,class:"animate-spin mr-2"},qt=["disabled"],Lt={key:0,class:"animate-spin mr-2"},Pt={key:3,class:"mt-6"},Vt={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-8 text-center"},$t={key:1,class:"bg-white rounded-lg shadow border overflow-hidden"},Qt=["onClick"],Rt={class:"flex items-center justify-between"},Gt={class:"font-bold text-lg text-gray-800"},Dt={class:"text-sm text-gray-600"},Ut={class:"text-green-600"},Wt={class:"text-red-600"},zt={key:0},Ht=["onClick"],Jt={class:"flex items-center justify-between"},Xt={class:"font-semibold text-blue-800"},Yt={class:"text-xs text-blue-600"},Zt={class:"text-green-600"},Nt={class:"text-red-600"},es={key:0},ts=["onClick"],ss={class:"flex items-center justify-between"},as={class:"font-medium text-blue-700 text-sm"},ls={class:"text-xs text-blue-600"},ns={class:"text-green-600"},os={class:"text-red-600"},us={key:0},is={class:"min-w-full divide-y divide-gray-200"},ds={class:"bg-white divide-y divide-gray-200"},rs={class:"hover:bg-gray-50"},cs={class:"px-4 py-3 text-sm font-medium text-gray-900"},gs={class:"flex items-center"},vs=["onClick"],ps={class:"px-4 py-3 text-sm text-gray-500"},ks={class:"font-semibold"},fs={class:"px-4 py-3 text-sm text-right font-semibold text-gray-900"},ms={class:"px-4 py-3 text-sm text-right font-semibold text-gray-900"},_s={class:"px-4 py-3 text-sm text-center"},bs={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},xs={key:1,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"},hs={key:0,class:"hover:bg-gray-50 bg-blue-50/30"},ys={class:"px-4 py-3 text-sm text-gray-500"},Ss={class:"font-semibold"},ws={class:"px-4 py-3 text-sm text-right font-semibold text-gray-700"},Ts={class:"px-4 py-3 text-sm text-right font-semibold text-gray-700"},Cs={key:1,class:"hover:bg-gray-50 bg-purple-50/30"},js={class:"px-4 py-3 text-sm text-gray-500"},Os={class:"font-semibold"},Ms={class:"px-4 py-3 text-sm text-right font-semibold text-gray-700"},Es={class:"px-4 py-3 text-sm text-right font-semibold text-gray-700"},Bs={key:2,class:"bg-gray-50"},Fs={colspan:"6",class:"px-4 py-3"},As={class:"bg-white border rounded-lg p-3"},Is={class:"space-y-2"},Ks={class:"flex-1"},qs={class:"font-medium text-gray-700"},Ls=["title"],Ps={key:1,class:"text-gray-500 ml-2",title:"Total pakai = Σ (qty pesanan × qty modifier × BOM/modifier) per transaksi. Bukan (32×32×30) karena tiap transaksi beda qty."},Vs={class:"text-right"},$s={class:"font-semibold text-blue-600"},Qs={key:2,class:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded"},Rs={key:3,class:"mt-4"},Gs={class:"grid grid-cols-3 gap-4 mb-4"},Ds={class:"bg-blue-50 border border-blue-200 rounded-lg p-3"},Us={class:"text-2xl font-bold text-blue-900"},Ws={class:"bg-green-50 border border-green-200 rounded-lg p-3"},zs={class:"text-2xl font-bold text-green-900"},Hs={class:"bg-red-50 border border-red-200 rounded-lg p-3"},Js={class:"text-2xl font-bold text-red-900"},Xs={class:"grid grid-cols-2 gap-4"},Ys={class:"font-semibold text-gray-800 mb-3"},Zs={class:"grid grid-cols-3 gap-2 text-sm mb-3"},Ns={class:"text-center"},ea={class:"font-bold text-gray-800"},ta={class:"text-center"},sa={class:"font-bold text-green-800"},aa={class:"text-center"},la={class:"font-bold text-red-800"},na={key:4,class:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mt-4"},oa={key:5,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mt-4"},ma={__name:"Form",props:{outlets:Array,user:Object},setup(ce){const D=ce,_=g({id_outlet:1,outlet_name:""}),y=g(new Date().toISOString().slice(0,10)),ge=new Date().toISOString().slice(0,10),j=g(!1),U=g(!1),w=g(""),k=g(""),L=g(!1),ve=g({}),ae=g({}),N=g(D.outlets&&D.outlets.length?D.outlets:[]),b=g(""),T=g(""),F=g({}),$=g(!1),W=g({}),z=g({}),H=g({}),J=g({}),R=g([]),G=g([]),P=g([]),c=g(null),S=g([]),X=g(!1),A=g({}),I=g({}),K=g({}),q=g({}),pe=ee(()=>_.value.outlet_name),ke=ee(()=>{if(!c.value||!c.value.has_stock_cut)return!1;const a=T.value&&T.value!==""?T.value:null;if(c.value.logs&&c.value.logs.length>0){const t=c.value.logs.filter(s=>s.status==="success");return t.length===0?!1:a===null?t.length>0:t.some(s=>{const i=s.type_filter||null;return i===null?!0:i===a})}if(c.value.log){const t=c.value.log;if(t.status!=="success")return!1;const s=t.type_filter||null;return s===null||a===null?!0:s===a}return!1}),E=ee(()=>{if(!S.value||S.value.length===0)return{};const a={};return S.value.forEach(t=>{const s=t.warehouse_name,i=t.category_name,r=t.sub_category_name;a[s]||(a[s]={}),a[s][i]||(a[s][i]={}),a[s][i][r]||(a[s][i][r]=[]),a[s][i][r].push(t)}),a});Ke(async()=>{if(D.user&&(_.value=D.user),_.value.id_outlet&&_.value.id_outlet!=1&&(b.value=_.value.id_outlet),!N.value.length){const a=await B.get("/api/outlets");N.value=a.data}await fe(),L.value=!1});async function fe(){const[a,t]=await Promise.all([B.get("/api/items"),B.get("/api/warehouse-outlets",{params:{outlet_id:b.value||_.value.id_outlet}})]);ve.value=Object.fromEntries(a.data.map(s=>[s.id,s.name])),ae.value=Object.fromEntries(t.data.map(s=>[s.id,s.name]))}te(b,async a=>{if(_.value.id_outlet===1&&a){const t=await B.get("/api/warehouse-outlets",{params:{outlet_id:a}});ae.value=Object.fromEntries(t.data.map(s=>[s.id,s.name]))}y.value&&(c.value=null,await Q())}),te(y,async a=>{a&&(b.value||_.value.id_outlet)&&(c.value=null,await Q())}),te(T,async a=>{y.value&&(b.value||_.value.id_outlet)&&(c.value=null,await Q())});async function Q(){try{const a=await B.post("/stock-cut/check-status",{tanggal:y.value,id_outlet:b.value||_.value.id_outlet,type:T.value||null});c.value=a.data}catch(a){console.error("Error checking stock cut status:",a)}}async function me(){j.value=!0,w.value="",k.value="",L.value=!1,F.value={},$.value=!1,P.value=[],R.value=[],G.value=[],S.value=[],X.value=!1,A.value={},I.value={},K.value={},q.value={};try{await Q();const a=T.value||null;if(c.value&&c.value.has_stock_cut){if(c.value.can_cut===!1){const s=c.value.logs||[],i=s.length>0?s[0]:null;let r="";const d=a&&a!==""?a:null,x=d===null?"Semua Type":d==="food"?"Food":"Beverages";c.value.has_all_mode?r='Stock cut "Semua Type" sudah pernah dilakukan untuk tanggal ini. Tidak dapat melakukan stock cut lagi, terlepas dari type yang dipilih.':d===null?c.value.has_food_mode&&c.value.has_beverages_mode?r='Stock cut "Food" dan "Beverages" sudah pernah dilakukan untuk tanggal ini. Tidak dapat melakukan stock cut "Semua Type" lagi.':c.value.has_food_mode?r='Stock cut "Food" sudah pernah dilakukan untuk tanggal ini. Tidak dapat melakukan stock cut "Semua Type" jika sudah ada stock cut sebelumnya.':c.value.has_beverages_mode?r='Stock cut "Beverages" sudah pernah dilakukan untuk tanggal ini. Tidak dapat melakukan stock cut "Semua Type" jika sudah ada stock cut sebelumnya.':r='Stock cut sudah pernah dilakukan untuk tanggal ini. Tidak dapat melakukan stock cut "Semua Type" lagi.':d==="food"&&c.value.has_food_mode?r='Stock cut "Food" sudah pernah dilakukan untuk tanggal ini. Tidak dapat melakukan stock cut "Food" lagi.':d==="beverages"&&c.value.has_beverages_mode?r='Stock cut "Beverages" sudah pernah dilakukan untuk tanggal ini. Tidak dapat melakukan stock cut "Beverages" lagi.':r=`Stock cut "${x}" tidak dapat dilakukan untuk tanggal ini karena sudah ada stock cut sebelumnya.`,k.value=r,$.value=!1,j.value=!1;return}if(c.value.logs&&c.value.logs.length>0){const s=c.value.logs.find(i=>i.status==="success");s&&s.status}}const t=await B.post("/stock-cut/engineering",{tanggal:y.value,id_outlet:b.value||_.value.id_outlet,type:T.value||null});if(F.value=t.data.engineering,R.value=t.data.missing_bom,P.value=t.data.modifiers,G.value=t.data.missing_modifier_bom,$.value=!0,Object.keys(F.value).length===0&&P.value.length===0){const s=a&&a!==""?a:null;if(s&&c.value&&c.value.has_stock_cut)if(s==="food"?c.value.has_food_mode:s==="beverages"?c.value.has_beverages_mode:!1)w.value="Tidak ada transaksi/menu terjual pada tanggal dan outlet yang dipilih.";else try{const r=await B.post("/stock-cut/fix-data",{tanggal:y.value,id_outlet:b.value||_.value.id_outlet});if(r.data.status==="success"&&r.data.fixed_count>0){const d=await B.post("/stock-cut/engineering",{tanggal:y.value,id_outlet:b.value||_.value.id_outlet,type:T.value||null});F.value=d.data.engineering,P.value=d.data.modifiers,R.value=d.data.missing_bom,G.value=d.data.missing_modifier_bom,Object.keys(F.value).length===0&&P.value.length===0&&(w.value="Tidak ada transaksi/menu terjual pada tanggal dan outlet yang dipilih.")}else w.value="Tidak ada transaksi/menu terjual pada tanggal dan outlet yang dipilih."}catch(r){console.error("Error fixing data:",r),w.value="Tidak ada transaksi/menu terjual pada tanggal dan outlet yang dipilih."}else w.value="Tidak ada transaksi/menu terjual pada tanggal dan outlet yang dipilih."}}catch(a){console.error("Error fetching engineering data:",a),k.value="Gagal mengambil data engineering. Silakan coba lagi."}finally{j.value=!1}}async function _e(){j.value=!0,w.value="",k.value="",L.value=!1,S.value=[],X.value=!1,A.value={},I.value={},K.value={},q.value={};try{const a=await B.post("/stock-cut/cek-kebutuhan",{tanggal:y.value,id_outlet:b.value||_.value.id_outlet,type:T.value||null});if(a.data.status==="success"){S.value=a.data.laporan_stock||[],X.value=S.value.length>0;const t=a.data.total_kurang>0;S.value.length===0?(L.value=!1,$.value&&(Object.keys(F.value).length>0||P.value.length>0)?R.value.length>0||G.value.length>0?k.value="Tidak ada kebutuhan stock karena ada item/modifier yang belum punya BOM. Silakan lengkapi BOM terlebih dahulu sebelum melakukan stock cut.":k.value="Tidak ada order_items yang perlu dipotong stock. Kemungkinan semua item untuk type yang dipilih sudah dipotong sebelumnya. Silakan cek log stock cut atau coba dengan type yang berbeda.":k.value=a.data.message||'Tidak ada kebutuhan stock untuk tanggal dan outlet yang dipilih. Silakan klik "Cek Engineering" terlebih dahulu untuk melihat data transaksi.'):t?(L.value=!1,k.value="Stock kurang, tidak bisa potong stock!"):(L.value=!0,w.value="Stock cukup, siap untuk potong stock!")}else k.value=a.data.message||"Terjadi kesalahan saat memeriksa kebutuhan stock."}catch(a){console.error("Error checking stock needs:",a),k.value="Gagal memeriksa kebutuhan stock. Silakan coba lagi."}finally{j.value=!1}}async function be(){var a;U.value=!0,k.value="",w.value="";try{const t=await B.post("/stock-cut/dispatch",{tanggal:y.value,id_outlet:b.value||_.value.id_outlet,type:T.value||null});t.data.status==="success"?(w.value=t.data.message||"Potong stock berhasil.",L.value=!1,await Q()):t.data.kurang?k.value="Stock kurang, tidak bisa potong stock!":t.data.already_cut?(k.value=t.data.message||"Stock cut sudah pernah dilakukan untuk tanggal ini.",await Q()):k.value=t.data.message||"Terjadi kesalahan saat memproses stock cut."}catch(t){const s=(a=t.response)==null?void 0:a.data;s!=null&&s.already_cut?(k.value=s.message||"Stock cut sudah pernah dilakukan untuk tanggal ini.",await Q()):k.value=(s==null?void 0:s.message)||t.message||"Terjadi kesalahan saat memproses stock cut."}finally{U.value=!1}}function xe(a){W.value[a]=!W.value[a]}function he(a,t){z.value[a+t]=!z.value[a+t]}function ye(a,t,s){H.value[a+t+s]=!H.value[a+t+s]}function Se(a){J.value[a]=!J.value[a]}function we(a){A.value[a]=!A.value[a]}function Te(a,t){I.value[a+t]=!I.value[a+t]}function Ce(a,t,s){K.value[a+t+s]=!K.value[a+t+s]}function je(a){q.value[a]=!q.value[a]}function p(a){return a==null?"0.00":parseFloat(a).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}function Oe(a){return a.modifiers.reduce((t,s)=>t+s.qty,0)}function le(a){return Object.values(a).reduce((t,s)=>t+Object.values(s).reduce((i,r)=>i+r.length,0),0)}function Me(a){return Object.values(a).reduce((t,s)=>t+s.length,0)}function ne(a){return Object.values(a).reduce((t,s)=>t+Object.values(s).reduce((i,r)=>i+r.filter(d=>d.status==="cukup").length,0),0)}function oe(a){return Object.values(a).reduce((t,s)=>t+Object.values(s).reduce((i,r)=>i+r.filter(d=>d.status==="kurang").length,0),0)}function Ee(a){return Object.values(a).reduce((t,s)=>t+s.filter(i=>i.status==="cukup").length,0)}function Be(a){return Object.values(a).reduce((t,s)=>t+s.filter(i=>i.status==="kurang").length,0)}function Fe(){Object.keys(E.value).forEach(a=>{A.value[a]=!0,Object.keys(E.value[a]).forEach(t=>{const s=a+t;I.value[s]=!0,Object.keys(E.value[a][t]).forEach(i=>{const r=a+t+i;K.value[r]=!0,E.value[a][t][i].forEach(d=>{const x=d.item_id+"-"+d.warehouse_id+"-"+d.unit_id;q.value[x]=!0})})})})}function Ae(){Object.keys(E.value).forEach(a=>{A.value[a]=!1,Object.keys(E.value[a]).forEach(t=>{const s=a+t;I.value[s]=!1,Object.keys(E.value[a][t]).forEach(i=>{const r=a+t+i;K.value[r]=!1,E.value[a][t][i].forEach(d=>{const x=d.item_id+"-"+d.warehouse_id+"-"+d.unit_id;q.value[x]=!1})})})})}return(a,t)=>(l(),qe(Pe,{title:"Stock Cut"},{header:Y(()=>[e("div",Ve,[t[6]||(t[6]=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},[e("i",{class:"fa-solid fa-scissors text-blue-500"}),h(" Potong Stock ")],-1)),e("div",$e,[de(se(re),{href:a.route("stock-cut.menu-cost"),class:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition"},{default:Y(()=>t[4]||(t[4]=[e("i",{class:"fa-solid fa-calculator mr-1"},null,-1),h(" Report Cost Menu ")])),_:1},8,["href"]),de(se(re),{href:a.route("stock-cut.index"),class:"bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 transition"},{default:Y(()=>t[5]||(t[5]=[e("i",{class:"fa-solid fa-list mr-1"},null,-1),h(" Log Stock Cut ")])),_:1},8,["href"])])])]),default:Y(()=>[e("div",Qe,[e("div",Re,[e("div",Ge,[e("form",{onSubmit:Le(me,["prevent"]),class:"space-y-4 bg-white rounded-xl shadow-xl p-8"},[e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-gray-700"},"Tanggal",-1)),V(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=s=>y.value=s),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500",max:se(ge),required:""},null,8,De),[[ue,y.value]])]),_.value.id_outlet===1?(l(),n("div",Ue,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700"},[h("Outlet "),e("span",{class:"text-red-500"},"*")],-1)),V(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>b.value=s),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500",required:""},[t[8]||(t[8]=e("option",{value:""},"Pilih Outlet",-1)),(l(!0),n(f,null,m(N.value,s=>(l(),n("option",{key:s.id,value:s.id},o(s.name),9,We))),128))],512),[[ie,b.value]])])):(l(),n("div",ze,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700"},"Outlet",-1)),e("input",{type:"text",value:pe.value,class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm bg-gray-100 cursor-not-allowed",readonly:""},null,8,He),V(e("input",{type:"hidden","onUpdate:modelValue":t[2]||(t[2]=s=>b.value=s)},null,512),[[ue,b.value]])])),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700"},"Type Item (Opsional)",-1)),V(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>T.value=s),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm"},t[11]||(t[11]=[e("option",{value:""},"Semua Type (Food + Beverages)",-1),e("option",{value:"food"},"Food (Asian, Western, Food)",-1),e("option",{value:"beverages"},"Beverages",-1)]),512),[[ie,T.value]])]),e("div",Je,[e("button",{type:"submit",disabled:j.value,class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition"},[j.value?(l(),n("span",Ye,"⏳")):v("",!0),t[13]||(t[13]=h(" Cek Engineering "))],8,Xe)])],32),c.value&&c.value.has_stock_cut&&c.value.logs&&c.value.logs.length>0?(l(),n("div",Ze,[(l(!0),n(f,null,m(c.value.logs.filter(s=>s.status==="success"),s=>(l(),n("div",{key:s.id,class:"mb-4"},[e("div",Ne,[t[15]||(t[15]=e("strong",{class:"font-bold"},"Stock Cut Sudah Dilakukan!",-1)),e("div",et,[e("p",null,"Outlet ini sudah melakukan potong stock pada tanggal "+o(y.value)+".",1),s.type_filter?(l(),n("p",tt,[t[14]||(t[14]=h(" Type yang sudah dipotong: ")),e("span",st,o(s.type_filter==="food"?"Food":s.type_filter==="beverages"?"Beverages":"Semua Type"),1)])):(l(),n("p",at,"Type: Semua Type (Food + Beverages)")),e("p",null,"Total item dipotong: "+o(s.total_items_cut),1),e("p",null,"Total modifier dipotong: "+o(s.total_modifiers_cut),1),e("p",null,"Dilakukan pada: "+o(new Date(s.created_at).toLocaleString("id-ID")),1)])])]))),128)),(l(!0),n(f,null,m(c.value.logs.filter(s=>s.status!=="success"),s=>(l(),n("div",{key:s.id,class:"mb-4"},[e("div",lt,[t[17]||(t[17]=e("strong",{class:"font-bold"},"Stock Cut Gagal!",-1)),e("div",nt,[e("p",null,"Outlet ini pernah mencoba potong stock pada tanggal "+o(y.value)+" tetapi gagal.",1),s.error_message?(l(),n("p",ot,"Error: "+o(s.error_message),1)):v("",!0),e("p",null,"Dilakukan pada: "+o(new Date(s.created_at).toLocaleString("id-ID")),1),t[16]||(t[16]=e("p",{class:"mt-2 font-semibold"},"Anda dapat mencoba stock cut lagi.",-1))])])]))),128)),c.value.can_cut===!1?(l(),n("div",ut,[t[18]||(t[18]=e("strong",{class:"font-bold"},"⚠️ Perhatian!",-1)),e("p",it,[c.value.has_all_mode?(l(),n("span",dt,' Stock cut "Semua Type" sudah pernah dilakukan. Tidak dapat melakukan stock cut lagi untuk tanggal ini. ')):c.value.has_food_mode&&c.value.has_beverages_mode?(l(),n("span",rt,' Stock cut "Food" dan "Beverages" sudah pernah dilakukan. Tidak dapat melakukan stock cut lagi untuk tanggal ini. ')):c.value.has_food_mode?(l(),n("span",ct,' Stock cut "Food" sudah pernah dilakukan. Anda masih bisa melakukan stock cut "Beverages". ')):c.value.has_beverages_mode?(l(),n("span",gt,' Stock cut "Beverages" sudah pernah dilakukan. Anda masih bisa melakukan stock cut "Food". ')):(l(),n("span",vt," Stock cut sudah pernah dilakukan untuk tanggal ini. "))])])):v("",!0)])):v("",!0),$.value&&F.value.length===0?(l(),n("div",pt,t[19]||(t[19]=[e("div",{class:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded"}," Tidak ada transaksi/menu terjual pada tanggal dan outlet yang dipilih. ",-1)]))):v("",!0),$.value&&Object.keys(F.value).length?(l(),n("div",kt,[t[29]||(t[29]=e("h3",{class:"font-bold mb-2"},"Engineering (Item Terjual)",-1)),(l(!0),n(f,null,m(F.value,(s,i)=>(l(),n("div",{key:i,class:"mb-4 border rounded-lg"},[e("button",{onClick:r=>xe(i),class:"w-full text-left px-4 py-2 bg-blue-50 font-bold rounded-t-lg flex items-center justify-between"},[e("span",null,o(i),1),e("span",null,[e("i",{class:M(W.value[i]?"fa fa-chevron-down":"fa fa-chevron-right")},null,2)])],8,ft),V(e("div",null,[(l(!0),n(f,null,m(s,(r,d)=>(l(),n("div",{key:d,class:"ml-4 mb-2 border-l-2 border-blue-200"},[e("button",{onClick:x=>he(i,d),class:"w-full text-left px-4 py-2 bg-blue-100 font-semibold flex items-center justify-between"},[e("span",null,o(d),1),e("span",null,[e("i",{class:M(z.value[i+d]?"fa fa-chevron-down":"fa fa-chevron-right")},null,2)])],8,mt),V(e("div",null,[(l(!0),n(f,null,m(r,(x,C)=>(l(),n("div",{key:C,class:"ml-4 mb-2 border-l-2 border-blue-100"},[e("button",{onClick:u=>ye(i,d,C),class:"w-full text-left px-4 py-2 bg-blue-200 font-medium flex items-center justify-between"},[e("span",null,o(C),1),e("span",null,[e("i",{class:M(H.value[i+d+C]?"fa fa-chevron-down":"fa fa-chevron-right")},null,2)])],8,_t),V(e("div",null,[e("table",bt,[t[20]||(t[20]=e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-2 text-left"},"Nama Item"),e("th",{class:"px-4 py-2 text-right"},"Qty Terjual")])],-1)),e("tbody",null,[(l(!0),n(f,null,m(x,u=>(l(),n("tr",{key:u.item_name},[e("td",xt,o(u.item_name),1),e("td",ht,o(u.total_qty),1)]))),128))])])],512),[[Z,H.value[i+d+C]]])]))),128))],512),[[Z,z.value[i+d]]])]))),128))],512),[[Z,W.value[i]]])]))),128)),R.value.length?(l(),n("div",yt,[t[21]||(t[21]=e("strong",{class:"font-bold"},"Perhatian!",-1)),t[22]||(t[22]=h(" Ada item yang belum punya BOM: ")),e("ul",St,[(l(!0),n(f,null,m(R.value,s=>(l(),n("li",{key:s.item_id},o(s.item_name)+" (ID: "+o(s.item_id)+") ",1))),128))])])):v("",!0),$.value&&P.value.length?(l(),n("div",wt,[t[26]||(t[26]=e("h3",{class:"font-bold mb-2"},"Modifier Engineering",-1)),(l(!0),n(f,null,m(P.value,(s,i)=>(l(),n("div",{key:s.group_id,class:"mb-4 border rounded-lg"},[e("button",{onClick:r=>Se(s.group_id),class:"w-full text-left px-4 py-2 bg-purple-50 font-bold rounded-t-lg flex items-center justify-between"},[e("span",null,o(s.group_name)+" (Total: "+o(Oe(s))+")",1),e("span",null,[e("i",{class:M(J.value[s.group_id]?"fa fa-chevron-down":"fa fa-chevron-right")},null,2)])],8,Tt),V(e("div",null,[e("div",Ct,[e("table",jt,[t[23]||(t[23]=e("thead",null,[e("tr",{class:"bg-purple-100"},[e("th",{class:"px-4 py-2 text-left text-sm font-semibold text-purple-800"},"No"),e("th",{class:"px-4 py-2 text-left text-sm font-semibold text-purple-800"},"Nama Modifier"),e("th",{class:"px-4 py-2 text-right text-sm font-semibold text-purple-800"},"Qty Terjual")])],-1)),e("tbody",null,[(l(!0),n(f,null,m(s.modifiers,(r,d)=>(l(),n("tr",{key:r.name,class:"hover:bg-purple-50"},[e("td",Ot,o(d+1),1),e("td",Mt,o(r.name),1),e("td",Et,o(r.qty),1)]))),128))])])])],512),[[Z,J.value[s.group_id]]])]))),128)),G.value.length?(l(),n("div",Bt,[t[24]||(t[24]=e("strong",{class:"font-bold"},"Perhatian!",-1)),t[25]||(t[25]=h(" Ada modifier yang belum punya BOM: ")),e("ul",Ft,[(l(!0),n(f,null,m(G.value,s=>(l(),n("li",{key:s.name},o(s.name)+" (Modifier ID: "+o(s.modifier_id)+") ",1))),128))])])):v("",!0)])):v("",!0),e("div",At,[e("button",{onClick:_e,disabled:j.value,class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition"},[j.value?(l(),n("span",Kt,"⏳")):v("",!0),t[27]||(t[27]=h(" Cek Kebutuhan Stock Engineering "))],8,It),L.value&&!ke.value?(l(),n("button",{key:0,onClick:be,disabled:U.value,class:"ml-2 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition"},[U.value?(l(),n("span",Lt,"⏳")):v("",!0),t[28]||(t[28]=h(" Potong Stock Sekarang (Queue) "))],8,qt)):v("",!0)])])):v("",!0),X.value?(l(),n("div",Pt,[e("div",{class:"flex items-center justify-between mb-4"},[t[30]||(t[30]=e("h3",{class:"font-bold text-lg"},"Laporan Kebutuhan vs Stock Tersedia",-1)),e("div",{class:"flex gap-2"},[e("button",{onClick:Fe,class:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition"}," Expand All "),e("button",{onClick:Ae,class:"bg-gray-600 text-white px-3 py-1 rounded text-sm hover:bg-gray-700 transition"}," Collapse All ")])]),j.value?(l(),n("div",Vt,t[31]||(t[31]=[e("div",{class:"animate-spin text-blue-500 text-4xl mb-4"},"⏳",-1),e("p",{class:"text-blue-700 font-medium"},"Memuat data laporan stock...",-1)]))):S.value.length>0?(l(),n("div",$t,[(l(!0),n(f,null,m(E.value,(s,i)=>(l(),n("div",{key:i,class:"mb-6"},[e("button",{onClick:r=>we(i),class:"w-full bg-gray-100 px-4 py-3 border-b text-left hover:bg-gray-200 transition"},[e("div",Rt,[e("div",null,[e("h4",Gt,o(i)+" ("+o(le(s))+" items)",1),e("div",Dt,[e("span",Ut,o(ne(s))+" cukup",1),t[32]||(t[32]=h(" | ")),e("span",Wt,o(oe(s))+" kurang",1)])]),e("i",{class:M([{"fa-chevron-down":!A.value[i],"fa-chevron-up":A.value[i]},"fa-solid text-gray-600"])},null,2)])],8,Qt),A.value[i]?(l(),n("div",zt,[(l(!0),n(f,null,m(s,(r,d)=>(l(),n("div",{key:d,class:"mb-4"},[e("button",{onClick:x=>Te(i,d),class:"w-full bg-blue-50 px-4 py-2 border-b text-left hover:bg-blue-100 transition"},[e("div",Jt,[e("div",null,[e("h5",Xt,o(d)+" ("+o(Me(r))+" items)",1),e("div",Yt,[e("span",Zt,o(Ee(r))+" cukup",1),t[33]||(t[33]=h(" | ")),e("span",Nt,o(Be(r))+" kurang",1)])]),e("i",{class:M([{"fa-chevron-down":!I.value[i+d],"fa-chevron-up":I.value[i+d]},"fa-solid text-blue-600"])},null,2)])],8,Ht),I.value[i+d]?(l(),n("div",es,[(l(!0),n(f,null,m(r,(x,C)=>(l(),n("div",{key:C,class:"mb-3"},[e("button",{onClick:u=>Ce(i,d,C),class:"w-full bg-blue-100 px-4 py-1 border-b text-left hover:bg-blue-200 transition"},[e("div",ss,[e("div",null,[e("h6",as,o(C)+" ("+o(x.length)+" items)",1),e("div",ls,[e("span",ns,o(x.filter(u=>u.status==="cukup").length)+" cukup",1),t[34]||(t[34]=h(" | ")),e("span",os,o(x.filter(u=>u.status==="kurang").length)+" kurang",1)])]),e("i",{class:M([{"fa-chevron-down":!K.value[i+d+C],"fa-chevron-up":K.value[i+d+C]},"fa-solid text-blue-600"])},null,2)])],8,ts),K.value[i+d+C]?(l(),n("div",us,[e("table",is,[t[44]||(t[44]=e("thead",null,[e("tr",{class:"bg-gray-50"},[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Item"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Unit"),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Kebutuhan"),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Stock Tersedia"),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Selisih"),e("th",{class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status")])],-1)),e("tbody",ds,[(l(!0),n(f,null,m(x,u=>(l(),n(f,{key:u.item_id+"-"+u.warehouse_id+"-"+u.unit_id},[e("tr",rs,[e("td",cs,[e("div",gs,[e("button",{onClick:O=>je(u.item_id+"-"+u.warehouse_id+"-"+u.unit_id),class:"mr-2 text-blue-600 hover:text-blue-800"},[e("i",{class:M([{"fa-chevron-down":!q.value[u.item_id+"-"+u.warehouse_id+"-"+u.unit_id],"fa-chevron-up":q.value[u.item_id+"-"+u.warehouse_id+"-"+u.unit_id]},"fa-solid text-sm"])},null,2)],8,vs),h(" "+o(u.item_name),1)])]),e("td",ps,[e("span",ks,o(u.unit_small_name||u.unit_name),1),t[35]||(t[35]=e("span",{class:"text-xs text-gray-400 ml-1"},"(Small)",-1))]),e("td",fs,o(p(u.kebutuhan_small||u.kebutuhan)),1),e("td",ms,o(p(u.stock_tersedia_small||u.stock_tersedia)),1),e("td",{class:M(["px-4 py-3 text-sm text-right font-semibold",(u.selisih_small||u.selisih)>0?"text-red-600":"text-green-600"])},o((u.selisih_small||u.selisih)>0?"+"+p(u.selisih_small||u.selisih):p(u.selisih_small||u.selisih)),3),e("td",_s,[u.status==="cukup"?(l(),n("span",bs," Cukup ")):(l(),n("span",xs," Kurang "))])]),u.has_medium_unit&&u.unit_medium_name?(l(),n("tr",hs,[t[37]||(t[37]=e("td",{class:"px-4 py-3 text-sm text-gray-500"},null,-1)),e("td",ys,[e("span",Ss,o(u.unit_medium_name),1),t[36]||(t[36]=e("span",{class:"text-xs text-gray-400 ml-1"},"(Medium)",-1))]),e("td",ws,o(p(u.kebutuhan_medium)),1),e("td",Ts,o(p(u.stock_tersedia_medium)),1),e("td",{class:M(["px-4 py-3 text-sm text-right font-semibold",u.selisih_medium>0?"text-red-600":"text-green-600"])},o(u.selisih_medium>0?"+"+p(u.selisih_medium):p(u.selisih_medium)),3),t[38]||(t[38]=e("td",{class:"px-4 py-3 text-sm text-center"},[e("span",{class:"text-xs text-gray-500"},"-")],-1))])):v("",!0),u.has_large_unit&&u.unit_large_name?(l(),n("tr",Cs,[t[40]||(t[40]=e("td",{class:"px-4 py-3 text-sm text-gray-500"},null,-1)),e("td",js,[e("span",Os,o(u.unit_large_name),1),t[39]||(t[39]=e("span",{class:"text-xs text-gray-400 ml-1"},"(Large)",-1))]),e("td",Ms,o(p(u.kebutuhan_large)),1),e("td",Es,o(p(u.stock_tersedia_large)),1),e("td",{class:M(["px-4 py-3 text-sm text-right font-semibold",u.selisih_large>0?"text-red-600":"text-green-600"])},o(u.selisih_large>0?"+"+p(u.selisih_large):p(u.selisih_large)),3),t[41]||(t[41]=e("td",{class:"px-4 py-3 text-sm text-center"},[e("span",{class:"text-xs text-gray-500"},"-")],-1))])):v("",!0),q.value[u.item_id+"-"+u.warehouse_id+"-"+u.unit_id]&&u.contributing_menus&&u.contributing_menus.length>0?(l(),n("tr",Bs,[e("td",Fs,[e("div",As,[t[42]||(t[42]=e("h6",{class:"font-semibold text-gray-800 mb-2"},"Menu yang Mengurangi Stock:",-1)),t[43]||(t[43]=e("p",{class:"text-xs text-gray-500 mb-2"},"Angka di kanan = total pakai (gram/satuan). Untuk modifier: (qty pesanan × qty modifier × BOM/modifier) dijumlah per transaksi.",-1)),e("div",Is,[(l(!0),n(f,null,m(u.contributing_menus,(O,Ie)=>(l(),n("div",{key:Ie,class:"flex justify-between items-center text-sm border-b pb-1"},[e("div",Ks,[e("span",qs,o(O.menu_name),1),O.type==="menu"?(l(),n("span",{key:0,class:"text-gray-500 ml-2",title:"Qty pesanan × BOM per porsi = "+p(O.total_contributed)}," (Total: "+o(p(O.menu_qty))+" × "+o(p(O.bom_qty_per_menu))+") ",9,Ls)):O.type==="modifier"?(l(),n("span",Ps," (Qty pesanan total: "+o(p(O.menu_qty))+", Qty modifier total: "+o(p(O.modifier_qty))+", BOM/modifier: "+o(p(O.bom_qty_per_modifier))+") ",1)):v("",!0)]),e("div",Vs,[e("span",$s,o(p(O.total_contributed)),1)])]))),128))])])])])):v("",!0)],64))),128))])])])):v("",!0)]))),128))])):v("",!0)]))),128))])):v("",!0)]))),128))])):j.value?v("",!0):(l(),n("div",Qs,t[45]||(t[45]=[e("strong",{class:"font-bold"},"Tidak ada data laporan stock untuk ditampilkan.",-1),e("p",{class:"mt-2 text-sm"},'Silakan klik tombol "Cek Kebutuhan Stock Engineering" untuk memuat data laporan stock.',-1)]))),S.value.length>0?(l(),n("div",Rs,[e("div",Gs,[e("div",Ds,[t[46]||(t[46]=e("div",{class:"text-sm font-medium text-blue-800"},"Total Item Dicek",-1)),e("div",Us,o(S.value.length),1)]),e("div",Ws,[t[47]||(t[47]=e("div",{class:"text-sm font-medium text-green-800"},"Stock Cukup",-1)),e("div",zs,o(S.value.filter(s=>s.status==="cukup").length),1)]),e("div",Hs,[t[48]||(t[48]=e("div",{class:"text-sm font-medium text-red-800"},"Stock Kurang",-1)),e("div",Js,o(S.value.filter(s=>s.status==="kurang").length),1)])]),e("div",Xs,[(l(!0),n(f,null,m(E.value,(s,i)=>(l(),n("div",{key:i,class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},[e("h5",Ys,o(i),1),e("div",Zs,[e("div",Ns,[t[49]||(t[49]=e("div",{class:"font-medium text-gray-600"},"Total",-1)),e("div",ea,o(le(s)),1)]),e("div",ta,[t[50]||(t[50]=e("div",{class:"font-medium text-green-600"},"Cukup",-1)),e("div",sa,o(ne(s)),1)]),e("div",aa,[t[51]||(t[51]=e("div",{class:"font-medium text-red-600"},"Kurang",-1)),e("div",la,o(oe(s)),1)])])]))),128))])])):v("",!0)])):v("",!0),w.value?(l(),n("div",na,o(w.value),1)):v("",!0),k.value?(l(),n("div",oa,o(k.value),1)):v("",!0)])])])]),_:1}))}};export{ma as default};
