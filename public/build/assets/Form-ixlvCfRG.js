import{r as v,c as D,a as H,w as L,A as z,B as i,C as G,D as t,x as Q,G as B,Q as Y,W as P,H as f,L as u,F as _,M as w,N as n,I as C,J as g,E as Z,l as ee}from"./vendor-vue-g7iCcTkf.js";import{A as te}from"./AppLayout-Cke2dYBX.js";import{S as c}from"./app-AaUk6aDd.js";import se from"./CustomerModal-Bw8bjZ8Q.js";import"./vendor-utils-CpgP2uT4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-DtjcyHN1.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./vendor-charts-CuqD4wLC.js";import"./lodash-DB3HVzpp.js";const oe={class:"max-w-7xl w-full mx-auto py-8 px-2"},le={class:"flex justify-between items-center mb-6"},ae={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},re={class:"lg:col-span-1"},ne={class:"bg-white rounded-2xl shadow-2xl p-6"},ie={class:"mb-4"},ue=["value"],de={class:"mb-4"},me={class:"mb-4"},ce=["value"],be={class:"mb-4"},fe=["value"],ve={class:"mb-4"},pe={class:"mb-4"},he={class:"flex gap-2"},ge={class:"mb-4 relative"},ye={class:"relative"},_e={key:0,class:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto"},we=["onClick"],xe={class:"flex justify-between items-start"},ke={class:"flex-1"},Ce={class:"font-semibold text-gray-800"},Se={class:"text-sm text-gray-500 mt-1"},Ie={class:"inline-block mr-4"},Ee={class:"inline-block"},Te=["disabled"],je={key:0},qe={key:1},De={class:"lg:col-span-2"},Be={class:"bg-white rounded-2xl shadow-2xl p-6"},Pe={class:"flex justify-between items-center mb-4"},Ne={class:"text-lg font-bold text-blue-600"},Ve={key:0,class:"text-center py-10 text-gray-400"},Ue={key:1,class:"space-y-4"},Ae={class:"flex justify-between items-start mb-3"},Oe={class:"flex-1"},Re={class:"font-semibold text-gray-800"},Fe={class:"text-sm text-gray-500"},Ke={class:"text-sm text-gray-500"},$e=["onClick"],Me={class:"grid grid-cols-3 gap-4"},We=["onUpdate:modelValue","onInput"],Je=["onUpdate:modelValue","onChange"],Xe=["value"],He=["value"],Le=["value"],ze={class:"flex gap-2"},Ge=["onUpdate:modelValue","onInput"],Qe=["onClick"],Ye={class:"mt-3 text-right"},Ze={class:"font-semibold text-blue-600"},ct={__name:"Form",props:{warehouses:Array,warehouseDivisions:Array,customers:Array},setup(S){const N=S,l=v({customer_id:"",sale_date:new Date().toISOString().split("T")[0],warehouse_id:"",warehouse_division_id:"",notes:"",items:[],total_amount:0}),p=v(""),h=v(""),y=v(!1),x=v(!1);v([]);const d=v([]),b=v(!1),m=v(-1),V=D(()=>l.value.warehouse_id?N.warehouseDivisions.filter(o=>o.warehouse_id==l.value.warehouse_id):[]),T=D(()=>l.value.items.reduce((o,e)=>o+(e.subtotal||0),0));let I=null;H(()=>{setTimeout(()=>{var o;(o=document.getElementById("barcode-input"))==null||o.focus()},100)}),L(h,o=>{I&&clearTimeout(I),o&&o.length>=2?I=setTimeout(()=>{U()},300):(d.value=[],b.value=!1)});async function j(){var o;if(p.value.trim()){if(!l.value.warehouse_id){c.fire("Error","Pilih warehouse terlebih dahulu!","error");return}try{const s=await(await fetch("/retail-warehouse-sale/search-items",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({barcode:p.value,warehouse_id:l.value.warehouse_id})})).json();if(!s.success){c.fire("Error",s.message,"error"),p.value="";return}const a=s.item,r=l.value.items.find(E=>E.item_id===a.item_id);if(r)r.qty+=1,r.subtotal=r.qty*r.price;else{const E={item_id:a.item_id,item_name:a.item_name,barcode:p.value,qty:1,unit:a.unit_medium,price:a.price||0,subtotal:a.price||0,stock:{small:a.qty_small||0,medium:a.qty_medium||0,large:a.qty_large||0},units:{small:a.unit_small,medium:a.unit_medium,large:a.unit_large}};l.value.items.push(E)}p.value="",(o=document.getElementById("barcode-input"))==null||o.focus()}catch(e){console.error("Error scanning barcode:",e),c.fire("Error","Terjadi kesalahan saat scan barcode","error")}}}async function U(){if(!h.value.trim()||h.value.length<2){d.value=[],b.value=!1;return}if(!l.value.warehouse_id){c.fire("Error","Pilih warehouse terlebih dahulu!","error");return}try{const e=await(await fetch("/retail-warehouse-sale/search-items-by-name",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({search:h.value,warehouse_id:l.value.warehouse_id})})).json();e.success?(d.value=e.items,b.value=!0,m.value=-1):(d.value=[],b.value=!1)}catch(o){console.error("Error searching items:",o),d.value=[],b.value=!1}}function q(o){const e=l.value.items.find(s=>s.item_id===o.item_id);if(e)e.qty+=1,e.subtotal=e.qty*e.price;else{const s={item_id:o.item_id,item_name:o.item_name,barcode:"",qty:1,unit:o.unit_medium,price:o.price||0,subtotal:o.price||0,stock:{small:o.qty_small||0,medium:o.qty_medium||0,large:o.qty_large||0},units:{small:o.unit_small,medium:o.unit_medium,large:o.unit_large}};l.value.items.push(s)}h.value="",d.value=[],b.value=!1,m.value=-1,setTimeout(()=>{var s;(s=document.getElementById("item-search-input"))==null||s.focus()},100)}function A(o){if(!(!b.value||d.value.length===0))switch(o.key){case"ArrowDown":o.preventDefault(),m.value=Math.min(m.value+1,d.value.length-1);break;case"ArrowUp":o.preventDefault(),m.value=Math.max(m.value-1,-1);break;case"Enter":o.preventDefault(),m.value>=0&&m.value<d.value.length&&q(d.value[m.value]);break;case"Escape":b.value=!1,m.value=-1;break}}function O(){setTimeout(()=>{b.value=!1,m.value=-1},200)}function k(o){const e=l.value.items[o];e.subtotal=e.qty*e.price}function R(o){l.value.items.splice(o,1)}function F(){y.value=!0}function K(o){l.value.customer_id=o.id,y.value=!1}function $(o){l.value.customer_id=o.id,y.value=!1}async function M(){if(!l.value.customer_id){c.fire("Error","Pilih customer terlebih dahulu!","error");return}if(!l.value.warehouse_id){c.fire("Error","Pilih warehouse terlebih dahulu!","error");return}if(l.value.items.length===0){c.fire("Error","Tidak ada item yang dipilih!","error");return}if(l.value.items.filter(e=>!e.price||e.price<=0).length>0){c.fire("Error","Semua item harus memiliki harga!","error");return}x.value=!0;try{const s=await(await fetch("/retail-warehouse-sale",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({...l.value,total_amount:T.value})})).json();s.success?c.fire({title:"Berhasil!",text:s.message,icon:"success",confirmButtonText:"OK"}).then(()=>{P.visit(route("retail-warehouse-sale.index"))}):c.fire("Error",s.message,"error")}catch(e){console.error("Error submitting form:",e),c.fire("Error","Terjadi kesalahan saat menyimpan data","error")}finally{x.value=!1}}function W(o){o.key==="Enter"&&j()}async function J(o){try{return(await(await fetch(`/api/retail-warehouse-sale/item-price?item_id=${o}`,{method:"GET",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json()).price||0}catch(e){return console.error("Error fetching price:",e),0}}async function X(o){const e=l.value.items[o],s=await J(e.item_id);e.price=s,k(o)}return(o,e)=>(i(),z(te,null,{default:G(()=>[t("div",oe,[t("div",le,[e[9]||(e[9]=t("h1",{class:"text-2xl font-bold text-gray-800 flex items-center gap-2"},[t("i",{class:"fa-solid fa-store text-blue-500"}),B(" Buat Penjualan Warehouse Retail ")],-1)),t("button",{onClick:e[0]||(e[0]=s=>Y(P).visit(o.route("retail-warehouse-sale.index"))),class:"bg-gray-500 text-white px-4 py-2 rounded-xl shadow-lg hover:shadow-xl transition-all font-semibold"}," Kembali ")]),t("div",ae,[t("div",re,[t("div",ne,[e[24]||(e[24]=t("h2",{class:"text-xl font-bold text-gray-800 mb-4"},"Informasi Penjualan",-1)),t("div",ie,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Customer",-1)),f(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.value.customer_id=s),class:"w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500"},[e[10]||(e[10]=t("option",{value:""},"Pilih Customer",-1)),(i(!0),u(_,null,w(S.customers,s=>(i(),u("option",{key:s.id,value:s.id},n(s.name)+" ("+n(s.code)+") ",9,ue))),128))],512),[[C,l.value.customer_id]]),t("button",{onClick:F,type:"button",class:"mt-2 w-full px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"},e[11]||(e[11]=[t("i",{class:"fa-solid fa-plus mr-2"},null,-1),B(" Tambah Customer Baru ")]))]),t("div",de,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tanggal Penjualan",-1)),f(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.value.sale_date=s),type:"date",class:"w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[g,l.value.sale_date]])]),t("div",me,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Warehouse",-1)),f(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>l.value.warehouse_id=s),class:"w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500"},[e[14]||(e[14]=t("option",{value:""},"Pilih Warehouse",-1)),(i(!0),u(_,null,w(S.warehouses,s=>(i(),u("option",{key:s.id,value:s.id},n(s.name),9,ce))),128))],512),[[C,l.value.warehouse_id]])]),t("div",be,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Division (Opsional)",-1)),f(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.warehouse_division_id=s),class:"w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500"},[e[16]||(e[16]=t("option",{value:""},"Pilih Division",-1)),(i(!0),u(_,null,w(V.value,s=>(i(),u("option",{key:s.id,value:s.id},n(s.name),9,fe))),128))],512),[[C,l.value.warehouse_division_id]])]),t("div",ve,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan",-1)),f(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.notes=s),rows:"3",class:"w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[g,l.value.notes]])]),t("div",pe,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Scan Barcode",-1)),t("div",he,[f(t("input",{id:"barcode-input","onUpdate:modelValue":e[6]||(e[6]=s=>p.value=s),onKeypress:W,type:"text",placeholder:"Scan barcode item...",class:"flex-1 rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500"},null,544),[[g,p.value]]),t("button",{onClick:j,type:"button",class:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600"},e[19]||(e[19]=[t("i",{class:"fa-solid fa-barcode"},null,-1)]))])]),t("div",ge,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Cari Nama Barang",-1)),t("div",ye,[f(t("input",{id:"item-search-input","onUpdate:modelValue":e[7]||(e[7]=s=>h.value=s),onKeydown:A,onBlur:O,type:"text",placeholder:"Ketik nama barang...",class:"w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500"},null,544),[[g,h.value]]),e[21]||(e[21]=t("div",{class:"absolute inset-y-0 right-0 flex items-center pr-3"},[t("i",{class:"fa-solid fa-search text-gray-400"})],-1))]),b.value&&d.value.length>0?(i(),u("div",_e,[(i(!0),u(_,null,w(d.value,(s,a)=>(i(),u("div",{key:s.item_id,onClick:r=>q(s),class:ee(["px-4 py-3 cursor-pointer border-b border-gray-100 hover:bg-blue-50 transition-colors",m.value===a?"bg-blue-100":""])},[t("div",xe,[t("div",ke,[t("h4",Ce,n(s.item_name),1),t("div",Se,[t("span",Ie,"Stok: "+n(s.qty_medium||0)+" "+n(s.unit_medium),1),t("span",Ee,"Harga: "+n(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(s.price)),1)])]),e[22]||(e[22]=t("div",{class:"text-right"},[t("span",{class:"text-xs text-gray-400"},"Enter untuk pilih")],-1))])],10,we))),128))])):Z("",!0)]),t("button",{onClick:M,disabled:x.value,class:"w-full bg-gradient-to-r from-blue-500 to-blue-700 text-white py-3 rounded-xl shadow-lg hover:shadow-2xl transition-all font-semibold disabled:opacity-60"},[x.value?(i(),u("span",je,"Menyimpan...")):(i(),u("span",qe,"Simpan Penjualan"))],8,Te)])]),t("div",De,[t("div",Be,[t("div",Pe,[e[25]||(e[25]=t("h2",{class:"text-xl font-bold text-gray-800"},"Item Penjualan",-1)),t("div",Ne," Total: "+n(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(T.value)),1)]),l.value.items.length===0?(i(),u("div",Ve,e[26]||(e[26]=[t("i",{class:"fa-solid fa-barcode text-4xl mb-4"},null,-1),t("p",null,"Scan barcode item untuk menambahkan ke penjualan",-1)]))):(i(),u("div",Ue,[(i(!0),u(_,null,w(l.value.items,(s,a)=>(i(),u("div",{key:a,class:"border border-gray-200 rounded-lg p-4"},[t("div",Ae,[t("div",Oe,[t("h3",Re,n(s.item_name),1),t("p",Fe,"Barcode: "+n(s.barcode),1),t("p",Ke,"Stok: "+n(s.stock.medium)+" "+n(s.units.medium),1)]),t("button",{onClick:r=>R(a),class:"text-red-500 hover:text-red-700"},e[27]||(e[27]=[t("i",{class:"fa-solid fa-trash"},null,-1)]),8,$e)]),t("div",Me,[t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Qty",-1)),f(t("input",{"onUpdate:modelValue":r=>s.qty=r,onInput:r=>k(a),type:"number",min:"1",class:"w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500"},null,40,We),[[g,s.qty,void 0,{number:!0}]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Unit",-1)),f(t("select",{"onUpdate:modelValue":r=>s.unit=r,onChange:r=>k(a),class:"w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500"},[t("option",{value:s.units.small},n(s.units.small),9,Xe),t("option",{value:s.units.medium},n(s.units.medium),9,He),t("option",{value:s.units.large},n(s.units.large),9,Le)],40,Je),[[C,s.unit]])]),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Harga",-1)),t("div",ze,[f(t("input",{"onUpdate:modelValue":r=>s.price=r,onInput:r=>k(a),type:"number",min:"0",step:"100",class:"flex-1 rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500"},null,40,Ge),[[g,s.price,void 0,{number:!0}]]),t("button",{onClick:r=>X(a),type:"button",class:"px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",title:"Refresh harga dari sistem"},e[30]||(e[30]=[t("i",{class:"fa-solid fa-sync-alt"},null,-1)]),8,Qe)])])]),t("div",Ye,[t("span",Ze," Subtotal: "+n(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(s.subtotal)),1)])]))),128))]))])])]),Q(se,{show:y.value,onClose:e[8]||(e[8]=s=>y.value=!1),onCustomerSelected:K,onCustomerCreated:$},null,8,["show"])])]),_:1}))}};export{ct as default};
