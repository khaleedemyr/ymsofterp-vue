import{$ as q,c as Y,r as m,W as C,w as Q,a as X,A as M,B as f,C as Z,D as t,E as G,x as O,G as w,H as E,J as $,L as x,F as z,M as N,N as y,l as ee}from"./vendor-vue-g7iCcTkf.js";import{l as te}from"./lodash-DB3HVzpp.js";import{a as P}from"./vendor-utils-CpgP2uT4.js";import{S as R}from"./app-DvUgkxHf.js";import{A as oe}from"./AppLayout-CCl6N_RX.js";import ae from"./Form-mF0-KQIP.js";import se from"./ModalDetailGoodReceive-CddjnnrK.js";import le from"./ModalEditGoodReceive-Dqu8Cxv2.js";import{E as ne}from"./jspdf.es.min-g7fk9MIf.js";import"./vendor-charts-CuqD4wLC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ProfileUpdateModal-oDgFzWKX.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";import"./Modal-BBL5yay4.js";import"./SecondaryButton-DMNVinm_.js";async function re({grNumber:g,date:v,supplier:_,items:p,receivedByName:d,poNumber:u,notes:r,showReprintLabel:k=!1}){let n=0;if(n+=15,n+=20,n+=8,n+=10,n+=8,p&&p.length?p.forEach(i=>{const c=i.name.length>20?Math.ceil(i.name.length/20):1;n+=c*3.5+4}):n+=8,r&&r.trim()){n+=4;const i=a.splitTextToSize(r,76).length;n+=i*3.5+4}n+=12,n+=15;const a=new ne({unit:"mm",format:[80,Math.max(297,n)]});let o=10;k&&(a.setFontSize(8),a.setFont(void 0,"normal"),a.text("reprint",78,7,{align:"right"})),a.setFontSize(13),a.setFont(void 0,"bold"),a.text("GOOD RECEIVE",40,o,{align:"center"}),o+=6,a.setFontSize(10),a.text("JUSTUS GROUP",40,o,{align:"center"}),o+=5,a.setFont(void 0,"normal"),a.setFontSize(9),a.text(`No: ${g}`,2,o),o+=4,a.text(`Tanggal: ${v}`,2,o),o+=4,a.text(`Supplier: ${_}`,2,o),o+=4,u&&(a.text(`PO: ${u}`,2,o),o+=4),d&&(a.text(`Petugas: ${d}`,2,o),o+=4),o+=1.5,a.setLineWidth(.5),a.line(2,o,78,o),o+=2.5,p&&p.length?p.forEach(i=>{const c=`${i.qty_received} ${i.unit_code||i.unit} ${i.name}`;a.splitTextToSize(c,76).forEach(S=>{a.text(S,2,o),o+=3.5}),o+=1.5}):(a.text("TIDAK ADA ITEM",2,o),o+=3.5),r&&r.trim()&&(o+=2,a.setFontSize(8),a.setFont(void 0,"bold"),a.text("Catatan:",2,o),o+=3.5,a.setFont(void 0,"normal"),a.splitTextToSize(r,76).forEach(c=>{a.text(c,2,o),o+=3.5})),o+=1.5,a.setLineWidth(.5),a.line(2,o,78,o),o+=2.5,a.text("Terima kasih",2,o),o+=8,a.output("dataurlnewwindow")}const ie={class:"w-full py-8 px-0"},de={class:"flex justify-between items-center mb-6"},ue={class:"flex gap-2"},ce=["href"],fe={class:"flex flex-wrap gap-3 mb-4 items-center"},pe={class:"bg-white rounded-2xl shadow-2xl overflow-x-auto transition-all"},xe={class:"w-full min-w-full divide-y divide-gray-200"},me={key:0},ge={class:"px-6 py-3 font-semibold"},be={class:"px-6 py-3"},ve={class:"px-6 py-3"},he={class:"px-6 py-3"},we={class:"px-6 py-3"},ye={class:"px-6 py-3"},ke={key:0,class:"max-w-xs"},_e=["title"],Se={key:1,class:"text-gray-400 text-sm italic"},Ce={class:"px-6 py-3"},Re={class:"flex gap-2"},Ge=["onClick"],Ee=["onClick","disabled"],$e={key:0,class:"fa fa-spinner fa-spin mr-1"},Te={key:1,class:"fa fa-print mr-1"},Fe=["onClick"],Be=["onClick"],De={class:"flex justify-end mt-4 gap-2"},Le=["disabled","onClick","innerHTML"],Xe={__name:"Index",props:{goodReceives:Object,filters:Object,canDelete:{type:Boolean,default:!1}},setup(g){var B,D,L;const v=g,_=q();Y(()=>{var l;return((l=_.props.auth)==null?void 0:l.user)||_.props.user});const p=m(!1),d=m(((B=v.filters)==null?void 0:B.from)||""),u=m(((D=v.filters)==null?void 0:D.to)||""),r=m(((L=v.filters)==null?void 0:L.search)||""),k=m(!1),n=m(!1),a=m(null),o=m(null),i=m(null),c=()=>{const l={search:r.value,from:d.value,to:u.value};sessionStorage.setItem("foodGoodReceiveFilters",JSON.stringify(l))},T=()=>{try{const l=sessionStorage.getItem("foodGoodReceiveFilters");if(l){const e=JSON.parse(l);r.value=e.search||"",d.value=e.from||"",u.value=e.to||""}}catch(l){console.error("Error restoring filter state:",l)}},S=te.debounce(()=>{c(),C.get("/food-good-receive",{search:r.value,from:d.value,to:u.value},{preserveState:!0,replace:!0})},400);Q([r,d,u],()=>{c()},{deep:!0});function F(){S()}function I(){S()}async function V(l){c();try{const e=await fetch(`/food-good-receive/${l}`);if(!e.ok)throw new Error("Gagal fetch detail");a.value=await e.json(),k.value=!0}catch{alert("Gagal mengambil detail Good Receive")}}async function j(l){c();try{const e=await fetch(`/food-good-receive/${l}`);if(!e.ok)throw new Error("Gagal fetch detail");o.value=await e.json(),n.value=!0}catch{alert("Gagal mengambil detail Good Receive")}}async function A(l){var s,b;if((await R.fire({title:"Yakin hapus data ini?",text:"Data Good Receive dan semua data inventory terkait akan dihapus permanen!",icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, hapus",cancelButtonText:"Batal",reverseButtons:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed)try{const h=await P.delete(`/food-good-receive/${l}`);if(h.data.success)await R.fire({icon:"success",title:"Berhasil!",text:"Good Receive berhasil dihapus",timer:2e3,showConfirmButton:!1}),C.get("/food-good-receive",{search:r.value,from:d.value,to:u.value},{preserveState:!0,replace:!0});else throw new Error(h.data.message||"Gagal menghapus data")}catch(h){console.error("Error deleting good receive:",h),await R.fire({icon:"error",title:"Gagal!",text:((b=(s=h.response)==null?void 0:s.data)==null?void 0:b.message)||h.message||"Terjadi kesalahan saat menghapus data",confirmButtonColor:"#3085d6"})}}function U(){k.value=!1,a.value=null}function H(){n.value=!1,o.value=null}function J(){n.value=!1,o.value=null,C.get("/food-good-receive",{search:r.value,from:d.value,to:u.value},{preserveState:!0,replace:!0})}function W(l){l&&(c(),C.get(l,{search:r.value,from:d.value,to:u.value},{preserveState:!0,replace:!0}))}async function K(l){i.value=l;try{const{data:e}=await P.get(`/api/food-good-receive/${l}/struk`);await re({...e,showReprintLabel:!0})}catch{await R.fire({icon:"error",title:"Gagal",text:"Gagal mengambil data struk. Coba lagi."})}finally{i.value=null}}return X(()=>{T(),c()}),(l,e)=>(f(),M(oe,null,{default:Z(()=>[t("div",ie,[t("div",de,[e[6]||(e[6]=t("h1",{class:"text-2xl font-bold text-gray-800 flex items-center gap-2"},[t("i",{class:"fa-solid fa-truck"}),w(" Good Receive ")],-1)),t("div",ue,[t("a",{href:l.route("food-good-receive.report"),class:"bg-gradient-to-r from-green-500 to-green-700 text-white px-4 py-2 rounded-xl shadow-lg hover:shadow-2xl transition-all font-semibold"},e[5]||(e[5]=[t("i",{class:"fa-solid fa-chart-bar mr-2"},null,-1),w(" Report ")]),8,ce),t("button",{onClick:e[0]||(e[0]=s=>p.value=!0),class:"bg-gradient-to-r from-blue-500 to-blue-700 text-white px-4 py-2 rounded-xl shadow-lg hover:shadow-2xl transition-all font-semibold"}," + Buat Good Receive ")])]),t("div",fe,[E(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>r.value=s),onInput:I,type:"text",placeholder:"Cari Nomor GR, PO, Supplier, Petugas, atau Keterangan...",class:"w-64 px-4 py-2 rounded-xl border border-blue-200 shadow focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition"},null,544),[[$,r.value]]),E(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=s=>d.value=s),onChange:F,class:"px-2 py-2 rounded-xl border border-blue-200 shadow focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition",placeholder:"Dari tanggal"},null,544),[[$,d.value]]),e[7]||(e[7]=t("span",null,"-",-1)),E(t("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=s=>u.value=s),onChange:F,class:"px-2 py-2 rounded-xl border border-blue-200 shadow focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition",placeholder:"Sampai tanggal"},null,544),[[$,u.value]])]),t("div",pe,[t("table",xe,[e[13]||(e[13]=t("thead",{class:"bg-gradient-to-r from-blue-50 to-blue-100"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider rounded-tl-2xl"},"Nomor GR"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Tanggal"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"No. PO"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Supplier"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Petugas"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider"},"Keterangan"),t("th",{class:"px-6 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider rounded-tr-2xl"},"Aksi")])],-1)),t("tbody",null,[!g.goodReceives.data||!g.goodReceives.data.length?(f(),x("tr",me,e[8]||(e[8]=[t("td",{colspan:"7",class:"text-center py-10 text-gray-400"},"Belum ada data Good Receive.",-1)]))):G("",!0),(f(!0),x(z,null,N(g.goodReceives.data,s=>(f(),x("tr",{key:s.id,class:"hover:bg-blue-50 transition shadow-sm"},[t("td",ge,y(s.gr_number),1),t("td",be,y(s.receive_date),1),t("td",ve,y(s.po_number),1),t("td",he,y(s.supplier_name),1),t("td",we,y(s.received_by_name),1),t("td",ye,[s.notes?(f(),x("div",ke,[t("div",{class:"text-sm text-gray-700 truncate",title:s.notes},y(s.notes),9,_e)])):(f(),x("div",Se," - "))]),t("td",Ce,[t("div",Re,[t("button",{onClick:b=>V(s.id),class:"inline-flex items-center btn btn-xs bg-blue-100 text-blue-800 hover:bg-blue-200 rounded px-2 py-1 font-semibold transition"},e[9]||(e[9]=[t("i",{class:"fa-solid fa-eye mr-1"},null,-1),w(" Detail ")]),8,Ge),t("button",{onClick:b=>K(s.id),disabled:i.value===s.id,class:"inline-flex items-center btn btn-xs bg-green-100 text-green-800 hover:bg-green-200 rounded px-2 py-1 font-semibold transition disabled:opacity-50"},[i.value===s.id?(f(),x("i",$e)):(f(),x("i",Te)),e[10]||(e[10]=w(" Reprint "))],8,Ee),t("button",{onClick:b=>j(s.id),class:"inline-flex items-center btn btn-xs bg-yellow-100 text-yellow-800 hover:bg-yellow-200 rounded px-2 py-1 font-semibold transition"},e[11]||(e[11]=[t("i",{class:"fa-solid fa-pen-to-square mr-1"},null,-1),w(" Edit ")]),8,Fe),v.canDelete?(f(),x("button",{key:0,onClick:b=>A(s.id),class:"inline-flex items-center btn btn-xs bg-red-100 text-red-700 hover:bg-red-200 rounded px-2 py-1 font-semibold transition"},e[12]||(e[12]=[t("i",{class:"fa-solid fa-trash mr-1"},null,-1),w(" Hapus ")]),8,Be)):G("",!0)])])]))),128))])])]),t("div",De,[(f(!0),x(z,null,N(g.goodReceives.links,s=>(f(),x("button",{key:s.label,disabled:!s.url,onClick:b=>W(s.url),innerHTML:s.label,class:ee(["px-3 py-1 rounded-lg border text-sm font-semibold",[s.active?"bg-blue-600 text-white shadow-lg":"bg-white text-blue-700 hover:bg-blue-50",s.url?"cursor-pointer":"opacity-50 cursor-not-allowed"]])},null,10,Le))),128))]),p.value?(f(),M(ae,{key:0,onClose:e[4]||(e[4]=s=>p.value=!1)})):G("",!0),O(se,{show:k.value,gr:a.value,onClose:U},null,8,["show","gr"]),O(le,{show:n.value,gr:o.value,onClose:H,onSuccess:J},null,8,["show","gr"])])]),_:1}))}};export{Xe as default};
