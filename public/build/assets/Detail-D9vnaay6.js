import{r as m,$ as de,c as b,a as ce,L as a,B as l,D as e,E as d,A as me,x as r,G as T,N as n,l as M,F as p,M as x,C as c,Q as u}from"./vendor-vue-g7iCcTkf.js";import{a as V}from"./vendor-utils-CpgP2uT4.js";import ve from"./CommentModal-By3cDhhF.js";import{A as fe}from"./AppLayout-Cg9_BqdS.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{Y as A,h as _,_ as R,G as z,S as B}from"./vendor-ui-CrPgGUUb.js";import"./CameraModal-UOq4SzNh.js";import"./app-CL3toCqm.js";import"./vendor-charts-CuqD4wLC.js";import"./ProfileUpdateModal-DcALjTaB.js";import"./InputLabel-Bg0AMQZ3.js";import"./PrimaryButton-BbBAD9SX.js";import"./TextInput-B7P_xVe4.js";const pe={class:"max-w-7xl mx-auto py-6"},xe={key:0,class:"text-center py-12"},ye={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-6"},be={class:"flex items-center"},_e={class:"text-red-700 mt-1"},he={key:2,class:"space-y-6"},ke={class:"bg-white rounded-lg shadow p-6"},we={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ce={class:"mt-1 text-sm text-gray-900"},Se={class:"mt-1 text-sm text-gray-900"},Te={class:"mt-1 text-sm text-gray-900"},De={class:"mt-1 text-sm text-gray-900"},Pe={class:"mt-4"},Ie={class:"mt-1 text-sm text-gray-900"},je={class:"bg-white rounded-lg shadow p-6"},Ee={class:"space-y-3"},Ne={class:"flex items-center"},$e={class:"text-sm font-medium text-gray-900"},Me={class:"text-xs text-gray-500 capitalize"},Ve={class:"bg-white rounded-lg shadow p-6"},Ae={key:0,class:"mb-6"},Re={key:0,class:"mb-4"},ze={class:"text-sm text-gray-600 mb-2"},Be={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},Le=["onClick"],Oe=["src","alt"],Fe={key:1,class:"mb-4"},Ge={class:"text-sm text-gray-600 mb-2"},We={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},Ye=["onClick"],Ke={class:"text-xs text-gray-600"},qe={key:1},He={class:"space-y-2"},Qe={class:"text-sm text-gray-900"},Ue={key:2,class:"text-center py-8 text-gray-500"},Je={class:"bg-white rounded-lg shadow p-6"},Xe={class:"flex justify-between items-center mb-4"},Ze={key:0,class:"space-y-4"},et={class:"flex justify-between items-start"},tt={class:"flex-1"},st={class:"flex items-center gap-2 mb-2"},lt={class:"font-medium text-gray-900"},at={class:"text-xs text-gray-500"},ot={class:"text-gray-700 mb-2"},it={key:0,class:"flex flex-wrap gap-2"},nt=["onClick"],rt={key:1,class:"text-center py-8 text-gray-500"},ut={class:"fixed inset-0 overflow-y-auto"},dt={class:"flex min-h-full items-center justify-center p-4"},ct=["src","alt"],mt={class:"fixed inset-0 overflow-y-auto"},vt={class:"flex min-h-full items-center justify-center"},ft={class:"relative aspect-video bg-black rounded-lg overflow-hidden"},gt=["src","alt"],pt=["src"],xt={class:"flex justify-center gap-2 mt-4"},yt=["onClick"],bt=["src","alt"],_t={key:1,class:"w-full h-full bg-gray-800 flex items-center justify-center"},ht={class:"fixed inset-0 overflow-y-auto"},kt={class:"flex min-h-full items-center justify-center p-4"},wt=["src"],Ct={layout:fe},St=Object.assign(Ct,{__name:"Detail",props:{id:String},setup(q){const k=q,i=m(null),D=m(!0),w=m(null),P=m([]),C=m(!1),I=m(!1),j=m(!1),E=m(!1),h=m(null),S=m(null),v=m(0),L=m(null),H=de(),Q=b(()=>{var o,t;return((t=(o=H.props.auth)==null?void 0:o.user)==null?void 0:t.id)||null}),f=b(()=>{var o;return(o=i.value)!=null&&o.media?i.value.media.reduce((t,s)=>(s.file_type&&s.file_type.startsWith("image/")?t.images.push({id:s.id,url:`/storage/${s.file_path}`,name:s.file_name||"Image",type:s.file_type}):s.file_type&&s.file_type.startsWith("video/")&&t.videos.push({id:s.id,url:`/storage/${s.file_path}`,name:s.file_name||"Video",type:s.file_type}),t),{images:[],videos:[]}):{images:[],videos:[]}}),U=b(()=>f.value.images.slice(0,4)),N=b(()=>{const o=f.value.images.map(s=>({...s,mediaType:"image"})),t=f.value.videos.map(s=>({...s,mediaType:"video"}));return[...o,...t]}),O=b(()=>N.value.length),y=b(()=>N.value[v.value]||{});async function F(){var o,t;try{D.value=!0,w.value=null;const s=await V.get(`/api/maintenance-order/${k.id}`);i.value=s.data,await $()}catch(s){console.error("Error loading task:",s),w.value=((t=(o=s.response)==null?void 0:o.data)==null?void 0:t.error)||"Failed to load task details"}finally{D.value=!1}}async function $(){try{const o=await V.get(`/api/maintenance-comments/${k.id}`);P.value=o.data}catch(o){console.error("Error loading comments:",o)}}async function J(o){try{await V.delete(`/api/maintenance-comments/${o}`),await $()}catch(t){console.error("Error deleting comment:",t)}}function X(){C.value=!1,$()}function Z(){window.location.href=`/maintenance-order/${k.id}/edit`}function ee(o){return{TASK:"To Do",PR:"Purchase Requisition",PO:"Purchase Order",IN_PROGRESS:"In Progress",IN_REVIEW:"In Review",DONE:"Done"}[o]||o}function te(o){return{TASK:"bg-gray-100 text-gray-800",PR:"bg-yellow-100 text-yellow-800",PO:"bg-blue-100 text-blue-800",IN_PROGRESS:"bg-purple-100 text-purple-800",IN_REVIEW:"bg-orange-100 text-orange-800",DONE:"bg-green-100 text-green-800"}[o]||"bg-gray-100 text-gray-800"}function se(o){return{Low:"bg-green-100 text-green-800",Medium:"bg-yellow-100 text-yellow-800",High:"bg-red-100 text-red-800",Critical:"bg-purple-100 text-purple-800"}[o]||"bg-gray-100 text-gray-800"}function G(o){return new Date(o).toLocaleDateString("id-ID")}function le(o){h.value=o,I.value=!0}function W(){I.value=!1,h.value=null}function ae(o,t){v.value=t,j.value=!0}function Y(){j.value=!1,v.value=0}function oe(){v.value>0&&v.value--}function ie(){v.value<O.value-1&&v.value++}function ne(o){v.value=o}function re(o){S.value=o,E.value=!0}function K(){E.value=!1,S.value=null}return ce(()=>{F(),document.title="Task Detail - YMSoft"}),(o,t)=>(l(),a("div",pe,[e("div",{class:"flex justify-between items-center mb-6"},[t[5]||(t[5]=e("h1",{class:"text-2xl font-bold text-blue-900"},"Task Detail",-1)),e("div",{class:"flex gap-3"},[t[4]||(t[4]=e("a",{href:"/maintenance-order/list",class:"btn-secondary"},[e("i",{class:"fas fa-arrow-left mr-2"}),T(" Back to List ")],-1)),e("button",{onClick:Z,class:"btn-primary"},t[3]||(t[3]=[e("i",{class:"fas fa-edit mr-2"},null,-1),T(" Edit Task ")]))])]),D.value?(l(),a("div",xe,t[6]||(t[6]=[e("i",{class:"fas fa-spinner fa-spin text-4xl text-blue-600"},null,-1),e("p",{class:"mt-4 text-gray-600"},"Loading task details...",-1)]))):w.value?(l(),a("div",ye,[e("div",be,[t[8]||(t[8]=e("i",{class:"fas fa-exclamation-triangle text-red-600 text-xl mr-3"},null,-1)),e("div",null,[t[7]||(t[7]=e("h3",{class:"text-lg font-medium text-red-800"},"Error Loading Task",-1)),e("p",_e,n(w.value),1)])]),e("div",{class:"mt-4"},[e("button",{onClick:F,class:"btn-primary"},t[9]||(t[9]=[e("i",{class:"fas fa-redo mr-2"},null,-1),T(" Try Again ")]))])])):i.value?(l(),a("div",he,[e("div",ke,[t[17]||(t[17]=e("h2",{class:"text-xl font-semibold text-gray-900 mb-4"},"Task Information",-1)),e("div",we,[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700"},"Task Number",-1)),e("p",Ce,n(i.value.task_number),1)]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700"},"Status",-1)),e("span",{class:M([te(i.value.status),"mt-1 inline-block px-2 py-1 text-xs font-medium rounded-full"])},n(ee(i.value.status)),3)]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700"},"Title",-1)),e("p",Se,n(i.value.title),1)]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700"},"Priority",-1)),e("span",{class:M([se(i.value.priority_name),"mt-1 inline-block px-2 py-1 text-xs font-medium rounded-full"])},n(i.value.priority_name),3)]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700"},"Category",-1)),e("p",Te,n(i.value.label_name),1)]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700"},"Due Date",-1)),e("p",De,n(G(i.value.due_date)),1)])]),e("div",Pe,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700"},"Description",-1)),e("p",Ie,n(i.value.description),1)])]),e("div",je,[t[19]||(t[19]=e("h2",{class:"text-xl font-semibold text-gray-900 mb-4"},"Team Members",-1)),e("div",Ee,[(l(!0),a(p,null,x(i.value.members,s=>(l(),a("div",{key:s.id,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[e("div",Ne,[t[18]||(t[18]=e("div",{class:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3"},[e("i",{class:"fas fa-user text-blue-600"})],-1)),e("div",null,[e("p",$e,n(s.nama_lengkap),1),e("p",Me,n(s.role),1)])])]))),128))])]),e("div",Ve,[t[25]||(t[25]=e("h2",{class:"text-xl font-semibold text-gray-900 mb-4"},"Attachments",-1)),i.value.media&&i.value.media.length>0?(l(),a("div",Ae,[t[21]||(t[21]=e("h3",{class:"text-lg font-medium text-gray-800 mb-3"},"Media Files",-1)),f.value.images.length>0?(l(),a("div",Re,[e("div",ze,"Photos ("+n(f.value.images.length)+")",1),e("div",Be,[(l(!0),a(p,null,x(U.value,(s,g)=>(l(),a("div",{key:s.id,class:"w-20 h-20 rounded-lg border cursor-pointer overflow-hidden hover:shadow-md transition-shadow",onClick:ue=>le(s)},[e("img",{src:s.url,alt:s.name,class:"w-full h-full object-cover"},null,8,Oe)],8,Le))),128)),f.value.images.length>4?(l(),a("div",{key:0,class:"w-20 h-20 rounded-lg border bg-gray-100 flex items-center justify-center text-xs text-gray-600 cursor-pointer hover:shadow-md transition-shadow",onClick:t[0]||(t[0]=s=>ae("image",4))}," +"+n(f.value.images.length-4),1)):d("",!0)])])):d("",!0),f.value.videos.length>0?(l(),a("div",Fe,[e("div",Ge,"Videos ("+n(f.value.videos.length)+")",1),e("div",We,[(l(!0),a(p,null,x(f.value.videos,s=>(l(),a("div",{key:s.id,class:"w-20 h-20 rounded-lg bg-gray-100 flex items-center justify-center cursor-pointer relative group hover:shadow-md transition-shadow",onClick:g=>re(s)},[t[20]||(t[20]=e("div",{class:"absolute inset-0 bg-black/40 group-hover:bg-black/60 flex items-center justify-center transition-all rounded-lg"},[e("i",{class:"fas fa-play text-white text-xl"})],-1)),e("span",Ke,n(s.name),1)],8,Ye))),128))])])):d("",!0)])):d("",!0),i.value.documents&&i.value.documents.length>0?(l(),a("div",qe,[t[23]||(t[23]=e("h3",{class:"text-lg font-medium text-gray-800 mb-3"},"Documents",-1)),e("div",He,[(l(!0),a(p,null,x(i.value.documents,s=>(l(),a("div",{key:s.id,class:"flex items-center p-3 bg-gray-50 rounded-lg"},[t[22]||(t[22]=e("i",{class:"fas fa-file-alt text-blue-600 mr-3"},null,-1)),e("span",Qe,n(s.file_name||"Document"),1)]))),128))])])):d("",!0),(!i.value.media||i.value.media.length===0)&&(!i.value.documents||i.value.documents.length===0)?(l(),a("div",Ue,t[24]||(t[24]=[e("i",{class:"fas fa-paperclip text-4xl mb-3"},null,-1),e("p",null,"No attachments found",-1)]))):d("",!0)]),e("div",Je,[e("div",Xe,[t[27]||(t[27]=e("h2",{class:"text-xl font-semibold text-gray-900"},"Comments",-1)),e("button",{onClick:t[1]||(t[1]=s=>C.value=!0),class:"btn-primary"},t[26]||(t[26]=[e("i",{class:"fas fa-plus mr-2"},null,-1),T(" Add Comment ")]))]),P.value.length>0?(l(),a("div",Ze,[(l(!0),a(p,null,x(P.value,s=>(l(),a("div",{key:s.id,class:"border-l-4 border-blue-500 pl-4 py-3"},[e("div",et,[e("div",tt,[e("div",st,[e("span",lt,n(s.user_name),1),e("span",at,n(G(s.created_at)),1)]),e("p",ot,n(s.comment),1),s.attachments&&s.attachments.length>0?(l(),a("div",it,[(l(!0),a(p,null,x(s.attachments,g=>(l(),a("div",{key:g.id,class:"flex items-center gap-1 text-xs text-blue-600"},[t[28]||(t[28]=e("i",{class:"fas fa-paperclip"},null,-1)),e("span",null,n(g.file_name),1)]))),128))])):d("",!0)]),s.user_id===Q.value?(l(),a("button",{key:0,onClick:g=>J(s.id),class:"text-red-600 hover:text-red-800 text-sm",title:"Delete comment"},t[29]||(t[29]=[e("i",{class:"fas fa-trash"},null,-1)]),8,nt)):d("",!0)])]))),128))])):(l(),a("div",rt,t[30]||(t[30]=[e("i",{class:"fas fa-comments text-4xl mb-3"},null,-1),e("p",null,"No comments yet. Be the first to comment!",-1)])))])])):d("",!0),C.value?(l(),me(ve,{key:3,"task-id":k.id,onClose:t[2]||(t[2]=s=>C.value=!1),onCommentAdded:X},null,8,["task-id"])):d("",!0),r(u(B),{appear:"",show:I.value,as:"template"},{default:c(()=>[r(u(A),{as:"div",onClose:W,class:"relative z-50"},{default:c(()=>[r(u(_),{enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:c(()=>[r(u(R),{class:"fixed inset-0 bg-black/75"})]),_:1}),e("div",ut,[e("div",dt,[r(u(_),{enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:c(()=>[r(u(z),{class:"relative bg-white rounded-lg max-w-3xl"},{default:c(()=>[e("button",{onClick:W,class:"absolute -top-10 right-0 text-white hover:text-gray-300"},t[31]||(t[31]=[e("i",{class:"fas fa-times text-xl"},null,-1)])),h.value?(l(),a("img",{key:0,src:h.value.url,alt:h.value.name,class:"rounded-lg"},null,8,ct)):d("",!0)]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]),r(u(B),{appear:"",show:j.value,as:"template"},{default:c(()=>[r(u(A),{as:"div",onClose:Y,class:"relative z-50"},{default:c(()=>[r(u(_),{enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:c(()=>[r(u(R),{class:"fixed inset-0 bg-black/90"})]),_:1}),e("div",mt,[e("div",vt,[r(u(_),{enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:c(()=>[r(u(z),{class:"relative w-full max-w-4xl p-4"},{default:c(()=>[v.value>0?(l(),a("button",{key:0,onClick:oe,class:"absolute left-4 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 z-10"},t[32]||(t[32]=[e("i",{class:"fas fa-chevron-left text-3xl"},null,-1)]))):d("",!0),v.value<O.value-1?(l(),a("button",{key:1,onClick:ie,class:"absolute right-4 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 z-10"},t[33]||(t[33]=[e("i",{class:"fas fa-chevron-right text-3xl"},null,-1)]))):d("",!0),e("button",{onClick:Y,class:"absolute top-4 right-4 text-white hover:text-gray-300 z-10"},t[34]||(t[34]=[e("i",{class:"fas fa-times text-xl"},null,-1)])),e("div",ft,[y.value.mediaType==="image"?(l(),a("img",{key:0,src:y.value.url,alt:y.value.name,class:"w-full h-full object-contain"},null,8,gt)):y.value.mediaType==="video"?(l(),a("video",{key:1,src:y.value.url,ref:s=>{y.value.mediaType==="video"&&(L.value=s)},controls:"",class:"w-full h-full"},null,8,pt)):d("",!0)]),e("div",xt,[(l(!0),a(p,null,x(N.value,(s,g)=>(l(),a("button",{key:s.id,onClick:ue=>ne(g),class:M(["w-16 h-12 rounded overflow-hidden border-2",v.value===g?"border-white":"border-transparent"])},[s.mediaType==="image"?(l(),a("img",{key:0,src:s.url,alt:s.name,class:"w-full h-full object-cover"},null,8,bt)):(l(),a("div",_t,t[35]||(t[35]=[e("i",{class:"fas fa-play text-white"},null,-1)])))],10,yt))),128))])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]),r(u(B),{appear:"",show:E.value,as:"template"},{default:c(()=>[r(u(A),{as:"div",onClose:K,class:"relative z-50"},{default:c(()=>[r(u(_),{enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:c(()=>[r(u(R),{class:"fixed inset-0 bg-black/75"})]),_:1}),e("div",ht,[e("div",kt,[r(u(_),{enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:c(()=>[r(u(z),{class:"relative bg-black rounded-lg overflow-hidden max-w-3xl"},{default:c(()=>[e("button",{onClick:K,class:"absolute top-4 right-4 text-white hover:text-gray-300 z-10"},t[36]||(t[36]=[e("i",{class:"fas fa-times text-xl"},null,-1)])),S.value?(l(),a("video",{key:0,src:S.value.url,ref_key:"videoPlayer",ref:L,controls:"",class:"w-full"},null,8,wt)):d("",!0)]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])]))}}),Bt=ge(St,[["__scopeId","data-v-b1f6f1ec"]]);export{Bt as default};
