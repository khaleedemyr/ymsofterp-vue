ğŸ”— ALUR JOIN DARI GOOD RECEIVE KE FLOOR ORDER

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           GOOD RECEIVE (GR) FLOW                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1ï¸âƒ£ OUTLET FOOD GOOD RECEIVES (gr)
   â”œâ”€â”€ id (PK)
   â”œâ”€â”€ outlet_id â†’ tbl_data_outlet
   â”œâ”€â”€ delivery_order_id â†’ delivery_orders
   â”œâ”€â”€ receive_date
   â””â”€â”€ deleted_at

2ï¸âƒ£ OUTLET FOOD GOOD RECEIVE ITEMS (i)
   â”œâ”€â”€ id (PK)
   â”œâ”€â”€ outlet_food_good_receive_id â†’ gr.id
   â”œâ”€â”€ item_id â†’ items
   â”œâ”€â”€ unit_id â†’ units
   â”œâ”€â”€ received_qty â† QUANTITY YANG DI-RECEIVE
   â””â”€â”€ (TIDAK ADA HARGA DI SINI!)

3ï¸âƒ£ ITEMS (it)
   â”œâ”€â”€ id (PK)
   â”œâ”€â”€ name
   â”œâ”€â”€ sub_category_id â†’ sub_categories
   â”œâ”€â”€ warehouse_division_id â†’ warehouse_division
   â””â”€â”€ (TIDAK ADA HARGA DI SINI!)

4ï¸âƒ£ DELIVERY ORDERS (do)
   â”œâ”€â”€ id (PK)
   â”œâ”€â”€ floor_order_id â†’ food_floor_orders â† KUNCI UNTUK DAPAT HARGA!
   â””â”€â”€ (Mengacu ke Floor Order)

5ï¸âƒ£ FOOD FLOOR ORDER ITEMS (fo) â† SUMBER HARGA!
   â”œâ”€â”€ id (PK)
   â”œâ”€â”€ floor_order_id â†’ food_floor_orders
   â”œâ”€â”€ item_id â†’ items
   â”œâ”€â”€ price â† HARGA ADA DI SINI!
   â””â”€â”€ (Harga ditetapkan saat Floor Order dibuat)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              JOIN SEQUENCE                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

gr.id = i.outlet_food_good_receive_id
    â†“
i.item_id = it.id
    â†“
it.sub_category_id = sc.id
    â†“
i.unit_id = u.id
    â†“
gr.delivery_order_id = do.id
    â†“
i.item_id = fo.item_id AND fo.floor_order_id = do.floor_order_id â† KEY JOIN!
    â†“
it.warehouse_division_id = wd.id (LEFT JOIN)
    â†“
wd.warehouse_id = w.id (LEFT JOIN)
    â†“
gr.outlet_id = o.id_outlet

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              FINAL CALCULATION                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SUBTOTAL = i.received_qty Ã— fo.price

KATEGORI berdasarkan:
â”œâ”€â”€ w.name (warehouse): MK1, MK2, MAIN STORE
â””â”€â”€ sc.name (sub_category): Chemical, Stationary, Marketing, dll

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              WHY THIS JOIN?                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â“ MENGAPA HARUS JOIN KE FLOOR ORDER?
âœ… Karena harga disimpan di Floor Order Items, bukan di GR Items
âœ… GR Items hanya menyimpan quantity yang benar-benar di-receive
âœ… Harga sudah ditetapkan saat Floor Order dibuat (sebelum delivery)

â“ MENGAPA TIDAK LANGSUNG DARI ITEMS KE FLOOR ORDER?
âœ… Karena 1 item bisa punya harga berbeda di floor order yang berbeda
âœ… Perlu memastikan floor order yang sama dengan delivery order

â“ MENGAPA PERLU DELIVERY ORDERS?
âœ… Delivery Orders adalah jembatan antara GR dan Floor Order
âœ… GR dibuat berdasarkan Delivery Order
âœ… Delivery Order mengacu ke Floor Order

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              POTENTIAL ISSUES                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âš ï¸  MISSING FLOOR ORDER ITEMS
    â†’ Item di GR tidak ada di Floor Order
    â†’ Solusi: LEFT JOIN + COALESCE(fo.price, 0)

âš ï¸  WRONG FLOOR ORDER REFERENCE
    â†’ delivery_order.floor_order_id salah
    â†’ Solusi: Validasi data integrity

âš ï¸  MULTIPLE FLOOR ORDER ITEMS
    â†’ Duplikasi item di floor order
    â†’ Solusi: Unique constraint di database

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              EXAMPLE DATA FLOW                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Floor Order #100:
â”œâ”€â”€ Item A: Price 10,000
â””â”€â”€ Item B: Price 15,000

Delivery Order #200 (floor_order_id: 100):
â””â”€â”€ Mengacu ke Floor Order #100

Good Receive #300 (delivery_order_id: 200):
â”œâ”€â”€ Item A: Qty 5
â””â”€â”€ Item B: Qty 3

RESULT:
â”œâ”€â”€ Item A: 5 Ã— 10,000 = 50,000
â””â”€â”€ Item B: 3 Ã— 15,000 = 45,000
TOTAL: 95,000
